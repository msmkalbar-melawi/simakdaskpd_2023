<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * Controller master data kegiatan
 */

class Tukd extends CI_Controller {


	public $ppkd1 = "4.02.02.01";
	public $ppkd2 = "4.02.02.02";
	
	function __contruct()
	{	
		parent::__construct();
  
	}
	
	function load_ttd_skpd($ttd="",$kd_skpd2=""){
        
		$sql = "SELECT * FROM ms_ttd WHERE kd_skpd= '$kd_skpd2' and kode IN ('$ttd','KPA')";
		
        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }  
		
		echo json_encode($result);
        $mas->free_result();
    	   
	}

	 function dth()
    {
        $data['page_title']= 'CETAK DTH';
        $this->template->set('title', 'CETAK DTH');   
        $this->template->load('template','tukd/transaksi/dth',$data) ; 
    }
	
	function cetak_dth($lcskpd='',$nbulan='',$ctk=''){
        $nomor = str_replace('123456789',' ',$this->uri->segment(6));
        $nip2 = str_replace('123456789',' ',$this->uri->segment(7));
        $tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($this->uri->segment(8));
        $atas = $this->uri->segment(9);
        $bawah = $this->uri->segment(10);
        $kiri = $this->uri->segment(11);
        $kanan = $this->uri->segment(12);
        $tglawal = $this->uri->segment(13);
        $tglakhir = $this->uri->segment(14);

        

        if(strlen($nbulan)>2){
            $oke= str_replace('mantapjiwatenan','\' and a.tgl_bukti <=\' ', $nbulan);
            $okelagi="'$oke'";
            $nbulan=" (a.tgl_bukti >= $okelagi) ";
            $xbulan="";
        }else{
            $xbulan=strtoupper($this->tukd_model->getBulan($nbulan));
            $oke=$nbulan;
            $nbulan =" MONTH (a.tgl_bukti) = '$nbulan' ";
        }
        if($ctk==13){
            $mbahmu="";
            
        } else {
            $mbahmu=" and b.kd_skpd = '$lcskpd' ";
            
        }
            $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
            $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$lcskpd'";
                     $sqlsclient=$this->db->query($sqlsc);
                     foreach ($sqlsclient->result() as $rowsc)
                     {
                        $kab     = $rowsc->kab_kota;
                        $prov     = $rowsc->provinsi;
                        $daerah  = $rowsc->daerah;
                        $thn     = $rowsc->thn_ang;
                     }           

             $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip2'";
                     $sqlttd=$this->db->query($sqlttd1);
                     foreach ($sqlttd->result() as $rowttd)
                    {
                        $nip=$rowttd->nip;                    
                        $nama= $rowttd->nm;
                        $jabatan  = $rowttd->jab;
                        $pangkat  = $rowttd->pangkat;
                    }

            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip = '$nomor'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }

                if($ctk==13){
                    $ntaps ='';
                } else{
                     $ntaps ='<TABLE style="border-collapse:collapse; font-size:14px" width="100%">
                     <TR>
                        <TD align="left" width="20%" >OPD</TD>
                        <TD align="left" width="100%" >: '.$lcskpd.' '.$skpd.'</TD>
                     </TR>
             
                     </TABLE>';
                }
        
            $cRet ='<TABLE style="border-collapse:collapse; font-size:14px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
                    <TR>
                        <TD align="center" ><b>'.$prov.' </TD>
                    </TR>
                    <tr></tr>
                    <TR>
                        <TD align="center" ><b>DAFTAR TRANSAKSI HARIAN BELANJA DAERAH (DTH) <br>
                                             '.$xbulan.'</TD>
                    </TR>
                    </TABLE><br/>';

                    $cRet .="$ntaps";

            $cRet .='<TABLE style="border-collapse:collapse; font-size:14px" width="100%" border="1" cellspacing="2" cellpadding="2" align="center">
                     <thead>
                     <TR>
                        <TD rowspan="2" width="80" bgcolor="#CCCCCC" align="center" >No.</TD>
                        <TD colspan="2" width="90"  bgcolor="#CCCCCC" align="center" >SPM/SPD</TD>
                        <TD colspan="2" width="150"  bgcolor="#CCCCCC" align="center" >SP2D </TD>
                        <TD rowspan="2" width="150" bgcolor="#CCCCCC" align="center" >Akun Belanja</TD>
                        <TD colspan="3" width="150" bgcolor="#CCCCCC" align="center" >Potongan Pajak</TD>
                        <TD rowspan="2" width="150" bgcolor="#CCCCCC" align="center" >NPWP</TD>
                        <TD rowspan="2" width="150" bgcolor="#CCCCCC" align="center" >Nama Rekanan</TD>
                        <TD rowspan="2" width="80" bgcolor="#CCCCCC" align="center" >NTPN</TD>
                        <TD rowspan="2" width="150" bgcolor="#CCCCCC" align="center" >Ket</TD>
                     </TR>
                     <TR>
                        <TD width="90"  bgcolor="#CCCCCC" align="center" >No. SPM</TD>
                        <TD width="150"  bgcolor="#CCCCCC" align="center" >Nilai Belanja(Rp)</TD>                       
                        <TD width="150"  bgcolor="#CCCCCC" align="center" >No. SP2D </TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" >Nilai Belanja (Rp)</TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" >Akun Potongan</TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" >Jenis</TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" >jumlah (Rp)</TD>
                     </TR>
                     </thead>
                     ';
            
            
                /* $query = $this->db->query("select 1 urut, c.no_spm,c.nilai,c.no_sp2d,x.nil_trans as nilai_belanja,'' no_bukti,'' kode_belanja,
                    '' as kd_rek5,'' as jenis_pajak,0 as nilai_pot,'' as npwp,
                    '' as nmrekan,z.banyak, ''ket,c.jns_spp, '' ntpn
                    FROM trhstrpot a  
                    INNER JOIN trdstrpot b 
                    ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
                    LEFT JOIN trhsp2d c 
                    ON a.kd_skpd=c.kd_skpd AND a.no_sp2d=c.no_sp2d
                    LEFT JOIN 
                    (SELECT b.kd_skpd, a.no_sp2d, SUM(a.nilai) as nil_trans FROM trdtransout a 
                    INNER JOIN trhtransout b ON a.kd_skpd=b.kd_skpd AND a.no_bukti=b.no_bukti
                    WHERE b.kd_skpd='$lcskpd'
                    GROUP BY b.kd_skpd, a.no_sp2d) x
                    ON a.kd_skpd=x.kd_skpd AND a.no_sp2d=x.no_sp2d
                    LEFT JOIN 
                    (SELECT b.kd_skpd,b.no_sp2d, COUNT(b.no_sp2d) as banyak
                    FROM trdstrpot a JOIN trhstrpot b ON a.no_bukti = b.no_bukti and a.kd_skpd=b.kd_skpd
                    WHERE b.kd_skpd = '$lcskpd' AND month(b.tgl_bukti)='$nbulan' 
                    GROUP BY b.kd_skpd,b.no_sp2d)z 
                    ON a.kd_skpd=z.kd_skpd and a.no_sp2d=z.no_sp2d
                    WHERE a.kd_skpd = '$lcskpd' AND month(a.tgl_bukti)='$nbulan'
                    GROUP BY c.no_spm,c.nilai,c.no_sp2d,x.nil_trans,z.banyak,c.jns_spp
                    UNION ALL
                    SELECT 2 as urut, '' as no_spm,0 as nilai,b.no_sp2d as no_sp2d,0 as nilai_belanja,
                    a.no_bukti, kd_kegiatan+'.'+a.kd_rek_trans as kode_belanja,RTRIM(a.kd_rek5),'' as jenis_pajak,a.nilai as nilai_pot,a.npwp,
                    rekanan nmrekan,0 banyak, 'No Set: '+a.no_bukti as ket,'' jns_spp, a.ntpn
                    FROM trdstrpot a JOIN trhstrpot b ON a.no_bukti = b.no_bukti and a.kd_skpd=b.kd_skpd
                    WHERE b.kd_skpd = '$lcskpd' AND month(b.tgl_bukti)='$nbulan'
                    ORDER BY no_sp2d,urut,no_spm,kode_belanja,kd_rek5");   */ 
                
                $query = $this->db->query("SELECT 1 urut, p.no_spm, p.nil_spm nilai, p.no_sp2d, p.nil_sp2d nilai_belanja, '' no_bukti, '' kode_belanja, '' kd_rek5,
       '' as jenis_pajak,0 as nilai_pot, (select npwp from trhspm WHERE no_spm=p.no_spm) npwp, p.nmrekan as nmrekan, '' ket,p.jns_spp, '' ntpn 
                                    FROM (
                                    SELECT x.kd_skpd, x.no_sp2d, y.no_spm, x.pot, y.nil_spm, y.nil_sp2d, y.jns_spp,y.nmrekan FROM (
                                    SELECT b.kd_skpd, a.no_sp2d, SUM(b.nilai) pot 
                                    FROM trhstrpot a INNER JOIN trdstrpot b ON a.kd_skpd=b.kd_skpd AND a.no_bukti=b.no_bukti
                                    WHERE $nbulan $mbahmu
                                    GROUP BY b.kd_skpd, a.no_sp2d ) x
                                    LEFT JOIN
                                    (
                                    SELECT d.kd_skpd, d.no_spm, c.nilai nil_spm, d.no_sp2d, d.nilai nil_sp2d, d.jns_spp, c.nmrekan   
                                    FROM trdspp a INNER JOIN trhspp b
                                    ON a.no_spp = b.no_spp AND a.kd_skpd = b.kd_skpd
                                    INNER JOIN trhspm c 
                                    ON b.no_spp = c.no_spp AND a.kd_skpd = c.kd_skpd
                                    INNER JOIN trhsp2d d
                                    on c.no_spm = d.no_spm AND c.kd_skpd=d.kd_skpd
                                    WHERE (d.sp2d_batal=0 OR d.sp2d_batal is NULL) and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
                                    GROUP BY d.kd_skpd,d.no_spm, d.no_sp2d, c.nilai, d.nilai, d.jns_spp,c.nmrekan) y
                                    ON x.kd_skpd=y.kd_skpd AND x.no_sp2d=y.no_sp2d ) p
                                    UNION ALL

                                    SELECT 2 as urut, '' as no_spm,0 as nilai,p.no_sp2d,0 as nilai_belanja,
                                                        p.no_bukti, p.kode_belanja,p.kd_rek5,'' as jenis_pajak,p.pot as nilai_pot,p.npwp,
                                                        rekanan nmrekan,    case when p.jns_spp='6' or p.jns_spp='5' or  p.jns_spp='4' then p.keperluan else 
                                    'No Set: ' + p.no_bukti end AS ket, p.jns_spp, p.ntpn
                                    FROM (
                                    SELECT x.*, y.keperluan FROM (
                                    SELECT b.kd_skpd, b.no_bukti, a.kd_kegiatan+'.'+b.kd_rek_trans kode_belanja, 
                                           RTRIM(b.kd_rek5) kd_rek5, a.no_sp2d, b.nilai pot, b.rekanan, b.npwp, b.ntpn, a.jns_spp  
                                    FROM trhstrpot a INNER JOIN trdstrpot b ON a.kd_skpd=b.kd_skpd AND a.no_bukti=b.no_bukti
                                    WHERE $nbulan $mbahmu ) x
                                    LEFT JOIN
                                    (
                                    SELECT d.kd_skpd, d.no_spm, c.nilai nil_spm, d.no_sp2d, d.nilai nil_sp2d, d.jns_spp, b.keperluan    
                                    FROM trdspp a INNER JOIN trhspp b
                                    ON a.no_spp = b.no_spp AND a.kd_skpd = b.kd_skpd
                                    INNER JOIN trhspm c 
                                    ON b.no_spp = c.no_spp AND a.kd_skpd = c.kd_skpd
                                    INNER JOIN trhsp2d d
                                    on c.no_spm = d.no_spm AND c.kd_skpd=d.kd_skpd
                                    WHERE (d.sp2d_batal=0 OR d.sp2d_batal is NULL) and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
                                    GROUP BY d.kd_skpd,d.no_spm, d.no_sp2d, c.nilai, d.nilai, d.jns_spp,b.keperluan) y
                                    ON x.kd_skpd=y.kd_skpd AND x.no_sp2d=y.no_sp2d ) p
                                    where p.kd_rek5 in ('2110301','2130101','2130201','2130301','2130401','2130501')
                                    ORDER BY no_sp2d,urut,no_spm,kode_belanja,kd_rek5");

                
                $lcno=0;
                $tot_nilai=0;
                $tot_nilai_belanja=0;
                $tot_nilai_pot=0;
                foreach ($query->result() as $row) {
                    $no_spm = $row->no_spm; 
                    $nilai = $row->nilai;    
                    $nilai_belanja =$row->nilai_belanja;
                    $no_sp2d = $row->no_sp2d;
                    $jns_spp = $row->jns_spp;
                    if($jns_spp=='2'){
                    $nilai_belanja =$nilai; 
                    }
                    $kode_belanja=$row->kode_belanja;
                    $kd_rek5 = $row->kd_rek5;
                    $jenis_pajak = $row->jenis_pajak;
                    $nilai_pot = $row->nilai_pot;
                    $npwp = $row->npwp;
                    $ntpn = $row->ntpn;
                    $nmrekan  = $row->nmrekan;
                    $ket  = $row->ket;
                    
                    if (($row->urut)==1){
                           $lcno = $lcno + 1;
                       } 
                    
                    if($kd_rek5=='2130301'){
                        $kd_rek5='411211';
                        $jenis_pajak='PPn';
                    }
                    if($kd_rek5=='2130101'){
                        $kd_rek5='411121';
                        $jenis_pajak='PPh 21';
                    }
                    if($kd_rek5=='2130201'){
                        $kd_rek5='411122';
                        $jenis_pajak='PPh 22';
                    }
                    if($kd_rek5=='2130401'){
                        $kd_rek5='411124';
                        $jenis_pajak='PPh 23';
                    }
                    if($kd_rek5=='2130501'){
                        $kd_rek5='411128';
                        $jenis_pajak='PPh 4';
                    }
                    if($kd_rek5=='2130601'){
                        $kd_rek5='411128';
                        $jenis_pajak='PPh 4 Ayat (2)';
                    }
					if($kd_rek5=='2110301'){
                        $kd_rek5='411128';
                        $jenis_pajak='PPh Pusat';
                    }
                    
                if (($row->urut)==1){
                            $cRet.='<TR>
                                <TD width="80" valign="top" align="center">'.$lcno.'</TD>
                                <TD width="90" valign="top" >'.$no_spm.'</TD>
                                <TD width="150" valign="top" align="right" >'.number_format($nilai,'2','.',',').'</TD>                              
                                <TD width="150" valign="top" >'.$no_sp2d.'</TD>
                                <TD width="150" valign="top" align="right" >'.number_format($nilai_belanja,'2','.',',').'</TD>
                                <TD width="150" align="right" ></TD>
                                <TD width="150" align="left" ></TD>
                                <TD width="150" align="left" ></TD>
                                <TD width="150" align="left" ></TD>
                                <TD width="150" align="left" >'.$npwp.'</TD>
                                <TD width="150" align="left" >'.$nmrekan.'</TD>
                                <TD width="150" align="left" ></TD>
                                <TD width="150" valign="top" align="left" > </TD>
                             </TR>';    
                        } else{
                            $cRet.='<TR>
                                <TD align="right" style="border-top:hidden;" ></TD>
                                <TD align="right" style="border-top:hidden;" ></TD>
                                <TD align="right" style="border-top:hidden;"></TD>
                                <TD align="right" style="border-top:hidden;"></TD>
                                <TD align="right" style="border-top:hidden;"></TD>
                                <TD width="150" valign="top" align="left"  style="border-top:hidden;">'.$kode_belanja.'</TD>
                                <TD width="150" valign="top" align="center"  style="border-top:hidden;">'.$kd_rek5.'</TD>
                                <TD width="150" valign="top" align="left"  style="border-top:hidden;">'.$jenis_pajak.'</TD>
                                <TD width="150" valign="top" align="right" style="border-top:hidden;" >'.number_format($nilai_pot,'2','.',',').'</TD>
                                <TD width="150" valign="top" align="left"  style="border-top:hidden;">'.$npwp.'</TD>
                                <TD width="150" valign="top" align="left"  style="border-top:hidden;">'.$nmrekan.'</TD>
                                <TD align="right" style="border-top:hidden;">'.$ntpn.'</TD>
                                <TD style="border-top:hidden;" width="150" valign="top" align="left" >'.$ket.'</TD>
                             </TR>';
                            
                        }
                $tot_nilai=$tot_nilai+$nilai;
                $tot_nilai_belanja=$tot_nilai_belanja+$nilai_belanja;
                $tot_nilai_pot=$tot_nilai_pot+$nilai_pot;
                }
            $cRet .='<TR>
                        <TD width="90"  bgcolor="#CCCCCC" align="center" >Total</TD>
                        <TD width="90"  bgcolor="#CCCCCC" align="center" >'.$lcno.'</TD>
                        <TD width="90"  bgcolor="#CCCCCC" align="right" >'.number_format($tot_nilai,'2','.',',').'</TD>
                        <TD width="90"  bgcolor="#CCCCCC" align="center" ></TD>
                        <TD width="90"  bgcolor="#CCCCCC" align="right" >'.number_format($tot_nilai_belanja,'2','.',',').'</TD>
                        <TD width="90"  bgcolor="#CCCCCC" align="center" ></TD>
                        <TD width="150"  bgcolor="#CCCCCC" align="center" ></TD>                        
                        <TD width="150"  bgcolor="#CCCCCC" align="center" ></TD>
                        <TD width="150" bgcolor="#CCCCCC" align="right" >'.number_format($tot_nilai_pot,'2','.',',').'</TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" ></TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" ></TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" ></TD>
                        <TD width="150" bgcolor="#CCCCCC" align="center" ></TD>
                     </TR>';
            

            $cRet .='</TABLE>';

            if($ctk==13){
                $mantap ='<TABLE style="font-size:14px;" width="100%" align="center">
                    <TR>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ></TD>
                        <TD width="50%" align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ></TD>
                        <TD width="50%" align="center" >'.$jabatan.'</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                    </TR>
                     <TR>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ><b><u></u></b><br></TD>
                        <TD width="50%" align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ></TD>
                        <TD width="50%" align="center" >'.$nip.'</TD>
                    </TR>
                    </TABLE><br/>';
                $ctk=1;
            } else {

                $mantap ='<TABLE style="font-size:14px;" width="100%" align="center">
                    <TR>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ></TD>
                        <TD width="50%" align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ></TD>
                        <TD width="50%" align="center" >'.$jabatan1.'</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                    </TR>
                     <TR>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                        <TD width="50%" align="center" ><b>&nbsp;</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ><b><u></u></b><br></TD>
                        <TD width="50%" align="center" ><b><u>'.$nama1.'</u></b><br>'.$pangkat1.'</TD>
                    </TR>
                    <TR>
                        <TD width="50%" align="center" ></TD>
                        <TD width="50%" align="center" >'.$nip1.'</TD>
                    </TR>
                    </TABLE><br/>';                

 /*  tampil ttd 2            $mantap ='<TABLE style="font-size:14px;" width="100%" align="center">
                        <TR>
                            <TD width="50%" align="center" ><b>&nbsp;</TD>
                            <TD width="50%" align="center" ><b>&nbsp;</TD>
                        </TR>
                        <TR>
                            <TD width="50%" align="center" >Mengetahui,</TD>
                            <TD width="50%" align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
                        </TR>
                        <TR>
                            <TD width="50%" align="center" >'.$jabatan.'</TD>
                            <TD width="50%" align="center" >'.$jabatan1.'</TD>
                        </TR>
                        <TR>
                            <TD width="50%" align="center" ><b>&nbsp;</TD>
                            <TD width="50%" align="center" ><b>&nbsp;</TD>
                        </TR>
                         <TR>
                            <TD width="50%" align="center" ><b>&nbsp;</TD>
                            <TD width="50%" align="center" ><b>&nbsp;</TD>
                        </TR>
                        <TR>
                            <TD width="50%" align="center" ><b><u>'.$nama.' </u></b><br>'.$pangkat.'</TD>
                            <TD width="50%" align="center" ><b><u>'.$nama1.'</u></b><br>'.$pangkat1.'</TD>
                        </TR>
                        <TR>
                            <TD width="50%" align="center" >'.$nip.'</TD>
                            <TD width="50%" align="center" >'.$nip1.'</TD>
                        </TR>
                        </TABLE><br/>';*/
                }

                $cRet .="$mantap";

            $data['prev']= $cRet;
             switch ($ctk)
        {
            case 0;
            echo ("<title>DTH</title>");
                echo $cRet;
                break;
            case 1;
                //$this->_mpdf('',$cRet,10,10,10,10,1,'');
                $this->_mpdf_margin('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);
               //$this->_mpdf_margin('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);
               break;
            case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DTH.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
            break;
        }
    }
	
	function cek_renja()
    {
        $data['page_title']= 'CETAK';
        $this->template->set('title', 'Cetak KUA');   
        $this->template->load('template','anggaran/rka/cek_renja',$data) ; 
    }
    
	 function pengeluaran_lain()
    {
        $data['page_title']= 'TAMBAH PENGELUARAN LAIN-LAIN';
        $this->template->set('title', 'INPUT TAMBAH PENGELUARAN LAIN-LAIN');   
        $this->template->load('template','tukd/transaksi/tambah_pengeluaran_lain',$data) ; 
    }
	
	function load_keluar_lain() {
		$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
		$kd_skpd  = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = " WHERE kd_skpd = '$kd_skpd' ";
        if ($kriteria <> ''){                               
           $where=" WHERE kd_skpd = '$kd_skpd'  AND (upper(NO_BUKTI) like upper('%$kriteria%') or TGL_BUKTI like '%$kriteria%' or upper(KD_SKPD) like 
                    upper('%$kriteria%') or upper(jns_beban) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from TRHOUTLAIN $where ";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
		//alert('aaa');
		
        $sql = "SELECT TOP $rows a.*,isnull(b.nm_rek5,'') [nm_rek5] from TRHOUTLAIN a left join ms_pot b on a.kd_rek5=b.kd_rek5 
                $where and NO_BUKTI not in (SELECT TOP $offset NO_BUKTI from TRHOUTLAIN  $where order by CAST(NO_BUKTI AS INT)) 
                order by CAST(NO_BUKTI AS INT),KD_SKPD";
       // $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['NO_BUKTI'],
                        'tgl_bukti' => $resulte['TGL_BUKTI'],
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
                        'ket' => $resulte['KET'],
                        'pay' => $resulte['pay'],
                        'jns_beban' => $resulte['jns_beban'],
                        'kd_skpd' => $resulte['KD_SKPD'],
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
						'thn_lalu' => $resulte['thnlalu']
                        );
                        $ii++;
        }
		$result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
	}
	
	
	function cetak_cek_rekening($skpd='',$giat='',$kdrek='',$ctk='',$anggaran=''){
        
            
            $this->load->library('status_anggaran');

            $field = $this->status_anggaran->status_anggarancombo($anggaran);
            $cRet = '';
            $cRet .='<TABLE style="font-size:16px" width="100%" border="0">
					<TR>
						<TD align="center" width="100%"><BR><BR><BR><b>CETAK BUKU RINCIAN OBJEK<BR>
						KEGIATAN '.strtoupper($this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan')).'<BR>
                        REKENING '.strtoupper($this->tukd_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5')).'
						</TD>
					</TR>
				    </TABLE>';

			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="1" width="100%" >
					<THEAD>
					 <TR>
						<TD align="center" ><b>No SP2D/ No SPP /No Tagih/ No Bukti</b></TD>
						<TD align="center" ><b>Tanggal</b></TD>
						<TD align="center" ><b>Ket</b></TD>
						<TD align="center" ><b>Nilai</b></TD>		
					 </TR>
					 </THEAD>';    

		
		$sqlww= $this->db->query("select 1 [no],b.no_sp2d [no1],b.tgl_sp2d [tgl],b.keperluan [ket],a.nilai [nilai] 
        from trdspp a join trhsp2d b on a.no_spp=b.no_spp where b.jns_spp not  in ('1','2')
        and a.kd_kegiatan='$giat' and a.kd_rek5='$kdrek' and (b.sp2d_batal is null or b.sp2d_batal<>'1')
        union all        
        select 2 [no],b.no_spp [no1],b.tgl_spp [tgl],b.keperluan [ket],a.nilai [nilai] 
        from trdspp a join trhspp b on a.no_spp=b.no_spp where b.jns_spp not  in ('1','2')
        and a.no_spp  not in(select no_spp from trhsp2d where kd_skpd='$skpd')
        and a.kd_kegiatan='$giat' and a.kd_rek5='$kdrek'  and (b.sp2d_batal is null or b.sp2d_batal<>'1')
        union all
        select  3 [no],b.no_bukti [no1],a.tgl_bukti [tgl],a.ket [ket],b.nilai [nilai] from trhtagih a join trdtagih b on a.kd_skpd=b.kd_skpd and a.no_bukti=b.no_bukti 
        where b.kd_kegiatan='$giat' and kd_rek='$kdrek' and a.no_bukti not in(select no_tagih from trhspp where kd_skpd='$skpd') 
        union all
        select 4 [no],a.no_bukti [no1],b.tgl_bukti [tgl],b.ket,a.nilai from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd 
        where b.jns_spp in ('1','2') and a.kd_kegiatan='$giat' and a.kd_rek5='$kdrek' order by [no],tgl,no1");
        $tnilai = 0;
		foreach ($sqlww->result() as $row){
            $no1    = $row->no1;
            $tgl    = $row->tgl;
            $ket    = $row->ket;
            $nilai  = $row->nilai;
			$tnilai = $tnilai + $nilai;
			
			$cRet .=' <TR>
						<TD align="left" >'.$no1.'</TD>
						<TD align="left" >'.$tgl.'</TD>
						<TD align="left" >'.$ket.'</TD>
						<TD align="right" >'.number_format($nilai,"2",",",".").'</TD>		
					 </TR>';	
            			
		}

		$sqlww2= $this->db->query("select $field [nilai] from trdrka where kd_kegiatan='$giat' and kd_rek5='$kdrek'");
		foreach ($sqlww2->result() as $row1){
			$angg = $row1->nilai;
		}
		$sisa = $angg - $tnilai;
			$cRet .=' <TR>
						<TD >Anggaran</TD>
						<TD align="right" >'.number_format($angg,"2",",",".").'</TD>	
						<TD colspan="2"></TD>
							
					 </TR>
					 <TR>
						<TD >Total Inputan</TD>
						<TD align="right" >'.number_format($tnilai,"2",",",".").'</TD>
						<TD colspan="2"></TD>
								
					 </TR>
					 <TR>
						<TD >Sisa</TD>
						<TD align="right" >'.number_format($sisa,"2",",",".").'</TD>	
						<TD colspan="2"></TD>
							
					 </TR>
					 ';	
            $cRet .='</TABLE>';			
		
		
		$data['prev']= $cRet;
            switch ($ctk) {
				case 0;
					echo ("<title> CEK ANGGARAN</title>");
					echo $cRet;
					break;
				case 1;
					///$this->_mpdf('',$cRet,10,10,10,'0',0,'');
					//$this->_mpdf('',$cRet,10,10,10,'0',1,'');
					$this->_mpdf('',$cRet,10,10,10,'L',0,'');
					break;
				case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename=$skpd.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
			}
	}
	
	function rekap_terimasetor(){
        $data['page_title']= 'Rekapitulasi Penerimaan Penyetoran';
        $this->template->set('title', 'Rekapitulasi Penerimaan Penyetoran');   
        $this->template->load('template','tukd/pendapatan/terima_setor_rekap',$data) ; 
    }
	
	function cetak_rekapterimasetor(){ 
        $thn_ang = $this->session->userdata('pcThang');
        $lcskpd = $_REQUEST['kd_skpd'];
        //$bulan = $_REQUEST['bulan'];
        $bulan1 = $_REQUEST['bulan1'];
        $bulan2 = $_REQUEST['bulan2'];
            
        //$lcperiode = $this->tukd_model->getBulan($bulan);
       
	   $lcperiode1 = $this->tanggal_format_indonesia($bulan1);
	   $lcperiode2 = $this->tanggal_format_indonesia($bulan2);
	   
        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
        $trh2 = $hasil->row();          
        $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"11\" style=\"font-size:14px;\"><b>".strtoupper($lcNmskpd)."</b></td>
            </tr></table>
			<br>
			<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<thead>
            <tr>
                <td align=\"center\" colspan=\"15\"  bgcolor=\"#CCCCCC\">".strtoupper($lcperiode1)." s/d ".strtoupper($lcperiode2)."</td>
            </tr>
            <tr>                
                <td align=\"center\" rowspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">Tanggal</td>
                <td align=\"center\" colspan=\"2\" width=\"20%\"  bgcolor=\"#CCCCCC\">PKB</td>
                <td align=\"center\" colspan=\"2\" width=\"20%\"  bgcolor=\"#CCCCCC\">BBN-KB</td>
                <td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">PKA</td>
                <td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">BBN-KA</td>
                <td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">PAP</td>
				<td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">DENDA PKB</td>
				<td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">DENDA BBNKB</td>
            </tr>
			<tr>                
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (KASDA)</td>
            </tr>
			</thead>";
           
		    $sql = "SELECT tgl_kas, SUM(CASE WHEN kode=1 AND LEFT(kd_rek5,5)='41101' THEN total ELSE 0 END) terima_pkb,
									SUM(CASE WHEN kode=2 AND LEFT(kd_rek5,5)='41101' THEN total ELSE 0 END) setor_pkb,
									SUM(CASE WHEN kode=1 AND LEFT(kd_rek5,5)='41102' AND kd_rek5<>'4110213' THEN total ELSE 0 END) terima_bbnkb,
									SUM(CASE WHEN kode=2 AND LEFT(kd_rek5,5)='41102' AND kd_rek5<>'4110213' THEN total ELSE 0 END) setor_bbnkb,
									0 AS terima_pka,
									0 AS setor_pka,
									SUM(CASE WHEN kode=1 AND kd_rek5='4110213' THEN total ELSE 0 END) terima_bbnka,
									SUM(CASE WHEN kode=2 AND kd_rek5='4110213' THEN total ELSE 0 END) setor_bbnka,
									SUM(CASE WHEN kode=1 AND LEFT(kd_rek5,5)='41104' THEN total ELSE 0 END) AS terima_pap,
									SUM(CASE WHEN kode=2 AND LEFT(kd_rek5,5)='41104' THEN total ELSE 0 END) AS setor_pap,
									SUM(CASE WHEN kode=1 AND kd_rek5='4140701' THEN total ELSE 0 END) AS terima_denda_pkb,
									SUM(CASE WHEN kode=2 AND kd_rek5='4140701' THEN total ELSE 0 END) AS setor_denda_pkb,
									SUM(CASE WHEN kode=1 AND kd_rek5='4140702' THEN total ELSE 0 END) AS terima_denda_bbnkb,
									SUM(CASE WHEN kode=2 AND kd_rek5='4140702' THEN total ELSE 0 END) AS setor_denda_bbnkb 
					FROM (
					SELECT 1 kode, a.tgl_sts tgl_kas, b.kd_rek5, SUM(b.rupiah) total
					FROM trhkasin_pkd a inner join trdkasin_pkd b ON a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans NOT IN ('3') AND b.kd_skpd='$lcskpd' 
					GROUP BY a.tgl_sts, b.kd_rek5
					UNION ALL
					SELECT 1 kode, a.tgl_sts tgl_kas, b.kd_rek5, SUM(b.rupiah*-1) total
					FROM trhkasin_pkd a inner join trdkasin_pkd b ON a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans IN ('3') AND b.kd_skpd='$lcskpd' 
					GROUP BY a.tgl_sts, b.kd_rek5
					UNION ALL
					select 2 kode, a.tgl_kas, b.kd_rek5, SUM(b.rupiah) total
					FROM trhkasin_ppkd a inner join trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans IN ('4') AND b.kd_skpd='$lcskpd'
					GROUP BY a.tgl_kas, b.kd_rek5
					UNION ALL
					select 2 kode, a.tgl_kas, b.kd_rek5, SUM(b.rupiah*-1) total
					FROM trhrestitusi a inner join trdrestitusi b ON a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans IN ('3') AND b.kd_skpd='$lcskpd'
					GROUP BY a.tgl_kas, b.kd_rek5) x
					WHERE x.tgl_kas BETWEEN '$bulan1' AND '$bulan2'
					GROUP BY tgl_kas
					ORDER BY tgl_kas";     
            $hasil = $this->db->query($sql);
            $tot_terima_pkb=0;
            $tot_setor_pkb=0;
			$tot_terima_denda_pkb=0;
			$tot_setor_denda_pkb=0;
			$tot_terima_denda_bbnkb=0;
			$tot_setor_denda_bbnkb=0;
            $tot_terima_bbnkb=0;
            $tot_setor_bbnkb=0;
            $tot_terima_pka=0;
            $tot_setor_pka=0;
            $tot_terima_bbnka=0;
            $tot_setor_bbnka=0;
            $tot_terima_pap=0;
            $tot_setor_pap=0;
			foreach ($hasil->result() as $row)
            {
                $tanggal=$row->tgl_kas;
				$tgl = $this->tanggal_format_indonesia($tanggal);
                $terima_pkb=$row->terima_pkb;    
                $setor_pkb=$row->setor_pkb;    
                $terima_denda_pkb=$row->terima_denda_pkb;    
                $setor_denda_pkb=$row->setor_denda_pkb; 
				$terima_denda_bbnkb=$row->terima_denda_bbnkb;    
                $setor_denda_bbnkb=$row->setor_denda_bbnkb; 				
                $terima_bbnkb=$row->terima_bbnkb;    
                $setor_bbnkb=$row->setor_bbnkb;    
                $terima_pka=$row->terima_pka;    
                $setor_pka=$row->setor_pka;    
                $terima_bbnka=$row->terima_bbnka;    
                $setor_bbnka=$row->setor_bbnka;    
                $terima_pap=$row->terima_pap;    
                $setor_pap=$row->setor_pap;    

				$tot_terima_pkb = $tot_terima_pkb+$terima_pkb;
				$tot_setor_pkb = $tot_setor_pkb+$setor_pkb;
				$tot_terima_denda_pkb = $tot_terima_denda_pkb+$terima_denda_pkb;
				$tot_setor_denda_pkb = $tot_setor_denda_pkb+$setor_denda_pkb;
				$tot_terima_denda_bbnkb = $tot_terima_denda_bbnkb+$terima_denda_bbnkb;
				$tot_setor_denda_bbnkb = $tot_setor_denda_bbnkb+$setor_denda_bbnkb;
				$tot_terima_bbnkb = $tot_terima_bbnkb+$terima_bbnkb;
				$tot_setor_bbnkb = $tot_setor_bbnkb+$setor_bbnkb;
				$tot_terima_pka = $tot_terima_pka+$terima_pka;
				$tot_setor_pka = $tot_setor_pka+$setor_pka;
				$tot_terima_bbnka = $tot_terima_bbnka+$terima_bbnka;
				$tot_setor_bbnka = $tot_setor_bbnka+$setor_bbnka;
				$tot_terima_pap = $tot_terima_pap+$terima_pap;
				$tot_setor_pap = $tot_setor_pap+$setor_pap;
				
				$cRet .="<tr>                
                <td align=\"center\" >".$tgl."</td>
                <td align=\"right\" >".number_format($terima_pkb,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_pkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_bbnkb,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_bbnkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_pka,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_pka,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_bbnka,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_bbnka,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_pap,"2",",",".")."</td>
                <td align=\"right\" >".number_format($setor_pap,"2",",",".")."</td>
				<td align=\"right\" >".number_format($terima_denda_pkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($setor_denda_pkb,"2",",",".")."</td>
				<td align=\"right\" >".number_format($terima_denda_bbnkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($setor_denda_bbnkb,"2",",",".")."</td>
            </tr>";
            }
                   
				$cRet .="<tr>                
                <td align=\"center\" ><b>Total</td>
                <td align=\"right\" ><b>".number_format($tot_terima_pkb,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_pkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_bbnkb,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_bbnkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_pka,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_pka,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_bbnka,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_bbnka,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_pap,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_setor_pap,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_terima_denda_pkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_setor_denda_pkb,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_terima_denda_bbnkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_setor_denda_bbnkb,"2",",",".")."</td>
            </tr>";
         $cRet .='</table>';
         $data['prev']= $cRet; 
		 echo $cRet;
         
    }
    
	function cetak_rekapterimasetor2(){ 
        $thn_ang = $this->session->userdata('pcThang');
        $lcskpd = $_REQUEST['kd_skpd'];
        //$bulan = $_REQUEST['bulan'];
        $bulan1 = $_REQUEST['bulan1'];
        $bulan2 = $_REQUEST['bulan2'];  
        //$lcperiode = $this->tukd_model->getBulan($bulan);
       $lcperiode1 = $this->tanggal_format_indonesia($bulan1);
	   $lcperiode2 = $this->tanggal_format_indonesia($bulan2);
	   
	   
        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
        $trh2 = $hasil->row();          
        $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"11\" style=\"font-size:14px;\"><b>".strtoupper($lcNmskpd)."</b></td>
            </tr></table>
			<br>
			<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<thead>
            <tr>
                <td align=\"center\" colspan=\"15\"  bgcolor=\"#CCCCCC\">".strtoupper($lcperiode1)." s/d ".strtoupper($lcperiode2)."</td>
            </tr>
            <tr>                
                <td align=\"center\" rowspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">Tanggal</td>
                <td align=\"center\" colspan=\"2\" width=\"20%\"  bgcolor=\"#CCCCCC\">PKB</td>
                <td align=\"center\" colspan=\"2\" width=\"20%\"  bgcolor=\"#CCCCCC\">BBN-KB</td>
                <td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">PKA</td>
                <td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">BBN-KA</td>
                <td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">PAP</td>
				<td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">DENDA PKB</td>
				<td align=\"center\" colspan=\"2\" width=\"10%\"  bgcolor=\"#CCCCCC\">DENDA BBNKB</td>
            </tr>
			<tr>                
                <td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\">Terima (SKPD)</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\">Setoran (SKPD)</td>
            </tr>
			</thead>";
           
			$sql = "SELECT tgl_kas, SUM(CASE WHEN kode=1 AND LEFT(kd_rek5,5)='41101' THEN total ELSE 0 END) terima_pkb,
									SUM(CASE WHEN kode=2 AND LEFT(kd_rek5,5)='41101' THEN total ELSE 0 END) setor_pkb,
									SUM(CASE WHEN kode=1 AND LEFT(kd_rek5,5)='41102' AND kd_rek5<>'4110213' THEN total ELSE 0 END) terima_bbnkb,
									SUM(CASE WHEN kode=2 AND LEFT(kd_rek5,5)='41102' AND kd_rek5<>'4110213' THEN total ELSE 0 END) setor_bbnkb,
									0 AS terima_pka,
									0 AS setor_pka,
									SUM(CASE WHEN kode=1 AND kd_rek5='4110213' THEN total ELSE 0 END) terima_bbnka,
									SUM(CASE WHEN kode=2 AND kd_rek5='4110213' THEN total ELSE 0 END) setor_bbnka,
									SUM(CASE WHEN kode=1 AND LEFT(kd_rek5,5)='41104' THEN total ELSE 0 END) AS terima_pap,
									SUM(CASE WHEN kode=2 AND LEFT(kd_rek5,5)='41104' THEN total ELSE 0 END) AS setor_pap,
									SUM(CASE WHEN kode=1 AND kd_rek5='4140701' THEN total ELSE 0 END) AS terima_denda_pkb,
									SUM(CASE WHEN kode=2 AND kd_rek5='4140701' THEN total ELSE 0 END) AS setor_denda_pkb,
									SUM(CASE WHEN kode=1 AND kd_rek5='4140702' THEN total ELSE 0 END) AS terima_denda_bbnkb,
									SUM(CASE WHEN kode=2 AND kd_rek5='4140702' THEN total ELSE 0 END) AS setor_denda_bbnkb 
					FROM (
					SELECT 1 kode, tgl_terima tgl_kas, kd_rek5, SUM(nilai) total 
					FROM tr_terima WHERE LEFT(kd_rek5,1)='4' AND kd_skpd='$lcskpd' GROUP BY tgl_terima, kd_rek5
					UNION ALL
					SELECT 1 kode, a.tgl_sts tgl_kas, b.kd_rek5, SUM(b.rupiah*-1) total
					FROM trhkasin_pkd a inner join trdkasin_pkd b ON a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans IN ('3') AND b.kd_skpd='$lcskpd' 
					GROUP BY a.tgl_sts, b.kd_rek5
					UNION ALL
					select 2 kode, a.tgl_sts tgl_kas, b.kd_rek5, SUM(b.rupiah) total
					FROM trhkasin_pkd a inner join trdkasin_pkd b ON a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans NOT IN ('3') AND b.kd_skpd='$lcskpd'
					GROUP BY a.tgl_sts, b.kd_rek5
					UNION ALL
					select 2 kode, a.tgl_sts tgl_kas, b.kd_rek5, SUM(b.rupiah*-1) total
					FROM trhkasin_pkd a inner join trdkasin_pkd b ON a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
					WHERE LEFT(b.kd_rek5,1)='4' AND a.jns_trans IN ('3') AND b.kd_skpd='$lcskpd'
					GROUP BY a.tgl_sts, b.kd_rek5) x
					WHERE x.tgl_kas BETWEEN '$bulan1' AND '$bulan2'
					GROUP BY x.tgl_kas
					ORDER BY x.tgl_kas";     
            $hasil = $this->db->query($sql);
            $tot_terima_pkb=0;
            $tot_setor_pkb=0;
			$tot_terima_denda_pkb=0;
			$tot_setor_denda_pkb=0;
			$tot_terima_denda_bbnkb=0;
			$tot_setor_denda_bbnkb=0;
            $tot_terima_bbnkb=0;
            $tot_setor_bbnkb=0;
            $tot_terima_pka=0;
            $tot_setor_pka=0;
            $tot_terima_bbnka=0;
            $tot_setor_bbnka=0;
            $tot_terima_pap=0;
            $tot_setor_pap=0;
			foreach ($hasil->result() as $row)
            {
                $tanggal=$row->tgl_kas;
				$tgl = $this->tanggal_format_indonesia($tanggal);
                $terima_pkb=$row->terima_pkb;    
                $setor_pkb=$row->setor_pkb;    
                $terima_denda_pkb=$row->terima_denda_pkb;    
                $setor_denda_pkb=$row->setor_denda_pkb; 
				$terima_denda_bbnkb=$row->terima_denda_bbnkb;    
                $setor_denda_bbnkb=$row->setor_denda_bbnkb; 				
                $terima_bbnkb=$row->terima_bbnkb;    
                $setor_bbnkb=$row->setor_bbnkb;    
                $terima_pka=$row->terima_pka;    
                $setor_pka=$row->setor_pka;    
                $terima_bbnka=$row->terima_bbnka;    
                $setor_bbnka=$row->setor_bbnka;    
                $terima_pap=$row->terima_pap;    
                $setor_pap=$row->setor_pap;    

				$tot_terima_pkb = $tot_terima_pkb+$terima_pkb;
				$tot_setor_pkb = $tot_setor_pkb+$setor_pkb;
				$tot_terima_denda_pkb = $tot_terima_denda_pkb+$terima_denda_pkb;
				$tot_setor_denda_pkb = $tot_setor_denda_pkb+$setor_denda_pkb;
				$tot_terima_denda_bbnkb = $tot_terima_denda_bbnkb+$terima_denda_bbnkb;
				$tot_setor_denda_bbnkb = $tot_setor_denda_bbnkb+$setor_denda_bbnkb;
				$tot_terima_bbnkb = $tot_terima_bbnkb+$terima_bbnkb;
				$tot_setor_bbnkb = $tot_setor_bbnkb+$setor_bbnkb;
				$tot_terima_pka = $tot_terima_pka+$terima_pka;
				$tot_setor_pka = $tot_setor_pka+$setor_pka;
				$tot_terima_bbnka = $tot_terima_bbnka+$terima_bbnka;
				$tot_setor_bbnka = $tot_setor_bbnka+$setor_bbnka;
				$tot_terima_pap = $tot_terima_pap+$terima_pap;
				$tot_setor_pap = $tot_setor_pap+$setor_pap;
				
				$cRet .="<tr>                
                <td align=\"center\" >".$tgl."</td>
                <td align=\"right\" >".number_format($terima_pkb,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_pkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_bbnkb,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_bbnkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_pka,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_pka,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_bbnka,"2",",",".")."</td>
				<td align=\"right\" >".number_format($setor_bbnka,"2",",",".")."</td>
                <td align=\"right\" >".number_format($terima_pap,"2",",",".")."</td>
                <td align=\"right\" >".number_format($setor_pap,"2",",",".")."</td>
				<td align=\"right\" >".number_format($terima_denda_pkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($setor_denda_pkb,"2",",",".")."</td>
				<td align=\"right\" >".number_format($terima_denda_bbnkb,"2",",",".")."</td>
                <td align=\"right\" >".number_format($setor_denda_bbnkb,"2",",",".")."</td>
            </tr>";
            }
                   
				$cRet .="<tr>                
                <td align=\"center\" ><b>Total</td>
                <td align=\"right\" ><b>".number_format($tot_terima_pkb,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_pkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_bbnkb,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_bbnkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_pka,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_pka,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_bbnka,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_setor_bbnka,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_terima_pap,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_setor_pap,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_terima_denda_pkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_setor_denda_pkb,"2",",",".")."</td>
				<td align=\"right\" ><b>".number_format($tot_terima_denda_bbnkb,"2",",",".")."</td>
                <td align=\"right\" ><b>".number_format($tot_setor_denda_bbnkb,"2",",",".")."</td>
            </tr>";
         $cRet .='</table>';
         $data['prev']= $cRet; 
		 echo $cRet;
         
    }
	
	function ppkd__pend() {
		$id  = $this->session->userdata('pcUser'); 
		$usernm      = $this->session->userdata('pcNama');
        $kd_skpd = $this->session->userdata('kdskpd');
        
		$lccr = $this->input->post('q');
       
		$sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd='$kd_skpd'";
        
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	
	function list_ttd_ppkd($kode) {
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kode in ('$kode') order by nama";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	function tarik_kasda(){
        $data['page_title']= 'INPUT S T S';
        $this->template->set('title', 'INPUT S T S');   
        $this->template->load('template','tukd/pendapatan/tarik_kasda',$data) ; 
    }
    
	function load_tglsts(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $kd_skpd = $this->input->post('kd_skpd');
        $where ='';
		$where2 ='';
        if ($kriteria <> ''){                               
            $where="AND a.tgl_sts = '$kriteria'";            
        }
		
		if ($kd_skpd <> ''){                               
            $where2="WHERE kd_skpd = '$kd_skpd'";            
        }
	   
        $sql = "SELECT count(*) as total from (
					SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
									FROM trhkasin_pkd a  
									WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) NOT IN ('3.13.01') AND kd_skpd<>'1.02.02.01'
									AND no_sts not in (select no_sts from trhkasin_ppkd WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) NOT IN ('3.13.01') AND kd_skpd<>'1.02.02.01')
					UNION ALL
					SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
									FROM trhkasin_pkd a  
									WHERE jns_trans IN ('4','2') $where 
										  AND LEFT(kd_skpd,7) IN ('3.13.01') 
										  AND kd_skpd NOT IN ('3.13.01.01','3.13.01.17')
										  AND status=1
										  AND no_sts not in (select no_sts from trhkasin_ppkd WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) IN ('3.13.01') 
										  AND kd_skpd NOT IN ('3.13.01.01','3.13.01.17')))x $where2" ;

        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
		   $sql = "SELECT * FROM (
					SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
									FROM trhkasin_pkd a  
									WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) NOT IN ('3.13.01') AND kd_skpd<>'1.02.02.01'
									AND no_sts not in (select no_sts from trhkasin_ppkd WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) NOT IN ('3.13.01') AND kd_skpd<>'1.02.02.01')
					UNION ALL
					SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
									FROM trhkasin_pkd a  
									WHERE jns_trans IN ('4','2') $where 
										  AND LEFT(kd_skpd,7) IN ('3.13.01') 
										  AND kd_skpd NOT IN ('3.13.01.01','3.13.01.17')
										  AND status=1
										  AND no_sts not in (select no_sts from trhkasin_ppkd WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) IN ('3.13.01') 
										  AND kd_skpd NOT IN ('3.13.01.01','3.13.01.17')))x $where2
					order by tgl_sts,kd_skpd";

        $query1 = $this->db->query($sql); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id'         => $ii,        
                        'no_sts'     => $resulte['no_sts'],
                        'tgl_sts'    => $resulte['tgl_sts'],
                        'kd_skpd'    => $resulte['kd_skpd'],
						'keterangan' => $resulte['keterangan'],
                        'total'      => $resulte['total'],
						'kd_kegiatan'=> $resulte['kd_kegiatan'],
						'jns_trans'  => $resulte['jns_trans'],
                        'jns_cp'     => $resulte['jns_cp'],  
                        'pot_khusus' => $resulte['pot_khusus'],  
                        'nm_skpd' => $resulte['nm_skpd'],
                        'status' => $resulte['status']
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
	
	function tarik_skpd() {
        $lccr = $this->input->post('q');
        $sql = "SELECT '' kd_skpd, '' nm_skpd
				UNION ALL
				SELECT kd_skpd, nm_skpd from (
					SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
					FROM trhkasin_pkd a  
					WHERE jns_trans IN ('4','2') AND kd_skpd NOT IN ('1.02.02.01','3.13.01.01','3.13.01.17'))x
				WHERE upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%')
				group by kd_skpd, nm_skpd
				order by kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}

	function simpan_sts_kasda_all(){
        
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
				
	    $where="AND a.tgl_sts = '$tgl'";            
        
		if($skpd<>''){                               
            $where2="WHERE kd_skpd = '$skpd'";
			$where3="AND b.kd_skpd = '$skpd'";
			$where4="AND no_sts not in (select b.no_sts from trhkasin_ppkd b where tgl_sts='$tgl' AND b.kd_skpd='$skpd')";
        }else{
			$where2="";
			$where3="";
			$where4="WHERE no_sts not in (select b.no_sts from trhkasin_ppkd b where tgl_sts='$tgl')";
		}		
				
        // Simpan Header //
        $msg = array();
        	
				$query1 = $this->db->query("select case when max(nomor) is null then 0 else max(nomor) end as nomor from (
											select no_kas nomor,'Terima STS' ket from trhkasin_ppkd where isnumeric(no_kas)=1
											UNION ALL
											select no_kas nomor,'Terima STS' ket from trhrestitusi where isnumeric(no_kas)=1
											UNION ALL
											select nomor,'Terima non SP2D' ket from penerimaan_non_sp2d where isnumeric(nomor)=1
											UNION ALL
											select nomor,'keluar non SP2D' ket from pengeluaran_non_sp2d where isnumeric(nomor)=1
											UNION ALL
											select no,'koreksi' ket from trkasout_ppkd where isnumeric(no)=1
											) z");
				$prvn = $query1->row();          
				$num = $prvn->nomor;         
				
				$sql = "insert into trdkasin_ppkd											  
						SELECT kd_skpd, no_sts, kd_rek5, rupiah, kd_kegiatan, no_kas, sumber FROM (
						select b.kd_skpd, b.no_sts, b.kd_rek5, b.rupiah, b.kd_kegiatan,'' no_kas, b.sumber 
						from trdkasin_pkd b inner join trhkasin_pkd a on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
						where LEFT(b.kd_rek5,1)=4 $where  AND LEFT(b.kd_skpd,7) NOT IN ('3.13.01') AND b.kd_skpd<>'1.02.02.01'
						UNION ALL
						select b.kd_skpd, b.no_sts, b.kd_rek5, b.rupiah, b.kd_kegiatan,'' no_kas, b.sumber 
						from trdkasin_pkd b inner join trhkasin_pkd a on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts 
						where LEFT(b.kd_rek5,1)=4 $where  
						AND LEFT(b.kd_skpd,7) IN ('3.13.01') 
						AND b.kd_skpd NOT IN ('3.13.01.01','3.13.01.17')
						AND a.status=1) x $where2 $where4";
                $asg = $this->db->query($sql);
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{
               
				   $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber) 
							select $num+ROW_NUMBER() OVER (ORDER BY tgl_kas) AS no_kas, tgl_sts, no_sts, kd_skpd, tgl_sts, keterangan, total, kd_kegiatan, jns_trans, sumber 
							FROM (
							SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
											FROM trhkasin_pkd a  
											WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) NOT IN ('3.13.01') AND kd_skpd<>'1.02.02.01'
											AND no_sts not in (select no_sts from trhkasin_ppkd WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) NOT IN ('3.13.01') AND kd_skpd<>'1.02.02.01')
							UNION ALL
							SELECT a.*,(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd 
											FROM trhkasin_pkd a  
											WHERE jns_trans IN ('4','2') $where 
												  AND LEFT(kd_skpd,7) IN ('3.13.01') 
												  AND kd_skpd NOT IN ('3.13.01.01','3.13.01.17')
												  AND status=1
												  AND no_sts not in (select no_sts from trhkasin_ppkd WHERE jns_trans IN ('4','2') $where AND LEFT(kd_skpd,7) IN ('3.13.01') 
												  AND kd_skpd NOT IN ('3.13.01.01','3.13.01.17')))x $where2";
					$asg = $this->db->query($sql);
				
					if (!($asg)){
						$msg = array('pesan'=>'0');
						echo json_encode($msg);
						exit();
					}
				}
			   
		
					$sql = "update b set b.no_kas=a.no_kas
							from trdkasin_ppkd b inner join trhkasin_ppkd a 
							on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts and a.kd_kegiatan=b.kd_kegiatan
							where LEFT(b.kd_rek5,1)=4 $where AND a.jns_trans in ('4','2') $where3";
					$asg = $this->db->query($sql);
				
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{
					$sql = "update a set a.no_cek=1
							from trhkasin_ppkd b inner join trhkasin_pkd a 
							on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts and a.kd_kegiatan=b.kd_kegiatan
							where a.jns_trans in ('4','2') $where $where3";
					$asg = $this->db->query($sql);
					if (!($asg)){
						$msg = array('pesan'=>'0');
						echo json_encode($msg);
						exit();
					}
				}
			
            echo '1';
       
    }

	function load_dtglsts() {    
        $kriteria = $this->input->post('no');
		$skpd = $this->input->post('kd_skpd');
		$ctgl = $this->input->post('ctgl');
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek, b.nm_pengirim, c.nm_rek4
        from trdkasin_pkd a left join ms_pengirim b on a.sumber=b.kd_pengirim left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4 where a.no_sts = '$kriteria' and a.kd_skpd='$skpd' and LEFT(a.kd_rek5,1)='4'";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'rupiah' =>  $resulte['rupiah'],
                        'sumber' =>  $resulte['sumber'],
                        'nmsumber' =>  $resulte['nm_pengirim'],
                        'nm_rek4' =>  $resulte['nm_rek4']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function simpan_sts_kasda(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $tglkas = $this->input->post('tglkas');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        $rekbank= $this->input->post('rekbank');
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   = $this->input->post('sumber');
        $kd_skpd  = $this->session->userdata('kdskpd');
		
		
		if($sumber=='' || $sumber=='0'){
			$sumber2 = $this->session->userdata('pcNama');
		}else{
			$sumber2 = $sumber;
		}
				
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
		$last_update=  '';
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_ppkd') {
            $sql = "delete from trhkasin_ppkd where kd_skpd='$skpd' and no_sts='$nomor'";
            $asg = $this->db->query($sql);
            if ($asg){
				
				$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
											select no_kas nomor,'Terima STS' ket from trhkasin_ppkd where isnumeric(no_kas)=1
											UNION ALL
											select nomor,'Terima non SP2D' ket from penerimaan_non_sp2d where isnumeric(nomor)=1
											UNION ALL
											select nomor,'keluar non SP2D' ket from pengeluaran_non_sp2d where isnumeric(nomor)=1
											UNION ALL
											select no,'koreksi' ket from trkasout_ppkd where isnumeric(no)=1
											) z");
				$prvn = $query1->row();          
				$num = $prvn->nomor;         
				
               $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber) 
                        values('$num','$tglkas','$nomor','$skpd','$tgl','$ket',$total,'$giat','$jnsrek','$sumber')";
                $asg = $this->db->query($sql);
				
				$sql = "update trhkasin_pkd set no_cek=1 where no_sts='$nomor' AND kd_skpd='$skpd' and kd_kegiatan='$giat' and jns_trans='$jnsrek'";
                $asg = $this->db->query($sql);
				
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
				
                if ($asg){
										
                    $sql = "delete from trdkasin_ppkd where no_sts='$nomor' and kd_skpd='$skpd'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan,sumber) values $lcnilaidet";
                        $asg = $this->db->query($sql);
						
						$sql = "update trdkasin_ppkd set no_kas='$num' where no_sts='$nomor' AND kd_skpd='$skpd' and kd_kegiatan='$giat'";
						$asg = $this->db->query($sql);
                    }                
                }            
            }
            echo '1';
        }
    }

	
	function load_wilayah() {        
        
        $skpd = $this->session->userdata('kdskpd');               
        $lccr = $this->input->post('q');
        
        $sql = "select * from ms_wilayah where (upper(kd_wilayah) like upper('%$lccr%') OR upper(nm_wilayah) like upper('%$lccr%'))
			order by cast(kd_wilayah as int)";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
             $result[] = array(
                        'id' => $ii,        
                        'kd_wilayah' => $resulte['kd_wilayah'],  
                        'nm_wilayah' => $resulte['nm_wilayah']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
	 
	function penerimaan_non_sp2d()
    {
        $data['page_title']= 'PENERIMAAN NON PENDAPATAN';
        $this->template->set('title', 'PENERIMAAN NON PENDAPATAN');   
        $this->template->load('template','tukd/sp2d/penerimaan_non_sp2d',$data) ; 
    }
	
	function load_penerimaan_nonsp2d(){
        
        $sql = "SELECT * from penerimaan_non_sp2d order by nomor";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nomor' => $resulte['nomor'],
                        'tanggal' => $resulte['tanggal'],
						'keterangan' => $resulte['keterangan'],
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
						'jns' => $resulte['jenis']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function hapus_penerimaan_non_sp2d() {    	
		$nomor = $this->input->post('no');
		$tgl   = $this->input->post('tanggal');
		//$nilai = $this->input->post('nilai');
        $query = "delete from penerimaan_non_sp2d where nomor='$nomor' and tanggal='$tgl'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }  
	
	function cetak_penerimaan_non_sp2d()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN NON SP2D';
        $this->template->set('title', 'BUKU KAS PENERIMAAN NON SP2D');   
        $this->template->load('template','tukd/sp2d/ctk_penerimaan_non_sp2d',$data) ; 
    }
	
	
    function rp_minus($nilai){
        if($nilai<0){
            $nilai = $nilai * (-1);
            $nilai = '('.number_format($nilai,"2",",",".").')';    
        }else{
            $nilai = number_format($nilai,"2",",","."); 
        }
        
        return $nilai;
    } 
 
	function buku_transfer_daerah($ctk='',$ttd1='',$tgl='',$bln=''){
		$lntahunang = $this->session->userdata('pcThang');
		$bulan = $this->getBulan($bln);
		$lcttd = str_replace('123456789',' ',$ttd1);
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($tgl);
		
		if($bln<=3){
			$tw = "Triwulan 1 Tahun $lntahunang";
		}else if($bln<=6){
			$tw = "Triwulan 2 Tahun $lntahunang";
		}else if($bln<=9){
			$tw = "Triwulan 3 Tahun $lntahunang";
		}else{
			$tw = "Triwulan 4 Tahun $lntahunang";
		}
		
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='PPKD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$namattd= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$sqlmap = "SELECT SUM(rupiah) rupiah FROM (
SELECT * FROM (
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '1' urut, '1' as spasi, 'PENYALURAN TRANSFER MELALUI KPPN' nama) c
						LEFT JOIN
						(SELECT '1' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x 

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '2' urut, '1' as spasi, 'TRANSFER DBH PAJAK' nama) c
						LEFT JOIN
						(SELECT '2' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x 

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '3' urut, '2' as spasi, 'DBH PPh Pasal 21' nama) c
						LEFT JOIN
						( SELECT '3' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210105') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '4' urut, '2' as spasi, 'DBH PPh Pasal 25-29 WPOPDN' nama) c
						LEFT JOIN
						( SELECT '4' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210103') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '5' urut, '2' as spasi, 'DBH PBB Bagi Rata' nama) c
						LEFT JOIN
						( SELECT '5' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '6' urut, '2' as spasi, 'DBH PBB Migas' nama) c
						LEFT JOIN
						( SELECT '6' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210101') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '7' urut, '2' as spasi, 'Biaya Pemungutan PBB Migas' nama) c
						LEFT JOIN
						( SELECT '7' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210104') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '8' urut, '2' as spasi, 'DBH PBB Panas Bumi' nama) c
						LEFT JOIN
						( SELECT '8' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '9' urut, '2' as spasi, 'Biaya Pemungutan PBB Panas Bumi' nama) c
						LEFT JOIN
						( SELECT '9' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210102') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '10' urut, '2' as spasi, 'PBB Bagian Prov/Kab/Kota' nama) c
						LEFT JOIN
						( SELECT '10' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '11' urut, '2' as spasi, 'Kurang Bayar DBH PBB Bagian Prov TA 2014 pada' nama) c
						LEFT JOIN
						( SELECT '11' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '12' urut, '1' as spasi, 'TRANSFER DBH CUKAI' nama) c
						LEFT JOIN
						( SELECT '12' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '13' urut, '2' as spasi, 'DBH Cukai Hasil Tembakau' nama) c
						LEFT JOIN
						( SELECT '13' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210106') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						--UNION
						--SELECT urut, spasi, nama, ISNULL(SUM(rupiah),0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						--SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						--(select '13' urut, '2' as spasi, 'DBH Pajak Rokok' nama) c
						--LEFT JOIN
						--( SELECT '13' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and --a.kd_skpd=b.kd_skpd
						--where kd_rek5 in ('4110501') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						--GROUP BY urut, spasi, nama, tgl_kas

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '14' urut, '1' as spasi, 'TRANSFER DBH SDA' nama) c
						LEFT JOIN
						( SELECT '14' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '15' urut, '1' as spasi, 'PERTAMBANGAN UMUM' nama) c
						LEFT JOIN
						( SELECT '15' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '16' urut, '2' as spasi, 'DBH Pertambangan Umum - Iuran Tetap' nama) c
						LEFT JOIN
						( SELECT '16' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210204') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '17' urut, '2' as spasi, 'DBH Pertambangan Umum - Royalti' nama) c
						LEFT JOIN
						( SELECT '17' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210205') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '18' urut, '1' as spasi, 'MINYAK' nama) c
						LEFT JOIN
						( SELECT '18' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '19' urut, '2' as spasi, 'DBH Minyak 15%' nama) c
						LEFT JOIN
						( SELECT '19' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '20' urut, '2' as spasi, 'DBH Minyak 0,5%' nama) c
						LEFT JOIN
						( SELECT '20' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '21' urut, '2' as spasi, 'DBH Minyak Dalam Rangka Otsus' nama) c
						LEFT JOIN
						( SELECT '21' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '22' urut, '1' as spasi, 'GAS' nama) c
						LEFT JOIN
						( SELECT '22' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '23' urut, '2' as spasi, 'DBH Gas 30%' nama) c
						LEFT JOIN
						( SELECT '23' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '24' urut, '2' as spasi, 'DBH Gas 0,5%' nama) c
						LEFT JOIN
						( SELECT '24' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '25' urut, '2' as spasi, 'DBH Gas Dalam Rangka Otsus' nama) c
						LEFT JOIN
						( SELECT '25' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '26' urut, '1' as spasi, 'PANAS BUMI' nama) c
						LEFT JOIN
						( SELECT '26' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '27' urut, '2' as spasi, 'DBH Panas Bumi' nama) c
						LEFT JOIN
						( SELECT '27' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '28' urut, '1' as spasi, 'KEHUTANAN' nama) c
						LEFT JOIN
						( SELECT '28' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '29' urut, '2' as spasi, 'DBH PSDH Reboisasi Kehutanan' nama) c
						LEFT JOIN
						( SELECT '29' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210202') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '30' urut, '2' as spasi, 'DBH PSDH' nama) c
						LEFT JOIN
						( SELECT '30' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210203') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '31' urut, '2' as spasi, 'DBH HUPH' nama) c
						LEFT JOIN
						( SELECT '31' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210201','4230109') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '32' urut, '2' as spasi, 'DBH DR' nama) c
						LEFT JOIN
						( SELECT '32' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '33' urut, '1' as spasi, 'PERIKANAN' nama) c
						LEFT JOIN
						( SELECT '33' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '34' urut, '2' as spasi, 'DBH Perikanan' nama) c
						LEFT JOIN
						( SELECT '34' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '35' urut, '1' as spasi, 'TRANSFER DAU' nama) c
						LEFT JOIN
						( SELECT '35' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '36' urut, '2' as spasi, 'Transfer Dana Alokasi Umum' nama) c
						LEFT JOIN
						( SELECT '36' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4220101') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '37' urut, '1' as spasi, 'TRANSFER DAK' nama) c
						LEFT JOIN
						( SELECT '37' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '38' urut, '2' as spasi, 'Transfer Dana Alokasi Khusus' nama) c
						LEFT JOIN
						( SELECT '38' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '39' urut, '2' as spasi, 'DAK Fisik Bidang Infrastruktur Jalan dan Irigasi' nama) c
						LEFT JOIN
						( SELECT '39' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230106') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '40' urut, '2' as spasi, 'DAK Fisik Bidang Pendidikan' nama) c
						LEFT JOIN
						( SELECT '40' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230103') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '41' urut, '2' as spasi, 'DAK Fisik Bidang Kelautan dan Perikanan' nama) c
						LEFT JOIN
						( SELECT '41' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230107') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '42' urut, '2' as spasi, 'DAK Fisik Bidang Kesehatan' nama) c
						LEFT JOIN
						( SELECT '42' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230104','4230206') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '43' urut, '2' as spasi, 'DAK Fisik Bidang Pertanian' nama) c
						LEFT JOIN
						( SELECT '43' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230105') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '44' urut, '2' as spasi, 'DAK Fisik Bidang Lingkungan Hidup dan Kehutanan' nama) c
						LEFT JOIN
						( SELECT '44' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230109') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '45' urut, '2' as spasi, 'DAK Fisik Bidang Energi Skala Kecil' nama) c
						LEFT JOIN
						( SELECT '45' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230111') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '46' urut, '2' as spasi, 'Transfer Dana Alokasi Khusus BOS Satuan Pendidikan' nama) c
						LEFT JOIN
						( SELECT '46' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230207') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '47' urut, '1' as spasi, 'TRANSFER DANA OTONOMI KHUSUS' nama) c
						LEFT JOIN
						( SELECT '47' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '48' urut, '2' as spasi, 'Transfer Dana Otonomi Khusus' nama) c
						LEFT JOIN
						( SELECT '48' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '49' urut, '1' as spasi, 'TRANSFER DANA PENYESUAIAN' nama) c
						LEFT JOIN
						( SELECT '49' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '50' urut, '2' as spasi, 'Pelayanan Administrasi Kependudukan' nama) c
						LEFT JOIN
						( SELECT '50' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230210') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '51' urut, '2' as spasi, 'Dana Tambahan Penghasilan Guru PNSD' nama) c
						LEFT JOIN
						( SELECT '51' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230203') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '52' urut, '2' as spasi, 'Dana Tunjangan Profesi Guru PNSD' nama) c
						LEFT JOIN
						( SELECT '52' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230202') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '53' urut, '2' as spasi, 'Dana Tunjangan Khusus Guru PNSD' nama) c
						LEFT JOIN
						( SELECT '53' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230209') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '54' urut, '2' as spasi, 'Dana Bantuan Operasional Sekolah' nama) c
						LEFT JOIN
						( SELECT '54' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230201') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '55' urut, '2' as spasi, 'Dana Insentif Daerah (DID)' nama) c
						LEFT JOIN
						( SELECT '55' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4340104') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '56' urut, '2' as spasi, 'Dana Proyek Pemerintah Daerah dan Desentralisasi' nama) c
						LEFT JOIN
						( SELECT '56' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '57' urut, '1' as spasi, 'TRANSFER DANA DESA' nama) c
						LEFT JOIN
						( SELECT '57' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '58' urut, '2' as spasi, 'Dana Desa' nama) c
						LEFT JOIN
						( SELECT '58' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x ) z
						) z";
		
		$hasilmap = $this->db->query($sqlmap);
		foreach ($hasilmap->result() as $row)
		{
		   $nilaitot = $row->rupiah;
		}
		
		

		$cRet="";
		
		$cRet .="
			<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
				<td colspan=\"5\" align=\"center\" style=\"font-size:12px;\">LEMBAR KONFIRMASI TRANSFER KE DAERAH</td>
            </tr>
			<tr>
				<td colspan=\"5\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
            </tr>
			<tr>
                <td valign=\"top\" align=\"left\" style=\"font-size:12px;\">Telah Terima dari</td>
				<td valign=\"top\" align=\"left\" style=\"font-size:12px;\">:</td>
				<td valign=\"top\" colspan=\"3\" align=\"justify\" style=\"font-size:12px;\">Direktur Jenderal Perbendaharaan Selaku Kuasa Bendahara Umum Negara</td>
            </tr>
			<tr>
                <td valign=\"top\" align=\"left\" style=\"font-size:12px;\">Melalui KPPN sejumlah Rp.</td>
				<td valign=\"top\" align=\"left\" style=\"font-size:12px;\">:</td>
				<td valign=\"top\" colspan=\"3\" align=\"left\" style=\"font-size:12px;\">".number_format($nilaitot, '2', ',', '.')."</td>
            </tr>
			<tr>
                <td valign=\"top\" align=\"left\" style=\"font-size:12px;\">Terbilang</td>
				<td valign=\"top\" align=\"left\" style=\"font-size:12px;\">:</td>
				<td valign=\"top\" colspan=\"3\" align=\"justify\" style=\"font-size:12px;\">".$this->tukd_model->terbilang($nilaitot).";</td>
            </tr>
			<tr>
                <td valign=\"top\" align=\"left\" style=\"font-size:12px;\">Untuk Keperluan</td>
				<td valign=\"top\" align=\"left\" style=\"font-size:12px;\">:</td>
				<td valign=\"top\" colspan=\"3\" align=\"left\" style=\"font-size:12px;\">Pencairan Anggaran Transfer ke Daerah TA $lntahunang</td>
            </tr>
			<tr>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
				<td width=\"5%\" align=\"left\" style=\"font-size:12px;\">Bulan</td>
				<td width=\"5%\" align=\"left\" style=\"font-size:12px;\">:</td>
				<td align=\"left\" style=\"font-size:12px;\">$bulan $lntahunang</td>
            </tr>
			<tr>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
				<td width=\"5%\" align=\"left\" style=\"font-size:12px;\">Daerah</td>
				<td width=\"5%\" align=\"left\" style=\"font-size:12px;\">:</td>
				<td align=\"left\" style=\"font-size:12px;\">Prov.Kalbar</td>
            </tr>
			<tr>
                <td align=\"left\" style=\"font-size:12px;\">Dengan Rincian</td>
				<td align=\"left\" style=\"font-size:12px;\">:</td>
				<td colspan=\"3\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
            </tr>
            
			</table>";
			
			$cRet .="<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" width=\"50%\" style=\"font-weight:bold;\">JENIS ANGGARAN TRANSFER KE DAERAH</td>  
                <td align=\"center\" width=\"15%\" style=\"font-weight:bold;\">JUMLAH KOTOR</td>
				<td align=\"center\" width=\"5%\" style=\"font-weight:bold;\">POT.</td>
                <td align=\"center\" width=\"15%\" style=\"font-weight:bold;\">JUMLAH BERSIH</td>
                <td align=\"center\" width=\"15%\" style=\"font-weight:bold;\">Diterima Tanggal</td>
            </tr>
			</thead>";
			
			$sql = "SELECT * FROM (
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '1' urut, '1' as spasi, 'PENYALURAN TRANSFER MELALUI KPPN' nama) c
						LEFT JOIN
						(SELECT '1' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x 

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '2' urut, '1' as spasi, 'TRANSFER DBH PAJAK' nama) c
						LEFT JOIN
						(SELECT '2' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x 

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '3' urut, '2' as spasi, 'DBH PPh Pasal 21' nama) c
						LEFT JOIN
						( SELECT '3' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210105') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '4' urut, '2' as spasi, 'DBH PPh Pasal 25-29 WPOPDN' nama) c
						LEFT JOIN
						( SELECT '4' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210103') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '5' urut, '2' as spasi, 'DBH PBB Bagi Rata' nama) c
						LEFT JOIN
						( SELECT '5' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '6' urut, '2' as spasi, 'DBH PBB Migas' nama) c
						LEFT JOIN
						( SELECT '6' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210101') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '7' urut, '2' as spasi, 'Biaya Pemungutan PBB Migas' nama) c
						LEFT JOIN
						( SELECT '7' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210104') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '8' urut, '2' as spasi, 'DBH PBB Panas Bumi' nama) c
						LEFT JOIN
						( SELECT '8' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '9' urut, '2' as spasi, 'Biaya Pemungutan PBB Panas Bumi' nama) c
						LEFT JOIN
						( SELECT '9' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210102') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '10' urut, '2' as spasi, 'PBB Bagian Prov/Kab/Kota' nama) c
						LEFT JOIN
						( SELECT '10' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '11' urut, '2' as spasi, 'Kurang Bayar DBH PBB Bagian Prov TA 2014 pada' nama) c
						LEFT JOIN
						( SELECT '11' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '12' urut, '1' as spasi, 'TRANSFER DBH CUKAI' nama) c
						LEFT JOIN
						( SELECT '12' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '13' urut, '2' as spasi, 'DBH Cukai Hasil Tembakau' nama) c
						LEFT JOIN
						( SELECT '13' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210106') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						--UNION
						--SELECT urut, spasi, nama, ISNULL(SUM(rupiah),0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						--SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						--(select '13' urut, '2' as spasi, 'DBH Pajak Rokok' nama) c
						--LEFT JOIN
						--( SELECT '13' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and --a.kd_skpd=b.kd_skpd
						--where kd_rek5 in ('4110501') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						--GROUP BY urut, spasi, nama, tgl_kas

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '14' urut, '1' as spasi, 'TRANSFER DBH SDA' nama) c
						LEFT JOIN
						( SELECT '14' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '15' urut, '1' as spasi, 'PERTAMBANGAN UMUM' nama) c
						LEFT JOIN
						( SELECT '15' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '16' urut, '2' as spasi, 'DBH Pertambangan Umum - Iuran Tetap' nama) c
						LEFT JOIN
						( SELECT '16' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210204') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '17' urut, '2' as spasi, 'DBH Pertambangan Umum - Royalti' nama) c
						LEFT JOIN
						( SELECT '17' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210205') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '18' urut, '1' as spasi, 'MINYAK' nama) c
						LEFT JOIN
						( SELECT '18' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '19' urut, '2' as spasi, 'DBH Minyak 15%' nama) c
						LEFT JOIN
						( SELECT '19' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '20' urut, '2' as spasi, 'DBH Minyak 0,5%' nama) c
						LEFT JOIN
						( SELECT '20' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '21' urut, '2' as spasi, 'DBH Minyak Dalam Rangka Otsus' nama) c
						LEFT JOIN
						( SELECT '21' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '22' urut, '1' as spasi, 'GAS' nama) c
						LEFT JOIN
						( SELECT '22' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '23' urut, '2' as spasi, 'DBH Gas 30%' nama) c
						LEFT JOIN
						( SELECT '23' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '24' urut, '2' as spasi, 'DBH Gas 0,5%' nama) c
						LEFT JOIN
						( SELECT '24' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '25' urut, '2' as spasi, 'DBH Gas Dalam Rangka Otsus' nama) c
						LEFT JOIN
						( SELECT '25' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '26' urut, '1' as spasi, 'PANAS BUMI' nama) c
						LEFT JOIN
						( SELECT '26' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '27' urut, '2' as spasi, 'DBH Panas Bumi' nama) c
						LEFT JOIN
						( SELECT '27' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '28' urut, '1' as spasi, 'KEHUTANAN' nama) c
						LEFT JOIN
						( SELECT '28' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '29' urut, '2' as spasi, 'DBH PSDH Reboisasi Kehutanan' nama) c
						LEFT JOIN
						( SELECT '29' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210202') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '30' urut, '2' as spasi, 'DBH PSDH' nama) c
						LEFT JOIN
						( SELECT '30' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210203') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '31' urut, '2' as spasi, 'DBH HUPH' nama) c
						LEFT JOIN
						( SELECT '31' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4210201','4230109') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '32' urut, '2' as spasi, 'DBH DR' nama) c
						LEFT JOIN
						( SELECT '32' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '33' urut, '1' as spasi, 'PERIKANAN' nama) c
						LEFT JOIN
						( SELECT '33' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '34' urut, '2' as spasi, 'DBH Perikanan' nama) c
						LEFT JOIN
						( SELECT '34' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '35' urut, '1' as spasi, 'TRANSFER DAU' nama) c
						LEFT JOIN
						( SELECT '35' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '36' urut, '2' as spasi, 'Transfer Dana Alokasi Umum' nama) c
						LEFT JOIN
						( SELECT '36' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4220101') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '37' urut, '1' as spasi, 'TRANSFER DAK' nama) c
						LEFT JOIN
						( SELECT '37' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '38' urut, '2' as spasi, 'Transfer Dana Alokasi Khusus' nama) c
						LEFT JOIN
						( SELECT '38' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '39' urut, '2' as spasi, 'DAK Fisik Bidang Infrastruktur Jalan dan Irigasi' nama) c
						LEFT JOIN
						( SELECT '39' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230106') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '40' urut, '2' as spasi, 'DAK Fisik Bidang Pendidikan' nama) c
						LEFT JOIN
						( SELECT '40' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230103') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '41' urut, '2' as spasi, 'DAK Fisik Bidang Kelautan dan Perikanan' nama) c
						LEFT JOIN
						( SELECT '41' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230107') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '42' urut, '2' as spasi, 'DAK Fisik Bidang Kesehatan' nama) c
						LEFT JOIN
						( SELECT '42' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230104','4230206') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '43' urut, '2' as spasi, 'DAK Fisik Bidang Pertanian' nama) c
						LEFT JOIN
						( SELECT '43' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230105') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '44' urut, '2' as spasi, 'DAK Fisik Bidang Lingkungan Hidup dan Kehutanan' nama) c
						LEFT JOIN
						( SELECT '44' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230109') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '45' urut, '2' as spasi, 'DAK Fisik Bidang Energi Skala Kecil' nama) c
						LEFT JOIN
						( SELECT '45' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230111') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '46' urut, '2' as spasi, 'Transfer Dana Alokasi Khusus BOS Satuan Pendidikan' nama) c
						LEFT JOIN
						( SELECT '46' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230207') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '47' urut, '1' as spasi, 'TRANSFER DANA OTONOMI KHUSUS' nama) c
						LEFT JOIN
						( SELECT '47' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '48' urut, '2' as spasi, 'Transfer Dana Otonomi Khusus' nama) c
						LEFT JOIN
						( SELECT '48' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '49' urut, '1' as spasi, 'TRANSFER DANA PENYESUAIAN' nama) c
						LEFT JOIN
						( SELECT '49' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '50' urut, '2' as spasi, 'Pelayanan Administrasi Kependudukan' nama) c
						LEFT JOIN
						( SELECT '50' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230210') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '51' urut, '2' as spasi, 'Dana Tambahan Penghasilan Guru PNSD' nama) c
						LEFT JOIN
						( SELECT '51' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230203') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '52' urut, '2' as spasi, 'Dana Tunjangan Profesi Guru PNSD' nama) c
						LEFT JOIN
						( SELECT '52' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230202') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x
						
						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '53' urut, '2' as spasi, 'Dana Tunjangan Khusus Guru PNSD' nama) c
						LEFT JOIN
						( SELECT '53' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230209') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '54' urut, '2' as spasi, 'Dana Bantuan Operasional Sekolah' nama) c
						LEFT JOIN
						( SELECT '54' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4230201') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '55' urut, '2' as spasi, 'Dana Insentif Daerah (DID)' nama) c
						LEFT JOIN
						( SELECT '55' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4340104') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '56' urut, '2' as spasi, 'Dana Proyek Pemerintah Daerah dan Desentralisasi' nama) c
						LEFT JOIN
						( SELECT '56' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '57' urut, '1' as spasi, 'TRANSFER DANA DESA' nama) c
						LEFT JOIN
						( SELECT '57' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x

						UNION
						SELECT urut, spasi, nama, ISNULL(rupiah,0) rupiah, ISNULL(tgl_kas,'') tgl_kas FROM (
						SELECT c.urut, c.spasi, c.nama, d.rupiah, d.tgl_kas FROM
						(select '58' urut, '2' as spasi, 'Dana Desa' nama) c
						LEFT JOIN
						( SELECT '58' urut, b.tgl_kas, a.rupiah from trdkasin_ppkd a inner join trhkasin_ppkd b on a.no_kas=b.no_kas and a.kd_skpd=b.kd_skpd
						where kd_rek5 in ('4') AND MONTH(tgl_kas)=$bln ) d on c.urut=d.urut )x ) z
						order by CAST(urut as int)";
                    
					$tot=0;
					$hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $urut = $row->urut;
                       $spasi = $row->spasi;
                       $nama = $row->nama;
                       $nilai = $row->rupiah;
                       $tgl_kas = $row->tgl_kas;
					   
					   
					   
					   if($tgl_kas=='1900-01-01'){
						   $tanggal_kas='';
					   }else{
						   $tanggal_kas = $this->tukd_model->tanggal_format_indonesia($tgl_kas);
					   }
					   
					   $tot=$tot+$nilai;
					
					switch ($spasi) {
					 case 1:
                        $cRet .='<tr>
							   <td align="left"  valign="top">'.$nama.'</td> 
							   <td align="right" valign="top"></td> 
							   <td align="right" valign="top"></td> 
							   <td align="right" valign="top"></td> 
							   <td align="right" valign="top"></td> 
							</tr>'; 
                        break;	
                    case 2:
                          $cRet .='<tr>
							   <td align="left"  valign="top">&nbsp;&nbsp;'.$nama.', '.$tw.'</td> 
							   <td align="right" valign="top">'.number_format($nilai, "2", ",", ".").'</td> 
							   <td align="right" valign="top"></td> 
							   <td align="right" valign="top">'.number_format($nilai, "2", ",", ".").'</td> 
							   <td align="right" valign="top">'.$tanggal_kas.'</td> 
							</tr>'; 
                        break;
					 }
					 
					}
					
					 $cRet .='<tr>
							   <td align="left"  valign="top">JUMLAH TOTAL PENERIMAAN TRANSFER</td> 
							   <td align="right" valign="top">'.number_format($tot, "2", ",", ".").'</td> 
							   <td align="right" valign="top"></td> 
							   <td align="right" valign="top">'.number_format($tot, "2", ",", ".").'</td> 
							   <td align="right" valign="top"></td> 
							</tr>'; 
			
			$cRet .="</table>";
			
			$cRet .="
			<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td colspan=\"6\" align=\"left\" style=\"font-size:12px;\">Dana tersebut telah diterima pada Rekening Kas Daerah sebagai berikut:</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">- Rekening Kas Daerah</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\"><b>&#8594;</b></td>
                <td align=\"left\" style=\"font-size:12px;\">Nomor Rekening</td>
                <td align=\"left\" style=\"font-size:12px;\">:</td>
                <td align=\"left\" style=\"font-size:12px;\">1001002201</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">Nama Rekening</td>
                <td align=\"left\" style=\"font-size:12px;\">:</td>
                <td align=\"left\" style=\"font-size:12px;\">Rekening Kas Umum Daerah Prov. Kalbar</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;\">Nama Bank</td>
                <td align=\"left\" style=\"font-size:12px;\">:</td>
                <td align=\"left\" style=\"font-size:12px;\">Bank Kalbar Cabang Utama Pontianak</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px;\">".$daerah.", ".$tanggal_ttd."</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px;\">an. GUBERNUR KALIMANTAN BARAT,</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px;\">Kepala Badan Pengelolaan Keuangan Dan Pendapatan Daerah</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px;\"><b><u>".$namattd."</u></b></td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px;\">".$pangkat."</td>
            </tr>
			<tr>
                <td width=\"5%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"20%\" align=\"left\" style=\"font-size:12px;\">&nbsp;</td>
                <td width=\"10%\" align=\"left\" style=\"font-size:12px;font-weight:30px;\">&nbsp;</td>
                <td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px;\">NIP. ".$nip."</td>
            </tr>
			</table>";
			
			switch ($ctk)
        {
            case 0;
			echo ("<title>Transfer Dana</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,10,1,'');
               break;
		}
			
	}
	
 
	function load_penerimaan_lain_ppkd2() {
        $skpd = $this->session->userdata('kdskpd');
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria <> ''){                               
            $where="WHERE a.kd_skpd ='$skpd' AND a.jns_trans=4 AND (upper(a.no_sts) like upper('%$kriteria%') or a.tgl_sts like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%'))";            
        } else{
			$where="WHERE a.kd_skpd ='$skpd' AND a.jns_trans=4 AND (upper(a.no_sts) like upper('%%'))";
		}
        
        $sql = "SELECT count(*) as tot from trhkasin_pkd a $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
 
		$sql = " SELECT TOP $rows a.*, b.kd_kegiatan, b.kd_rek5, c.nm_rek5,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd 
				from trhkasin_pkd a  INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd
				AND a.no_sts=b.no_sts 
				LEFT JOIN ms_rek5 c ON b.kd_rek5=c.kd_rek5
				$where AND a.no_sts NOT in (SELECT TOP $offset no_sts FROM trhkasin_pkd a $where order by CAST(a.no_kas as int)) order by CAST(a.no_kas as int)";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,      
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total'],2,'.',','),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nm_skpd' => $resulte['nm_skpd'],
						'sumber' => $resulte['sumber']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	}

	function load_pengirim_ppkd() {        
        
        $skpd = $this->session->userdata('kdskpd');               
        $lccr = $this->input->post('q');
        
        $sql = "select * from ms_pengirim where kd_skpd='$skpd' AND (upper(kd_pengirim) like upper('%$lccr%') OR upper(nm_pengirim) like upper('%$lccr%'))
			order by cast(kd_pengirim as int)";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_pengirim' => $resulte['kd_pengirim'],  
                        'nm_pengirim' => $resulte['nm_pengirim'],
                        'kd_skpd'     => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
	 
	
	function load_rekening_ppkd2() {
       
		$sql = "select * from trdrka_pend where left(kd_rek5,1)='4' and kd_skpd='4.02.02.02' order by kd_rek5";
		
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,           
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5']                                                                                          
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	function cek_simpan2(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');

		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' and kd_skpd='3.13.01.17' ");
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
		$msg = array('pesan'=>'1');
        echo json_encode($msg);
		} else{
		$msg = array('pesan'=>'0');
        echo json_encode($msg);
		}
		
	}
	 
	function simpan_kas_lainnya_ppkd(){
        $kd_skpd = $this->session->userdata('kdskpd'); 
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $pengirim    = $this->input->post('pengirim');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "insert into trhkasin_pkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,no_kas,tgl_kas,sumber,user_name) 
                        values('$nokas'+'/BP','$kd_skpd','$ttd','$ket','$nilai','3.13.3.13.01.17.00.04','4','$nokas','$ttd','$pengirim','$usernm')";
            $asg = $this->db->query($sql);
            
			 $sql = "insert into trdkasin_pkd(kd_skpd,no_sts,kd_rek5,rupiah,kd_kegiatan) values ('$kd_skpd','$nokas'+'/BP','$jns','$nilai','3.13.3.13.01.17.00.04')";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }

	function update_kas_lainnya_ppkd(){
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $pengirim    = $this->input->post('pengirim');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "update trhkasin_pkd set tgl_sts='$ttd',keterangan='$ket',total='$nilai',tgl_kas='$ttd',sumber='$pengirim' WHERE no_sts='$nokas' and kd_skpd='$kd_skpd' and jns_trans=4";
            $asg = $this->db->query($sql);
            
			 $sql = "update trdkasin_pkd set kd_rek5='$jns',rupiah='$nilai' WHERE no_sts='$nokas' and kd_skpd='$kd_skpd' and LEFT(kd_rek5,1)=4";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '1';
            }else{
                echo '0';
            }
        

    }	
	
	function penerimaan_kas_lainnya_ppkd()
    {
        $data['page_title']= 'PENERIMAAN LAINNYA';
        $this->template->set('title', 'PENERIMAAN LAINNYA');   
        $this->template->load('template','tukd/sp2d/penerimaan_kas_lainnya_ppkd',$data) ; 
    }
	
	
	function no_urut_ppkd2(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
	select no_sts nomor,'Terima STS' ket,kd_skpd from trhkasin_pkd where isnumeric(no_kas)=1 and kd_skpd='$kd_skpd'
	) z 
	");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }

	function no_urut_ppkd3(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("SELECT COUNT(no_sts)+1 nomor FROM trhkasin_pkd WHERE kd_skpd='$kd_skpd' AND jns_trans=4");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }

	
	function hapus_penerimaan_lainnya_ppkd() {    	
		$no_kas = $this->input->post('no_kas');
		$tgl = $this->input->post('tgl_kas');
		$kd_skpd = $this->session->userdata('kdskpd'); 
		
        $query = "delete from trhkasin_pkd where no_sts='$no_kas' and kd_skpd='$kd_skpd' AND jns_trans=4";
		$asg = $this->db->query($query);
		
		$query = "delete from trdkasin_pkd where no_sts='$no_kas' and kd_skpd='$kd_skpd' AND LEFT(kd_rek5,1)=4";
		$asg = $this->db->query($query);
		
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }

	
	function register_cp_ppkd()
    {
        $data['page_title']= 'CETAK REGISTER CP';
        $this->template->set('title', 'CETAK REGISTER CP');   
        $this->template->load('template','tukd/pendapatan/cetak_register_cp_ppkd',$data) ; 
    }
 
	function koreksi_penerimaan(){
        $data['page_title']= 'KOREKSI PENERIMAAN';
        $this->template->set('title', 'KOREKSI PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/koreksi_penerimaan',$data) ; 
    }	

	function cetak_reg_cp_ppkd($lcskpd='',$ctk='',$ttd1='',$ttd2='',$tglttd='',$tgl1='',$tgl2=''){
        $nomor = str_replace('123456789',' ',$ttd1);
		$nip2 = str_replace('123456789',' ',$ttd2);
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($tglttd);
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$lcskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip = '$nomor'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		
			$cRet ='<TABLE style="border-collapse:collapse; font-size:14px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>'.$prov.' </TD>
					</TR>
					<tr></tr>
                    <TR>
						<TD align="center" ><b>REGISTER CP <br>
											</TD>
					</TR>
					</TABLE><br/>';

			$cRet .='<TABLE style="border-collapse:collapse; font-size:14px" width="100%">
					 <TR>
						<TD align="left" width="20%" >OPD</TD>
						<TD align="left" width="100%" >: '.$lcskpd.' '.$skpd.'</TD>
					 </TR>
					 <TR>
						<TD align="left">Kepala OPD</TD>
						<TD align="left">: '.$nama.'</TD>
					 </TR>
					 </TABLE>';

			$cRet .='<TABLE style="border-collapse:collapse; font-size:14px" width="100%" border="1" cellspacing="2" cellpadding="2" align="center">
					 <thead>
					 <TR>
						<TD width="10%" bgcolor="#CCCCCC" align="center" ><b>No.</b></TD>
                        <TD width="10%" bgcolor="#CCCCCC" align="center" ><b>Tanggal CP</b></TD>
						<TD width="10%" bgcolor="#CCCCCC" align="center" ><b>No STS </b></TD>
						<TD width="20%" bgcolor="#CCCCCC" align="center" ><b>No SP2D</b></TD>
						<TD width="30%" bgcolor="#CCCCCC" align="center" ><b>Uraian</b></TD>
						<TD width="20%" bgcolor="#CCCCCC" align="center" ><b>Jumlah CP</b></TD>
					 </TR>
					 </thead>
					 ';
			
			
				$query = $this->db->query("SELECT * FROM (
								select a.tgl_sts, b.no_sts, a.no_sp2d, a.keterangan, b.rupiah ls
								from trhkasin_pkd a inner join trdkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts and a.kd_kegiatan=b.kd_kegiatan
													inner join trhkasin_ppkd c on a.kd_skpd=c.kd_skpd and a.no_sts=c.no_sts
													inner join trdkasin_ppkd d on c.kd_skpd=d.kd_skpd and c.no_sts=d.no_sts and c.no_kas=d.no_kas
								where a.kd_skpd='$lcskpd' and a.tgl_sts BETWEEN '$tgl1' AND '$tgl2' AND a.jns_trans IN ('5') AND LEFT(b.kd_rek5,1) IN ('5')) x
								GROUP BY tgl_sts, no_sts, no_sp2d, keterangan, ls
								ORDER BY tgl_sts, no_sts, no_sp2d, ls");
						
						
				$lcno=0;
				$tot_ls=0;
				foreach ($query->result() as $row) {
                    $tgl_sts = $row->tgl_sts; 
                    $no_sts = $row->no_sts;    
                    $no_sp2d = $row->no_sp2d;
					$keterangan=$row->keterangan;
                    $ls  = $row->ls;
                    $lcno=$lcno+1;
							$cRet.='<TR>
								<TD valign="top" align="center"> '.$lcno.' </TD>
								<TD valign="top" align="left">'.$this->tanggal_indonesia($tgl_sts).'</TD>
								<TD valign="top" align="center">'.$no_sts.'</TD>
								<TD valign="top" align="left">'.$no_sp2d.'</TD>
								<TD valign="top" align="left">'.$keterangan.'</TD>
								<TD valign="top" align="right">'.number_format($ls,'2','.',',').'</TD>
							 </TR>';
				$tot_ls=$tot_ls+$ls;
				}
				$cRet.='<TR>
								<TD colspan="5" valign="top" align="center"><b>J U M L A H</b></TD>
								<TD valign="top" align="right"><b>'.number_format($tot_ls,'2','.',',').'</b></TD>
							 </TR>';
				
			$cRet .='</TABLE>';
			
			$cRet .='<TABLE style="font-size:14px;" width="100%" align="center">
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" >Mengetahui,</TD>
						<TD width="50%" align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" >'.$jabatan.'</TD>
						<TD width="50%" align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					 <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
						<TD width="50%" align="center" ><b><u>'.$nama1.'</u></b><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" >'.$nip.'</TD>
						<TD width="50%" align="center" >'.$nip1.'</TD>
					</TR>
					
					</TABLE><br/>';

			$data['prev']= 'DTH';
             switch ($ctk)
        {
            case 0;
			echo ("<title>REG. CP</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,10,1,'');
               break;
		}
	}
	
	
	function ambil_rek_sts_ppkd() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
        $lcgiat = $this->uri->segment(4);
        $lcfilt = $this->uri->segment(6);
		$sp2d = str_replace('123456789','/',$this->uri->segment(5));
        $lc = '';
        if ($lcfilt!=''){
            $lcfilt = str_replace('A',"'",$lcfilt);
            $lcfilt = str_replace('B',",",$lcfilt);
            $lc = " and a.kd_rek5 not in ($lcfilt)";
        }
        
       
            $sql = "SELECT z.*, nilai-isnull(transaksi,0) as sisa FROM (SELECT a.kd_rek5,a.nm_rek5,SUM(a.nilai) as nilai,
					(SELECT sum(nilai) FROM trdtransout WHERE no_sp2d=c.no_sp2d and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) as transaksi
					FROM trdspp a INNER JOIN trhspp b ON a.no_spp = b.no_spp 
					INNER JOIN trhsp2d c ON c.no_spp = b.no_spp where c.no_sp2d ='$sp2d'
					AND c.kd_skpd = '$lckdskpd' and a.kd_kegiatan = '$lcgiat' 
					AND upper(a.kd_rek5) like upper('%$lccr%') $lc GROUP BY kd_rek5, nm_rek5,no_sp2d,a.kd_kegiatan)z
					";
            
       
        
        //echo $sql; upper(a.kd_rek5) like upper('%$lccr%') $lc
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],                  
                        'nilai' => $resulte['nilai'] ,                 
                        'transaksi' => $resulte['transaksi'],                  
                        'sisa' => $resulte['sisa']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	
	function ambil_rek1_ppkd() {
        $lccr = $this->input->post('q');
        $lcfilt = $this->uri->segment(3);
        $lc = '';
        if ($lcfilt!=''){
            $lcfilt = str_replace('A',"'",$lcfilt);
            $lcfilt = str_replace('B',",",$lcfilt);
            $lc = " and a.kd_rek5 not in ($lcfilt)";
        }
        
       
            $sql = "SELECT a.kd_rek5,a.nm_rek5 FROM ms_rek5 a
            where left(kd_rek5,3)='111' $lc";
            
       
        
        //echo $sql;
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function simpan_sts_ar_ppkd(){
        $tabel       = $this->input->post('tabel');
        $nomor       = $this->input->post('no');
        $nomor_kas   = $this->input->post('lckas');
        $tgl_kas     = $this->input->post('tglkas');
        $bank        = $this->input->post('bank');
        $tgl         = $this->input->post('tgl');
        $skpd        = $this->input->post('skpd');
        $ket         = $this->input->post('ket');
        $jnsrek      = $this->input->post('jnsrek');
        $giat        = $this->input->post('giat');
        $rekbank     = $this->input->post('rekbank');
        $total       = $this->input->post('total');
        $lckdrek     = $this->input->post('kdrek');
        $lnil_rek    = $this->input->post('nilai');
        $lcnilaidet  = $this->input->post('value_det');
        $sumber      = $this->input->post('sts');  
        $sp2d        = $this->input->post('sp2d');  
        $jns_cp      = $this->input->post('jns_cp');  
        $potlain     = $this->input->post('potlain');  
        $nmskpd      = $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $usernm      = $this->session->userdata('pcNama');
		$last_update = date('d-m-y H:i:s');
      // $last_update = " ";
	  
		if($jnsrek=='5'){
			$and = "AND LEFT(kd_rek5,1)<>'4'";
			$no_terima = $nomor_kas+1;
		}else{
			$and = "";
			$no_terima = "";
		}
	  
        $msg = array();
        if ($tabel == 'trhkasin_pkd') {
            
            $sql = "delete from trhkasin_pkd where kd_skpd='$skpd' and no_sts='$nomor' and jns_trans='$jnsrek'";
            $asg = $this->db->query($sql);
            
            if ($asg){
				
				 $sql = "insert into trhkasin_pkd(no_kas,no_sts,kd_skpd,tgl_sts,tgl_kas,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber,pot_khusus,no_sp2d,jns_cp,no_terima) 
                        values('$nomor_kas','$nomor','$skpd','$tgl','$tgl_kas','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$usernm','$potlain','$sp2d','$jns_cp','$no_terima')";
				 
				$asg = $this->db->query($sql); 
				 
				/* $sql = "insert into trhkasin_ppkd(no_kas,no_sts,kd_skpd,tgl_sts,tgl_kas,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber,pot_khusus,no_sp2d,jns_cp) 
                        values('$nomor_kas','$nomor','$skpd','$tgl','$tgl_kas','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$usernm','$potlain','$sp2d','$jns_cp')";
				
                $asg = $this->db->query($sql); */
				
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_pkd where no_sts='$nomor' AND kd_skpd='$skpd' $and";
					 $asg = $this->db->query($sql);
					
					/* $sql = "delete from trdkasin_ppkd where no_sts='$nomor' AND kd_skpd='$skpd'";
                    $asg = $this->db->query($sql); */
					
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                         $sql = "insert into trdkasin_pkd(kd_skpd,no_sts,kd_rek5,rupiah,kd_kegiatan,no_terima) values $lcnilaidet";
						 $asg = $this->db->query($sql);
						
						/* $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,kd_kegiatan,no_kas) values $lcnilaidet";
                        $asg = $this->db->query($sql); */
                    }                
                }            
            } 
            echo '2';
        }
    }
	
	function update_sts_kas_ag_ppkd(){
        
        $tabel       = $this->input->post('tabel');
        $nomor       = $this->input->post('no');
        $nohide       = $this->input->post('nohide');
        $nomor_kas       = $this->input->post('lckas');
        $tgl_kas       = $this->input->post('tglkas');
        $bank        = $this->input->post('bank');
        $tgl         = $this->input->post('tgl');
        $skpd        = $this->input->post('skpd');
        $ket         = $this->input->post('ket');
        $jnsrek      = $this->input->post('jnsrek');
        $giat        = $this->input->post('giat');
        $rekbank     = $this->input->post('rekbank');
        $total       = $this->input->post('total');
        $lckdrek     = $this->input->post('kdrek');
        $lnil_rek    = $this->input->post('nilai');
        $lcnilaidet  = $this->input->post('value_det');
        $sumber      = $this->input->post('sts');  
        $sp2d        = $this->input->post('sp2d');  
        $jns_cp        = $this->input->post('jns_cp');
		$potlain   = $this->input->post('potlain');  
		$no_terima   = $this->input->post('no_terima');  

        $nmskpd      = $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $usernm      = $this->session->userdata('pcNama');
		$last_update = date('d-m-y H:i:s');
      // $last_update = " ";
        $msg = array();
        if ($tabel == 'trhkasin_pkd') {
            
            $sql = "delete from trhkasin_pkd where kd_skpd='$skpd' and no_sts='$nohide' and jns_trans='$jnsrek'";
			$asg = $this->db->query($sql);
			
			/* $sql = "delete from trhkasin_ppkd where kd_skpd='$skpd' and no_kas='$nomor'";
            $asg = $this->db->query($sql); */
			
            if ($asg){
				
				 $sql = "insert into trhkasin_pkd(no_kas,no_sts,kd_skpd,tgl_sts,tgl_kas,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber,pot_khusus,no_sp2d,jns_cp) 
                        values('$nomor_kas','$nomor','$skpd','$tgl','$tgl_kas','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$$usernm','$potlain','$sp2d','$jns_cp')";
				
               
                $asg = $this->db->query($sql);
				
				/* $sql = "insert into trhkasin_ppkd(no_kas,no_sts,kd_skpd,tgl_sts,tgl_kas,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber,pot_khusus,no_sp2d,jns_cp) 
                        values('$nomor_kas','$nomor','$skpd','$tgl','$tgl_kas','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$usernm','$potlain','$sp2d','$jns_cp')";
				
                $asg = $this->db->query($sql); */
				
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_pkd where no_sts='$nohide' AND kd_skpd='$skpd' AND LEFT(kd_rek5,1)=5";
					$asg = $this->db->query($sql); 
					
					/* $sql = "delete from trdkasin_ppkd where no_sts='$nomor' AND kd_skpd='$skpd'";
                    $asg = $this->db->query($sql);
					 */
                       
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_pkd(kd_skpd,no_sts,kd_rek5,rupiah,kd_kegiatan,no_terima) values $lcnilaidet";
                        $asg = $this->db->query($sql); 
						
						/* $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,kd_kegiatan,no_kas) values $lcnilaidet";
                        $asg = $this->db->query($sql); */
                    }                
                }            
            } 
            echo '2';
        }
        
       
    }
    
	function load_sisa_tunai_ppkd(){
		$kd_skpd  = $this->session->userdata('kdskpd');        
        $query1 = $this->db->query("SELECT 
				SUM(case when jns=1 then jumlah else 0 end ) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				FROM (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan WHERE kd_skpd='$kd_skpd' UNION ALL
				select tgl_kas as tgl,no_kas as bku,keterangan as ket, nilai as jumlah, '1' as jns,kd_skpd as kode from tr_jpanjar where jns=2 AND kd_skpd='$kd_skpd' UNION ALL
				select tgl_panjar as tgl,no_panjar as bku,keterangan as ket, nilai as jumlah, '2' as jns,kd_skpd as kode from tr_panjar WHERE kd_skpd='$kd_skpd' UNION ALL
				select a.tgl_sts as tgl,a.no_sts as bku, a.keterangan as ket, SUM(b.rupiah) as jumlah, '2' as jns, a.kd_skpd as kode 
					from trhkasin_pkd a INNER JOIN trdkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
					where jns_trans NOT IN('4','2') and pot_khusus =0  AND a.kd_skpd='$kd_skpd'
					GROUP BY a.tgl_sts,a.no_sts, a.keterangan,a.kd_skpd				
				UNION ALL
				SELECT	a.tgl_bukti AS tgl,	a.no_bukti AS bku, a.ket AS ket, SUM(z.nilai) - isnull(pot, 0) AS jumlah, '2' AS jns, a.kd_skpd AS kode
								FROM trhtransout a INNER JOIN trdtransout z ON a.no_bukti=z.no_bukti AND a.kd_skpd=z.kd_skpd
								LEFT JOIN trhsp2d b ON z.no_sp2d = b.no_sp2d
								LEFT JOIN (SELECT no_spm, SUM (nilai) pot	FROM trspmpot GROUP BY no_spm) c
								ON b.no_spm = c.no_spm WHERE pay = 'TUNAI' AND panjar <> 1
								AND a.kd_skpd='$kd_skpd' 
								AND a.no_bukti NOT IN(
								select no_bukti from trhtransout 
								where no_sp2d in 
								(SELECT no_sp2d as no_bukti FROM trhtransout where kd_skpd='$kd_skpd' GROUP BY no_sp2d HAVING COUNT(no_sp2d)>1)
								 and  no_kas not in
								(SELECT min(z.no_kas) as no_bukti FROM trhtransout z WHERE z.jns_spp in (4,5,6) and kd_skpd='$kd_skpd' 
								
								GROUP BY z.no_sp2d HAVING COUNT(z.no_sp2d)>1)
								and jns_spp in (4,5,6) and kd_skpd='$kd_skpd')
								GROUP BY a.tgl_bukti,a.no_bukti,a.ket,a.no_sp2d,z.no_sp2d,a.total,pot,a.kd_skpd
						UNION ALL
				SELECT	tgl_bukti AS tgl,	no_bukti AS bku, ket AS ket,  isnull(total, 0) AS jumlah, '2' AS jns, kd_skpd AS kode
								from trhtransout 
								WHERE pay = 'TUNAI' AND panjar <> 1 and no_sp2d in 
								(SELECT no_sp2d as no_bukti FROM trhtransout where kd_skpd='$kd_skpd' GROUP BY no_sp2d HAVING COUNT(no_sp2d)>1)
								AND   no_kas not in
								(SELECT min(z.no_kas) as no_bukti FROM trhtransout z WHERE z.jns_spp in (4,5,6) and kd_skpd='$kd_skpd' 
							
								GROUP BY z.no_sp2d HAVING COUNT(z.no_sp2d)>1)
								and jns_spp in (4,5,6) and kd_skpd='$kd_skpd'
				
				UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain  WHERE pay='TUNAI' AND kd_skpd='$kd_skpd'UNION ALL
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_setorsimpanan WHERE jenis ='2' AND kd_skpd='$kd_skpd'UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='TUNAI'AND kd_skpd='$kd_skpd'
				) a 
				where  kode='$kd_skpd'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        //'rekspm' => number_format($resulte['rekspm'],2,'.',','),
                        'sisa' => number_format(($resulte['terima'] - $resulte['keluar']),2,'.',',')                      
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	}
	
	
	function cek_simpan_ppkd(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');
	    $field2    = $this->input->post('field2');
	    $tabel2   = $this->input->post('tabel2');
		$kd_skpd  = $this->session->userdata('kdskpd');        
		if ($field2==''){
		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' and kd_skpd = '$kd_skpd' ");
		} else{
		$hasil=$this->db->query(" select count(*) as jumlah FROM (select $field as nomor FROM $tabel WHERE kd_skpd = '$kd_skpd' UNION ALL
		SELECT $field2 as nomor FROM $tabel2 WHERE kd_skpd = '$kd_skpd')a WHERE a.nomor = '$nomor' ");		
		}
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
		$msg = array('pesan'=>'1');
        echo json_encode($msg);
		} else{
		$msg = array('pesan'=>'0');
        echo json_encode($msg);
		}
		
	}

	function cek_simpan_ppkd2(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');
	    $kd_skpd  = $this->session->userdata('kdskpd');        
		
		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' and kd_skpd = '$kd_skpd' and jns_trans<>'4'");
		
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
		$msg = array('pesan'=>'1');
        echo json_encode($msg);
		} else{
		$msg = array('pesan'=>'0');
        echo json_encode($msg);
		}
		
	}

	function sts_kas_ppkd()
    {
        $data['page_title']= 'INPUT S T S KAS';
        $this->template->set('title', 'INPUT S T S KAS');   
        $this->template->load('template','tukd/pendapatan/sts_kas_ppkd',$data) ; 
    }
	
	function load_sts_kas_ppkd() {
		$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
		$kd_skpd = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="AND (upper(a.no_sts) like upper('%$kriteria%') or a.tgl_sts like '%$kriteria%')";            
        }

		$sql = "SELECT count(*) as tot from trhkasin_pkd a WHERE  kd_skpd = '$kd_skpd' $where ";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
                
        $sql = "SELECT TOP $rows a.* ,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd from trhkasin_pkd a 
				where a.kd_skpd='$kd_skpd' and a.jns_trans in ('5','1') $where and no_sts not in (
				SELECT TOP $offset a.no_sts from trhkasin_pkd a WHERE  a.kd_skpd='$kd_skpd' and a.jns_trans in ('5','1') order by CAST(no_sts as int)) 
				order by CAST(no_sts as int)";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
       
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total'],2,'.',','),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'no_sp2d' => $resulte['no_sp2d'],
                        'jns_cp' => $resulte['jns_cp'],
                        'pot_khusus' => $resulte['pot_khusus'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
       $result["total"] = $total->tot;
        $result["rows"] = $row; 
        $query1->free_result();   
        echo json_encode($result);
    	   
	} 
	
	function load_tetap_sts_ppkd() {
        //$kriteria = '';
        //$kriteria = $this->input->post('cari');
        $skpd = $this->uri->segment(3);
        $kd_rek5 = $this->uri->segment(4);
        
        //$where ='';
//        if ($kriteria <> ''){                               
//            $where="where kd_skpd = '$skpd' and kd_rek5 = '$kd_rek5' and (upper(no_tetap) like upper('%$kriteria%') or
//            upper(keterangan) like upper('%$kriteria%'))";            
//        }
//        
        $sql = "SELECT * from tr_terima where kd_skpd = '$skpd' and kd_rek5 = '$kd_rek5' and sts_tetap = '1' order by no_tetap";
        //echo $sql;
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_terima'],
                        'tgl_tetap' => $resulte['tgl_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
	function ambil_rek_tetap_ppkd() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "select distinct a.kd_rek5 as kd_rek5,b.nm_rek5 AS nm_rek,b.map_lo as kd_rek, c.nm_rek4, a.kd_kegiatan FROM 
        trdrka_pend a left join ms_rek5 b on a.kd_rek5=b.kd_rek5 left join ms_rek4 c on left(a.kd_rek5,5)=c.kd_rek4 
		where a.kd_skpd = '$lckdskpd' and left(a.kd_rek5,1)='4' and 
        (upper(a.kd_rek5) like upper('%$lccr%') or b.nm_rek5 like '%$lccr%') order by kd_rek5";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek'],  
                        'nm_rek' => $resulte['nm_rek'],
						'nm_rek4' => $resulte['nm_rek4'],
                        'kd_kegiatan' => $resulte['kd_kegiatan']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
	function load_jns_str_ppkd(){
        $lccr ='[{   
        "id":"5",  
        "text":"Belanja"  
    }]';  
    echo $lccr;
    }  
	
	function load_sp2d_sts_ppkd($cskpd='') {
			$lccr = $this->input->post('q');
            $kode = $this->uri->segment(3);
            $lcskpd  = $this->session->userdata('kdskpd');
            //$lcskpd = $this->uri->segment(4);
			$sql = "SELECT no_sp2d,jns_spp,CASE jns_spp WHEN '5' THEN 'LS PPKD' END AS jns_cp from trhsp2d  WHERE kd_skpd = '$lcskpd' AND jns_spp in('5') AND upper(no_sp2d) like upper('%$lccr%')" ;
			
                
            //echo $sql;    
            $query1 = $this->db->query($sql);  
            $result = array();
            $ii = 0;
            foreach($query1->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'no_sp2d' => $resulte['no_sp2d'],
							'jns_spp' => $resulte['jns_spp'],
							'jns_cp' => $resulte['jns_cp']
                            );
                            $ii++;
            }
               
            echo json_encode($result);
        	   
    	}
	
	function load_trskpd_sts_ag_ppkd() {
            $sp2d='';        
			$sp2d = str_replace('123456789','/',$this->uri->segment(3));
            $lcskpd  = $this->session->userdata('kdskpd');
			$sql1="SELECT jns_spp, no_spp FROM trhsp2d WHERE no_sp2d='$sp2d'";
			$sql2=$this->db->query($sql1);
			foreach ($sql2->result() as $row1){
				$jns=$row1->jns_spp;                    
			}
			if($jns ==1|| $jns==2){
				 $sql = "SELECT a.kd_kegiatan,a.nm_kegiatan FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti = b.no_bukti  AND a.kd_skpd=b.kd_skpd
					where a.no_sp2d ='$sp2d' group by a.kd_kegiatan,a.nm_kegiatan";    
			} else{
            $sql = "SELECT a.kd_kegiatan,a.nm_kegiatan FROM trdspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp  AND a.kd_skpd=b.kd_skpd
			where b.no_sp2d ='$sp2d' group by a.kd_kegiatan,a.nm_kegiatan ";   
			}
            $query1 = $this->db->query($sql);  
            $result = array();
            $ii = 0;
            foreach($query1->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan']
                            );
                            $ii++;
            }
               
            echo json_encode($result);
        	   
    	}
	
	
	function load_koreksi_penerimaan() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria <> ''){                               
            $where="WHERE (upper(a.no) like upper('%$kriteria%') or a.tanggal like '%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%'))";            
        } else{
			$where="WHERE (upper(a.no) like upper('%%'))";
		}
        
        $sql = "SELECT count(*) as tot from trkasout_ppkd a $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
       
		$sql = " SELECT TOP $rows a.* from trkasout_ppkd a
$where AND a.no NOT in (SELECT TOP $offset no FROM trkasout_ppkd a $where order by cast(a.no as int)) order by cast(a.no as int)";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,      
                        'no' => $resulte['no'],
                        'tanggal' => $resulte['tanggal'],
                        'keterangan' => $resulte['keterangan'],
						'kd_skpd' => $resulte['kd_skpd'],
						'nm_skpd' => $resulte['nm_skpd'],
						'jenis' => $resulte['kd_rek'],
						'nm_jenis' => $resulte['nm_kd_rek'],
                        'nilai' =>  number_format($resulte['nilai']),                                                                                          
                        'status' => $resulte['status']                                                                                                        
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	}
	
	function load_rekening_ppkd() {
       $lckdskpd = $this->uri->segment(3);        
		
		/* $sql = "select a.kd_skpd, b.nm_skpd, a.kd_rek5, c.nm_rek5   from trdkasin_ppkd a 
				inner join ms_skpd b on a.kd_skpd=b.kd_skpd
				inner join trdrka c on a.kd_rek5=c.kd_rek5
				where a.kd_skpd='$lckdskpd'
				group by a.kd_skpd,b.nm_skpd,a.kd_rek5,c.nm_rek5"; */
				
		$sql = "select a.kd_skpd, a.nm_skpd, a.kd_rek5, a.nm_rek5 from trdrka_pend a 
				where a.kd_skpd='$lckdskpd'
				group by a.kd_skpd,a.nm_skpd, a.kd_rek5, a.nm_rek5";
		
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,           
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],                                                                                          
                        'kd_rek5' => $resulte['kd_rek5'],                                                                                          
                        'nm_rek5' => $resulte['nm_rek5']                                                                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	
	function simpan_koreksi_penerimaan(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $kd_skpd  = $this->input->post('kd_skpd');
        $nm_skpd  = $this->input->post('nm_skpd');
        $jns    = $this->input->post('jns');
        $nmjenis    = $this->input->post('nmjenis');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $ngaruh  = $this->input->post('ngaruh');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "insert into trkasout_ppkd(no,tanggal,keterangan,nilai,kd_rek,nm_kd_rek,kd_skpd,nm_skpd,status) 
                        values('$nokas','$ttd','$ket','$nilai','$jns','$nmjenis','$kd_skpd','$nm_skpd','$ngaruh')";
            
			$sql2 = "update trkasout_ppkd set kd_kegiatan=left(kd_skpd,4)+'.'+'$kd_skpd'+'.00.04'
			         where kd_skpd='$kd_skpd' and no='$nokas'";
            
			$asg = $this->db->query($sql);
            $asg2 = $this->db->query($sql2);
			
			
			if($asg or $asg2){
                echo '2';
            }else{
                echo '0';
            }
  
    }
	
	function hapus_koreksi_penerimaan(){    	
		$no_kas = $this->input->post('no_kas');
		$tgl = $this->input->post('tgl_kas');
		//$nilai = $this->input->post('nilai');
        $query = "delete from trkasout_ppkd where no='$no_kas'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
	}
	
	
	function update_koreksi_penerimaan(){
        
		$nokas  = $this->input->post('nokas');
		$kd_skpd  = $this->input->post('kd_skpd');
		$nm_skpd  = $this->input->post('nm_skpd');
        $jns    = $this->input->post('jns');
        $nmjenis    = $this->input->post('nmjenis');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $ngaruh  = $this->input->post('ngaruh');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "update trkasout_ppkd set kd_rek='$jns', nm_kd_rek='$nmjenis', tanggal='$ttd',keterangan='$ket',nilai='$nilai',kd_skpd='$kd_skpd',nm_skpd='$nm_skpd',kd_kegiatan=left(kd_skpd,4)+'.'+'$kd_skpd'+'.00.04', status='$ngaruh' WHERE no='$nokas'";
            $asg = $this->db->query($sql);
            
			
			
			if($asg){
                echo '1';
            }else{
                echo '0';
            }
        

    }

	

	function get_status($tgl,$skpd){
        $n_status = '';
        $tanggal = $tgl;
        $sql = "select case when '$tanggal'>=tgl_dpa_ubah and status_ubah='1' then 'nilai_ubah' 
                    when '$tanggal'>=tgl_dpa_sempurna and status_sempurna='1' then 'nilai_sempurna' 
                    when '$tanggal'<=tgl_dpa and status='1' 
                    then 'nilai' else 'nilai' end as anggaran from trhrka where kd_skpd ='$skpd' ";
        
        $q_trhrka = $this->db->query($sql);
        $num_rows = $q_trhrka->num_rows();
        
        foreach ($q_trhrka->result() as $r_trhrka){
             $n_status = $r_trhrka->anggaran;                   
        }    
        return $n_status;                         
    }

	
	function load_pengirim() {        
        
        $skpd = $this->session->userdata('kdskpd');               
        $lccr = $this->input->post('q');
        
        $sql = "select * from ms_pengirim where (upper(kd_pengirim) like upper('%$lccr%') OR upper(nm_pengirim) like upper('%$lccr%'))
			order by cast(kd_pengirim as int)";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_pengirim' => $resulte['kd_pengirim'],  
                        'nm_pengirim' => $resulte['nm_pengirim'],
                        'kd_skpd'     => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
	 
	function daftar_penerimaan()
    {
        $data['page_title']= 'DAFTAR PENERIMAAN';
        $this->template->set('title', 'DAFTAR PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/daftar_penerimaan',$data) ; 
    } 
	
	function ctk_daftar_penerimaan(){
		$kd_kirim     = $this->uri->segment(3);
		$lcttd        = str_replace('123456789',' ',$this->uri->segment(5));
		$thn_ang      = $this->session->userdata('pcThang');
		$prv          = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn         = $prv->row();          
		$prov         = $prvn->provinsi;         
		$daerah       = $prvn->daerah;
		
		
		$cetk         = $this->uri->segment(10);
		
		if($cetk=='2'){
			$tgl          = $this->uri->segment(11);
			$nm_tglawal   = $this->tanggal_format_indonesia_kasda2($tgl);
			
			$tgl2         = $this->uri->segment(12);
			$nm_tglakhir  = $this->tanggal_format_indonesia_kasda2($tgl2);
		}else{
			$blnawal      = $this->uri->segment(6);
			$nm_bulanawal = $this->getBulan_kasda($blnawal);
			
			$blnakhir     = $this->uri->segment(7);
			$nm_bulakhir  = $this->getBulan_kasda($blnakhir);
		}
		$no_halaman   = $this->uri->segment(8);
		$spasi        = $this->uri->segment(9);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$pengirim      = $this->db->query("SELECT TOP 1 nm_pengirim from ms_pengirim where kd_pengirim='$kd_kirim'");
		$nama_pengirim = $pengirim->row();          
		$h_pengirim   = $nama_pengirim->nm_pengirim;
		
		if($cetk=='3'){
			$judul_bulan = "BULAN : $nm_bulanawal S/D $nm_bulakhir";
		}else{
			$judul_bulan = "TANGGAL : $nm_tglawal S/D $nm_tglakhir";
		}
		
		$judul="DAFTAR PENERIMAAN<br>($h_pengirim)<br>$judul_bulan";
                                               
                    
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">No. Kas</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Tanggal</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">Keterangan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
				</tr>
				</thead>"; 
		
		if($cetk=='3'){
		//per periode
		$sql = "SELECT a.no_sts, a.kd_skpd, a.tgl_sts, a.keterangan, a.total, a.sumber, b.nm_pengirim 
                  FROM trhkasin_ppkd a left join ms_pengirim b on a.sumber=b.kd_pengirim
                WHERE a.sumber='$kd_kirim' AND (month(a.tgl_sts)>='$blnawal' and month(a.tgl_sts)<='$blnakhir') 
                ORDER BY a.tgl_sts  ";
		}else{
		//per per tanggal
		$sql = "SELECT a.no_sts, a.kd_skpd, a.tgl_sts, a.keterangan, a.total, a.sumber, b.nm_pengirim 
                  FROM trhkasin_ppkd a left join ms_pengirim b on a.sumber=b.kd_pengirim
                WHERE a.sumber='$kd_kirim' AND (a.tgl_sts >= '$tgl' and a.tgl_sts <= '$tgl2') 
                ORDER BY a.tgl_sts  ";	
		}
		$hasil = $this->db->query($sql);
		
		$jmlh_periode_ini = 0;
		$jmlh_periode_ini2 = 0;
		
		foreach ($hasil->result() as $row){
			
			$no_sts		  = $row->no_sts;
			$kd_skpd	  = $row->kd_skpd;
			$tgl_sts	  = $row->tgl_sts;
			$keterangan	  = $row->keterangan;
			$sumber	      = $row->sumber;
			$nm_pengirim  = $row->nm_pengirim;
			$nilai	      = $row->total;
			
			if($nilai=='' || empty($nilai)){
				$nilaix = 0;
			}else{
				$nilaix = $nilai;
			}
			$nilai1x = number_format($nilaix,"2",",",".");
			
			$jmlh_periode_ini  = $jmlh_periode_ini+$nilaix;
			$jmlh_periode_ini2 = number_format($jmlh_periode_ini,"2",",",".");
			
				$cRet .="<tr>
							<td align=\"center\">$no_sts</td>
							<td align=\"left\">$tgl_sts</td>
							<td align=\"right\">$nilai1x</td>
							<td align=\"left\">$nm_pengirim</td>
						</tr>";
			
		}
		if($cetk=='3'){ 
			//total sebelum
			$sql2 = "select sum(a.total) as nilai 
						from trhkasin_pkd a
						where a.sumber='$kd_kirim' AND month(a.tgl_sts)<'$blnawal'";
		}else{
			//total sebelum
			$sql2 = "select sum(a.total) as nilai 
						from trhkasin_pkd a
						where a.sumber='$kd_kirim' AND a.tgl_sts<'$tgl' ";
		}
		$hasil2=$this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$nilai2    = $row->nilai;
			
			if($nilai2=='' || empty($nilai2)){
				$nilai2x = 0;
			}else{
				$nilai2x = $nilai2;
			}
			
			$nilai_sbl = number_format($nilai2x,"2",",",".");
		}

		//total seluruh
		$total_periode = $jmlh_periode_ini+$nilai2x;
		if($total_periode=='' || empty($total_periode)){
				$total_periode2 = 0;
			}else{
				$total_periode2 = $total_periode;
			}
		
		$total_periode2x = number_format($total_periode2,"2",",",".");
		
		$cRet .= '
		<tr>
			<TD align="left" colspan="2">Jumlah Periode Ini </TD>
			<TD align="right"><b>'.$jmlh_periode_ini2.'</TD>
			<TD align="right" ></TD>
		</tr>
		
		<tr>
			
			<TD style="border-top:hidden" align="left" colspan="2">Jumlah s/d Periode Lalu </TD>
			<TD style="border-top:hidden;" align="right" ><b>'.$nilai_sbl.'</TD>
			<TD style="border-top:hidden;" align="right" ></TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah s/d Periode Ini</TD>
			<TD style="border-top:hidden;" align="right"><b>'.$total_periode2x.'</TD>
			<TD style="border-top:hidden;" align="right"></TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>DAFTAR PENERIMAAN</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}
		
	}
	
	function bk_retribusi(){
        $data['page_title']= 'CETAK RETRIBUSI';
        $this->template->set('title', 'CETAK RETRIBUSI');   
        $this->template->load('template','tukd/sp2d/bk_retribusi',$data) ; 
    }
	
	function transfer_dana(){
        $data['page_title']= 'CETAK TRANSFER DANA';
        $this->template->set('title', 'CETAK TRANSFER DANA');   
        $this->template->load('template','tukd/realisasi/transfer_dana',$data) ; 
    }

	function ctk_bk_retribusi($jns='', $ctk='',$ttd1='',$tgl=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(5));
		$tanggal = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		$no_halaman = $this->uri->segment(7);
		$spasi = $this->uri->segment(8);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		switch ($jns){
                        case '0': //GAJI
						//$where2="and a.jns_spp='4'";
						$judul="RETRIBUSI";
                            break; 
                        /* case '1': //NON GAJI
						$where2="and a.jns_spp!='4'";
						$judul="BUKU KAS PENERIMAAN";
                            break; */
                                               
                    }
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"45%\" style=\"font-weight:bold\">Uraian</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"30%\" style=\"font-weight:bold\">Kode Rekening</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
				</tr>
				<tr>
					<td align=\"center\"></td>
					<td align=\"left\">Tanggal : $tanggal</td>
					<td align=\"center\"></td>
					<td align=\"center\"></td>
				</tr>
				</thead>";
		
		$nilai3=0; 
		
		//isi
				$sql = "select * from(
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON b.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd !='1.20.15.17'  AND LEFT(a.kd_rek5,3) IN ('412','413','414','421','422','423','434') AND LEFT(a.kd_rek5,5) NOT IN ('41407')
					GROUP BY b.no_kas,nm_pengirim, f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON b.sumber = e.kd_pengirim
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd !='1.20.15.17' AND LEFT(a.kd_rek5,3) IN ('412','413','414','421','422','423','434') AND LEFT(a.kd_rek5,5) NOT IN ('41407')
						
					UNION ALL
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						''nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd ='1.20.15.17' AND LEFT(a.kd_rek5,3) IN ('412','413','414','421','422','423','434') AND LEFT(a.kd_rek5,5) NOT IN ('41407')
					GROUP BY b.no_kas,f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						b.keterangan nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas  AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd ='1.20.15.17' AND LEFT(a.kd_rek5,3) IN ('412','413','414','421','422','423','434') AND LEFT(a.kd_rek5,5) NOT IN ('41407')
					
					UNION ALL
					SELECT
							1 AS urut,
							'' no_sts,
							'' kd_skpd,
							nm_skpd,
							'' kd_kegiatan,
							'' kd_rek5,
							[no] as no_kas,
							'' tgl_kas,
							'' nm_pengirim,
							'' nm_rek5,
							0 rupiah
						FROM
							trkasout_ppkd  
						WHERE
							tanggal = '$tgl' AND LEFT(kd_rek,3) IN ('412','413','414','421','422','423','434') AND LEFT(kd_rek,5) NOT IN ('41407')
						UNION ALL
						SELECT
								2 AS urut,
								[no] as no_sts,
								kd_skpd,
								'' nm_skpd,
								''kd_kegiatan,
								kd_rek kd_rek5,
								[no] no_kas,
								[tanggal] tgl_kas,
								'' nm_pengirim,
								keterangan+' '+nm_kd_rek nm_rek5,
								nilai rupiah
							FROM
							trkasout_ppkd 
							WHERE
							tanggal = '$tgl'
							AND LEFT(kd_rek,3) IN ('412','413','414','421','422','423','434') AND LEFT(kd_rek,5) NOT IN ('41407')
					) a
					
					order by cast(no_kas as int),urut";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
			
			$urut		  = $row->urut;
			$no_sts       = $row->no_sts;
			$kd_skpd      = $row->kd_skpd;
			$nm_skpd      = $row->nm_skpd;
			$kd_kegiatan  = $row->kd_kegiatan;
			$kd_rek5      = $row->kd_rek5;
			$no_kas       = $row->no_kas;
			$tgl_kas      = $row->tgl_kas;
			$nm_pengirim  = $row->nm_pengirim;
			
			if($nm_pengirim==''){
				$nama_kirim = $nm_skpd;
			}else{
				$nama_kirim = $nm_pengirim;
			}
			
			$nm_rek5      = $row->nm_rek5;
			$nilai        = $row->rupiah;
			$nilaix       = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                      
			if($nilai<0){
				$a="(";
				$b=")";
				$nilaix = number_format($nilai*-1,"2",",",".");
			}else{
				$a="";
				$b="";
			}
			//$jumlah      = ($row->jumlah)+1;
			
			//total pertanggal
			$nilai3=$nilai3+$nilai;
												
			if ($kd_kegiatan==''){
				$kode="";
			} else {
				$kode="$kd_kegiatan.$kd_rek5";
			}
		
			if($urut=='1'){
				$cRet .="<tr>
							<td align=\"center\">$no_kas</td>
							<td align=\"left\">$nama_kirim</td>
							<td align=\"left\"></td>
							<td align=\"right\"></td>
						</tr>";
			}else{
				$cRet .="<tr>
							<td align=\"left\" style=\"border-top:hidden;\"></td>
							<td align=\"left\" style=\"border-top:hidden;\">$nm_rek5</td>
							<td align=\"left\" style=\"border-top:hidden;\">$kode</td>
							<td align=\"right\" style=\"border-top:hidden;\">$a $nilaix $b</td>
						</tr>";
			}
		}
		 
		
		 
		//total sebelum
		$sql2 = "select sum(rupiah) as nilai from(
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON b.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE b.tgl_kas <='$tgl' AND a.kd_skpd !='1.20.15.17'  AND LEFT(a.kd_rek5,3) IN ('412') 
					GROUP BY b.no_kas,nm_pengirim, f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON b.sumber = e.kd_pengirim
					WHERE b.tgl_kas<='$tgl' AND a.kd_skpd !='1.20.15.17' AND LEFT(a.kd_rek5,3) IN ('412') 
							
					UNION ALL
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						''nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE b.tgl_kas<='$tgl' AND a.kd_skpd ='1.20.15.17' AND LEFT(a.kd_rek5,3) IN ('412')
					GROUP BY b.no_kas,f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						b.keterangan nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas  AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					WHERE b.tgl_kas<='$tgl' AND a.kd_skpd ='1.20.15.17' AND LEFT(a.kd_rek5,3) IN ('412')
					
					UNION ALL
					SELECT
							1 AS urut,
							'' no_sts,
							'' kd_skpd,
							nm_skpd,
							'' kd_kegiatan,
							'' kd_rek5,
							[no] as no_kas,
							'' tgl_kas,
							'' nm_pengirim,
							'' nm_rek5,
							0 rupiah
						FROM
							trkasout_ppkd  
						WHERE
							tanggal <= '$tgl' AND LEFT(kd_rek,3) IN ('412')
						UNION ALL
						SELECT
								2 AS urut,
								[no] as no_sts,
								kd_skpd,
								'' nm_skpd,
								''kd_kegiatan,
								kd_rek kd_rek5,
								[no] no_kas,
								[tanggal] tgl_kas,
								'' nm_pengirim,
								keterangan+' '+nm_kd_rek nm_rek5,
								nilai rupiah
							FROM
							trkasout_ppkd 
							WHERE
							tanggal <= '$tgl'
							AND LEFT(kd_rek,3) IN ('412')
					) a";
		$hasil2=$this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$nilai2  = $row->nilai;
			$nilai2x = number_format($nilai2,"2",",",".");
		}	
		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		$cRet .= '
		<tr>
			<TD></TD>
			<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
			<TD align="right" >'.$nilai3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
			<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
			<TD align="right" >'.$totalx.'</TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Retribusi</title>");
			 echo $cRet;
		}else{
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}
		
	}

	function load_sisa_anggaran($skpd){
        $query1 = $this->db->query("SELECT SUM(nilai_ubah) as nilai FROM trdrka WHERE kd_skpd='$skpd' 
									AND RIGHT(kd_kegiatan,5) NOT IN ('00.51','00.04')");
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'nilai' => number_format($resulte['nilai'],2,'.',','),
                        );
                        $ii++;
        }
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	}    
	
	
	function load_sisa_sp2d($skpd){
        $query1 = $this->db->query("SELECT SUM(nilai) as nilai FROM (
									SELECT SUM(d.nilai) as nilai FROM trhsp2d a 
									INNER JOIN trhspm b ON a.kd_skpd=b.kd_skpd AND a.no_spm=b.no_spm
									INNER JOIN trhspp c ON b.kd_skpd=c.kd_skpd AND b.no_spp=c.no_spp
									INNER JOIN trdspp d ON c.kd_skpd=d.kd_skpd AND c.no_spp=d.no_spp
									WHERE (c.sp2d_batal!=1 OR c.sp2d_batal IS NULL) AND a.kd_skpd='$skpd'
									AND RIGHT(d.kd_kegiatan,5)!='00.51'
									UNION ALL
									SELECT SUM(d.nilai) as nilai FROM trhsp2d a 
									INNER JOIN trhspm b ON a.kd_skpd=b.kd_skpd AND a.no_spm=b.no_spm
									INNER JOIN trhspp c ON b.kd_skpd=c.kd_skpd AND b.no_spp=c.no_spp
									INNER JOIN trdspp d ON c.kd_skpd=d.kd_skpd AND c.no_spp=d.no_spp
									WHERE (c.sp2d_batal!=1 OR c.sp2d_batal IS NULL) AND a.kd_skpd='$skpd'
									AND a.jns_spp='1')a");
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'nilai' => number_format($resulte['nilai'],2,'.',','),
                        );
                        $ii++;
        }
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	} 
	

	
	function register_cp(){
        $data['page_title']= 'REGISTER CP';
        $this->template->set('title', 'REGISTER CP');   
        $this->template->load('template','tukd/pendapatan/register_cp',$data) ; 
    }

	function cetak_register_cp_rekap($tgl1='',$tgl2='',$no='',$ttd='',$ctk=''){
            $lntahunang = $this->session->userdata('pcThang');       
			$cRet ='<TABLE width="100%" style="font-size:16px">
                    <TR>
						<TD align="center" ><b>PEMERINTAH DAERAH PROVINSI KALIMANTAN BARAT <br>
						REGISTER PENERIMAAN CONTRA POS TAHUN ANGGARAN '.$lntahunang.'</b><br>
						Tanggal '.$this->tanggal_format_indonesia($tgl1).' s/d '.$this->tanggal_format_indonesia($tgl2).'
						
					</TD>
					</TR>
					</TABLE><br/>';

			$cRet .='<TABLE style="border-collapse:collapse;font-size:14px" border="1" cellspacing="2" cellpadding="0" width="100%" >
					 <THEAD>
					 <TR>
						<TD bgcolor="#CCCCCC" align="center" width="5%">NO</TD>
						<TD bgcolor="#CCCCCC" align="center" width="10%">KODE</TD>
						<TD bgcolor="#CCCCCC" align="center" width="55%">NAMA SKPD</TD>						
						<TD bgcolor="#CCCCCC" align="center" width="30%">TOTAL</TD>
					 </TR>
					 </THEAD>
					 ';
			

			
				$query = $this->db->query("SELECT a.kd_skpd,a.nm_skpd
						,ISNULL(total,0) total
						FROM ms_skpd a LEFT JOIN 
					(SELECT kd_skpd,SUM (nilai) AS total
					FROM
					(
					SELECT a.no_kas,a.tgl_kas, a.kd_skpd,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
					FROM (
					SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, LEFT(kd_rek5,3) as kd_rek, SUM(rupiah) as nilai FROM trhkasin_ppkd a 
					INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd,LEFT(kd_rek5,3)) a
					LEFT JOIN 
					(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
					INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
					ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
					WHERE (tgl_kas BETWEEN '$tgl1' AND '$tgl2')
					GROUP BY a.kd_skpd) b
					ON a.kd_skpd=b.kd_skpd
					");
				
				$no=0;
				$hkpg_t=0;
				$pot_lain_t=0;
				$cp_t=0;
				$ls_peg_t=0;
				$ls_brng_t=0;
				$ls_modal_t=0;
				$up_gu_peg_t=0;
				$up_gu_brng_t=0;
				$up_gu_modal_t=0;
				$total_t=0;
				foreach ($query->result() as $row) {
                    $kd_skpd =$row->kd_skpd;
                    $nm_skpd =$row->nm_skpd;
                    $total=$row->total;
					$total_t=$total_t+$total;
					$no=$no+1;
					$cRet .='<TR>
								<TD align="left" >'.$no.'</TD>
								<TD align="left" >'.$kd_skpd.'</TD>
								<TD align="left" >'.$nm_skpd.'</TD>								
								<TD align="right" >'.number_format($total,"2",",",".").'</TD>
							 </TR>';					
			
				}
				
				$cRet .='<TR>
								<TD colspan="3" align="right" ><b>Jumlah</b></TD>
								<TD align="right" >'.number_format($total_t,"2",",",".").'</TD>
							 </TR>';
			/*$nbulan_l=$nbulan-1;
			
			$query = $this->db->query("SELECT 
					SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '1' THEN nilai	ELSE 0 END) AS hkpg_l
					,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '0' THEN nilai	ELSE 0 END) AS pot_lain_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '1' THEN	nilai ELSE 0 END) AS cp_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) IN ('511','521') THEN	nilai ELSE 0	END) AS ls_peg_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '522' THEN	nilai ELSE 0	END) AS ls_brng_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '523' THEN	nilai ELSE 0	END) AS ls_modal_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('511','521') THEN nilai	ELSE 0 END) AS up_gu_peg_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('522') THEN	nilai	ELSE 0 END) AS up_gu_brng_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('523') THEN	nilai	ELSE 0 END) AS up_gu_modal_l
					,SUM (nilai) AS total_l
					FROM
					(
					SELECT a.no_kas,a.tgl_kas, a.kd_skpd,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
					FROM (
					SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, LEFT(kd_rek5,3) as kd_rek, SUM(rupiah) as nilai FROM trhkasin_ppkd a 
					INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd,LEFT(kd_rek5,3)) a
					LEFT JOIN 
					(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
					INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
					ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
					WHERE MONTH(tgl_kas)='$nbulan_l'
					"); 
			foreach ($query->result() as $row) {	
				$hkpg_l =$row->hkpg_l;
				$pot_lain_l =$row->pot_lain_l;
				$cp_l =$row->cp_l;
				$ls_peg_l =$row->ls_peg_l;
				$ls_brng_l =$row->ls_brng_l;
				$ls_modal_l =$row->ls_modal_l;
				$up_gu_peg_l =$row->up_gu_peg_l;
				$up_gu_brng_l =$row->up_gu_brng_l;
				$up_gu_modal_l =$row->up_gu_modal_l;
				$total_l =$row->total_l;
				$cRet .='<TR>
						<TD colspan="2" align="right" >Jumlah sampai bulan Sebelumnya</TD>
						<TD align="right" >'.number_format($hkpg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($pot_lain_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($cp_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_modal_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_modal_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($total_l,"2",",",".").'</TD>
					 </TR>';
			}		
				$cRet .='<TR>
						<TD colspan="2" align="right" >Jumlah sampai bulan '.$this->tukd_model->getBulan($nbulan).'</TD>
						<TD align="right" >'.number_format($hkpg_t+$hkpg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($pot_lain_t+$pot_lain_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($cp_t+$cp_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_peg_t+$ls_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_brng_t+$ls_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_modal_t+$ls_modal_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_peg_t+$up_gu_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_brng_t+$up_gu_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_modal_t+$up_gu_modal_l,"2",",",".").' </TD>
						<TD align="right" >'.number_format($total_t+$total_l,"2",",",".").'</TD>
					 </TR>';			
			*/
			$cRet .='</TABLE>';
			
			

			$data['prev']= 'Register CP KASDA';
	switch ($ctk)
        {
            case 0;
			 echo ("<title> Register CP Kasda</title>");
				echo $cRet;
				break;
            case 1;
			$this->_mpdf('',$cRet,10,10,10,'P',1,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_cp.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}
	}
	
	function cetak_register_cp_rekap_rinci($tgl1='',$tgl2='',$no='',$ttd='',$ctk=''){
            $lntahunang = $this->session->userdata('pcThang');       
			$cRet ='<TABLE width="100%" style="font-size:16px">
                    <TR>
						<TD align="center" ><b>PEMERINTAH DAERAH PROVINSI KALIMANTAN BARAT <br>
						REGISTER PENERIMAAN CONTRA POS TAHUN ANGGARAN '.$lntahunang.'</b><br>
						Tanggal '.$this->tanggal_format_indonesia($tgl1).' s/d '.$this->tanggal_format_indonesia($tgl2).'
						
					</TD>
					</TR>
					</TABLE><br/>';

			$cRet .='<TABLE style="border-collapse:collapse;font-size:14px" border="1" cellspacing="2" cellpadding="0" width="100%" >
					 <THEAD>
					 <TR>
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="10%">KODE</TD>
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="30%">Uraian</TD>						
						<TD bgcolor="#CCCCCC" colspan="9" align="center" width="60%">CP</TD>
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="10%">Jumlah</TD>
					 </TR>
					 <TR>
					 <TD colspan="6" bgcolor="#CCCCCC" align="center">LS</TD>
					 <TD colspan="3" bgcolor="#CCCCCC" align="center">UP/GU/TU</TD>
					 </TR>
					 <TR>
					 <TD colspan="3" bgcolor="#CCCCCC" align="center">Gaji</TD>
					 <TD colspan="3" bgcolor="#CCCCCC" align="center">Barang dan Jasa</TD>
					 <TD rowspan="2" bgcolor="#CCCCCC" align="center">Pegawai</TD>
					 <TD rowspan="2" bgcolor="#CCCCCC" align="center">Barang</TD>
					 <TD rowspan="2" bgcolor="#CCCCCC" align="center">Modal</TD>
					 </TR>
					 <TR>
					 <TD bgcolor="#CCCCCC" align="center">HKPG</TD>
					 <TD bgcolor="#CCCCCC" align="center">Pot. Lain</TD>
					 <TD bgcolor="#CCCCCC" align="center">CP</TD>
					 <TD bgcolor="#CCCCCC" align="center">Peg.</TD>
					 <TD bgcolor="#CCCCCC" align="center">Brng.</TD>
					 <TD bgcolor="#CCCCCC" align="center">Modal.</TD>
					 </TR>
					 </THEAD>
					 ';
			
				$query = $this->db->query("SELECT a.kd_skpd,a.nm_skpd
						,ISNULL(hkpg,0) hkpg
						,ISNULL(pot_lain,0) pot_lain
						,ISNULL(cp,0) cp
						,ISNULL(ls_peg,0) ls_peg
						,ISNULL(ls_brng,0) ls_brng
						,ISNULL(ls_modal,0) ls_modal
						,ISNULL(up_gu_peg,0) up_gu_peg
						,ISNULL(up_gu_brng,0) up_gu_brng
						,ISNULL(up_gu_modal,0) up_gu_modal
						,ISNULL(total,0) total
						FROM ms_skpd a LEFT JOIN 
					(SELECT kd_skpd
					,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '1' THEN nilai	ELSE 0 END) AS hkpg
					,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '2' THEN nilai	ELSE 0 END) AS pot_lain
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '1' THEN	nilai ELSE 0 END) AS cp
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) IN ('511','521') THEN	nilai ELSE 0	END) AS ls_peg
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '522' THEN	nilai ELSE 0	END) AS ls_brng
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '523' THEN	nilai ELSE 0	END) AS ls_modal
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('511','521') THEN nilai	ELSE 0 END) AS up_gu_peg
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('522') THEN	nilai	ELSE 0 END) AS up_gu_brng
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('523') THEN	nilai	ELSE 0 END) AS up_gu_modal
					,SUM (nilai) AS total
					FROM
					(
					SELECT a.no_kas,a.tgl_kas, a.kd_skpd,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
					FROM (
					SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, LEFT(kd_rek5,3) as kd_rek, SUM(rupiah) as nilai FROM trhkasin_ppkd a 
					INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd,LEFT(kd_rek5,3)) a
					LEFT JOIN 
					(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
					INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
					ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
					WHERE (tgl_kas BETWEEN '$tgl1' AND '$tgl2')
					GROUP BY a.kd_skpd) b
					ON a.kd_skpd=b.kd_skpd
					");
				
				$no=0;
				$hkpg_t=0;
				$pot_lain_t=0;
				$cp_t=0;
				$ls_peg_t=0;
				$ls_brng_t=0;
				$ls_modal_t=0;
				$up_gu_peg_t=0;
				$up_gu_brng_t=0;
				$up_gu_modal_t=0;
				$total_t=0;
				foreach ($query->result() as $row) {
                    $kd_skpd =$row->kd_skpd;
                    $nm_skpd =$row->nm_skpd;
                    $hkpg =$row->hkpg;
                    $pot_lain =$row->pot_lain;
                    $cp=$row->cp;                    
                    $ls_peg=$row->ls_peg;                    
                    $ls_brng=$row->ls_brng;                    
                    $ls_modal=$row->ls_modal;                    
                    $up_gu_peg=$row->up_gu_peg;                    
                    $up_gu_brng=$row->up_gu_brng;                    
                    $up_gu_modal=$row->up_gu_modal;   
                    $total=$row->total;
					$hkpg_t=$hkpg_t+$hkpg;
					$pot_lain_t=$pot_lain_t+$pot_lain;
					$cp_t=$cp_t+$cp;
					$ls_peg_t=$ls_peg_t+$ls_peg;
					$ls_brng_t=$ls_brng_t+$ls_brng;
					$ls_modal_t=$ls_modal_t+$ls_modal;
					$up_gu_peg_t=$up_gu_peg_t+$up_gu_peg;
					$up_gu_brng_t=$up_gu_brng_t+$up_gu_brng;
					$up_gu_modal_t=$up_gu_modal_t+$up_gu_modal;
					$total_t=$total_t+$total;
					$no=$no+1;
					$cRet .='<TR>
								<TD align="left" >'.$kd_skpd.'</TD>
								<TD align="left" >'.$nm_skpd.'</TD>								
								<TD align="right" >'.number_format($hkpg,"2",",",".").'</TD>
								<TD align="right" >'.number_format($pot_lain,"2",",",".").'</TD>
								<TD align="right" >'.number_format($cp,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_peg,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_brng,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_modal,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_peg,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_brng,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_modal,"2",",",".").'</TD>
								<TD align="right" >'.number_format($total,"2",",",".").'</TD>
							 </TR>';					
			
				}
				
				$cRet .='<TR>
								<TD colspan="2" align="right" >Jumlah</TD>
								<TD align="right" >'.number_format($hkpg_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($pot_lain_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($cp_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_peg_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_brng_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_modal_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_peg_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_brng_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_modal_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($total_t,"2",",",".").'</TD>
							 </TR>';
			/*$nbulan_l=$nbulan-1;
			
			$query = $this->db->query("SELECT 
					SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '1' THEN nilai	ELSE 0 END) AS hkpg_l
					,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '0' THEN nilai	ELSE 0 END) AS pot_lain_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '1' THEN	nilai ELSE 0 END) AS cp_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) IN ('511','521') THEN	nilai ELSE 0	END) AS ls_peg_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '522' THEN	nilai ELSE 0	END) AS ls_brng_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '523' THEN	nilai ELSE 0	END) AS ls_modal_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('511','521') THEN nilai	ELSE 0 END) AS up_gu_peg_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('522') THEN	nilai	ELSE 0 END) AS up_gu_brng_l
					,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('523') THEN	nilai	ELSE 0 END) AS up_gu_modal_l
					,SUM (nilai) AS total_l
					FROM
					(
					SELECT a.no_kas,a.tgl_kas, a.kd_skpd,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
					FROM (
					SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, LEFT(kd_rek5,3) as kd_rek, SUM(rupiah) as nilai FROM trhkasin_ppkd a 
					INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd,LEFT(kd_rek5,3)) a
					LEFT JOIN 
					(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
					INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
					WHERE jns_trans IN ('5','1')
					GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
					ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
					WHERE MONTH(tgl_kas)='$nbulan_l'
					"); 
			foreach ($query->result() as $row) {	
				$hkpg_l =$row->hkpg_l;
				$pot_lain_l =$row->pot_lain_l;
				$cp_l =$row->cp_l;
				$ls_peg_l =$row->ls_peg_l;
				$ls_brng_l =$row->ls_brng_l;
				$ls_modal_l =$row->ls_modal_l;
				$up_gu_peg_l =$row->up_gu_peg_l;
				$up_gu_brng_l =$row->up_gu_brng_l;
				$up_gu_modal_l =$row->up_gu_modal_l;
				$total_l =$row->total_l;
				$cRet .='<TR>
						<TD colspan="2" align="right" >Jumlah sampai bulan Sebelumnya</TD>
						<TD align="right" >'.number_format($hkpg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($pot_lain_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($cp_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_modal_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_modal_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($total_l,"2",",",".").'</TD>
					 </TR>';
			}		
				$cRet .='<TR>
						<TD colspan="2" align="right" >Jumlah sampai bulan '.$this->tukd_model->getBulan($nbulan).'</TD>
						<TD align="right" >'.number_format($hkpg_t+$hkpg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($pot_lain_t+$pot_lain_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($cp_t+$cp_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_peg_t+$ls_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_brng_t+$ls_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($ls_modal_t+$ls_modal_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_peg_t+$up_gu_peg_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_brng_t+$up_gu_brng_l,"2",",",".").'</TD>
						<TD align="right" >'.number_format($up_gu_modal_t+$up_gu_modal_l,"2",",",".").' </TD>
						<TD align="right" >'.number_format($total_t+$total_l,"2",",",".").'</TD>
					 </TR>';			
			*/
			$cRet .='</TABLE>';
			
			

			$data['prev']= 'Register CP KASDA';
	switch ($ctk)
        {
            case 0;
			 echo ("<title> Register CP Kasda</title>");
				echo $cRet;
				break;
            case 1;
			$this->_mpdf('',$cRet,10,10,10,'P',1,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_cp.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}
	}
	
	
	function cetak_register_cp($tgl1='',$tgl2='',$no='',$ttd='',$skpd='',$ctk=''){
            $lntahunang = $this->session->userdata('pcThang');       
			$cRet ='<TABLE width="100%" style="font-size:16px">
                    <TR>
						<TD align="center" ><b>PEMERINTAH DAERAH PROVINSI KALIMANTAN BARAT <br>
						REGISTER PENERIMAAN CONTRA POS TAHUN ANGGARAN '.$lntahunang.'</b><br>
						Tanggal '.$this->tanggal_format_indonesia($tgl1).' s/d '.$this->tanggal_format_indonesia($tgl2).'
						
					</TD>
					</TR>
					</TABLE><br/>';

			$cRet .='<TABLE style="border-collapse:collapse;font-size:14px" border="1" cellspacing="2" cellpadding="0" width="100%" >
					 <THEAD>
					 <TR>
						<TD bgcolor="#CCCCCC" align="center" width="5%">No. Kas</TD>
						<TD bgcolor="#CCCCCC" align="center" width="10%">Tanggal Kas</TD>
						<TD bgcolor="#CCCCCC" align="center" width="55%">Uraian</TD>						
						<TD bgcolor="#CCCCCC" align="center" width="15%">Kode Rekening</TD>
						<TD bgcolor="#CCCCCC" align="center" width="15%">Penerimaan (Rp)</TD>
					 </TR>
					 </THEAD>
					 ';
			

				if($skpd=="-"){
					$where = "";
				} else{
					$str=strlen($skpd);
					$where = " AND LEFT(kd_skpd,".strlen($skpd).")='$skpd'";
				}
				$query = $this->db->query("SELECT '1' as jenis,no_kas,tgl_kas,kd_skpd,keterangan as keterangan,'' kd_kegiatan, ''kd_rek,nilai FROM(
						SELECT a.no_kas,a.tgl_kas, a.kd_skpd,keterangan, nilai, jns_trans,jns_cp,pot_khusus
						FROM (
						SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan,SUM(rupiah) as nilai 
						FROM trhkasin_ppkd a 
						INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
						WHERE jns_trans IN ('5','1')
						GROUP BY a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan) a
						LEFT JOIN 
						(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
						INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
						WHERE jns_trans IN ('5','1')
						GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
						ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
						WHERE (tgl_kas  BETWEEN '$tgl1' AND '$tgl2')
						$where

						UNION ALL

						SELECT '2' as jenis,no_kas,tgl_kas,kd_skpd,keterangan as keterangan,kd_kegiatan,kd_rek,nilai FROM(
						SELECT a.no_kas,a.tgl_kas, a.kd_skpd,keterangan, kd_kegiatan,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
						FROM (
						SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan,b.kd_kegiatan,kd_rek5 as kd_rek, rupiah as nilai 
						FROM trhkasin_ppkd a 
						INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
						WHERE jns_trans IN ('5','1')) a
						LEFT JOIN 
						(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
						INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
						WHERE jns_trans IN ('5','1')
						GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
						ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
						WHERE (tgl_kas  BETWEEN '$tgl1' AND '$tgl2')
						$where
						ORDER BY tgl_kas,no_kas,jenis
					");
				
				$no=0;
				$hkpg_t=0;
				$pot_lain_t=0;
				$cp_t=0;
				$ls_peg_t=0;
				$ls_brng_t=0;
				$ls_modal_t=0;
				$up_gu_peg_t=0;
				$up_gu_brng_t=0;
				$up_gu_modal_t=0;
				$total_t=0;
				foreach ($query->result() as $row) {
                    $jenis = $row->jenis;
                    $no_kas = $row->no_kas;
                    $tgl_kas = $row->tgl_kas;
                    $keterangan = $row->keterangan;
                    $kd_kegiatan = $row->kd_kegiatan;
                    $kd_rek = $row->kd_rek;
                    $nilai = $row->nilai;
                    $kd_skpd = $row->kd_skpd;
					$no=$no+1;
					if($jenis==1){
					$cRet .='<TR>
								<TD align="left" >'.$no_kas.'</TD>
								<TD align="left" >'.$tgl_kas.'</TD>
								<TD align="left" >'.$keterangan.'<br>
												 SKPD	: '.$this->rka_model->get_nama($kd_skpd,'nm_skpd','ms_skpd','kd_skpd').' <br>
												 Total  : '.number_format($nilai,"2",",",".").' </TD>								
								<TD align="left" ></TD>								
								<TD align="right" ></TD>
							 </TR>';		
					}
					else{
					$total_t=$total_t+$nilai;
					$cRet .= '<tr>
					<td style="border-top:hidden;"></td>
					<td style="border-top:hidden;"></td>
					<td style="border-top:hidden;"></td>
					<td valign="top" style="border-top:hidden;">'.$kd_kegiatan.'.'.$kd_rek.'</td>
					<td valign="top" align="right" style="border-top:hidden;">'.number_format($nilai,"2",",",".").'</td>
					</tr>';
					}
									
			
				}
				
				$cRet .='<TR>
								<TD colspan="4" align="right" ><b>Jumlah Periode Ini</b>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
								<TD align="right" >'.number_format($total_t,"2",",",".").'</TD>
							 </TR>';
							 
				$query = $this->db->query("SELECT SUM(nilai) as nilai_lalu FROM(
						SELECT a.no_kas,a.tgl_kas, a.kd_skpd,keterangan, kd_kegiatan,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
						FROM (
						SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan,b.kd_kegiatan,kd_rek5 as kd_rek, rupiah as nilai 
						FROM trhkasin_ppkd a 
						INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
						WHERE jns_trans IN ('5','1')) a
						LEFT JOIN 
						(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
						INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
						WHERE jns_trans IN ('5','1')
						GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
						ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
						WHERE (tgl_kas <'$tgl1')
						$where
					"); 			 
				foreach ($query->result() as $row) {	
				$nilai_lalu =$row->nilai_lalu;
				$cRet .='<TR>
								<TD colspan="4" align="right" ><b>Jumlah Periode Lalu</b>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
								<TD align="right" >'.number_format($nilai_lalu,"2",",",".").'</TD>
							 </TR>';
				}			 
							 
							 
			$cRet .='</TABLE>';
			
			

			$data['prev']= 'Register CP KASDA';
	switch ($ctk)
        {
            case 0;
			 echo ("<title> Register CP Kasda</title>");
				echo $cRet;
				break;
            case 1;
			$this->_mpdf('',$cRet,10,10,10,'P',1,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_cp.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}
	}
	
	function cetak_register_cp_rinci($tgl1='',$tgl2='',$no='',$ttd='',$skpd='',$ctk=''){
            $lntahunang = $this->session->userdata('pcThang');       
			$cRet ='<TABLE width="100%" style="font-size:16px">
                    <TR>
						<TD align="center" ><b>PEMERINTAH DAERAH PROVINSI KALIMANTAN BARAT <br>
						REGISTER PENERIMAAN CONTRA POS TAHUN ANGGARAN '.$lntahunang.'</b><br>
						Tanggal '.$this->tanggal_format_indonesia($tgl1).' s/d '.$this->tanggal_format_indonesia($tgl2).'
						
					</TD>
					</TR>
					</TABLE><br/>';

			
			$cRet .='<TABLE style="border-collapse:collapse;font-size:14px" border="1" cellspacing="2" cellpadding="0" width="100%" >
					 <THEAD>
					 <TR>
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="10%">No. Kas</TD>
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="10%">Tgl Kas</TD>						
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="30%">Uraian</TD>						
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="20%">Rekening</TD>						
						<TD bgcolor="#CCCCCC" colspan="9" align="center" width="60%">CP</TD>
						<TD bgcolor="#CCCCCC" rowspan="4" align="center" width="10%">Jumlah</TD>
					 </TR>
					 <TR>
					 <TD colspan="6" bgcolor="#CCCCCC" align="center">LS</TD>
					 <TD colspan="3" bgcolor="#CCCCCC" align="center">UP/GU/TU</TD>
					 </TR>
					 <TR>
					 <TD colspan="3" bgcolor="#CCCCCC" align="center">Gaji</TD>
					 <TD colspan="3" bgcolor="#CCCCCC" align="center">Barang dan Jasa</TD>
					 <TD rowspan="2" bgcolor="#CCCCCC" align="center">Pegawai</TD>
					 <TD rowspan="2" bgcolor="#CCCCCC" align="center">Barang</TD>
					 <TD rowspan="2" bgcolor="#CCCCCC" align="center">Modal</TD>
					 </TR>
					 <TR>
					 <TD bgcolor="#CCCCCC" align="center">HKPG</TD>
					 <TD bgcolor="#CCCCCC" align="center">Pot. Lain</TD>
					 <TD bgcolor="#CCCCCC" align="center">CP</TD>
					 <TD bgcolor="#CCCCCC" align="center">Peg.</TD>
					 <TD bgcolor="#CCCCCC" align="center">Brng.</TD>
					 <TD bgcolor="#CCCCCC" align="center">Modal.</TD>
					 </TR>
					 </THEAD>
					 ';

				if($skpd=="-"){
					$where = "";
				} else{
					$str=strlen($skpd);
					$where = " AND LEFT(kd_skpd,".strlen($skpd).")='$skpd'";
				}
				$query = $this->db->query("
							SELECT '1' as jenis,no_kas,tgl_kas,kd_skpd,keterangan as keterangan,'' kd_kegiatan, ''kd_rek
							,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '1' THEN nilai	ELSE 0 END) AS hkpg
							,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '2' THEN nilai	ELSE 0 END) AS pot_lain
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '1' THEN	nilai ELSE 0 END) AS cp
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) IN ('511','521') THEN	nilai ELSE 0	END) AS ls_peg
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '522' THEN	nilai ELSE 0	END) AS ls_brng
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '523' THEN	nilai ELSE 0	END) AS ls_modal
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('511','521') THEN nilai	ELSE 0 END) AS up_gu_peg
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('522','111') THEN	nilai	ELSE 0 END) AS up_gu_brng
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('523') THEN	nilai	ELSE 0 END) AS up_gu_modal
							,SUM (nilai) AS total
							 FROM(
							SELECT a.no_kas,a.tgl_kas, a.kd_skpd,keterangan, nilai, jns_trans,jns_cp,pot_khusus,kd_rek
							FROM (
							SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan,kd_rek5 as kd_rek, SUM(rupiah) as nilai
							FROM trhkasin_ppkd a 
							INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
							WHERE jns_trans IN ('5','1')
							GROUP BY a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd,keterangan,kd_rek5) a
							LEFT JOIN 
							(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
							INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
							WHERE jns_trans IN ('5','1')
							GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
							ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
							WHERE (tgl_kas  BETWEEN '$tgl1' AND '$tgl2')
							$where
							GROUP BY no_kas,tgl_kas,kd_skpd,keterangan
							
							UNION ALL
							
							SELECT '2' as jenis,no_kas,tgl_kas,kd_skpd,keterangan as keterangan,kd_kegiatan,kd_rek
							,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '1' THEN nilai	ELSE 0 END) AS hkpg
							,SUM(CASE	WHEN jns_trans = '5'	AND jns_cp = '1' AND pot_khusus = '2' THEN nilai	ELSE 0 END) AS pot_lain
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '1' THEN	nilai ELSE 0 END) AS cp
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) IN ('511','521') THEN	nilai ELSE 0	END) AS ls_peg
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '522' THEN	nilai ELSE 0	END) AS ls_brng
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '2' AND LEFT(kd_rek,3) = '523' THEN	nilai ELSE 0	END) AS ls_modal
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('511','521') THEN nilai	ELSE 0 END) AS up_gu_peg
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('522','111') THEN	nilai	ELSE 0 END) AS up_gu_brng
							,SUM(CASE	WHEN jns_trans = '1'	AND jns_cp = '3' AND LEFT(kd_rek,3) IN ('523') THEN	nilai	ELSE 0 END) AS up_gu_modal
							,SUM (nilai) AS total
							 FROM(
							SELECT a.no_kas,a.tgl_kas, a.kd_skpd,keterangan, kd_kegiatan,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
							FROM (
							SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan,b.kd_kegiatan,kd_rek5 as kd_rek, rupiah as nilai 
							FROM trhkasin_ppkd a 
							INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
							WHERE jns_trans IN ('5','1')) a
							LEFT JOIN 
							(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
							INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
							WHERE jns_trans IN ('5','1')
							GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
							ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
							WHERE (tgl_kas  BETWEEN '$tgl1' AND '$tgl2')
							$where
							GROUP BY no_kas,tgl_kas,kd_skpd,keterangan,kd_kegiatan,kd_rek
							ORDER BY tgl_kas,no_kas,jenis
							");
				
				$no=0;
				$hkpg_t=0;
				$pot_lain_t=0;
				$cp_t=0;
				$ls_peg_t=0;
				$ls_brng_t=0;
				$ls_modal_t=0;
				$up_gu_peg_t=0;
				$up_gu_brng_t=0;
				$up_gu_modal_t=0;
				$total_t=0;
				foreach ($query->result() as $row) {
                    $jenis = $row->jenis;
                    $no_kas = $row->no_kas;
                    $tgl_kas = $row->tgl_kas;
                    $keterangan = $row->keterangan;
                    $kd_kegiatan = $row->kd_kegiatan;
                    $kd_rek = $row->kd_rek;
                    $kd_skpd = $row->kd_skpd;
					$hkpg =$row->hkpg;
                    $pot_lain =$row->pot_lain;
                    $cp=$row->cp;                    
                    $ls_peg=$row->ls_peg;                    
                    $ls_brng=$row->ls_brng;                    
                    $ls_modal=$row->ls_modal;                    
                    $up_gu_peg=$row->up_gu_peg;                    
                    $up_gu_brng=$row->up_gu_brng;                    
                    $up_gu_modal=$row->up_gu_modal;   
                    $total=$row->total;
					$no=$no+1;
					if($jenis==1){
					$cRet .='<TR>
								<TD align="left" >'.$no_kas.'</TD>
								<TD align="left" >'.$tgl_kas.'</TD>
								<TD align="left" >'.$keterangan.'<br>
												 SKPD	: '.$this->rka_model->get_nama($kd_skpd,'nm_skpd','ms_skpd','kd_skpd').' <br>
												 Total  : '.number_format($total,"2",",",".").' </TD>								
								<TD align="left" ></TD>								
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
								<TD align="right" ></TD>
							 </TR>';		
					}
					else{
					$hkpg_t=$hkpg_t+$hkpg;
					$pot_lain_t=$pot_lain_t+$pot_lain;
					$cp_t=$cp_t+$cp;
					$ls_peg_t=$ls_peg_t+$ls_peg;
					$ls_brng_t=$ls_brng_t+$ls_brng;
					$ls_modal_t=$ls_modal_t+$ls_modal;
					$up_gu_peg_t=$up_gu_peg_t+$up_gu_peg;
					$up_gu_brng_t=$up_gu_brng_t+$up_gu_brng;
					$up_gu_modal_t=$up_gu_modal_t+$up_gu_modal;
					$total_t=$total_t+$total;					$cRet .= '<tr>
					<td style="border-top:hidden;"></td>
					<td style="border-top:hidden;"></td>
					<td style="border-top:hidden;"></td>
					<td valign="top" style="border-top:hidden;">'.$kd_kegiatan.'.'.$kd_rek.'</td>
					<TD align="right" style="border-top:hidden;" >'.number_format($hkpg,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;">'.number_format($pot_lain,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;">'.number_format($cp,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;">'.number_format($ls_peg,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;">'.number_format($ls_brng,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;">'.number_format($ls_modal,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;" >'.number_format($up_gu_peg,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;" >'.number_format($up_gu_brng,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;" >'.number_format($up_gu_modal,"2",",",".").'</TD>
					<TD align="right" style="border-top:hidden;">'.number_format($total,"2",",",".").'</TD>
					</tr>';
					}
									
			
				}
				
				$cRet .='<TR>
								<TD colspan="4" align="right" ><b>Jumlah Periode Ini</b>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
								<TD align="right" >'.number_format($hkpg_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($pot_lain_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($cp_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_peg_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_brng_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($ls_modal_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_peg_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_brng_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($up_gu_modal_t,"2",",",".").'</TD>
								<TD align="right" >'.number_format($total_t,"2",",",".").'</TD>
							 </TR>';
							 
				$query = $this->db->query("SELECT SUM(nilai) as nilai_lalu FROM(
						SELECT a.no_kas,a.tgl_kas, a.kd_skpd,keterangan, kd_kegiatan,kd_rek, nilai, jns_trans,jns_cp,pot_khusus
						FROM (
						SELECT a.no_kas,a.no_sts,a.tgl_kas,a.kd_skpd, keterangan,b.kd_kegiatan,kd_rek5 as kd_rek, rupiah as nilai 
						FROM trhkasin_ppkd a 
						INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
						WHERE jns_trans IN ('5','1')) a
						LEFT JOIN 
						(SELECT a.no_sts , a.kd_skpd , a.jns_trans, a.jns_cp, pot_khusus FROM trhkasin_pkd a 
						INNER JOIN trdkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
						WHERE jns_trans IN ('5','1')
						GROUP BY a.no_sts, a.kd_skpd, a.jns_trans, a.jns_cp, pot_khusus ) b
						ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd)a
						WHERE (tgl_kas <'$tgl1')
						$where
					"); 			 
				/*foreach ($query->result() as $row) {	
				$nilai_lalu =$row->nilai_lalu;
				$cRet .='<TR>
								<TD colspan="4" align="right" ><b>Jumlah Periode Lalu</b>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
								<TD align="right" >'.number_format($nilai_lalu,"2",",",".").'</TD>
							 </TR>';
				}			 
				*/			 
							 
			$cRet .='</TABLE>';
			
			

			$data['prev']= 'Register CP KASDA';
	switch ($ctk)
        {
            case 0;
			 echo ("<title> Register CP Kasda</title>");
				echo $cRet;
				break;
            case 1;
			$this->_mpdf('',$cRet,10,10,10,'P',1,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_cp.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}
	}

	
		
    function spp()
	{	
	 $this->index('0','trhspp','no_spp','kd_skpd','SPP','spp','');
	}
	
	function penerimaan_pajak_daerah()
    {
        $data['page_title']= 'PENERIMAAN PAJAK DAERAH';
        $this->template->set('title', 'PENERIMAAN PAJAK DAERAH');   
        $this->template->load('template','tukd/sp2d/penerimaan_pajak_daerah',$data) ; 
    }
	
	//copy_sts
	function ctk_penerimaan_pajak_daerah($bulan=''){
        
        $thn_ang    = $this->session->userdata('pcThang');
        $prv        = $this->db->query("SELECT TOP 1 * from sclient");
        $prvn       = $prv->row();          
        $prov       = $prvn->provinsi;         
        $daerah     = $prvn->daerah;
        $no_halaman = $this->uri->segment(4);
        $buln       = $this->getBulan_kasda($bulan);
        $pilih      = $this->uri->segment(6);
        $judul2     = "";
        
        if($pilih=='2'){
        $pertanggal1        = $this->uri->segment(7);
        $nm_pertanggal1     = $this->tanggal_format_indonesia_kasda2($pertanggal1);
        $pertanggalsbl      = $this->uri->segment(8);
        $nm_pertanggalsbl   = $this->tanggal_format_indonesia_kasda2($pertanggalsbl);
        $judul2     = ""; 
        }
        //per pengirim TANGGAL
        if($pilih=='31'){
        $id_pengirim            = $this->uri->segment(9);
        $tgl_ttd_pengirim       = $this->uri->segment(14);
        $nm_tgl_ttd_pengirim    = $this->tanggal_format_indonesia_kasda2($tgl_ttd_pengirim);
        $tgl_ttd1_pengirim      = $this->uri->segment(15);
        $nm_tgl_ttd1_pengirim   = $this->tanggal_format_indonesia_kasda2($tgl_ttd1_pengirim);
        $judul2     = "";
        }
        //per pengirim BULAN
        if($pilih=='32'){
        $id_pengirim        = $this->uri->segment(9);
        $pengirim_bulan     = $this->uri->segment(10);
        $nm_pengirim_bulan  = $this->getBulan_kasda($pengirim_bulan);
        $pengirim_bulan1    = $this->uri->segment(11);
        $nm_pengirim_bulan1 = $this->getBulan_kasda($pengirim_bulan1);
        $judul2     = "";
        }
        
        //per wilayah TANGGAL
        if($pilih=='51'){
        $id_wilayah         = $this->uri->segment(16);
        $tgl_ttd_wilayah       = $this->uri->segment(17);
        $nm_tgl_ttd_wilayah = $this->tanggal_format_indonesia_kasda2($tgl_ttd_wilayah);
        $tgl_ttd1_wilayah      = $this->uri->segment(18);
        $nm_tgl_ttd1_wilayah   = $this->tanggal_format_indonesia_kasda2($tgl_ttd1_wilayah);
        
        $sql = "SELECT kd_pengirim FROM ms_wilayah where kd_wilayah='$id_wilayah'";
        $hasil = $this->db->query($sql);
        foreach ($hasil->result() as $row)
                    {
                       $kd_rek = $row->kd_pengirim;
                       
                       if($kd_rek==''){
                        $kd_rek="'X'";
                        }
                        
                    }
        
        $prv        = $this->db->query("SELECT nm_wilayah FROM ms_wilayah where kd_wilayah='$id_wilayah'");
        $prvn       = $prv->row();          
        $judul2     = $prvn->nm_wilayah; 
        
        }
        //per wilayah BULAN
        if($pilih=='52'){
        $id_wilayah        = $this->uri->segment(16);
        $wilayah_bulan     = $this->uri->segment(19);
        $nm_wilayah_bulan  = $this->getBulan_kasda($wilayah_bulan);
        $wilayah_bulan1    = $this->uri->segment(20);
        $nm_wilayah_bulan1 = $this->getBulan_kasda($wilayah_bulan1);
        
        $sql = "SELECT kd_pengirim FROM ms_wilayah where kd_wilayah='$id_wilayah'";
        $hasil = $this->db->query($sql);
        foreach ($hasil->result() as $row)
                    {
                       $kd_rek = $row->kd_pengirim;
                       
                       if($kd_rek==''){
                        $kd_rek="'X'";
                        }
                        
                    }
        
        $prv        = $this->db->query("SELECT nm_wilayah FROM ms_wilayah where kd_wilayah='$id_wilayah'");
        $prvn       = $prv->row();          
        $judul2     = $prvn->nm_wilayah; 
        
        }
        
        if($pilih=='4'){
        $rekap_bulan        = $this->uri->segment(12);
        $nm_rekap_bulan     = $this->getBulan_kasda($rekap_bulan);
        $rekap_bulan1       = $this->uri->segment(13);
        $nm_rekap_bulan1    = $this->getBulan_kasda($rekap_bulan1);
        $judul2     = "";
        }
        
        $judul="REKAPITULASI PENERIMAAN PAJAK DAERAH";
        
        
        if($pilih=='1'){
            $waktu = "Bulan : $buln";
        }else if($pilih=='2'){
            $waktu = "Tanggal : $nm_pertanggal1 $thn_ang";  
        }else if($pilih=='32'){
            $waktu = "Bulan : $nm_pengirim_bulan s/d  $nm_pengirim_bulan1 $thn_ang";    
        }else if($pilih=='31'){
            $waktu = "Tanggal : $nm_tgl_ttd_pengirim $thn_ang"; 
        }else if($pilih=='51'){
            $waktu = "Tanggal : $nm_tgl_ttd_wilayah $thn_ang";  
        }else if($pilih=='52'){
            $waktu = "Bulan : $nm_wilayah_bulan s/d  $nm_wilayah_bulan1 $thn_ang";  
        }else{
            $waktu = "Bulan : $nm_rekap_bulan s/d  $nm_rekap_bulan1 $thn_ang";  
        }
        $cRet = '';
        
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
                <tr>
                    <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\">&nbsp;</td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$judul2</b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\">&nbsp;</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$waktu</b></td>
                </tr>
                </table>
                <table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
                <thead>";
            if($pilih=='32'){   
            $cRet .="<tr>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"4%\" style=\"font-weight:bold;\">TANGGAL</td>  
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">UPPD/SAMSAT</td>  
                    <td align=\"center\" colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PKB</td>
                    <td align=\"center\" colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">BBN-KB</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">BBN-TKA</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">PKA</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">BBN-KA</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">PAP</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">DENDA PAP</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">SP 3</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">PBB-KB</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH</td>
                </tr>
                <tr>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold;\">PKB</td>  
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">DENDA PKB</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Tgk. PKB</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">BBN</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Denda BBN</td>
                </tr>
                <tr>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">15</td>
                </tr>
                </thead>";
            }else{
                $cRet .="<tr>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">UPPD/SAMSAT</td>  
                    <td align=\"center\" colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PKB</td>
                    <td align=\"center\" colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">BBN-KB</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">BBN-TKA</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">PKA</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">BBN-KA</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">PAP</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">DENDA PAP</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">SP 3</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">PBB-KB</td>
                    <td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH</td>
                </tr>
                <tr>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold;\">PKB</td>  
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">DENDA PKB</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Tgk. PKB</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">BBN</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Denda BBN</td>
                </tr>
                <tr>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
                    <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
                </tr>
                </thead>";
            }
            
                        $jumlah_pkb=0;
                        $jumlah_denda_pkb=0;
                        $jumlah_tgk_pkb=0;
                        $jumlah_bbn=0;
                        $jumlah_denda_bbn=0;
                        $jumlah_denda_bbntka=0;
                        $jumlah_pka=0;
                        $jumlah_bbn_ka=0;
                        $jumlah_pap=0;
                        $jumlah_denda_pap=0;
                        $jumlah_sp3=0;
                        $jumlah_pbb_kb=0;
                        $jumlah_jumlah=0;
                    
                        $pkb_all = "('4110101','4110102','4110103','4110104','4110105','4110106','4110107','4110108','4110109','4110110','4110111','4110112','4110113')";
                        $denda_pkb_all = "('4140701')";
                        $tgk_pkb_all = "('4110114')";
                        $bbn_all = "('4110201','4110202','4110203','4110204','4110205','4110206','4110207','4110208','4110209','4110210','4110211','4110212')";
                        $denda_bbn_all = "('4140702')";
                        $denda_bbn_tka = "('4140704')";
                        $pka_all = "('')";
                        $bbnka_all = "('4110213')";
                        $pap_all = "('4110401')";
                        $denda_pap_all = "('4140705')";
                        $sp3_all = "('4310302')";
                        $pbb_kb_all = "('4110301','4110302','4110303')";
                        $jumlah_all = "('4110101','4110102','4110103','4110104','4110105','4110106','4110107','4110108','4110109','4110110','4110111','4110112','4140701','4110114','4110201','4110202','4110203','4110204','4110205','4110206','4110207','4110208','4110209','4110210','4110211','4110212','4140702','4110113','4110213','4110401','4140705','4310302','4110301','4110302','4110303','4140704')";
                    
                    //PER BULAN
                    if($pilih=='1'){    
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim,ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka , ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap, ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE MONTH(a.tgl_kas)='$bulan'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411'
                                ORDER BY cast(a.kd_pengirim AS int)";
                    //PERTANGGAL    
                    }else if($pilih=='2'){
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim,ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka, ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap,ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka  
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE a.tgl_kas='$pertanggal1'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411'
                                ORDER BY cast(a.kd_pengirim AS int)";
                    //PERPENGIRIM BULAN
                    }else if($pilih=='32'){
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim, b.tgl_kas, ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka, ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap,ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber, a.tgl_kas
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb  
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber='$id_pengirim' AND (MONTH(a.tgl_kas)>='$pengirim_bulan' AND MONTH(a.tgl_kas)<='$pengirim_bulan1')
                                GROUP BY b.sumber, a.tgl_kas
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' AND a.kd_pengirim='$id_pengirim'
                                ORDER BY cast(a.kd_pengirim AS int)";
                    //PER SUMBER PER TANGGAL
                    }else if($pilih=='31'){
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim,ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka, ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap,ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber='$id_pengirim' AND a.tgl_kas='$tgl_ttd_pengirim'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' AND a.kd_pengirim='$id_pengirim'
                                ORDER BY cast(a.kd_pengirim AS int)";
                    //PER WILAYAH PER TANGGAL
                    }else if($pilih=='51'){
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim,ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka, ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap,ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb  
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber IN ($kd_rek) AND a.tgl_kas='$tgl_ttd_wilayah'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' AND a.kd_pengirim in ($kd_rek)
                                ORDER BY cast(a.kd_pengirim AS int)";
                    }else if($pilih=='52'){
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim,ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka, ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap,ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber IN ($kd_rek) AND (MONTH(a.tgl_kas)>='$wilayah_bulan' AND MONTH(a.tgl_kas)<='$wilayah_bulan1')
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' AND a.kd_pengirim in ($kd_rek)
                                ORDER BY cast(a.kd_pengirim AS int)";
                    }else{
                        $sql1="SELECT a.kd_pengirim,a.nm_pengirim,ISNULL(b.pkb,0) pkb, ISNULL(b.denda_pkb,0) denda_pkb, ISNULL(b.tgk_pkb,0) tgk_pkb, ISNULL(b.bbn,0) bbn, ISNULL(b.denda_bbn,0) denda_bbn,ISNULL(b.denda_bbntka,0) denda_bbntka, ISNULL(b.pka,0) pka, ISNULL(b.bbn_ka,0) bbn_ka, ISNULL(b.pap,0) pap, ISNULL(b.denda_pap,0) denda_pap, ISNULL(b.sp3,0) sp3,ISNULL(b.pbb_kb,0) pbb_kb, ISNULL(b.jumlah,0) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE MONTH(a.tgl_kas)>='$rekap_bulan' AND MONTH(a.tgl_kas)<='$rekap_bulan1'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411'
                                ORDER BY cast(a.kd_pengirim AS int)";
                    }           
                            $hasil1 = $this->db->query($sql1);
                            foreach ($hasil1->result() as $row1)
                            {
                                $kd_pengirim=$row1->kd_pengirim;
                                $nm_pengirim=$row1->nm_pengirim;
                                if($pilih=='32'){   
                                $tgl_kas=$row1->tgl_kas; 
                                }
                                $pkb=$row1->pkb;
                                $denda_pkb=$row1->denda_pkb;
                                $tgk_pkb=$row1->tgk_pkb;
                                $bbn=$row1->bbn;
                                $denda_bbn=$row1->denda_bbn;
                                $denda_bbntka=$row1->denda_bbntka;
                                $pka=$row1->pka;
                                $bbn_ka=$row1->bbn_ka;
                                $pap=$row1->pap;
                                $denda_pap=$row1->denda_pap;
                                $sp3=$row1->sp3;
                                $pbb_kb=$row1->pbb_kb;
                                $jumlah=$row1->jumlah;
                                
                                $jumlah_pkb=$jumlah_pkb+$pkb;
                                $jumlah_denda_pkb=$jumlah_denda_pkb+$denda_pkb;
                                $jumlah_tgk_pkb=$jumlah_tgk_pkb+$tgk_pkb;
                                $jumlah_bbn=$jumlah_bbn+$bbn;
                                $jumlah_denda_bbn=$jumlah_denda_bbn+$denda_bbn;
                                $jumlah_denda_bbntka=$jumlah_denda_bbntka+$denda_bbntka;
                                $jumlah_pka=$jumlah_pka+$pka;
                                $jumlah_bbn_ka=$jumlah_bbn_ka+$bbn_ka;
                                $jumlah_pap=$jumlah_pap+$pap;
                                $jumlah_denda_pap=$jumlah_denda_pap+$denda_pap;
                                $jumlah_sp3=$jumlah_sp3+$sp3;
                                $jumlah_pbb_kb=$jumlah_pbb_kb+$pbb_kb;
                                $jumlah_jumlah=$jumlah_jumlah+$jumlah;
                                
                            if($pilih=='32'){   
                                $cRet .="<tr>
                                <td align=\"left\">$tgl_kas</td>
                                <td align=\"left\">$kd_pengirim &nbsp; $nm_pengirim</td>
                                <td align=\"right\">".number_format($pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($tgk_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbntka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn_ka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($sp3,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pbb_kb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah,"2",",",".")."</td>
                            </tr>";
                            }else{
                                $cRet .="<tr>
                                <td align=\"left\">$kd_pengirim &nbsp; $nm_pengirim</td>
                                <td align=\"right\">".number_format($pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($tgk_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbntka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn_ka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($sp3,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pbb_kb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah,"2",",",".")."</td>
                                </tr>";
                            }
                            
                        }
                    
                    

            if($pilih=='1'){
                $waktu2 = "Jumlah Bulan : $buln";
            }else if($pilih=='2'){
                $waktu2 = "Jumlah Tanggal : $nm_pertanggal1";
            }else if($pilih=='32'){
                $waktu2 = "Jumlah Bulan : $nm_pengirim_bulan s/d $nm_pengirim_bulan1";
            }else if($pilih=='31'){
                $waktu2 = "Jumlah Tanggal : $nm_tgl_ttd_pengirim";
            }else if($pilih=='51'){
                $waktu2 = "Jumlah Tanggal : $nm_tgl_ttd_wilayah";
            }else if($pilih=='52'){
                $waktu2 = "Jumlah Bulan : $nm_wilayah_bulan s/d $nm_wilayah_bulan1";
            }else{
                $waktu2 = "Jumlah Bulan : $nm_rekap_bulan s/d $nm_rekap_bulan1";
            }
            
            if($pilih=='32'){
            $cRet .="<tr>
                                <td align=\"left\" colspan=\"2\"><b>$waktu2</b></td>
                                <td align=\"right\">".number_format($jumlah_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_tgk_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_bbntka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_pka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_bbn_ka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_sp3,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_pbb_kb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_jumlah,"2",",",".")."</td>
                    </tr>";
            }else{
                $cRet .="<tr>
                                <td align=\"left\"><b>$waktu2</b></td>
                                <td align=\"right\">".number_format($jumlah_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_tgk_pkb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_bbn,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_bbntka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_pka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_bbn_ka,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_denda_pap,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_sp3,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_pbb_kb,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah_jumlah,"2",",",".")."</td>
                    </tr>";
            }   
                if($pilih=='1'){    
                $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3,SUM(ISNULL(b.pbb_kb,0)) pbb_kb, SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbntka
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE MONTH(a.tgl_kas)<='$bulan'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411'
                                ";
                }else if($pilih=='2'){
                    $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3, SUM(ISNULL(b.pbb_kb,0)) pbb_kb, SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE a.tgl_kas <= '$pertanggalsbl'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411'
                                ";
                }else if($pilih=='32'){
                    $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3, SUM(ISNULL(b.pbb_kb,0)) pbb_kb, SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber='$id_pengirim' AND  MONTH(a.tgl_kas)<='$pengirim_bulan1'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' and a.kd_pengirim='$id_pengirim'";
                }else if($pilih=='31'){
                    $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3, SUM(ISNULL(b.pbb_kb,0)) pbb_kb, SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb  
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber='$id_pengirim' AND  a.tgl_kas<='$tgl_ttd1_pengirim'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' and a.kd_pengirim='$id_pengirim'";
                }else if($pilih=='51'){
                    $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3, SUM(ISNULL(b.pbb_kb,0)) pbb_kb, SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb  
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
                                WHERE b.sumber in ($kd_rek) AND  a.tgl_kas<='$tgl_ttd1_wilayah'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' and a.kd_pengirim in ($kd_rek)";
                }else if($pilih=='52'){
                    $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3, SUM(ISNULL(b.pbb_kb,0)) pbb_kb, SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb  
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE b.sumber in ($kd_rek) AND  MONTH(a.tgl_kas)<='$wilayah_bulan1'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411' and a.kd_pengirim in ($kd_rek)";
                }else{
                    $sql2="SELECT SUM(ISNULL(b.pkb,0)) pkb, SUM(ISNULL(b.denda_pkb,0)) denda_pkb, SUM(ISNULL(b.tgk_pkb,0)) tgk_pkb, SUM(ISNULL(b.bbn,0)) bbn, SUM(ISNULL(b.denda_bbn,0)) denda_bbn,SUM(ISNULL(b.denda_bbntka,0)) denda_bbntka, SUM(ISNULL(b.pka,0)) pka, SUM(ISNULL(b.bbn_ka,0)) bbn_ka, SUM(ISNULL(b.pap,0)) pap,sum(ISNULL(b.denda_pap,0)) denda_pap, SUM(ISNULL(b.sp3,0)) sp3, SUM(ISNULL(b.pbb_kb,0)) pbb_kb,SUM(ISNULL(b.jumlah,0)) jumlah 
                                FROM ms_pengirim a 
                                LEFT JOIN (
                                select b.sumber
                                ,SUM(CASE WHEN b.kd_rek5 IN $pkb_all THEN b.rupiah ELSE 0 END) as pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pkb_all THEN b.rupiah ELSE 0 END) as denda_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $tgk_pkb_all THEN b.rupiah ELSE 0 END) as tgk_pkb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbn_all THEN b.rupiah ELSE 0 END) as bbn 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_all THEN b.rupiah ELSE 0 END) as denda_bbn
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_bbn_tka THEN b.rupiah ELSE 0 END) as denda_bbntka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pka_all THEN b.rupiah ELSE 0 END) as pka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $bbnka_all THEN b.rupiah ELSE 0 END) as bbn_ka 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pap_all THEN b.rupiah ELSE 0 END) as pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $denda_pap_all THEN b.rupiah ELSE 0 END) as denda_pap 
                                ,SUM(CASE WHEN b.kd_rek5 IN $sp3_all THEN b.rupiah ELSE 0 END) as sp3 
                                ,SUM(CASE WHEN b.kd_rek5 IN $pbb_kb_all THEN b.rupiah ELSE 0 END) as pbb_kb 
                                ,SUM(CASE WHEN b.kd_rek5 IN $jumlah_all THEN b.rupiah ELSE 0 END) as jumlah 
                                from trhkasin_ppkd a 
                                inner join trdkasin_ppkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas
                                WHERE MONTH(a.tgl_kas)>='$rekap_bulan' AND MONTH(a.tgl_kas)<='$rekap_bulan1'
                                GROUP BY b.sumber
                                 ) b
                                on a.kd_pengirim=b.sumber
                                WHERE LEFT(jns_rek,3)='411'
                                ";
                }           
                            $hasil2 = $this->db->query($sql2);
                            foreach ($hasil2->result() as $row2)
                            {
                                
                                $pkb2=$row2->pkb;
                                $denda_pkb2=$row2->denda_pkb;
                                $tgk_pkb2=$row2->tgk_pkb;
                                $bbn2=$row2->bbn;
                                $denda_bbn2=$row2->denda_bbn;
                                $denda_bbntka2=$row2->denda_bbntka;
                                $pka2=$row2->pka;
                                $bbn_ka2=$row2->bbn_ka;
                                $pap2=$row2->pap;
                                $denda_pap2=$row2->denda_pap;
                                $sp32=$row2->sp3;
                                $pbb_kb2=$row2->pbb_kb;
                                $jumlah2=$row2->jumlah;
                                
                            }
                            if($pilih=='1'){
                                $waktu3 = "Jumlah s/d Bulan : $buln";
                            }else if($pilih=='2'){
                                $waktu3 = "Jumlah s/d Tanggal : $nm_pertanggalsbl";
                            }else if($pilih=='32'){
                                $waktu3 = "Jumlah s/d Bulan : $nm_pengirim_bulan1";
                            }else if($pilih=='31'){
                                $waktu3 = "Jumlah s/d Tanggal : $nm_tgl_ttd1_pengirim";
                            }else if($pilih=='52'){
                                $waktu3 = "Jumlah s/d Bulan : $nm_wilayah_bulan1";
                            }else if($pilih=='51'){
                                $waktu3 = "Jumlah s/d Tanggal : $nm_tgl_ttd1_wilayah";
                            }else{
                                $waktu3 = "Jumlah s/d Bulan : $nm_rekap_bulan1";
                            }
                
                if($pilih=='32'){
                $cRet .="<tr>
                                <td align=\"left\" colspan=\"2\"><b>$waktu3</b></td>
                                <td align=\"right\">".number_format($pkb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pkb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($tgk_pkb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbn2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbntka2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pka2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn_ka2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pap2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pap2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($sp32,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pbb_kb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah2,"2",",",".")."</td>
                            </tr>";
                }else{
                    $cRet .="<tr>
                                <td align=\"left\"><b>$waktu3</b></td>
                                <td align=\"right\">".number_format($pkb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pkb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($tgk_pkb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbn2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_bbntka2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pka2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($bbn_ka2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pap2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($denda_pap2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($sp32,"2",",",".")."</td>
                                <td align=\"right\">".number_format($pbb_kb2,"2",",",".")."</td>
                                <td align=\"right\">".number_format($jumlah2,"2",",",".")."</td>
                            </tr>";
                }           

        $cRet .= '</table>';
        
        $print = $this->uri->segment(5);
        
        if($print==0){
             $data['prev']= $cRet;    
             echo ("<title></title>");
             echo $cRet;
        }else{
            
            $this->_mpdf2('',$cRet,10,10,10,'1',$no_halaman,'');
            
        }
        
            
        
    }

	
	function cetak_amortisasi()
    {
        $data['page_title']= 'CETAK AMORTISASI';
        $this->template->set('title', 'CETAK AMORTISASI');   
        $this->template->load('template','tukd/transaksi/cetak_amortisasi',$data) ; 
    }
	
	function bk_penerimaan()
    {
        $data['page_title']= 'CETAK BUKU KAS PENERIMAAN';
        $this->template->set('title', 'CETAK BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/bk_penerimaan',$data) ; 
    }
	
	function ctk_bk_penerimaan($jns='', $ctk='',$ttd1='',$tgl=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(5));
		$cetk = $this->uri->segment(11);
		
		if($cetk=='1'){
			$tanggal = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
			
			$where ="b.tgl_kas = '$tgl'";
			$where2 ="tanggal = '$tgl'";
			$where1 ="tanggal = '$tgl'";
			$where3 ="a.tgl_kas<'$tgl'";
			$where4 ="c.tanggal<'$tgl'";
			$where5 ="tanggal<'$tgl'";
			
		}else{
			
			$tgl1 = $this->uri->segment(9);
			$tgl2 = $this->uri->segment(10);
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
			
			$where ="b.tgl_kas between '$tgl1' AND '$tgl2'";
			$where2 ="tanggal between '$tgl1' AND '$tgl2'";
			$where1 ="tanggal between '$tgl1' AND '$tgl2'";
			$where3 ="a.tgl_kas<'$tgl1'";
			$where4 ="c.tanggal<'$tgl1'";
			$where5 ="tanggal<'$tgl1'";
		}
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		$no_halaman = $this->uri->segment(7);
		$spasi = $this->uri->segment(8);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		switch ($jns){
                        case '0': //GAJI
						//$where2="and a.jns_spp='4'";
						$judul="BUKU KAS PEMBANTU PENERIMAAN";
                            break; 
                        /* case '1': //NON GAJI
						$where2="and a.jns_spp!='4'";
						$judul="BUKU KAS PENERIMAAN";
                            break; */
                                               
                    }
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"45%\" style=\"font-weight:bold\">Uraian</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Kode Rekening</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
				</tr>";
				
				if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
		
		$nilai3=0; 
		
		//isi
			/* //lap_1
				$sql = "select * from(
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE $where AND a.kd_skpd !='1.20.08.17'  AND LEFT(a.kd_rek5,3) NOT IN ('411','431','414') 
					GROUP BY b.no_kas,nm_pengirim, f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					WHERE $where AND a.kd_skpd !='1.20.08.17' AND LEFT(a.kd_rek5,3) NOT IN ('411','431','414') 
					
					UNION ALL
					
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE $where AND a.kd_skpd !='1.20.08.17' AND LEFT(a.kd_rek5,3) IN ('411','431','414') 
					GROUP BY b.no_kas,nm_pengirim, f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas  AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					WHERE $where AND a.kd_skpd !='1.20.08.17' AND LEFT(a.kd_rek5,3) IN ('411','431','414') 
					
					UNION ALL
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						''nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE $where AND a.kd_skpd ='1.20.08.17'
					GROUP BY b.no_kas,f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						b.keterangan nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas  AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					WHERE $where AND a.kd_skpd ='1.20.08.17'
					
					UNION ALL
					SELECT
							1 AS urut,
							'' no_sts,
							'' kd_skpd,
							nm_skpd,
							'' kd_kegiatan,
							'' kd_rek5,
							[no] as no_kas,
							'' tgl_kas,
							'' nm_pengirim,
							'' nm_rek5,
							0 rupiah
						FROM
							trkasout_ppkd  
						WHERE
							$where2
						UNION ALL
						SELECT
								2 AS urut,
								[no] as no_sts,
								kd_skpd,
								'' nm_skpd,
								kd_kegiatan,
								kd_rek kd_rek5,
								[no] no_kas,
								[tanggal] tgl_kas,
								'' nm_pengirim,
								keterangan+' '+nm_kd_rek nm_rek5,
								nilai as rupiah
							FROM
							trkasout_ppkd 
							WHERE
							$where2
						UNION ALL
							SELECT
								1 AS urut,
								'' no_sts,
								'' kd_skpd,
								(select nm_skpd from ms_skpd where kd_skpd='1.20.08.17') nm_skpd,
								'' kd_kegiatan,
								'' kd_rek5,
								[nomor] AS no_kas,
								'' tgl_kas,
								'' nm_pengirim,
								'' nm_rek5,
								0 rupiah
							FROM
								penerimaan_non_sp2d
							WHERE
								$where1
							UNION ALL
								SELECT
									2 AS urut,
									'[nomor]' AS no_sts,
									'1.20.08.17' kd_skpd,
									'' nm_skpd,
									'' kd_kegiatan,
									'' kd_rek5,
									[nomor] no_kas,
									[tanggal] tgl_kas,
									'' nm_pengirim,
									keterangan nm_rek5,
									nilai AS rupiah
								FROM
									penerimaan_non_sp2d
								WHERE
									$where1
					) a
					order by nm_pengirim, cast(no_kas as int),urut"; */
					
		//lap_2
					$sql = "select * from(
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE $where AND a.kd_skpd !='4.02.02.02'  AND LEFT(a.kd_rek5,3) NOT IN ('411','431','414') 
					GROUP BY b.no_kas,nm_pengirim, f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					WHERE $where AND a.kd_skpd !='4.02.02.02' AND LEFT(a.kd_rek5,3) NOT IN ('411','431','414') 
					
					UNION ALL
					
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						'' nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE $where AND a.kd_skpd !='4.02.02.02' AND LEFT(a.kd_rek5,3) IN ('411','431','414') 
					GROUP BY b.no_kas,f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas  AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					LEFT JOIN ms_pengirim e ON a.sumber = e.kd_pengirim
					WHERE $where AND a.kd_skpd !='4.02.02.02' AND LEFT(a.kd_rek5,3) IN ('411','431','414') 
					
					UNION ALL
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						''nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE $where AND a.kd_skpd ='4.02.02.02'
					GROUP BY b.no_kas,f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_kegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						b.keterangan nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_kas = b.no_kas  AND a.kd_skpd=b.kd_skpd
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					WHERE $where AND a.kd_skpd ='4.02.02.02'
					
					UNION ALL
					SELECT
							1 AS urut,
							'' no_sts,
							'' kd_skpd,
							nm_skpd,
							'' kd_kegiatan,
							'' kd_rek5,
							[no] as no_kas,
							'' tgl_kas,
							'' nm_pengirim,
							'' nm_rek5,
							0 rupiah
						FROM
							trkasout_ppkd  
						WHERE
							$where2
						UNION ALL
						SELECT
								2 AS urut,
								[no] as no_sts,
								kd_skpd,
								'' nm_skpd,
								kd_kegiatan,
								kd_rek kd_rek5,
								[no] no_kas,
								[tanggal] tgl_kas,
								'' nm_pengirim,
								keterangan+' '+nm_kd_rek nm_rek5,
								nilai as rupiah
							FROM
							trkasout_ppkd 
							WHERE
							$where2
						UNION ALL
							SELECT
								1 AS urut,
								'' no_sts,
								'' kd_skpd,
								(select nm_skpd from ms_skpd where kd_skpd='4.02.02.02') nm_skpd,
								'' kd_kegiatan,
								'' kd_rek5,
								[nomor] AS no_kas,
								'' tgl_kas,
								'' nm_pengirim,
								'' nm_rek5,
								0 rupiah
							FROM
								penerimaan_non_sp2d
							WHERE
								$where1
							UNION ALL
								SELECT
									2 AS urut,
									'[nomor]' AS no_sts,
									'3.13.01.17' kd_skpd,
									'' nm_skpd,
									'' kd_kegiatan,
									'' kd_rek5,
									[nomor] no_kas,
									[tanggal] tgl_kas,
									'' nm_pengirim,
									keterangan nm_rek5,
									nilai AS rupiah
								FROM
									penerimaan_non_sp2d
								WHERE
									$where1
					) a
					order by no_kas ,urut";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
			
			$urut		  = $row->urut;
			$no_sts       = $row->no_sts;
			$kd_skpd      = $row->kd_skpd;
			$nm_skpd      = $row->nm_skpd;
			$kd_kegiatan  = $row->kd_kegiatan;
			$kd_rek5      = $row->kd_rek5;
			$no_kas       = $row->no_kas;
			$tgl_kas      = $row->tgl_kas;
			$nm_pengirim  = $row->nm_pengirim;
			
			if($nm_pengirim==''){
				$nama_kirim = $nm_skpd;
				$nm_lokasi = "";
			}else{
				$nama_kirim = $nm_pengirim;
				$nm_lokasi = $nm_pengirim;
			}
			
			$nm_rek5      = $row->nm_rek5;
			$nilai        = $row->rupiah;
			$nilaix       = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                      
			if($nilai<0){
				$a="(";
				$b=")";
				$nilaix = number_format($nilai*-1,"2",",",".");
			}else{
				$a="";
				$b="";
			}
			//$jumlah      = ($row->jumlah)+1;
			
			//total pertanggal
			$nilai3=$nilai3+$nilai;
												
			if ($kd_kegiatan==''){
				$kode="";
			} else {
				$kode="$kd_kegiatan.$kd_rek5";
			}
		
			if($urut=='1'){
				$cRet .="<tr>
							<td align=\"center\">$no_kas</td>
							<td align=\"left\">$nama_kirim</td>
							<td align=\"left\"></td>
							<td align=\"right\"></td>
						</tr>";
			}else{
				$cRet .="<tr>
							<td align=\"left\" style=\"border-top:hidden;\"></td>
							<td align=\"left\" style=\"border-top:hidden;\">$nm_rek5 $nm_lokasi</td>
							<td align=\"left\" style=\"border-top:hidden;\">$kode</td>
							<td align=\"right\" style=\"border-top:hidden;\">$a $nilaix $b</td>
						</tr>";
			}
		}
		 
		
		 
		//total sebelum
		$sql2 = "select sum(nilai) as nilai from( 
				select sum(b.rupiah) as nilai from trhkasin_ppkd a 
				inner join trdkasin_ppkd b on a.no_kas=b.no_kas 
				and a.kd_skpd=b.kd_skpd 
				and a.no_sts=b.no_sts 
				where $where3
				UNION ALL
				select sum(c.nilai) as nilai from trkasout_ppkd c
				where $where4
				UNION ALL
				select sum(nilai) as nilai from penerimaan_non_sp2d
				where $where5
			) a";
		$hasil2=$this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$nilai2  = $row->nilai;
			$nilai2x = number_format($nilai2,"2",",",".");
		}	
		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		if($cetk=='1'){
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}else{
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		 $data['prev']= $cRet;  
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan</title>");
			 echo $cRet;
		}else if($print==1){
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=bk_terima.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
		
	}
	
	
	function daftar_pengeluaran()
    {
        $data['page_title']= 'DAFTAR PENGELUARAN';
        $this->template->set('title', 'DAFTAR PENGELUARAN');   
        $this->template->load('template','tukd/sp2d/daftar_pengeluaran',$data) ; 
    }
	
	function daftar_pajak()
    {
        $data['page_title']= 'DAFTAR PAJAK';
        $this->template->set('title', 'DAFTAR PAJAK');   
        $this->template->load('template','tukd/sp2d/daftar_pajak',$data) ; 
    }
	
	function buku_kas_penerimaan_pengeluaran_manual($ctk='',$ttd='',$tgl='',$number='',$no_halaman=''){
		
		$lcttd = str_replace('abc',' ',$this->uri->segment(4));
		$tanggal = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT top 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
	
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
			
		$sqlx="SELECT * from buku_kas where nomor='0'";	
		$sqlx1=$this->db->query($sqlx);
		 foreach ($sqlx1->result() as $rowttd)
			{
				$nomor=$rowttd->nomor;
				$uraian=$rowttd->uraian;
				$nilaiu= $rowttd->nilai;
				$nilaiu_x = number_format($nilaiu,"2",",",".");
			}
		if ($tgl=='2016-1-1'){	
		$cRet="";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
				<td></td>
                <td>Tanggal : $tanggal</td>
				<td></td>
                <td></td>
			</tr>
			<tr>
				<td align=\"center\">1</td>
                <td>$uraian</td>
				<td align=\"right\">$nilaiu_x</td>
                <td align=\"right\">0,00</td>
			</tr>
			</thead>";
		}else{
		$cRet="";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
				<td></td>
                <td>Tanggal : $tanggal</td>
				<td></td>
                <td></td>
			</tr>
			</thead>";
		}
		$tot_trm=0; 
		$tot_klr=0; 
		$sql="SELECT a.nomor, a.uraian,ISNULL(SUM(b.nilai),0) as nilai from 
				buku_kas a LEFT JOIN 
				(
				select jenis, sum(nilai) as nilai from buku_kas_penerimaan_pengeluaran
				where tanggal='$tgl' group by jenis
				UNION ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and  a.jns_spp !='4' and a.tgl_kas_bud='$tgl'
				UNION ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and  a.jns_spp ='4' and a.tgl_kas_bud='$tgl'
				UNION ALL
			SELECT
				13 AS jenis,
				isnull(SUM(x.nilai), 0) AS nilai
			FROM
				pengeluaran_non_sp2d x
			where x.tanggal = '$tgl') b
				on a.nomor=b.jenis 
				where nomor != '0' AND b.nilai !='0'
				GROUP BY a.nomor,a.uraian
				ORDER BY nomor";
		if ($tgl=='2016-1-1'){	
		$no=1;
		}else{
		$no=$number-1;	
		}
		$hasil = $this->db->query($sql);
		foreach ($hasil->result() as $row){
			$nomor  = $row->nomor;                    
			$uraian= $row->uraian;
			$nilai  = $row->nilai;
		if(($nomor==1) or ($nomor==2) or ($nomor==3) or ($nomor==4) or ($nomor==0) or ($nomor==5) or ($nomor==6) or ($nomor==7) or ($nomor==8) or ($nomor==9) or ($nomor==10)){
			$terima=$nilai;
			$keluar=0;
			
		} else {
			$terima=0;
			$keluar=$nilai;
		}
		$tot_trm=$tot_trm+$terima;
		$tot_klr=$tot_klr+$keluar;
		$no=$no+1;
		$cRet .= '<tr>
		<TD align="center" >'.$no.'</TD>
		<td valign="top">'.$uraian.'</td>
		<td valign="top" align="right">'.number_format($terima,"2",",",".").'</td>
		<td valign="top" align="right">'.number_format($keluar,"2",",",".").'</td>
		</tr>';
		
		}
		
		$sql3 = "select nilai from buku_kas where nomor ='0'";
		$hasil3 = $this->db->query($sql3);
		foreach ($hasil3->result() as $row){
		$nilai_ax = $row->nilai;
		$nilai_x = number_format($nilai_ax,"2",",",".");
		}
		
		$sql2 = "SELECT
				SUM(CASE WHEN nomor IN ('1','2','3','4','5','6','7','8','9','10') THEN nilai ELSE 0 END) as trm_sbl,
				SUM(CASE WHEN nomor IN ('11','12','13') THEN nilai ELSE 0 END) as klr_sbl
				FROM
				(SELECT a.nomor,ISNULL(SUM(b.nilai),0) as nilai from 
				buku_kas a LEFT JOIN 
				(
				select jenis, sum(nilai) as nilai from buku_kas_penerimaan_pengeluaran 
				where tanggal<'$tgl' group by jenis
				union ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and a.tgl_kas_bud <'$tgl'
				UNION ALL 
				SELECT 13 as jenis,
				isnull(sum(nilai),0) as nilai
				FROM pengeluaran_non_sp2d
				WHERE tanggal <'$tgl') b
				on a.nomor=b.jenis where a.nomor !='0'
				GROUP BY a.nomor) c";
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$trm_sbl = $row->trm_sbl+$nilai_ax;
		$klr_sbl = $row->klr_sbl;
		$nilai_2x = number_format($trm_sbl,"2",",",".");
		$nilai_3x = number_format($klr_sbl,"2",",",".");
		
		}	
		
			
		
		//$kas = ($tot_trm+$trm_sbl)-($tot_klr+$klr_sbl);
		//$kasnom = number_format($kas,"2",",",".");
		$total_terima = $tot_trm+$trm_sbl;
		$total_keluar = $tot_klr+$klr_sbl;
		$tot_saldo = $total_terima-$total_keluar;
		$totsaldo = number_format($tot_saldo,"2",",",".");
		
		if ($tgl=='2016-1-1'){
		$cRet .= '
		<tr>
			
			<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
			
			<td align="right">'.$nilaiu_x.'</td>
			<TD align="right">0,00</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
			<td style="border-top:hidden;" align="right">0,00</td>
			<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
			<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
			<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
		</tr>';
		
		$cRet .='</table>';
		}else{
		$cRet .= '
		<tr>
			
			<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
			
			<td align="right">'.number_format($tot_trm,"2",",",".").'</td>
			<TD align="right">'.number_format($tot_klr,"2",",",".").'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
			<td style="border-top:hidden;" align="right">'.$nilai_2x.'</td>
			<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
			<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
			<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
		</tr>';
		
		$cRet .='</table>';	
		}
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
						<td width=\"50%\"></td>
						<td width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td width=\"50%\">Pada hari ini, tanggal $tanggal</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td width=\"50%\">Oleh kami didapat dalam kas Rp. $totsaldo</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td><i>(".$this->tukd_model->terbilang($tot_saldo).")</i></td>
						<td width=\"50%\"></td>
					</tr>
                    
                  </table>";
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan dan Pengeluaran</title>");
			 echo $cRet;
		}else{
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}	
	}
	
	function cetak_buku_kas_pembantu_manual()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/ctk_bkp2_manual',$data) ; 
    }
	
	function load_rekening() {
       // $skpd     = $this->session->userdata('kdskpd');
		//$kriteria = '';
        //$kriteria = $this->input->post('cari');
        
		
		$sql = "select * from trdrka where left(kd_rek5,1)='4' and kd_skpd='3.13.01.17' order by kd_rek5";
		
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,           
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5']                                                                                          
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	function kode_organisasi() {
        $sql = "SELECT kd_org, nm_org FROM ms_organisasi";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_org'],  
                        'nm_skpd' => $resulte['nm_org']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
		$query1->free_result(); 	   
	}
	
	function kode_skpd() {
        $sql = "select kd_skpd, nm_skpd from ms_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'] 
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	   
	}
	
	
	function bkp2()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/bkp2',$data) ; 
    }
	
	function penerimaan_kas_lainnya()
    {
        $data['page_title']= 'PENERIMAAN LAINNYA';
        $this->template->set('title', 'PENERIMAAN LAINNYA');   
        $this->template->load('template','tukd/sp2d/penerimaan_kas_lainnya',$data) ; 
    }
	
	function simpan_kas_lainnya(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "insert into trhkasin_ppkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,no_kas,tgl_kas,sumber) 
                        values('$nokas','3.13.01.17','$ttd','$ket','$nilai','1.20.3.13.01.17.00.04','4','$nokas','$ttd','$usernm')";
            $asg = $this->db->query($sql);
            
			 $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan) values ('3.13.01.17','$nokas','$jns','$nilai','$nokas','1.20.3.13.01.17.00.04')";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }

	function hapus_penerimaan_lainnya() {    	
		$no_kas = $this->input->post('no_kas');
		$tgl = $this->input->post('tgl_kas');
		//$nilai = $this->input->post('nilai');
        $query = "delete from trhkasin_ppkd where no_kas='$no_kas' and kd_skpd='3.13.01.17'";
		$query = "delete from trdkasin_ppkd where no_kas='$no_kas' and kd_skpd='3.13.01.17'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }

	function load_penerimaan_lain_ppkd() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria <> ''){                               
            $where="WHERE a.kd_skpd ='3.13.01.17' AND (upper(a.no_sts) like upper('%$kriteria%') or a.tgl_sts like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%'))";            
        } else{
			$where="WHERE a.kd_skpd ='3.13.01.17' AND (upper(a.no_sts) like upper('%%'))";
		}
        
        $sql = "SELECT count(*) as tot from trhkasin_ppkd a $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        /* $sql = " SELECT TOP $rows a.no_sts, a.tgl_sts,a.kd_skpd,a.keterangan,a.total,
a.kd_bank, b.kd_kegiatan,a.jns_trans,a.rek_bank,a.no_kas,a.tgl_kas,a.no_cek,a.status, b.kd_rek5,c.nm_rek5,
(
	SELECT
		nm_skpd
	FROM
		ms_skpd
	WHERE
		kd_skpd = a.kd_skpd
) AS nm_skpd
FROM
	trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd
AND a.no_kas=b.no_kas 
LEFT JOIN ms_rek5 c ON b.kd_rek5=c.kd_rek5
 $where AND a.no_sts NOT in (SELECT TOP $offset no_sts FROM trhkasin_ppkd order by tgl_sts) AND a.kd_skpd = '1.20.15.17' 
 GROUP BY a.no_sts, a.tgl_sts,a.kd_skpd,a.keterangan,a.total,
a.kd_bank, b.kd_kegiatan,a.jns_trans,a.rek_bank,a.no_kas,a.tgl_kas,a.no_cek,a.status,b.kd_rek5, c.nm_rek5
 order by a.tgl_sts"; */
 
		$sql = " SELECT TOP $rows a.*, b.kd_kegiatan, b.kd_rek5, c.nm_rek5,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd 
		from trhkasin_ppkd a  INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd
AND a.no_kas=b.no_kas 
LEFT JOIN ms_rek5 c ON b.kd_rek5=c.kd_rek5
$where AND a.no_sts NOT in (SELECT TOP $offset no_sts FROM trhkasin_ppkd a $where order by cast(a.no_kas as int)) order by cast(a.no_kas as int)";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,      
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total'],2,'.',','),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	}

	
	function update_kas_lainnya(){
        
		$nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "update trhkasin_ppkd set tgl_sts='$ttd',keterangan='$ket',total='$nilai',tgl_kas='$ttd' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
            
			 $sql = "update trdkasin_ppkd set kd_rek5='$jns',rupiah='$nilai' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '1';
            }else{
                echo '0';
            }
        

    }	

	function hapus_bkp2() {    	
		$jenis = $this->input->post('jns');
		$tgl = $this->input->post('tanggal');
		//$nilai = $this->input->post('nilai');
        $query = "delete from buku_kas_penerimaan_pengeluaran where jenis='$jenis' and tanggal='$tgl'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }

	
	function load_bkp2() {
        
        $sql = "SELECT * from buku_kas_penerimaan_pengeluaran order by tanggal";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'jenis' => $resulte['jenis'],
                        'tanggal' => $resulte['tanggal'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",",")                                                                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function simpan_bkp2(){
        
        $tabel  = $this->input->post('tabel');
        $lckolom = $this->input->post('kolom');
        $lcnilai = $this->input->post('nilai');
        $cid = $this->input->post('cid');
        $lcid = $this->input->post('lcid');
        
            $sql = "insert into $tabel $lckolom values $lcnilai";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }

	function simpan_pengeluaran_non_sp2d(){
        
        $tabel  = $this->input->post('tabel');
        $lckolom = $this->input->post('kolom');
        $lcnilai = $this->input->post('nilai');
        $cid = $this->input->post('cid');
        $lcid = $this->input->post('lcid');
        
        $sql = "select $cid from $tabel where $cid='$lcid'";
        $res = $this->db->query($sql);
        if($res->num_rows()>0){
			echo '1';
		}else{
            $sql = "insert into $tabel $lckolom values $lcnilai";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            }
		}
        
    }
	
	function skpd__pend() {
		$id  = $this->session->userdata('pcUser'); 
		$usernm      = $this->session->userdata('pcNama');
        $kd_skpd = $this->session->userdata('kdskpd');
        $vkdskpd = substr($kd_skpd, -2);
        if($vkdskpd=='00' || $vkdskpd=='01'){ 
            $kd_skpd = substr($kd_skpd, 0, 7); 
        }
		$lccr = $this->input->post('q');
       
		if($usernm=='pajak'){
			$sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd IN (SELECT kd_skpd FROM user_akt WHERE user_id='$id')AND (upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%')) order by kd_skpd";
		}else{
			$sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%')";
        }
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	
	function ctk_daftar_pengeluaran($jns='', $bulan='', $ctak='', $ttd1='', $tgl=''){
		
		$lcttd      = str_replace('123456789',' ',$this->uri->segment(6));
		$thn_ang    = $this->session->userdata('pcThang');
		$prv        = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn       = $prv->row();          
		$prov       = $prvn->provinsi;         
		$daerah     = $prvn->daerah;
		$jns_beban  = $this->uri->segment(3);
		$no_halaman = $this->uri->segment(8);
		$jns_cetak  = $this->uri->segment(9);
		$tgl_cetak  = $this->uri->segment(10);
		$tgl_cetak1	= $this->tanggal_format_indonesia($tgl_cetak);
		$spasi      = $this->uri->segment(11);
		$skpd       = $this->uri->segment(12);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		if($jns_beban=='0'){
			//GJ
			$where = "AND a.jns_spp='4'";
			$judul="DAFTAR PENGELUARAN GAJI";	
		}else if($jns_beban=='1'){
			//LS
			$where = "AND (a.jns_spp='5' or a.jns_spp='6')";
			$judul="DAFTAR PENGELUARAN LS";
		}else if($jns_beban=='2'){
			//UP
			$where = "AND a.jns_spp='1'";
			$judul="DAFTAR PENGELUARAN UP";
		}else if($jns_beban=='3'){
			//TU
			$where = "AND a.jns_spp='3'";
			$judul="DAFTAR PENGELUARAN TU";
		}else{
			//GU
			$where = "AND a.jns_spp='2'";
			$judul="DAFTAR PENGELUARAN GU";
		}
	   
	   
	   if($jns_cetak=='0' || $jns_cetak=='2'){
			$where2 = "";
	   }else if($jns_cetak=='1' || $jns_cetak=='3'){
			$where2 = "AND LEFT(a.kd_skpd,7)='$skpd'";
	   }else{
		   $where2 = "AND a.kd_skpd='$skpd'";
	   }
						
		
		if($jns_cetak=='4'){
			$buln       = $this->getBulan_kasda($bulan);
			$bln="BULAN : $buln";
		}else{
			$bln="&nbsp;";
		}
		
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"><b>$bln</b></td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold;\">TANGGAL</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">NOMOR KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">NOMOR SP2D TANGGAL SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"29%\" style=\"font-weight:bold\">URAIAN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">KODE REKENING</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">PENERIMAAN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"11%\" style=\"font-weight:bold\">PENGELUARAN</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
				</tr>
				</thead>";

					//isi
						$sql="select * from(
								select 1 urut, 
								       a.no_kas_bud as urut2, 
									   a.no_kas_bud, 
									   a.tgl_kas_bud, 
									   a.no_sp2d, 
									   a.tgl_sp2d,
									   a.kd_skpd,
									   a.keperluan,
									   a.nmrekan,
									   c.pimpinan,
									   a.nm_skpd,
									   '' kd_kegiatan,
									   '' kd_rek5, 
									   '' nm_rek5, 
									   0 nilai,
									   0 no_bukti 
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
											   INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd 
											   INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd 
								where a.status_bud='1' and a.tgl_kas_bud<='$tgl' $where $where2
								group by a.tgl_kas_bud, a.no_kas_bud, a.no_sp2d, a.tgl_sp2d, a.keperluan, a.nmrekan, c.pimpinan, a.kd_skpd, a.nm_skpd
								UNION ALL
								select 2 urut,
									   '' no_kas_bud,
										a.no_kas_bud as urut2,
										'' tgl_kas_bud,
										'' no_sp2d, 
										'' tgl_sp2d, 
										a.kd_skpd,
										'' keperluan,
										'' nmrekan,
										'' pimpinan,
										'' nm_skpd,
										d.kd_kegiatan, 
										d.kd_rek5,
										d.nm_rek5,
										d.nilai,
										d.no_bukti  
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
											   INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd 
											   INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd 
								where a.status_bud='1' and a.tgl_kas_bud<='$tgl' $where $where2
								GROUP BY a.no_kas_bud, a.kd_skpd, a.keperluan, d.kd_kegiatan, d.kd_rek5, d.nm_rek5,d.nilai,d.no_bukti) a
							  order by cast(no_kas_bud as int),urut, kd_kegiatan, kd_rek5";
							  
					$hasil = $this->db->query($sql);
					
					$jum_terima = number_format(0,"2",",",".");
					
					$jum_pengeluaran=0;
					$jumlah_pengeluaran=0;
					$jmlh_pengeluaran=0;
					
					foreach ($hasil->result() as $rowttd)
					{
						$urut=$rowttd->urut;
						$urut2=$rowttd->urut2;
						$no_kas_bud=$rowttd->no_kas_bud;
						$tgl_kas_bud=$rowttd->tgl_kas_bud;
						$no_sp2d=$rowttd->no_sp2d;
						$tgl_sp2d=$rowttd->tgl_sp2d;
						$kd_skpd=$rowttd->kd_skpd;
						$keperluan=$rowttd->keperluan;
						$nmrekan=$rowttd->nmrekan;
						$pimpinan=$rowttd->pimpinan;
						$nm_skpd=$rowttd->nm_skpd;
						$kd_kegiatan=$rowttd->kd_kegiatan;
						$kd_rek5=$this->dotrek($rowttd->kd_rek5);
						$nm_rek5=$rowttd->nm_rek5;
						$nilai=$rowttd->nilai;
						$no_bukti=$rowttd->no_bukti;
					
						
						$jumlah_pengeluaran=number_format($nilai,"2",",",".");
						
						$jum_pengeluaran=$jum_pengeluaran+$nilai;
						$jmlh_pengeluaran=number_format($jum_pengeluaran,"2",",",".");
						
						if($kd_kegiatan==''){
							$kode="";
						}else{
							$kode="$kd_kegiatan.$kd_rek5";
						}
					
						if($urut=='1'){
						
							$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$kd_skpd' AND kode='BK' ";
								 $sqlnam=$this->db->query($sqlnam);
								 foreach ($sqlnam->result() as $rownam)
								{
									$nama_ben=$rownam->nama;                    
									$jabat_ben=$rownam->jabatan;                    
								}
								
							$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
							$jabat_ben = empty($jabat_ben) ? ' ' :$jabat_ben;
								
							$cRet .="<tr>
										<td align=\"center\">$tgl_kas_bud</td>
										<td align=\"center\">$no_kas_bud</td>
										<td align=\"center\">$no_sp2d <br>$tgl_sp2d</td>
										<td>$nama_ben, &nbsp; $nm_skpd</td>
										<td></td>
										<td></td>
										<td></td>
									</tr>";
						}else{
											
							$cRet .="<tr>
										<td style=\"border-top:hidden;\"></td>
										<td style=\"border-top:hidden;\"></td>
										<td style=\"border-top:hidden;\"></td>
										<td align=\"left\" style=\"border-top:hidden;\">$nm_rek5</td>
										<td align=\"center\" style=\"border-top:hidden;\">$kode</td>
										<td align=\"right\" style=\"border-top:hidden;\">$jum_terima</td>
										<td align=\"right\" style=\"border-top:hidden;\">$jumlah_pengeluaran</td>
									</tr>";
						}
					}
					
					$cRet .="<tr>
								<td colspan=\"5\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b>$jum_terima</b></td>
								<td align=\"right\"><b>$jmlh_pengeluaran</b></td>
							</tr>";
					
		$cRet .= '</table>';
	
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">Pontianak, $tgl_cetak1</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		
		$print = $this->uri->segment(5);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title></title>");
			 echo $cRet;
		}else{
			
			$this->_mpdf2('',$cRet,10,10,10,'1',$no_halaman,'');
			
		}
		
			
		
	}

	
	function ctk_daftar_pajak($jns='', $belanja='', $ctak='', $tgl='', $tgl2=''){
		
		$lcttd      = str_replace('%20',' ',$this->uri->segment(10));
		$thn_ang    = $this->session->userdata('pcThang');
		$tanggal    = $this->tanggal_format_indonesia_kasda($tgl);
		$tanggal2   = $this->tanggal_format_indonesia_kasda($tgl2);
		$no_halaman = $this->uri->segment(8);	
		$cetk       = $this->uri->segment(9);	
		$skpd       = $this->uri->segment(11);
		
		$prv        = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn       = $prv->row();          
		$prov       = $prvn->provinsi;         
		$daerah     = $prvn->daerah;
		
		
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		if($jns=='0'){
                         //GAJI
						$judul="DAFTAR POTONGAN SP2D GAJI";
		}else{
						//NON GAJI
						$judul="DAFTAR POTONGAN SP2D NON GAJI";                         
        }
		
		$cRet = '';
				
		//Gaji
		if($jns=='0'){
			//rekap per SKPD
			if($cetk=='0'){
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"33%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
				</tr>
				</thead>"; 
			
				$sql = "SELECT a.kd_skpd, a.nm_skpd, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 in ('2110701','2110702','2110703') THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor               ='0';
				$jum_nilai           =0;
				$jum_iwp             =0;
				$jum_taperum         =0;
				$jum_hkpg            =0;
				$jum_pph             =0;
				$jum_jumlah_potongan =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;

					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
			
			
			}else if($cetk=='1'){
				//per SKPD
				$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No Kas/Tanggal Kas</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No SP2D/Tanggal SP2D</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
				</tr>
				</thead>"; 
	
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND LEFT(a.kd_skpd,7)='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 in ('2110701','2110702','2110703') THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND LEFT(a.kd_skpd,7)='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor               ='0';
				$jum_nilai           =0;
				$jum_iwp             =0;
				$jum_taperum         =0;
				$jum_hkpg            =0;
				$jum_pph             =0;
				$jum_jumlah_potongan =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
								
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
							
			
			}else if($cetk=='2'){
				//per Unit
				$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No Kas/Tanggal Kas</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No SP2D/Tanggal SP2D</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
				</tr>
				</thead>"; 
	
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.kd_skpd='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d 
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 in ('2110701','2110702','2110703') THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.kd_skpd='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor                  ='0';
				$jum_nilai              =0;
				$jum_iwp                =0;
				$jum_taperum            =0;
				$jum_hkpg               =0;
				$jum_pph                =0;
				$jum_jumlah_potongan    =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
								
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
							
			
			}else{
				//Keseluruhan
				$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No Kas/Tanggal Kas</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No SP2D/Tanggal SP2D</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
				</tr>
				</thead>"; 
	
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 in ('2110701','2110702','2110703') THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor               ='0';
				$jum_nilai           =0;
				$jum_iwp             =0;
				$jum_taperum         =0;
				$jum_hkpg            =0;
				$jum_pph             =0;
				$jum_jumlah_potongan =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
								
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
			
			}
			
		//Non Gaji
		}else{
			//Rekap per SKPD
			if($cetk=='0'){ 
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lain-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
				</tr>
				</thead>"; 
				
				$sql = "SELECT a.kd_skpd, a.nm_skpd, ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor                  ='0';
				$jum_nilai              =0;
				$jum_ppn                =0;
				$jum_pph21              =0;
				$jum_pph22              =0;
				$jum_pph23              =0;
				$jum_psl4_a2            =0;
				$jum_iwppnpn            =0;
				$jum_pot_lain           =0;
				$jum_jumlah_potongan    =0;
				$jum_nilai_bersih       =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$kd_skpd-$nm_skpd</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}else if($cetk=='1'){
			  //Rekap Per SKPD
			  $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. KAS/TGL. KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. SP2D/TGL. SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lian-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN &nbsp; (Kol.6 s.d 12)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH &nbsp; (Kol.5 - 13)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
				</tr>
				</thead>"; 
				
				//isi
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, 
				    ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND LEFT(a.kd_skpd,7)='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND LEFT(a.kd_skpd,7)='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd,a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd AND a.no_sp2d=b.no_sp2d
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor              ='0';
				$jum_nilai          =0;
				$jum_ppn            =0;
				$jum_pph21          =0;
				$jum_pph22          =0;
				$jum_pph23          =0;
				$jum_psl4_a2        =0;
				$jum_iwppnpn        =0;
				$jum_pot_lain       =0;
				$jum_jumlah_potongan=0;
				$jum_nilai_bersih   =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}else if($cetk=='2'){
			  //Rekap Per Unit
			  $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. KAS/TGL. KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. SP2D/TGL. SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lian-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN &nbsp; (Kol.6 s.d 12)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH &nbsp; (Kol.5 - 13)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
				</tr>
				</thead>"; 
				
				//isi
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, 
				    ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND a.kd_skpd='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND a.kd_skpd='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd,a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd AND a.no_sp2d=b.no_sp2d
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor              ='0';
				$jum_nilai          =0;
				$jum_ppn            =0;
				$jum_pph21          =0;
				$jum_pph22          =0;
				$jum_pph23          =0;
				$jum_psl4_a2        =0;
				$jum_iwppnpn        =0;
				$jum_pot_lain       =0;
				$jum_jumlah_potongan=0;
				$jum_nilai_bersih   =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}else{
			  //Rekap Keseluruhan
			  $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. KAS/TGL. KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. SP2D/TGL. SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lian-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN &nbsp; (Kol.6 s.d 12)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH &nbsp; (Kol.5 - 13)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
				</tr>
				</thead>"; 
				
				//isi
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, 
				    ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd,a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd AND a.no_sp2d=b.no_sp2d
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor              ='0';
				$jum_nilai          =0;
				$jum_ppn            =0;
				$jum_pph21          =0;
				$jum_pph22          =0;
				$jum_pph23          =0;
				$jum_psl4_a2        =0;
				$jum_iwppnpn        =0;
				$jum_pot_lain       =0;
				$jum_jumlah_potongan=0;
				$jum_nilai_bersih   =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}
		}
				
		$cRet .= '</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $ctak;
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title></title>");
			 echo $cRet;
		}else{
			
			$this->_mpdf2('',$cRet,10,10,10,'1',$no_halaman,'');
			
		}

	}

	
	function cetak_spjterima2(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $lcskpd2 = $lcskpd;
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
         $atas = $this->uri->segment(4);
         $bawah = $this->uri->segment(5);
         $kiri = $this->uri->segment(6);
         $kanan = $this->uri->segment(7);
         
         if($jnsctk=='1'){
                $lcskpd = substr($lcskpd, 0, 7);
         }

		 if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
			
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_sempurna) and month('$lctgl2')<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
            
         }else{
            $bulan = $_REQUEST['bulan'];
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
				}else{
				$lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
				}  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_sempurna) and $bulan<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and $bulan>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
         }
         
		 
		
        $hasilang = $this->db->query($sqlang);
        $hasil_ang = $hasilang->row();          
        $anggaran_ = $hasil_ang->anggaran;
		  $lcNmPA = '';
		 $lcNipPA = '';
		 $lcJabatanPA = '';
		 $lcPangkatPA = '';
         $lcNmBP = '';
         $lcNipBP = '';
         $lcPangkatBP = '';
         $lcJabatanBP = '';
		 
		 
		 
         $tgl_ttd= $_REQUEST['tgl_ttd'];
		 $nippa = str_replace('123456789',' ',$_REQUEST['ttd']);		     
          if($nippa!=''){		 
             $csql="SELECT nip as nip,nama,jabatan,pangkat  FROM ms_ttd WHERE nip = '$nippa' AND kd_skpd = '$lcskpd2' AND kode='PA'";
    				 $hasil = $this->db->query($csql);
                     $num_hasil = $hasil->num_rows();
    				 if($num_hasil>0){
    				    $trh2 = $hasil->row(); 
                        $lcNmPA = $trh2->nama;
    				    $lcNipPA = $trh2->nip;
    				    $lcJabatanPA = $trh2->jabatan;
    				    $lcPangkatPA = $trh2->pangkat;
    				 }
		              
         }
		 
         $nipbp = str_replace('123456789',' ',$_REQUEST['ttd2']);		     
		 if($nipbp!=''){
             $csql="SELECT nip,nama,jabatan,pangkat FROM ms_ttd WHERE nip = '$nipbp' AND kd_skpd = '$lcskpd2' AND kode='BP'";
             $hasil3 = $this->db->query($csql);
             $num_hasil3 = $hasil3->num_rows();
             if($num_hasil3>0){
                 $trh3 = $hasil3->row(); 	
                 $lcNmBP = $trh3->nama;
                 $lcNipBP = $trh3->nip;
                 $lcPangkatBP = $trh3->pangkat;
                 $lcJabatanBP = $trh3->jabatan;
             }
         }

		 $prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd2'");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
        $hasil = $this->db->query($csql);
        $trh2 = $hasil->row();          
        $lcNmskpd = $trh2->nm_skpd;
        

        
		
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
           <tr>
                <td align=\"center\" colspan=\"13\" style=\"font-size:14px;border: solid 1px white;\"><b>".$prov."<br>
                    LAPORAN PERTANGGUNGJAWABAN BENDAHARA PENERIMAAN<BR>SPJ PENDAPATAN PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcskpd - $lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmPA</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmBP</td>
            </tr>
            
            </table>
			
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Kode<br>Rekening</td>
                <td align=\"center\" rowspan=\"2\" width=\"24%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Sampai dengan Bulan Lalu</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Bulan Ini</td>
                <td align=\"center\" colspan=\"4\" width=\"24%\" style=\"font-size:12px\">Sampai dengan Bulan Ini</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang<br>Terealisasi</td>                
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang telah<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa yang<br>Belum<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa Anggaran yang<br>Belum<br>Terealisasi/Pelam-<br>pauan Anggaran</td>                                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6=(5-4)</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>
                <td align=\"center\" style=\"font-size:12px\">9=(8-7)</td>
                <td align=\"center\" style=\"font-size:12px\">10=(4+7)</td>
                <td align=\"center\" style=\"font-size:12px\">11=(5+8)</td>
                <td align=\"center\" style=\"font-size:12px\">12=(11-10)</td>
                <td align=\"center\" style=\"font-size:12px\">13=(3-10)</td>                
            </tr>
			</thead>";
           
		  
            if ($pilih==1   ){
                $kon_terimaini = " (a.tgl_terima >= '$lctgl1' AND a.tgl_terima <= '$lctgl2')";
                $kon_keluarini = " (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2')";          
                $kon_terimalalu = " (a.tgl_terima < '$lctgl1')";
                $kon_keluarlalu = " (a.tgl_sts < '$lctgl1')";
           }else{
                $kon_terimaini = " (month(a.tgl_terima)= '$bulan' AND year(a.tgl_terima) = '$thn_ang')";
                $kon_terimaini_ppkd = " (month(b.tgl_sts)= '$bulan' AND year(b.tgl_sts) = '$thn_ang')";
                $kon_keluarini = " (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_keluarini_ppkd = " (month(b.tgl_sts)= '$bulan' AND year(b.tgl_sts) = '$thn_ang')";
                $kon_terimalalu = " (month(a.tgl_terima)< '$bulan' AND year(a.tgl_terima) = '$thn_ang')";
                $kon_terimalalu_ppkd = " (month(b.tgl_sts)< '$bulan' AND year(b.tgl_sts) = '$thn_ang')";
                $kon_keluarlalu = " (month(a.tgl_sts)< '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_keluarlalu_ppkd = " (month(b.tgl_sts)< '$bulan' AND year(b.tgl_sts) = '$thn_ang')";
           }

            $n_trdrka = 'trdrka_pend';
            
            $kon_skpd="a.kd_skpd = ";
            
			if($lcskpd=='1.20.15.17' || $lcskpd=='1.20.08.17' || $lcskpd=='3.13.01.17'){
				$sql = "select a.kd_skpd, a.kd_kegiatan, b.kd_rek3 kd_rek5, b.nm_rek3 nm_rek5, a.ang, a.ang_ubah, 
				   isnull(terima_ini,0) as terima_ini, isnull(terima_lalu,0) terima_lalu, 
				   isnull(keluar_ini,0) keluar_ini, isnull(keluar_lalu,0) keluar_lalu 
			from ( SELECT z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) kd_rek, SUM(z.nilai) AS ang, 
				   SUM(z.$anggaran_) AS ang_ubah, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_terimaini_ppkd) AS terima_ini, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_terimalalu_ppkd) AS terima_lalu, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_keluarini_ppkd) AS keluar_ini, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_keluarlalu_ppkd) AS keluar_lalu 
					FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' and left(z.kd_rek5,1)='4' 
					and right(z.kd_kegiatan,5)='00.04' 
					GROUP BY z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) )a left join (select kd_rek3, nm_rek3 from ms_rek3) b 
					on a.kd_rek=b.kd_rek3 
			UNION ALL 
			
			select a.kd_skpd, a.kd_kegiatan, b.kd_rek4 kd_rek5, b.nm_rek4 nm_rek5, a.ang, a.ang_ubah, 
				   isnull(terima_ini,0) as terima_ini, isnull(terima_lalu,0) terima_lalu, isnull(keluar_ini,0) keluar_ini,
				   isnull(keluar_lalu,0) keluar_lalu 
			from ( SELECT z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,5) kd_rek, SUM(z.nilai) AS ang, 
				   SUM(z.$anggaran_) AS ang_ubah, 
				  (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_terimaini_ppkd) AS terima_ini, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_terimalalu_ppkd) AS terima_lalu, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_keluarini_ppkd) AS keluar_ini, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE left(a.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_keluarlalu_ppkd) AS keluar_lalu  
							FROM $n_trdrka z 
					WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' and left(z.kd_rek5,1)='4' 
					and right(z.kd_kegiatan,5)='00.04' GROUP BY z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,5) )a 
					left join (select kd_rek4, nm_rek4 from ms_rek4) b on a.kd_rek=b.kd_rek4 
			UNION ALL 
			
			SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_terimaini_ppkd) AS terima_ini, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_terimalalu_ppkd) AS terima_lalu, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_keluarini_ppkd) AS keluar_ini, 
				   (SELECT SUM(a.rupiah) nilai 
					FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts
					WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
					and $kon_keluarlalu_ppkd) AS keluar_lalu  
					 FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' 
					 and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04' 
			 GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5,z.nm_rek5 order by kd_rek5";
			}else{
			$sql  = "select a.kd_skpd, a.kd_kegiatan, b.kd_rek3 kd_rek5, b.nm_rek3 nm_rek5, a.ang, 
       a.ang_ubah, isnull(terima_ini,0) as terima_ini, 
       isnull(terima_lalu,0) terima_lalu, isnull(keluar_ini,0) keluar_ini,
       isnull(keluar_lalu,0) keluar_lalu 
from ( 
   SELECT z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) kd_rek, SUM(z.nilai) AS ang, 
   SUM(z.$anggaran_) AS ang_ubah, 
   ((SELECT SUM(a.nilai) nilai 
   FROM tr_terima a WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd 
   and $kon_terimaini)
   -
   (SELECT ISNULL(SUM(b.rupiah),0) nilai FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
   ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
   WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd and jns_trans IN ('3')
   and $kon_keluarini
   )) AS terima_ini, 
   ((SELECT SUM(a.nilai) FROM tr_terima a WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) 
   and a.kd_skpd=z.kd_skpd and $kon_terimalalu)
   -
   (SELECT ISNULL(SUM(b.rupiah),0) nilai FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
   ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
   WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd and jns_trans IN ('3')
   and $kon_keluarlalu
   )) AS terima_lalu, 
   (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
   ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
   WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd and
   $kon_keluarini) AS keluar_ini, 
   (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
   ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
   WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd
   and $kon_keluarlalu) AS keluar_lalu 
   FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' 
   and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04'
   GROUP BY z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) )a 
   left join (select kd_rek3, nm_rek3 from ms_rek3) b on a.kd_rek=b.kd_rek3 

UNION ALL

select a.kd_skpd, a.kd_kegiatan, b.kd_rek4 kd_rek5, b.nm_rek4 nm_rek5, a.ang, a.ang_ubah, isnull(terima_ini,0) as terima_ini, isnull(terima_lalu,0) terima_lalu,
isnull(keluar_ini,0) keluar_ini,isnull(keluar_lalu,0) keluar_lalu  
from (
SELECT z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,5) kd_rek, SUM(z.nilai) AS ang, 
SUM(z.$anggaran_) AS ang_ubah,
((SELECT SUM(a.nilai) nilai FROM tr_terima a 
			WHERE left(a.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd and $kon_terimaini) 
			-
			(SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
			ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
			WHERE left(b.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd and jns_trans IN ('3') and $kon_keluarini)) AS terima_ini,
((SELECT SUM(a.nilai) FROM tr_terima a 
		   WHERE left(a.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd 
		   and $kon_terimalalu) 
		   -
			(SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
			ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
			WHERE left(b.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd and jns_trans IN ('3') and $kon_keluarlalu)) AS terima_lalu,
       (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
			ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
			WHERE left(b.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS keluar_ini, 
       (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
            ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
            WHERE left(b.kd_rek5,5)=left(z.kd_rek5,5) and a.kd_skpd=z.kd_skpd
            and $kon_keluarlalu) AS keluar_lalu 
FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' 
and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04' 
GROUP BY z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,5) 
)a
left join 
(select kd_rek4, nm_rek4 from ms_rek4) b
on a.kd_rek=b.kd_rek4

UNION ALL

SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, 
       SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah, 
       ((SELECT SUM(a.nilai) FROM tr_terima a 
			WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimaini) 
			-
			(SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
			ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
			WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and jns_trans in ('3') and $kon_keluarini)) AS terima_ini, 
       ((SELECT SUM(a.nilai) FROM tr_terima a 
		   WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd 
		   and $kon_terimalalu)
		   -
			(SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
			ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
			WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and jns_trans in ('3') and $kon_keluarlalu)) AS terima_lalu,
       (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
			ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
			WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS keluar_ini, 
       (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b 
            ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd 
            WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd
            and $kon_keluarlalu) AS keluar_lalu 
FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' 
and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04' 
GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5,z.nm_rek5 
			order by kd_rek5" ; }
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $lcprog_lama="";
                    $lckeg_lama="";
                    $ln_jlh1 =0;
                    $ln_jlh2 =0;
                    $ln_jlh3 =0;
                    $ln_jlh4 =0;
                    $ln_jlh5 =0;
                    $ln_jlh6 =0;
                    $ln_jlh7 =0;
                    $ln_jlh8 =0;
                    $ln_jlh9 =0;
                    $ln_jlh10 =0;
                    $ln_jlh11 =0;
                    
                    foreach ($hasil->result() as $row)
                    {
                        $lcprog=substr($row->kd_kegiatan,0,18);
                        $lckeg=$row->kd_kegiatan;
                        $lcrek=$row->kd_rek5;
                        
						$leng = strlen($lcrek);
						
						
						
                        if($lcprog<>$lcprog_lama){//cek program
                             if($lcskpd=='1.20.15.17' || $lcskpd=='1.20.08.17' || $lcskpd=='3.13.01.17'){
								$sql="SELECT z.kd_program, z.nm_program,(SELECT SUM (a.$anggaran_) FROM $n_trdrka a WHERE SUBSTRING (a.kd_kegiatan, 1, 18) = z.kd_program AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd' AND LEFT (a.kd_rek5, 1) = '4' AND RIGHT (a.kd_kegiatan, 5) = '00.04') AS ang_ubah,
								(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE SUBSTRING (a.kd_kegiatan, 1, 18) = z.kd_program AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT (a.kd_rek5, 1) = '4' AND b.jns_trans NOT IN (5,1) AND $kon_terimaini_ppkd) AS terima_ini,
								(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE SUBSTRING (a.kd_kegiatan, 1, 18) = z.kd_program AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT (a.kd_rek5, 1) = '4' AND b.jns_trans NOT IN (5,1) AND $kon_terimalalu_ppkd) AS terima_lalu,
								(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE SUBSTRING (a.kd_kegiatan, 1, 18) = z.kd_program AND LEFT (a.kd_skpd,len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT (a.kd_rek5, 1) = '4' AND b.jns_trans NOT IN (5,1) AND $kon_keluarini_ppkd) AS keluar_ini,
								(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE SUBSTRING (a.kd_kegiatan, 1, 18) = z.kd_program AND LEFT (a.kd_skpd,len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT (a.kd_rek5, 1) = '4' AND b.jns_trans NOT IN (5,1) AND $kon_keluarlalu_ppkd) AS keluar_lalu
								FROM trskpd z WHERE z.kd_kegiatan = '$lckeg' AND LEFT (z.kd_skpd,len('$lcskpd')) = '$lcskpd' GROUP BY z.kd_program, z.nm_program"; 
							 }else{
							 
							 $sql="select z.kd_program, z.nm_program,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and left(a.kd_rek5,1)='4' and right(a.kd_kegiatan,5)='00.04') AS ang_ubah,
                                ((SELECT SUM(a.nilai) FROM tr_terima a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimaini) - (SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and jns_trans in ('3') AND LEFT(b.kd_rek5,1)=4 and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini)) AS terima_ini,
                                ((SELECT SUM(a.nilai) FROM tr_terima a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimalalu) - (SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and jns_trans in ('3') AND LEFT(b.kd_rek5,1)=4 and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu)) AS terima_lalu,
								(SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and left(z.kd_skpd,len('$lcskpd'))='$lcskpd'
                                    group by z.kd_program, z.nm_program ";
							 }
                             $hasil_prog = $this->db->query($sql);
                             foreach ($hasil_prog->result() as $row_prog)
                             {

                             $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lcprog</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row_prog->nm_program</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_lalu,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_lalu,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)-($row_prog->terima_lalu),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_ini,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_ini,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_ini)-($row_prog->terima_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->terima_lalu)+($row_prog->terima_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)+($row_prog->keluar_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu+$row_prog->keluar_ini)-($row_prog->terima_lalu+$row_prog->terima_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah-($row_prog->terima_lalu+$row_prog->terima_ini),"2",",",".")."</b></td>
                                  </tr>";
                                    
                                
                             }
                                                                                                                                                                 
                        }
                        
                        if($lckeg<>$lckeg_lama){ //cek kegiatan
							if($lcskpd=='1.20.15.17' || $lcskpd=='1.20.08.17' || $lcskpd=='3.13.01.17'){
							$sql = "SELECT z.kd_kegiatan, z.nm_kegiatan,
									(SELECT SUM (a.$anggaran_) FROM $n_trdrka a 
									 WHERE a.kd_kegiatan = z.kd_kegiatan AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd') AS ang_ubah,
									(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE a.kd_kegiatan =  z.kd_kegiatan AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1) AND $kon_terimaini_ppkd) AS terima_ini,
									(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE a.kd_kegiatan = z.kd_kegiatan AND LEFT (a.kd_skpd,len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1) AND $kon_terimalalu_ppkd) AS terima_lalu,
									(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE a.kd_kegiatan = z.kd_kegiatan AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1) AND $kon_keluarini_ppkd) AS keluar_ini,
									(SELECT SUM (a.rupiah) FROM trdkasin_pkd a inner join trhkasin_pkd b on a.kd_skpd=b.kd_skpd and a.no_sts=b.no_sts WHERE a.kd_kegiatan = z.kd_kegiatan AND LEFT (a.kd_skpd, len('$lcskpd')) = '$lcskpd' AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1) AND $kon_keluarlalu_ppkd) AS keluar_lalu
									FROM trskpd z WHERE z.kd_kegiatan = '$lckeg' AND z.kd_skpd = '$lcskpd' GROUP BY z.kd_kegiatan, z.nm_kegiatan";
							}else{
                            $sql="select z.kd_kegiatan, z.nm_kegiatan,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd') AS ang_ubah,
                                ((SELECT SUM(a.nilai) FROM tr_terima a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimaini) - (SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE a.kd_kegiatan=z.kd_kegiatan and jns_trans in ('3') and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini)) AS terima_ini,
                                ((SELECT SUM(a.nilai) FROM tr_terima a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimalalu) - (SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE a.kd_kegiatan=z.kd_kegiatan and jns_trans in ('3') and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu)) AS terima_lalu,
                                (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd' 
                                    group by z.kd_kegiatan, z.nm_kegiatan";
							}
                             $hasil_keg = $this->db->query($sql);
                             foreach ($hasil_keg->result() as $row_keg)
                             {
                                $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lckeg</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:11px;border-bottom:none;border-top:none\"><b>$row_keg->nm_kegiatan</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_lalu,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_lalu,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)-($row_keg->terima_lalu),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_ini,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_ini,"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_ini)-($row_keg->terima_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->terima_lalu)+($row_keg->terima_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)+($row_keg->keluar_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu+$row_keg->keluar_ini)-($row_keg->terima_lalu+$row_keg->terima_ini),"2",",",".")."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah-($row_keg->terima_lalu+$row_keg->terima_ini),"2",",",".")."</b></td>
                                  </tr>";
                                
                                
                             }
                                                                                                                                                                 
                        }                                                                                                                        
                        
						if($leng==3 || $leng==5){
							
						  $cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lckeg.".$this->tukd_model->dotrek($lcrek)."</b></td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row->nm_rek5</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row->ang_ubah,"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row->terima_lalu,"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row->keluar_lalu,"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row->keluar_lalu)-($row->terima_lalu),"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row->terima_ini,"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row->keluar_ini,"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row->keluar_ini)-($row->terima_ini),"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row->terima_lalu)+($row->terima_ini),"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row->keluar_lalu)+($row->keluar_ini),"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini),"2",",",".")."</b></td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini),"2",",",".")."</b></td>
                              </tr>"; 
							$ln_jlh1=$ln_jlh1+ $row->ang_ubah;
							$ln_jlh2=$ln_jlh2+ $row->terima_lalu;
							$ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
							$ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
							$ln_jlh5=$ln_jlh5+ $row->terima_ini;
							$ln_jlh6=$ln_jlh6+ $row->keluar_ini;
							$ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
							$ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
							$ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
							$ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
							$ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
																				 
							$lcprog_lama=$lcprog;
							$lckeg_lama=$lckeg;
							
						}else{
							
						$cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lckeg.".$this->tukd_model->dotrek($lcrek)."</td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah,"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_lalu,"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_lalu,"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)-($row->terima_lalu),"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_ini,"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_ini,"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_ini)-($row->terima_ini),"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->terima_lalu)+($row->terima_ini),"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)+($row->keluar_ini),"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini),"2",",",".")."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini),"2",",",".")."</td>
                              </tr>"; 
							$ln_jlh1=$ln_jlh1+ $row->ang_ubah;
							$ln_jlh2=$ln_jlh2+ $row->terima_lalu;
							$ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
							$ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
							$ln_jlh5=$ln_jlh5+ $row->terima_ini;
							$ln_jlh6=$ln_jlh6+ $row->keluar_ini;
							$ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
							$ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
							$ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
							$ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
							$ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
																				 
							$lcprog_lama=$lcprog;
							$lckeg_lama=$lckeg;
							
						}
                       
                                                              
                                   
                    }
                
				if($lcskpd=='1.20.15.17' || $lcskpd=='1.20.08.17' || $lcskpd=='3.13.01.17'){
					$sql2=$this->db->query("select sum(a.ang) ang, sum(a.ang_ubah) ang_ubah, isnull(sum(terima_ini),0) as terima_ini, isnull(sum(terima_lalu),0) terima_lalu, isnull(sum(keluar_ini),0) keluar_ini, isnull(sum(keluar_lalu),0) keluar_lalu 
						from ( SELECT z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) kd_rek, 
							   SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah, 
							 (SELECT SUM (a.rupiah) nilai FROM trdkasin_pkd a INNER JOIN trhkasin_pkd b ON a.kd_skpd = b.kd_skpd AND a.no_sts = b.no_sts WHERE LEFT (a.kd_rek5, 3) = LEFT (z.kd_rek5, 3) AND a.kd_skpd = z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
							  and $kon_terimaini_ppkd) AS terima_ini, 
							 (SELECT SUM (a.rupiah) nilai FROM trdkasin_pkd a INNER JOIN trhkasin_pkd b ON a.kd_skpd = b.kd_skpd AND a.no_sts = b.no_sts WHERE LEFT (a.kd_rek5, 3) = LEFT (z.kd_rek5, 3) AND a.kd_skpd = z.kd_skpd  AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
							  and $kon_terimalalu_ppkd) AS terima_lalu, 
							 (SELECT SUM (a.rupiah) nilai FROM trdkasin_pkd a INNER JOIN trhkasin_pkd b ON a.kd_skpd = b.kd_skpd AND a.no_sts = b.no_sts WHERE LEFT (a.kd_rek5, 3) = LEFT (z.kd_rek5, 3) AND a.kd_skpd = z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
							   and $kon_keluarini_ppkd) AS keluar_ini, 
							   (SELECT SUM (a.rupiah) nilai FROM trdkasin_pkd a INNER JOIN trhkasin_pkd b ON a.kd_skpd = b.kd_skpd AND a.no_sts = b.no_sts WHERE LEFT (a.kd_rek5, 3) = LEFT (z.kd_rek5, 3) AND a.kd_skpd = z.kd_skpd AND a.kd_rek5<>'4141009' AND LEFT(a.kd_rek5,1)=4 AND b.jns_trans NOT IN (5,1)
							   and $kon_keluarlalu_ppkd) AS keluar_lalu 
								FROM trdrka_pend z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' 
								and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04' 
								GROUP BY z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) )a left join 
								(select kd_rek3, nm_rek3 from ms_rek3) b 
								on a.kd_rek=b.kd_rek3");
				}else{
				
				$sql2= $this->db->query("select sum(a.ang) ang, sum(a.ang_ubah) ang_ubah, isnull(sum(terima_ini),0) as terima_ini, isnull(sum(terima_lalu),0) terima_lalu, isnull(sum(keluar_ini),0) keluar_ini, isnull(sum(keluar_lalu),0) keluar_lalu 
						from ( SELECT z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) kd_rek, 
							   SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah, 
							 ((SELECT SUM(a.nilai) nilai FROM tr_terima a 
							  WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd 
							  and $kon_terimaini) 
							  -
							  (SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a 
							   INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) 
							   and a.kd_skpd=b.kd_skpd WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) 
							   and a.kd_skpd=z.kd_skpd and jns_trans in ('3')
							   and $kon_keluarini)) AS terima_ini, 
							 ((SELECT SUM(a.nilai) FROM tr_terima a 
							  WHERE left(a.kd_rek5,3)=left(z.kd_rek5,3) and a.kd_skpd=z.kd_skpd 
							  and $kon_terimalalu)
							  -
							  (SELECT ISNULL(SUM(b.rupiah),0) FROM trhkasin_pkd a 
							   INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) 
							   and a.kd_skpd=b.kd_skpd WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) 
							   and a.kd_skpd=z.kd_skpd and jns_trans in ('3')
							   and $kon_keluarlalu)) AS terima_lalu, 
							 (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a 
							   INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) 
							   and a.kd_skpd=b.kd_skpd WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) 
							   and a.kd_skpd=z.kd_skpd 
							   and $kon_keluarini) AS keluar_ini, 
							   (SELECT SUM(case when jns_trans in ('3') then b.rupiah*-1 else b.rupiah end) FROM trhkasin_pkd a 
								INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) 
								and a.kd_skpd=b.kd_skpd WHERE left(b.kd_rek5,3)=left(z.kd_rek5,3) 
								and a.kd_skpd=z.kd_skpd and $kon_keluarlalu) AS keluar_lalu 
								FROM trdrka_pend z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' 
								and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04' 
								GROUP BY z.kd_skpd, z.kd_kegiatan, left(z.kd_rek5,3) )a left join 
								(select kd_rek3, nm_rek3 from ms_rek3) b 
								on a.kd_rek=b.kd_rek3");
				}
							$row = $sql2->row();
							$ln_jlh12=$row->ang_ubah;
							$ln_jlh22=$row->terima_lalu;
							$ln_jlh32=$row->keluar_lalu;
							$ln_jlh42=($row->keluar_lalu)-($row->terima_lalu);
							$ln_jlh52=$row->terima_ini;
							$ln_jlh62=$row->keluar_ini;
							$ln_jlh72=($row->keluar_ini-$row->terima_ini);
							$ln_jlh82=($row->terima_lalu+$row->terima_ini);
							$ln_jlh92=($row->keluar_lalu+$row->keluar_ini);
							$ln_jlh102=(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
							$ln_jlh112=($row->ang_ubah-($row->terima_lalu+$row->terima_ini));

         $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" colspan=\"2\" style=\"font-size:12px\"><b>Jumlah</b></td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh12,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh22,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh32,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh42,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh52,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh62,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh72,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh82,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh92,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh102,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh112,"2",",",".")."</td>
                </tr>
				
				<tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">".$daerah.", ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanPA</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanBP</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
				<tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
				<tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b><br>$lcPangkatPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b><br>$lcPangkatBP</td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipBP</td>
                </tr>";
               
                
        $cRet .='</table>';
          $print = $this->uri->segment(3);
		if($print==0){
         $data['prev']= $cRet;    
		 echo ("<title>SPJ Pendapatan</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);
		}
    }
    
	
	function cetak_spjterimappkd(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $lcskpd2 = $lcskpd;
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
         
         if($jnsctk=='1'){
                $lcskpd = substr($lcskpd, 0, 7);
         }

		 if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
			
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_sempurna) and month('$lctgl2')<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
            
         }else{
            $bulan = $_REQUEST['bulan'];
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
				}else{
				$lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
				}  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_sempurna) and $bulan<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and $bulan>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
         }
         
		 
		
        $hasilang = $this->db->query($sqlang);
        $hasil_ang = $hasilang->row();          
        $anggaran_ = $hasil_ang->anggaran;
		 
		 
		 
		 
         $tgl_ttd= $_REQUEST['tgl_ttd'];
		 $nippa = str_replace('123456789',' ',$_REQUEST['ttd']);		     
         if($nippa==''){
                     $lcNmPA = '';
    				 $lcNipPA = '';
    				 $lcJabatanPA = '';
    				 $lcPangkatPA = '';
            
         }else{   		 
             $csql="SELECT nip as nip,nama,jabatan,pangkat  FROM ms_ttd WHERE nip = '$nippa' AND kd_skpd = '$lcskpd2' AND kode in ('PA','KPA')";
    				 $hasil = $this->db->query($csql);
    				 $trh2 = $hasil->row(); 
    				 
                     $lcNmPA = $trh2->nama;
    				 $lcNipPA = $trh2->nip;
    				 $lcJabatanPA = $trh2->jabatan;
    				 $lcPangkatPA = $trh2->pangkat;
		 }
         $nipbp = str_replace('123456789',' ',$_REQUEST['ttd2']);		     
		 if($nipbp==''){
             $lcNmBP = '';
             $lcNipBP = '';
             $lcPangkatBP = '';
             $lcJabatanBP = '';		  
		 }else{
             $csql="SELECT nip,nama,jabatan,pangkat FROM ms_ttd WHERE nip = '$nipbp' AND kd_skpd = '$lcskpd2' AND kode='BP'";
             $hasil3 = $this->db->query($csql);
             $trh3 = $hasil3->row(); 	
             $lcNmBP = $trh3->nama;
             $lcNipBP = $trh3->nip;
             $lcPangkatBP = $trh3->pangkat;
             $lcJabatanBP = $trh3->jabatan;
         }
		 $prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd2'");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
        $hasil = $this->db->query($csql);
        $trh2 = $hasil->row();          
        $lcNmskpd = $trh2->nm_skpd;
        

        
		
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"13\" style=\"font-size:14px;border: solid 1px white;\"><b>".$prov."<br>
                    LAPORAN PERTANGGUNGJAWABAN BENDAHARA PENERIMAAN<BR>SPJ PENDAPATAN PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">OPD</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
            </tr>
            
            </table>
			
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Kode<br>Rekening</td>
                <td align=\"center\" rowspan=\"2\" width=\"24%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Sampai dengan Bulan Lalu</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Bulan Ini</td>
                <td align=\"center\" colspan=\"4\" width=\"24%\" style=\"font-size:12px\">Sampai dengan Bulan Ini</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang<br>Terealisasi</td>                
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang telah<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa yang<br>Belum<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa Anggaran yang<br>Belum<br>Terealisasi/Pelam-<br>pauan Anggaran</td>                                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6=(5-4)</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>
                <td align=\"center\" style=\"font-size:12px\">9=(8-7)</td>
                <td align=\"center\" style=\"font-size:12px\">10=(4+7)</td>
                <td align=\"center\" style=\"font-size:12px\">11=(5+8)</td>
                <td align=\"center\" style=\"font-size:12px\">12=(11-10)</td>
                <td align=\"center\" style=\"font-size:12px\">13=(3-10)</td>                
            </tr>
			</thead>";
           

            if ($pilih==1   ){
                $kon_terimaini = " (a.tgl_kas >= '$lctgl1' AND a.tgl_kas <= '$lctgl2')";
                $kon_keluarini = " (a.tgl_kas >= '$lctgl1' AND a.tgl_kas <= '$lctgl2')";          
                $kon_terimalalu = " (a.tgl_kas < '$lctgl1')";
                $kon_keluarlalu = " (a.tgl_kas < '$lctgl1')";
           }else{
                $kon_terimaini = " (month(a.tgl_kas)= '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
                $kon_keluarini = " (month(a.tgl_kas)= '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
                $kon_terimalalu = " (month(a.tgl_kas)< '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
                $kon_keluarlalu = " (month(a.tgl_kas)< '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
           }

            $n_trdrka = 'trdrka';
            
            $kon_skpd="a.kd_skpd = ";
            $sql  = "SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah,
                    0 AS keluar_ini,
                    0 AS keluar_lalu,
                    (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS terima_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarlalu) AS terima_lalu                    
                    FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04'
                    GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5,z.nm_rek5
                    ORDER BY z.kd_rek5";
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $lcprog_lama="";
                    $lckeg_lama="";
                    $ln_jlh1 =0;
                    $ln_jlh2 =0;
                    $ln_jlh3 =0;
                    $ln_jlh4 =0;
                    $ln_jlh5 =0;
                    $ln_jlh6 =0;
                    $ln_jlh7 =0;
                    $ln_jlh8 =0;
                    $ln_jlh9 =0;
                    $ln_jlh10 =0;
                    $ln_jlh11 =0;
                    
                    foreach ($hasil->result() as $row)
                    {
                        $lcprog=substr($row->kd_kegiatan,0,18);
                        $lckeg=$row->kd_kegiatan;
                        $lcrek=$row->kd_rek5;
                        
                        if($lcprog<>$lcprog_lama){//cek program
                             $sql="select z.kd_program, z.nm_program,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and left(a.kd_rek5,1)='4' and right(a.kd_kegiatan,5)='00.04') AS ang_ubah,
                                0 AS keluar_ini,
                               00 AS keluar_lalu,
								(SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS terima_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and left(z.kd_skpd,len('$lcskpd'))='$lcskpd'
                                    group by z.kd_program, z.nm_program ";
                             $hasil_prog = $this->db->query($sql);
                             foreach ($hasil_prog->result() as $row_prog)
                             {
                             $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lcprog</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row_prog->nm_program</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)-($row_prog->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_ini)-($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->terima_lalu)+($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)+($row_prog->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu+$row_prog->keluar_ini)-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  </tr>";
                                    
                                
                             }
                                                                                                                                                                 
                        }
                        
                        if($lckeg<>$lckeg_lama){ //cek kegiatan
                            $sql="select z.kd_kegiatan, z.nm_kegiatan,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd') AS ang_ubah,
                                0 AS keluar_ini,
                                0 AS keluar_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS terima_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd' 
                                    group by z.kd_kegiatan, z.nm_kegiatan";
                             $hasil_keg = $this->db->query($sql);
                             foreach ($hasil_keg->result() as $row_keg)
                             {
                                $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lckeg</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:11px;border-bottom:none;border-top:none\"><b>$row_keg->nm_kegiatan</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)-($row_keg->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_ini)-($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->terima_lalu)+($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)+($row_keg->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu+$row_keg->keluar_ini)-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  </tr>";
                                
                                
                             }
                                                                                                                                                                 
                        }                                                                                                                        
                                                                                                                                
                       $cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lckeg.".$this->tukd_model->dotrek($lcrek)."</td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)-($row->terima_lalu))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_ini)-($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->terima_lalu)+($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)+($row->keluar_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini))."</td>
                              </tr>";    
                                                              
                        $ln_jlh1=$ln_jlh1+ $row->ang_ubah;
                        $ln_jlh2=$ln_jlh2+ $row->terima_lalu;
                        $ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
                        $ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
                        $ln_jlh5=$ln_jlh5+ $row->terima_ini;
                        $ln_jlh6=$ln_jlh6+ $row->keluar_ini;
                        $ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
                        $ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
                        $ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
                        $ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
                        $ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
                                                                             
                        $lcprog_lama=$lcprog;
                        $lckeg_lama=$lckeg;           
                    }
                    


         $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" colspan=\"2\" style=\"font-size:12px\"><b>Jumlah</b></td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh1)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh2)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh3)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh4)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh5)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh6)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh7)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh8)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh9)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh10)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh11)."</td>
                </tr>
                ";
                /* <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">".$daerah.", tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanPA</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanBP</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b><br>$lcPangkatPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b><br>$lcPangkatBP</td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipBP</td>
                </tr>"; */
                
                                  
                
        $cRet .='</table>';
          $print = $this->uri->segment(3);
		if($print==0){
         $data['prev']= $cRet;    
		 echo ("<title>SPJ Pendapatan</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'L',0,'');
		}
    }
    
	
	
	
	function update_bkp2(){
        
		$query = $this->input->post('st_query');
       
        $asg = $this->db->query($query);
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
        

    }	

	function pengeluaran_non_sp2d(){
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/pengeluaran_non_sp2d',$data) ; 
    }

	
	function load_pengeluaran_nonsp2d(){
        
        $sql = "SELECT * from pengeluaran_non_sp2d order by nomor";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nomor' => $resulte['nomor'],
                        'tanggal' => $resulte['tanggal'],
						'keterangan' => $resulte['keterangan'],
                        'nilai' => number_format($resulte['nilai'],"2",".",",")                                                                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	function hapus_pengeluaran_non_sp2d() {    	
		$nomor = $this->input->post('no');
		$tgl   = $this->input->post('tanggal');
		//$nilai = $this->input->post('nilai');
        $query = "delete from pengeluaran_non_sp2d where nomor='$nomor' and tanggal='$tgl'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }  

	
	function ctk_pengeluaran_non_sp2d($ctk='',$ttd='',$tgl='',$no_halaman=''){
		
		//$lcttd = str_replace('abc',' ',$this->uri->segment(4));
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$cetk = $this->uri->segment(9);
		
		
		
		if($cetk=='1'){
			$where = "where tanggal = '$tgl'";
			$where2 = "where d.tanggal <'$tgl'";
			
			$tanggala = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
		}else{
			
			
			$tgl1 = $this->uri->segment(7);
			$tgl2 = $this->uri->segment(8);
		
			$where = "where tanggal between '$tgl1' AND '$tgl2'";
			$where2 = "where d.tanggal <'$tgl1'";
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
		}
		
		
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PEMBANTU PENGELUARAN NON SP2D TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold;\">No. Urut</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold;\">Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"27%\" style=\"font-weight:bold\">Uraian</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"18%\" style=\"font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Pengeluaran (Rp)</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
            </tr>";
			
			if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggala</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
				
		$nilai3=0; 
		$sql = "SELECT * from pengeluaran_non_sp2d $where";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
		$nomor     = $row->nomor;	
		$tanggal    = $row->tanggal;	
		$keterangan  = $row->keterangan;	
		$nilai       = $row->nilai;
        $nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
		$nilai3=$nilai3+$nilai;

			$cRet .= '<tr>
			<td align="center">'.$nomor.'</td>
			<td align="center">'.$this->tanggal_format_indonesia($tanggal).'</td>
			<td>'.$keterangan.'</td>
			<TD></TD>
			<TD align="right">'.$nilaix.'</TD>
			</tr>';
			 
		} 
		
		$sql2 = "select sum(d.nilai) as nilai 
				from pengeluaran_non_sp2d d $where2";
				
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		
		if($cetk=='1'){
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="3" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}else{
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="3" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		$data['prev']= $cRet;  
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Pengeluaran Non SP2D</title>");
			 echo $cRet;
		}else if($print==1){
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=bk_pengnonsp2d.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
		
	}

	
	
	function update_pengeluaran_nonsp2d(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
		if($asg){
			echo '2';
		}else{
			echo '0';
		}
    }

	function cetak_pengeluaran_non_sp2d()
    {
        $data['page_title']= 'BUKU KAS PENGELUARAN NON SP2D';
        $this->template->set('title', 'BUKU KAS PENGELUARAN NON SP2D');   
        $this->template->load('template','tukd/sp2d/ctk_pengeluaran_non_sp2d',$data) ; 
    }
	
	function buku_kas_penerimaan_pengeluaran($ctk='',$ttd='',$tgl='',$number='',$no_halaman=''){
		
		//$lcttd = str_replace('abc',' ',$this->uri->segment(4));
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$cetk = $this->uri->segment(10);
		
		
		if($cetk=='1'){
			$tanggal = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
			
			$where ="AND a.tgl_kas = '$tgl'";
			$where2 ="AND a.tgl_kas_bud = '$tgl'";
			$where3 ="x.tanggal = '$tgl'";
			$where4 ="w.tanggal = '$tgl'";
			$where5 ="AND a.tgl_kas<'$tgl'";
			$where6 ="AND a.tgl_kas_bud<'$tgl'";
			$where7 ="x.tanggal < '$tgl'";
			$where8 ="w.tanggal < '$tgl'";
			$where9 ="AND a.tgl_kas < '$tgl'";
			
		}else{
			
			$tgl1 = $this->uri->segment(8);
			$tgl2 = $this->uri->segment(9);
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
			
			$where ="AND a.tgl_kas between '$tgl1' AND '$tgl2'";
			$where2 ="AND a.tgl_kas_bud between '$tgl1' AND '$tgl2'";
			$where3 ="x.tanggal between '$tgl1' AND '$tgl2'";
			$where4 ="w.tanggal between '$tgl1' AND '$tgl2'";
			$where5 ="AND a.tgl_kas<'$tgl1'";
			$where6 ="AND a.tgl_kas_bud<'$tgl1'";
			$where7 ="x.tanggal < '$tgl1'";
			$where8 ="w.tanggal < '$tgl1'";
			$where9 ="AND a.tgl_kas < '$tgl1'";
		}
		
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT top 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
	
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
			
		$sqlx="SELECT * from buku_kas where nomor='0'";	
		$sqlx1=$this->db->query($sqlx);
		 foreach ($sqlx1->result() as $rowttd)
			{
				$nomor=$rowttd->nomor;
				$uraian=$rowttd->uraian;
				$nilaiu= $rowttd->nilai;
				$nilaiu_x = number_format($nilaiu,"2",",",".");
			}
		
		$cRet="";
		
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>";
				
				if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
		
		$tot_trm=0; 
		$tot_klr=0; 
		
		 if( $tgl == $thn_ang+'-1-1'){
			$saldo="select '4' kd_rek, 'SALDO AWAL' nama, nilai , 1 jenis
			from buku_kas
			UNION ALL";
		}else{
		 	$saldo="";
		}
		$sql="select kd_rek, nama, sum(nilai) nilai, jenis from(
			
			$saldo
			SELECT LEFT(b.kd_rek5,3) as kd_rek, UPPER(c.nm_rek3) as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				LEFT JOIN ms_rek3 c ON LEFT(b.kd_rek5,3)=c.kd_rek3
				WHERE LEFT(b.kd_rek5,1) IN ('4') $where
				GROUP BY LEFT(b.kd_rek5,3),c.nm_rek3 
				UNION ALL
			SELECT  '414' as kd_rek, 'LAIN-LAIN PENDAPATAN ASLI DAERAH YANG SAH' as nama
								,SUM(rupiah) as nilai, 1 jenis
								FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
								WHERE LEFT(b.kd_rek5,1) IN ('5','1') and pot_khusus=3 $where
								 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,1)	 
				UNION ALL
				SELECT  510 as kd_rek, 'CONTRA POST' as nama
								,SUM(rupiah) as nilai, 1 jenis
								FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
								WHERE LEFT(b.kd_rek5,1) IN ('5','1') and pot_khusus<>3 $where
				UNION ALL
				SELECT
				 '511' kd_rek, 'PENGELUARAN BELANJA GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
						WHERE a.status_bud = '1' AND a.jns_spp = '4'
						AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
						$where2
				
				UNION ALL
				SELECT
				 '512' kd_rek, 'PENGELUARAN BELANJA NON GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
						WHERE a.status_bud = '1' AND a.jns_spp != '4'
						AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
						$where2
				
				UNION ALL
				SELECT
									'513' kd_rek, 'PENGELUARAN NON SP2D' nama,
									isnull(SUM(x.nilai), 0) AS nilai, 2 jenis
								FROM
									pengeluaran_non_sp2d x
								WHERE
									$where3
				UNION ALL
				SELECT
									'513' kd_rek, 'RESTITUSI' nama,
									isnull(SUM(b.rupiah), 0) AS nilai, 2 jenis
								FROM
									trdrestitusi b inner join trhrestitusi a on a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas and a.no_sts=b.no_sts
								WHERE a.jns_trans=3
									$where
				UNION ALL 
				SELECT 
					
					'514' as kd_rek,
					'KOREKSI PENERIMAAN' nama,
					isnull(SUM(w.nilai),0) as nilai,
					1 jenis
				FROM	
					trkasout_ppkd w
				WHERE
					$where4
				UNION ALL
							SELECT
								'515' AS kd_rek,
								'DEPOSITO' nama,
								isnull(SUM(w.nilai), 0) AS nilai,
								1 jenis
							FROM
								penerimaan_non_sp2d w
							WHERE
								$where4	
							AND w.jenis='1'
				UNION ALL
							SELECT
								'516' AS kd_rek,
								'PENERIMAAN NON SP2D' nama,
								isnull(SUM(w.nilai), 0) AS nilai,
								1 jenis
							FROM
								penerimaan_non_sp2d w
							WHERE
								$where4	
							AND w.jenis='2'
				) a
					where a.nilai<>0 group by kd_rek, nama, jenis order by kd_rek
				";
		
		
		$no=$number-1;	
		
		$hasil = $this->db->query($sql);
		foreach ($hasil->result() as $row){
			$kd_rek  = $row->kd_rek;                    
			$uraian= $row->nama;
			$nilai  = $row->nilai;
			$jenis  = $row->jenis;                    
			
		/* if(($nomor==1) or ($nomor==2) or ($nomor==3) or ($nomor==4) or ($nomor==0) or ($nomor==5) or ($nomor==6) or ($nomor==7) or ($nomor==8) or ($nomor==9)){
			$terima=$nilai;
			$keluar=0;
			
		} else {
			$terima=0;
			$keluar=$nilai;
		} */
		
		if($jenis=='1'){
			$terima=$nilai;
			if($terima<0){
				$a="(";
				$b=")";
				$nilaiterima = number_format($terima*-1,"2",",",".");
			}else{
				$a="";
				$b="";
				$nilaiterima = number_format($terima,"2",",",".");
			}
			
			$keluar=0;
			$nilaikeluar = number_format($keluar,"2",",",".");
			
		
		}else{
			$terima=0;
			$nilaiterima = number_format($terima,"2",",",".");
			$keluar=$nilai;
			$nilaikeluar = number_format($keluar,"2",",",".");
			$a="";
			$b="";	
		}
		
		$tot_trm=$tot_trm+$terima;
		$tot_klr=$tot_klr+$keluar;
		$no=$no+1;
		$cRet .= '<tr>
		<TD align="center" >'.$no.'</TD>
		<td valign="top">'.$uraian.'</td>
		<td valign="top" align="right">'.$a.''.$nilaiterima.''.$b.'</td>
		<td valign="top" align="right">'.$nilaikeluar.'</td>
		</tr>';
		
		}
		
		$sql3 = "select nilai from buku_kas where nomor ='0'";
			$hasil3 = $this->db->query($sql3);
			foreach ($hasil3->result() as $row){
			if($tgl == '2019-1-1'){
				$nilai_ax = 0;
			}else{
				$nilai_ax = $row->nilai;
			}
			
			$nilai_x = number_format($nilai_ax,"2",",",".");
		}
		
		$sql2 = "SELECT SUM(CASE WHEN jenis IN('1') THEN nilai ELSE 0 END) as trm_sbl,
						SUM(CASE WHEN jenis IN('2') THEN nilai ELSE 0 END) as klr_sbl
			FROM(
				SELECT  a.tgl_kas,LEFT(b.kd_rek5,3) as kd_rek, UPPER(c.nm_rek3) as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				LEFT JOIN ms_rek3 c ON LEFT(b.kd_rek5,3)=c.kd_rek3
				WHERE LEFT(b.kd_rek5,1) IN ('4') $where5
				 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,3),c.nm_rek3 
				UNION ALL
				SELECT  a.tgl_kas,LEFT(b.kd_rek5,1) as kd_rek, 'CONTRA POST' as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				WHERE LEFT(b.kd_rek5,1) IN ('5','1') $where5
				 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,1) 
				UNION ALL
				SELECT
				a.tgl_kas_bud, '' kd_rek, 'PENGELUARAN BELANJA NON GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp 	AND c.kd_skpd = d.kd_skpd
						WHERE a.status_bud = '1' AND  a.jns_spp != '4'
						AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
						$where6
				GROUP BY a.tgl_kas_bud
				UNION ALL
				SELECT
				a.tgl_kas_bud, '' kd_rek, 'PENGELUARAN BELANJA GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
						WHERE a.status_bud = '1' AND a.jns_spp = '4'
						AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
						$where6
				GROUP BY a.tgl_kas_bud
				UNION ALL
				SELECT
									x.tanggal,'' kd_rek, 'PENGELUARAN NON SP2D' nama,
									isnull(SUM(x.nilai), 0) AS nilai, 2 jenis
								FROM
									pengeluaran_non_sp2d x
								WHERE
									$where7
				GROUP BY x.tanggal
				UNION ALL
				SELECT
									a.tgl_kas,'' kd_rek, 'RESTITUSI' nama,
									isnull(SUM(b.rupiah), 0) AS nilai, 2 jenis
								FROM
									trdrestitusi b inner join trhrestitusi a on a.kd_skpd=b.kd_skpd and a.no_kas=b.no_kas and a.no_sts=b.no_sts
								WHERE a.jns_trans=3
									$where9
				GROUP BY a.tgl_kas
				UNION ALL
				SELECT
									w.tanggal,'' as kd_rek, 'KOREKSI PENERIMAAN' nama,
									isnull(SUM(w.nilai), 0) AS nilai, 1 jenis
								FROM
									trkasout_ppkd w
								WHERE
									$where8
								
				GROUP BY w.tanggal,w.kd_rek
				UNION ALL
				SELECT
									w.tanggal,'' as kd_rek, 'DEPOSITO' nama,
									isnull(SUM(w.nilai), 0) AS nilai, 1 jenis
								FROM
									penerimaan_non_sp2d w
								WHERE
									$where8
								AND w.jenis='1'
				GROUP BY w.tanggal
				UNION ALL
				SELECT
									w.tanggal,'' as kd_rek, 'PENERIMAAN NON SP2D' nama,
									isnull(SUM(w.nilai), 0) AS nilai, 1 jenis
								FROM
									penerimaan_non_sp2d w
								WHERE
									$where8
								AND w.jenis='2'
				GROUP BY w.tanggal
				) a";
		$hasil2 = $this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$trm_sbl = $row->trm_sbl+$nilai_ax;
			$klr_sbl = $row->klr_sbl;
			$nilai_2x = number_format($trm_sbl,"2",",",".");
			$nilai_3x = number_format($klr_sbl,"2",",",".");		
		}	
		
			
		
		//$kas = ($tot_trm+$trm_sbl)-($tot_klr+$klr_sbl);
		//$kasnom = number_format($kas,"2",",",".");
		$total_terima = $tot_trm+$trm_sbl;
		$total_keluar = $tot_klr+$klr_sbl;
		$tot_saldo = $total_terima-$total_keluar;
		$totsaldo = number_format($tot_saldo,"2",",",".");
		
	
			if($cetk=='1'){
			$cRet .= '
			<tr>
				
				<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
				
				<td align="right">'.number_format($tot_trm,"2",",",".").'</td>
				<TD align="right">'.number_format($tot_klr,"2",",",".").'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
				<td style="border-top:hidden;" align="right">'.$nilai_2x.'</td>
				<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
				<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
				<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
			</tr>';
			
			
			}else{
				$cRet .= '
			<tr>
				
				<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				
				<td align="right">'.number_format($tot_trm,"2",",",".").'</td>
				<TD align="right">'.number_format($tot_klr,"2",",",".").'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
				<td style="border-top:hidden;" align="right">'.$nilai_2x.'</td>
				<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal2.'</TD>
				<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
				<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
			</tr>';
			
			}
		
		$cRet .='</table>';	
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
						<td width=\"50%\"></td>
						<td width=\"50%\">&nbsp;</td>
					</tr>";
					if($cetk=='1'){
						$cRet .="<tr>
							<td width=\"50%\">Pada hari ini, tanggal $tanggal</td>
							<td width=\"50%\"></td>
						</tr>";
					}else{
						$cRet .="<tr>
							<td width=\"50%\">Pada hari ini, s.d  tanggal $tanggal2</td>
							<td width=\"50%\"></td>
						</tr>";
					}
					$cRet .="<tr>
						<td width=\"50%\">Oleh kami didapat dalam kas Rp. $totsaldo</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td><i>(".$this->tukd_model->terbilang($tot_saldo).")</i></td>
						<td width=\"50%\"></td>
					</tr>
                    
                  </table>";
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		$data['prev']= $cRet; 
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan dan Pengeluaran</title>");
			 echo $cRet;
		}else if($print==1){
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=b9.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
	}
	
	function buku_kas_penerimaan_pengeluaranv2($ctk='',$ttd='',$tgl='',$number='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$cetk = $this->uri->segment(10);
		
		
		if($cetk=='1'){
			$tanggal = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
			
			$where ="AND a.tgl_kas = '$tgl'";
			$where2 ="AND a.tgl_kas_bud = '$tgl'";
			$where3 ="x.tanggal = '$tgl'";
			$where4 ="w.tanggal = '$tgl'";
			$where5 ="AND a.tgl_kas<'$tgl'";
			$where6 ="AND a.tgl_kas_bud<'$tgl'";
			$where7 ="x.tanggal < '$tgl'";
			$where8 ="w.tanggal < '$tgl'";
			$where9 ="AND a.tgl_kas < '$tgl'";
			
		}else{
			
			$tgl1 = $this->uri->segment(8);
			$tgl2 = $this->uri->segment(9);
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
			
			$where ="AND a.tgl_kas between '$tgl1' AND '$tgl2'";
			$where2 ="AND a.tgl_kas_bud between '$tgl1' AND '$tgl2'";
			$where3 ="x.tanggal between '$tgl1' AND '$tgl2'";
			$where4 ="w.tanggal between '$tgl1' AND '$tgl2'";
			$where5 ="AND a.tgl_kas<'$tgl1'";
			$where6 ="AND a.tgl_kas_bud<'$tgl1'";
			$where7 ="x.tanggal < '$tgl1'";
			$where8 ="w.tanggal < '$tgl1'";
			$where9 ="AND a.tgl_kas < '$tgl1'";
		}
		
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT top 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
	
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
			
		$sqlx="SELECT * from buku_kas where nomor='0'";	
		$sqlx1=$this->db->query($sqlx);
		 foreach ($sqlx1->result() as $rowttd)
			{
				$nomor=$rowttd->nomor;
				$uraian=$rowttd->uraian;
				$nilaiu= $rowttd->nilai;
				$nilaiu_x = number_format($nilaiu,"2",",",".");
			}
		
		$cRet="";
		
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">TANGGAL</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"35%\" style=\"font-weight:bold\">PENERIMAAN</td>                
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\35%\" style=\"font-weight:bold\">PENGELUARAN</td>
			</tr>
			
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>";
				
		$tot_trm=0; 
		$tot_klr=0; 
		
		 if( $tgl == '2019-1-1'){
			$saldo="select '2019-1-1' tgl_kas, nilai , 1 jenis
			from buku_kas
			UNION ALL";
		}else{
		 	$saldo="";
		}
		$sql="SELECT terima.tgl_kas, terima.nilai terima, keluar.nilai keluar FROM (
				SELECT tgl_kas, SUM(nilai) nilai FROM (
				
				SELECT a.tgl_kas, SUM ( rupiah ) AS nilai,1 jenis 
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas= b.no_kas AND a.kd_skpd= b.kd_skpd
									 LEFT JOIN ms_rek3 c ON LEFT ( b.kd_rek5, 3 ) = c.kd_rek3 
				WHERE LEFT( b.kd_rek5, 1 ) IN ( '4' ) AND a.tgl_kas BETWEEN '$tgl1' AND '$tgl2'
				group by a.tgl_kas 
				UNION ALL
				
				SELECT a.tgl_kas,SUM ( rupiah ) AS nilai,1 jenis 
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas= b.no_kas AND a.kd_skpd= b.kd_skpd 
				WHERE LEFT (b.kd_rek5,1) IN ('5','1') AND pot_khusus=3 AND a.tgl_kas BETWEEN '$tgl1' AND '$tgl2' 
				GROUP BY a.tgl_kas 
				UNION ALL
				
				SELECT a.tgl_kas,SUM ( rupiah ) AS nilai,1 jenis 
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas= b.no_kas AND a.kd_skpd= b.kd_skpd 
				WHERE LEFT ( b.kd_rek5, 1 ) IN ( '5', '1' ) AND pot_khusus <> 3 AND a.tgl_kas BETWEEN '$tgl1' AND '$tgl2'
				GROUP BY a.tgl_kas 
				UNION ALL
				
				SELECT w.tanggal, isnull( SUM ( w.nilai ), 0 ) AS nilai, 1 jenis 
				FROM trkasout_ppkd w  
				WHERE w.tanggal BETWEEN '$tgl1' AND '$tgl2'
				GROUP BY w.tanggal
				UNION ALL
				
				SELECT w.tanggal, isnull(SUM(w.nilai), 0) AS nilai, 1 jenis 
				FROM penerimaan_non_sp2d w 
				WHERE w.tanggal between '$tgl1' AND '$tgl2' AND w.jenis='1' 
				GROUP BY w.tanggal
				UNION ALL
				
				SELECT w.tanggal, isnull(SUM(w.nilai), 0) AS nilai, 1 jenis 
				FROM penerimaan_non_sp2d w 
				WHERE w.tanggal between '$tgl1' AND '$tgl2' AND w.jenis='2'
				GROUP BY w.tanggal) x
				GROUP BY tgl_kas) terima
				LEFT JOIN 
				(SELECT tgl_kas, SUM(nilai) nilai FROM (				
				
				SELECT a.tgl_kas_bud tgl_kas,isnull( SUM ( d.nilai ), 0 ) AS nilai, 2 jenis 
					 FROM trhsp2d a INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
									INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
									INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd 
					 WHERE a.status_bud = '1' AND a.jns_spp = '4' 
					 AND ( c.sp2d_batal= 0 OR c.sp2d_batal IS NULL ) AND a.tgl_kas_bud BETWEEN '$tgl1' AND '$tgl2'
				GROUP BY a.tgl_kas_bud
				UNION ALL
				
				SELECT a.tgl_kas_bud tgl_kas, isnull( SUM ( d.nilai ), 0 ) AS nilai, 2 jenis 
					 FROM trhsp2d a INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
									INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
									INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd 
					 WHERE a.status_bud = '1' AND a.jns_spp != '4' AND ( c.sp2d_batal= 0 OR c.sp2d_batal IS NULL ) 
					 AND a.tgl_kas_bud BETWEEN '$tgl1' AND '$tgl2'
				GROUP BY a.tgl_kas_bud 
				UNION ALL
				
				SELECT x.tanggal tgl_kas, isnull( SUM ( x.nilai ), 0 ) AS nilai,2 jenis 
				FROM pengeluaran_non_sp2d x 
				WHERE x.tanggal BETWEEN '$tgl1' AND '$tgl2'
				GROUP BY x.tanggal 
				UNION ALL
				
				SELECT a.tgl_kas, isnull( SUM ( b.rupiah ), 0 ) AS nilai,2 jenis 
				FROM trdrestitusi b INNER JOIN trhrestitusi a ON a.kd_skpd= b.kd_skpd AND a.no_kas= b.no_kas AND a.no_sts= b.no_sts 
				WHERE a.jns_trans= 3 AND a.tgl_kas BETWEEN '$tgl1' AND '$tgl2'
				GROUP BY a.tgl_kas) x
				GROUP BY tgl_kas) keluar on terima.tgl_kas=keluar.tgl_kas
				ORDER BY terima.tgl_kas";
		$no=$number-1;	
		
		$hasil = $this->db->query($sql);
		foreach ($hasil->result() as $row){
			
			$tgl_uraian = $this->tanggal_format_indonesia($row->tgl_kas);
			$uraian= $tgl_uraian;
			$terima  = $row->terima;
			$keluar  = $row->keluar;                    
			
			if($terima<0){
				$a="(";
				$b=")";
				$nilaiterima = number_format($terima*-1,"2",",",".");
			}else{
				$a="";
				$b="";
				$nilaiterima = number_format($terima,"2",",",".");
			}
		
			if($keluar<0){
				$a="(";
				$b=")";
				$nilaikeluar = number_format($keluar*-1,"2",",",".");
			}else{
				$a="";
				$b="";
				$nilaikeluar = number_format($keluar,"2",",",".");
			}
		
			$tot_trm=$tot_trm+$terima;
			$tot_klr=$tot_klr+$keluar;
			$no=$no+1;
			$cRet .= '<tr>
			<TD align="center" >'.$no.'</TD>
			<td valign="top"align="center"">'.$uraian.'</td>
			<td valign="top" align="right">'.$a.''.$nilaiterima.''.$b.'</td>
			<td valign="top" align="right">'.$a.''.$nilaikeluar.''.$b.'</td>
			</tr>';
		}
		
		$cRet .= '
			<tr>
				
				<TD align="left" colspan="2"><b>Jumlah Tanggal &nbsp; '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				
				<td align="right"><b>'.number_format($tot_trm,"2",",",".").'</td>
				<TD align="right"><b>'.number_format($tot_klr,"2",",",".").'</TD>
			</tr>';
		
		$cRet .='</table>';	
		
		$print = $this->uri->segment(3);
		$data['prev']= $cRet; 
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan dan Pengeluaran</title>");
			 echo $cRet;
		}else if($print==1){
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=b9.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
	}
	
	
	
	function bkp2_gaji()
    {
        $data['page_title']= 'CETAK BKP2 GAJI';
        $this->template->set('title', 'CETAK BKP2 GAJI');   
        $this->template->load('template','tukd/sp2d/sp2d_bkp2_gj',$data) ; 
    }
	
	function ctk_bkp2_gaji($jns='', $ctk='',$ttd1='',$tgl=''){
		
			
		//$lcttd = str_replace('abc',' ',$this->uri->segment(5));
		$lcttd = str_replace('123456789',' ',$this->uri->segment(5));
		$cetk = $this->uri->segment(11);
		
		
		if($cetk=='1'){
			$tanggal = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
		}else{
			
			$tgl1 = $this->uri->segment(9);
			$tgl2 = $this->uri->segment(10);
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
		}
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		$no_halaman = $this->uri->segment(7);
		$spasi = $this->uri->segment(8);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		switch ($jns){
                        case '0': //GAJI
						$where2="and a.jns_spp='4'";
						//$where2="and LEFT(d.kd_rek5,2)='51'";
						$judul="BUKU KAS PEMBANTU PENGELUARAN GAJI";
                            break;
                        case '1': //NON GAJI
						$where2="and a.jns_spp!='4'";
						//$where2="and LEFT(d.kd_rek5,2) IN ('52','11')";
						$judul="BUKU KAS PEMBANTU PENGELUARAN NON GAJI";
                            break;
                                               
                    }
		
		if($cetk=='1'){
			$AND  = "AND a.tgl_kas_bud = '$tgl'";
			$AND2 = "AND a.tgl_kas_bud < '$tgl'";
		}else{
			$AND = "AND a.tgl_kas_bud between '$tgl1' AND '$tgl2'";
			$AND2 = "AND a.tgl_kas_bud < '$tgl1'";
		}
		
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"45%\" style=\"font-weight:bold\">Uraian</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"30%\" style=\"font-weight:bold\">Kode Rekening</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">Pengeluaran (Rp)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
				</tr>";
				
				if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
		$nilai3=0; 
		
		$sql = "SELECT * FROM (select 1 as urut, a.no_kas_bud as urut2,a.no_kas_bud, a.no_sp2d ,a.tgl_sp2d, a.kd_skpd,a.keperluan, 
a.jns_spp,a.jenis_beban,a.nmrekan,c.pimpinan,
'' kd_kegiatan,''kd_rek5,SUM(d.nilai) nilai, '' no_bukti,
				count(a.no_sp2d) as jumlah from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' $AND $where2
				AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				GROUP BY a.no_kas_bud, a.no_sp2d ,a.tgl_sp2d, a.kd_skpd,a.keperluan,a.jns_spp,a.jenis_beban,a.nmrekan,c.pimpinan
				UNION ALL
				SELECT
				2 urut,
				'' no_kas_bud,
				a.no_kas_bud AS urut2,
				'' no_sp2d,
				'' tgl_sp2d,
				a.kd_skpd,
				'' keperluan,
				'' jns_spp,
				'' jenis_beban,
				'' nmrekan,
				'' pimpinan,
				d.kd_kegiatan,
				d.kd_rek5,
				d.nilai,
				d.no_bukti,
				0 AS jumlah
				FROM 
				trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' $AND $where2
				AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				GROUP BY a.no_kas_bud, a.no_sp2d ,a.tgl_sp2d, a.kd_skpd,a.keperluan, d.kd_kegiatan, d.kd_rek5,d.nilai,d.no_bukti,d.kd) a
				order by cast(no_kas_bud as int),urut, kd_kegiatan,kd_rek5
				";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
			
			$no_urut     = $row->urut;	
			$no_urut2    = $row->urut2;	
			$no_kas_bud  = $row->no_kas_bud;	
			$no_sp2d     = $row->no_sp2d;
			$tgl_sp2d    = $row->tgl_sp2d;
			$jns_spp    = $row->jns_spp;
			$jenis_beban  = $row->jenis_beban;
			$nmrekan    = $row->nmrekan;
			$pimpinan    = $row->pimpinan;
			$kd_skpd    = $row->kd_skpd;
			$tglsp2d     = $this->tukd_model->tanggal_format_indonesia($tgl_sp2d);
			$keperluan   = $row->keperluan;
			$nilai       = $row->nilai;
			$nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
			$kd_kegiatan = $row->kd_kegiatan;
			$kd_rek5      = $this->dotrek($row->kd_rek5);
			$jumlah      = ($row->jumlah)+1;
												
			if ($kd_kegiatan==''){
				$kode="";
			} else {
				$kode="$kd_kegiatan.$kd_rek5";
			}
		
			if($no_urut=='1'){
				 if(($jns_spp=='6') && ($jenis_beban=='3')){
						$cRet .= '<tr>
						<td valign="top" rowspan="0">'.$no_urut2.'</td>
						<td valign="top" rowspan="0">'.$pimpinan.', '.$nmrekan.'<br> SP2D Tanggal : '.$tglsp2d.'
										  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nomor &nbsp;&nbsp;: '.$no_sp2d.'
										  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nilai &nbsp;&nbsp;: '.$nilaix.'
						</td>
						<TD align="right" ></TD>
						<TD align="right" ></TD>
						</tr>';
				} else {
						$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$kd_skpd' AND kode='BK' ";
							 $sqlnam=$this->db->query($sqlnam);
							 foreach ($sqlnam->result() as $rownam)
							{
								$nama_ben=$rownam->nama;                    
								$jabat_ben=$rownam->jabatan;                    
							}
							
						$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
						$jabat_ben = empty($jabat_ben) ? ' ' :$jabat_ben;
						
						$cRet .= '<tr>
						<td valign="top" rowspan="0">'.$no_urut2.'</td>
						<td valign="top" rowspan="0">'.$nama_ben.', '.$jabat_ben.', '.$this->rka_model->get_nama($kd_skpd,'nm_skpd','ms_skpd','kd_skpd').'<br>'.$keperluan.'
						   <br>SP2D Tanggal : '.$tglsp2d.'
						   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nomor &nbsp;&nbsp;: '.$no_sp2d.'
						   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nilai &nbsp;&nbsp;&nbsp;&nbsp;: '.$nilaix.'
						   
						</td>
						<TD align="right" ></TD>
						<TD align="right" ></TD>
						</tr>';	 
				 }
			} else{
					$nilai3=$nilai3+$nilai;
					$cRet .= '<tr>
					<td style="border-top:hidden;"></td>
					<td style="border-top:hidden;"></td>
					<td valign="top" style="border-top:hidden;">'.$kode.'</td>
					<td valign="top" align="right" style="border-top:hidden;">'.$nilaix.'</td>
					</tr>';
			  }
		}
		if($jns=='0'){
		$sql2 = "select sum(d.nilai) as nilai 
				from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' $AND2 and a.jns_spp='4'
				AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				";
		}else{
		$sql2 = "select sum(d.nilai) as nilai 
				from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' $AND2 and a.jns_spp !='4'
				AND (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				";	
		}
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",","."); 
		
		if($cetk=='1'){
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}else{
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}
		
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		 $data['prev']= $cRet;  
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Pembantu Pengeluaran</title>");
			 echo $cRet;
		}else if($print==1){
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=bk_keluar.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
		
	}

	
	function cetak_buku_kas_pembantu()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/ctk_bkp2',$data) ; 
    }
	
    function cari_spp()
	{
		
	$lccr =  $this->input->post('pencarian');
        $this->index('0','trhspp','no_spp','kd_skpd','SPP','spp',$lccr);
	}
    
	function index($offset=0,$lctabel,$field,$field1,$judul,$list,$lccari)
	{
		$data['page_title'] = " $judul";
		
		//$total_rows = $this->master_model->get_count($lctabel);
        if(empty($lccari)){
            $total_rows = $this->tukd_model->get_count($lctabel);
            $lc = "/.$lccari";
        }else{
            $total_rows = $this->tukd_model->get_count_teang($lctabel,$field,$field1,$lccari);
            $lc = "";
        }
		// pagination        
        if(empty($lccari)){
		$config['base_url']		= site_url("tukd/".$list);
        }else{
        $config['base_url']		= site_url("tukd/cari_".$list);    
        }
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	    //$data['isi']=$this->aktif_menu();
        //$data['isi']=$this->aktif_menu(); 
        //$data['isi']= $this->session->userdata('lcisi');         
		//$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
         if(empty($lccari)){     
		$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
        }else {
            $data['list'] 		= $this->master_model->getCari($lctabel,$field,$field1,$limit,$offset,$lccari);
        }
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		$a=$judul;
		$this->template->set('title', 'PENATAUSAHAAN ');
		$this->template->load('template', "tukd/".$list."/list", $data);
	}
    
    function backup()
    {
   	    $data['status_upload']= 'Backup Restore';
        $data['page_title']= 'Backup';
        $this->template->set('title', 'Backup');   
        $this->template->load('template','backup/backup',$data) ; 
    }
    
	function lamp_aset()
    {
        $data['page_title']= 'INPUT LAMP NERACA';
        $this->template->set('title', 'INPUT LAMP NERACA');   
        $this->template->load('template','tukd/transaksi/tambah_lamp_aset',$data) ; 
    }
	
	function cetak_lamp_aset()
    {
        $data['page_title']= 'CETAK LAMP NERACA';
        $this->template->set('title', 'CETAK LAMP NERACA');   
        $this->template->load('template','tukd/transaksi/cetak_lamp_aset',$data) ; 
    }
	
	
	function cetak_penyu_lamp_aset()
    {
        $data['page_title']= 'CETAK LAMP NERACA';
        $this->template->set('title', 'CETAK LAMP NERACA');   
        $this->template->load('template','tukd/transaksi/cetak_penyu_lamp_aset',$data) ; 
    }
	
	function cetak_umur_piutang()
    {
        $data['page_title']= 'CETAK ANALISIS UMUR PIUTANG';
        $this->template->set('title', 'CETAK ANALISIS UMUR PIUTANG');   
        $this->template->load('template','tukd/transaksi/cetak_umur_piutang',$data) ; 
    }
	
	
	function transfer(){
   	    $data['page_title']= 'Restore Transfer';
        $this->template->set('title', 'Restore Transfer');   
        $this->template->load('template','backup/transfer',$data) ; 
    }
    
	
    function sppls()
    {
        $data['page_title']= 'INPUT S P P';
        $this->template->set('title', 'INPUT S P P');   
        $this->template->load('template','tukd/spp/tambah_spp_ls',$data) ; 
    }
    
    function daftar_penguji()
    {
        $data['page_title']= 'INPUT DAFTAR PENGUJI';
        $this->template->set('title', 'INPUT DAFTAR PENGUJI');   
        $this->template->load('template','tukd/sp2d/daftar_penguji',$data) ; 
    }
    
    function register_pajak()
    {
        $data['page_title']= 'REGISTER POTONGAN PAJAK';
        $this->template->set('title', 'REGISTER POTONGAN PAJAK');   
        $this->template->load('template','tukd/register/register_pajak',$data) ; 
    }


    function sppup()
    {
        $data['page_title']= 'INPUT S P P U P';
        $this->template->set('title', 'INPUT S P P U P');   
        $this->template->load('template','tukd/spp/tambah_spp_up',$data) ; 
    }
    
	function terima_sp2d()
    {
        $data['page_title']= 'PENERIMAAN S P 2 D';
        $this->template->set('title', 'PENERIMAAN S P 2 D');   
        $this->template->load('template','tukd/sp2d/terima_sp2d',$data) ; 
    }
	
    function sppgu()
    {
        $data['page_title']= 'INPUT S P P G U';
        $this->template->set('title', 'INPUT S P P G U');   
        $this->template->load('template','tukd/spp/tambah_spp_gu',$data) ; 
    }

    function config_spp($jns2){
        $skpd     = $this->session->userdata('kdskpd');
		if($jns2=='BL'){
			$where = "and jns_spp in ('1','2','6')";
		}else{
			$where = "and jns_spp in ('3','4','5')";
		}
        $sql = "SELECT max(a.urut) as nilai FROM trhspp a WHERE a.kd_skpd = '$skpd' $where"; 
        $query1 = $this->db->query($sql);  
		
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(                                
                        'nomor' => $resulte['nilai'] + 1
                        );
                        
        }
        echo json_encode($result); 	
    }

    function cek_status_ang(){
        $tgl_spp = $this->input->post('tgl_cek');
        $skpd     = $this->session->userdata('kdskpd');
        $sql = "select case when statu=1 and status_sempurna=1 and status_ubah=1 and '$tgl_spp'>=tgl_dpa_ubah then 'Perubahan' 
				when statu=1 and status_sempurna=1 and status_ubah=1 and '$tgl_spp'>=tgl_dpa_sempurna and '$tgl_spp'<tgl_dpa_ubah then 'Penyempurnaan'
				when statu=1 and status_sempurna=1 and status_ubah=1 and '$tgl_spp'<tgl_dpa_sempurna then 'Penyusunan'
				when statu=1 and status_sempurna=1 and status_ubah=0 and '$tgl_spp'>=tgl_dpa_sempurna then 'Penyempurnaan' 
				when statu=1 and status_sempurna=1 and status_ubah=0 and '$tgl_spp'<tgl_dpa_sempurna then 'Penyusunan'
				when statu=1 and status_sempurna=0 and status_ubah=0 and '$tgl_spp'>=tgl_dpa then 'Penyusunan'
				else 'Penyusunan' end as anggaran from trhrka where kd_skpd ='$skpd'";
        $query1 = $this->db->query($sql);  
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'status_ang' => $resulte['anggaran']
                        );
                        $ii++;
        }
        echo json_encode($result);
    	$query1->free_result();   
    } 
    
	function ctk_umur_piutang($skpd='', $tahun='', $ctk=''){
    
		$lntahunang = $tahun;       
		$bulan = 12+1;
		$sql =  " select nm_skpd from ms_skpd where kd_skpd='$skpd'";
			$hasil = $this->db->query($sql);
            foreach ($hasil->result() as $row)
				{
					$nama_skpd = $row->nm_skpd;
				}
					
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH PROVINSI KALIMANTAN BARAT</b> <br>
					<b>".strtoupper($nama_skpd)."</b> <br>
                    <b>ANALISIS UMUR PIUTANG</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nama_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun<br>Penetapan</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bulan<br>Penetapan</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Piutang</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi<br>BPK</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Umur<br>Piutang</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kualitas<br>Piutang</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Taksiran<br>Piutang Tak<br>Tertagih</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Penyisihan<br>Piutang</td>
					<td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Nilai Buku<br>Piutang Tahun<br>$lntahunang</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                </tr>
				</thead>";
				
				$sql = "select '' no_lamp, kd_rek3 kode1, kd_rek3 kode, UPPER(nm_rek3) nama, '' lokasi, 0 tahun, 0 bulan, 0 jumlah, 0 sal_awal, 
						0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan, 0 umur_t, 0 umur_b, '' kualitas, 0 penyi_piu from lamp_aset where kd_rek3 
						in (113) and left(kd_rek5,5) not in ('11307') and kd_skpd='$skpd' and tahun<= $lntahunang
						union
						select '' no_lamp, LEFT(kd_rek5,5) kode1, LEFT(kd_rek5,5) kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) nama, 
						'' lokasi, 0 tahun, 0 bulan, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan, 0 umur_t, 
						0 umur_b, '' kualitas, 0 penyi_piu from lamp_aset where kd_rek3 
						in (113) and left(kd_rek5,5) not in ('11307') and kd_skpd='$skpd' and tahun<= $lntahunang
						union all
						select no_lamp, kode1, kode, nama, lokasi, tahun, bulan, jumlah,  sal_awal,  kurang,  
						tambah, tahun_n, koreksi, keterangan, umur_t, isnull(umur_b,1) umur_b, case when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)=0 then 'Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=0 and isnull(umur_b,1)>=1 then 'Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)>=1 then 'Kurang Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)=0 then 'Kurang Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)>=1 then 'Macet'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t>=6 then 'Macet'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)<=1 then 'Lancar'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 'Kurang Lancar'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 'Diragukan'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t>=1 then 'Macet'
						when kode1=1130407 then ''
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=0 then 'Lancar'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=1 then 'Kurang Lancar'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=2 then 'Diragukan'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)>=3 then 'Macet'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t>=1 then 'Macet'
						else 'Tidak Diketahui' end as kualitas,
						case when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=0 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t>=6 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)<=1 then
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi)* 0.5 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when kode1=1130407 then 0
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=2 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi)* 0.5 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)>=3 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						else 'Tidak Diketahui' end as penyi_piu 
						from
						(SELECT no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, lokasi, tahun, isnull(bulan,1) bulan, jumlah,   
						sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan, case when $bulan-isnull(bulan,1)=12 then $lntahunang-tahun+1 else $lntahunang-tahun end 
						as umur_t, case when $bulan-isnull(bulan,1)=12 then 0 else $bulan-isnull(bulan,1) end as umur_b FROM lamp_aset where kd_rek3 
						in (113) and left(kd_rek5,5) not in ('11307') and kd_skpd ='$skpd' and tahun<= $lntahunang) a
						union all
						select 'x' no_lamp, LEFT(kode1,5)+'988' kode1, '' kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kode1,5)) nama, 
						'' lokasi, 0 tahun, 0 bulan, 0 jumlah, sum(sal_awal) sal_awal, sum(kurang) kurang, 
						sum(tambah) tambah, sum(tahun_n) tahun_n, sum(koreksi) koreksi, '' keterangan, 0 umur_t, 
						0 umur_b, '' kualitas, sum(penyi_piu) penyi_piu
						from (select kode1, kode, nama, lokasi, tahun, bulan, jumlah,  sal_awal, kurang,  
						tambah, tahun_n, koreksi, keterangan, umur_t, isnull(umur_b,1) umur_b, case when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)=0 then 'Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=0 and isnull(umur_b,1)>=1 then 'Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)>=1 then 'Kurang Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)=0 then 'Kurang Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)>=1 then 'Macet'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t>=6 then 'Macet'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)<=1 then 'Lancar'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 'Kurang Lancar'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 'Diragukan'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t>=1 then 'Macet'
						when kode1=1130407 then ''
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=0 then 'Lancar'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=1 then 'Kurang Lancar'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=2 then 'Diragukan'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)>=3 then 'Macet'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t>=1 then 'Macet'
						else 'Tidak Diketahui' end as kualitas,
						case when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=0 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t>=6 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)<=1 then
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi)* 0.5 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when kode1=1130407 then 0
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=2 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi)* 0.5 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)>=3 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						else 'Tidak Diketahui' end as penyi_piu 
						from
						(SELECT no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, lokasi, tahun, isnull(bulan,1) bulan, jumlah,   
						sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan, case when $bulan-isnull(bulan,1)=12 then $lntahunang-tahun+1 else $lntahunang-tahun end 
						as umur_t, case when $bulan-isnull(bulan,1)=12 then 0 else $bulan-isnull(bulan,1) end as umur_b FROM lamp_aset where kd_rek3 
						in (113) and left(kd_rek5,5) not in ('11307') and kd_skpd ='$skpd' and tahun<= $lntahunang) a) a group by left(kode1,5)
						union all
						select 'xx' no_lamp, '99999999' kode1, '' kode, 'TOTAL PIUTANG PENDAPATAN' nama, 
						'' lokasi, 0 tahun, 0 bulan, 0 jumlah, sum(sal_awal) sal_awal, sum(kurang) kurang, 
						sum(tambah) tambah, sum(tahun_n) tahun_n, sum(koreksi) koreksi, '' keterangan, 0 umur_t, 
						0 umur_b, '' kualitas, sum(penyi_piu) penyi_piu
						from (select kode1, kode, nama, lokasi, tahun, bulan, jumlah,  sal_awal, kurang,  
						tambah, tahun_n, koreksi, keterangan, umur_t, isnull(umur_b,1) umur_b, case when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)=0 then 'Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=0 and isnull(umur_b,1)>=1 then 'Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)>=1 then 'Kurang Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)=0 then 'Kurang Lancar'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)>=1 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)=0 then 'Diragukan'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)>=1 then 'Macet'
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t>=6 then 'Macet'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)<=1 then 'Lancar'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 'Kurang Lancar'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 'Diragukan'
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t>=1 then 'Macet'
						when kode1=1130407 then ''
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=0 then 'Lancar'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=1 then 'Kurang Lancar'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=2 then 'Diragukan'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)>=3 then 'Macet'
						when (left(kode1,5) not in (11301,11302,1130410) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t>=1 then 'Macet'
						else 'Tidak Diketahui' end as kualitas,
						case when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=0 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=1 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=2 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=3 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=4 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.5 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t=5 and isnull(umur_b,1)>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5)=11301 or kode1=1130405) and umur_t>=6 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)<=1 then
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi)* 0.5 as decimal(20,2))
						when (left(kode1,5)=11302 or kode1 in (1130406,1130410)) and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when kode1=1130407 then 0
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=0 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.005 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 0.1 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)=2 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi)* 0.5 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t=0 and isnull(umur_b,1)>=3 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						when (left(kode1,5) not in (11301,11302) or kode1 not in (1130405,1130406,1130410,1130407)) and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n+koreksi) * 1 as decimal(20,2))
						else 'Tidak Diketahui' end as penyi_piu 
						from
						(SELECT no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, lokasi, tahun, isnull(bulan,1) bulan, jumlah,   
						sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan, case when $bulan-isnull(bulan,1)=12 then $lntahunang-tahun+1 else $lntahunang-tahun end 
						as umur_t, case when $bulan-isnull(bulan,1)=12 then 0 else $bulan-isnull(bulan,1) end as umur_b FROM lamp_aset where kd_rek3 
						in (113) and left(kd_rek5,5) not in ('11307') and kd_skpd ='$skpd' and tahun<= $lntahunang) a) a
						union
						select '' no_lamp, LEFT(kd_rek5,5)+'9999' kode1, '' kode, '' nama, '' lokasi, 0 tahun, 0 bulan, 0 jumlah, 0 sal_awal, 
						0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan, 0 umur_t, 0 umur_b, '' kualitas, 0 penyi_piu from lamp_aset where kd_rek3 
						in (113) and left(kd_rek5,5) not in ('11307') and kd_skpd='$skpd' and tahun<= $lntahunang
						order by kode1, tahun, bulan  
";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode1 = $row->kode1;
                       $kode = $row->kode;
					   $nama = $row->nama;
					   $bln = $row->bulan;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
                       $audited = $akhir+$koreksi;
                       $keterangan = $row->keterangan;
					   $umur_t = $row->umur_t;
					   $umur_b = $row->umur_b;
					   $kualitas = $row->kualitas;
					   $penyi_piu = $row->penyi_piu;
					   $nilai_piu = $audited-$penyi_piu;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $bln==0 ? $bln = '' : $bln=number_format($bln,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $umur_t==0 ? $umur_t = '' : $umur_t=number_format($umur_t,"0",",",".");
					   $umur_b==0 ? $umur_b = '' : $umur_b=number_format($umur_b,"0",",",".");
					   
					   if ($umur_b==0 && strlen($kode1)==7){$umur_piu=$umur_t." Tahun";}
					   elseif ($umur_t==0 && strlen($kode1)==7){$umur_piu=$umur_b." Bulan";}
					   elseif (strlen($kode1)!=7){$umur_piu = '';}
					   else {$umur_piu=$umur_t." Tahun " .$umur_b. " Bulan";}
					   
					   if($kualitas=='Lancar'){
					   $taksiran="0,5%";}
					   elseif($kualitas=='Kurang Lancar'){
					   $taksiran="10%";}
					   elseif($kualitas=='Diragukan'){
					   $taksiran="50%";}
					   elseif($kualitas==''){
					   $taksiran="";}
					   else{
					   $taksiran="100%";}
						
					   if (strlen($kode1)==7){$tahun=$tahun;}
					   else {$tahun = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$akhir=number_format($akhir,"2",",",".");}
					   else {$akhir = '';}
					   
					   if (strlen($kode1)==7){$taksiran=$taksiran;}
					   else {$taksiran = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$penyi_piu=number_format($penyi_piu,"2",",",".");}
					   else {$penyi_piu = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$nilai_piu=number_format($nilai_piu,"2",",",".");}
					   else {$nilai_piu = '';}
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   if (strlen($kode1)==7 || strlen($kode1)==8){$koreksi=number_format($koreksi,"2",",",".");}
					   else {$koreksi = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$audited=number_format($audited,"2",",",".");}
					   else {$audited = '';}
					   
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$bln</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$umur_piu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kualitas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$taksiran</td> 
							   <td align=\"center\" style=\"font-size:12px\">$penyi_piu</td>
							   <td align=\"center\" style=\"font-size:12px\">$nilai_piu</td> 
							</tr>";    
                    }
				
				/* if($ctk==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,0,1,'');
} */

		$data['prev']= $cRet;
		$judul  = "Analisis_Umur_Piutang_$skpd";
        $this->template->set('title', 'UMUR PIUTANG $tahun');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>UMUR PIUTANG $tahun</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
    
	function ctk_lamp_aset($skpd='',$rek3='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');       
        if($rek3==15){
			$nama_rek='Aset Lainnya';
		}else{
			$nama_rek=$this->tukd_model->get_nama($rek3,'nm_rek3','ms_rek3_64','kd_rek3');
		}
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');  
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH PROVINSI KALIMANTAN BARAT</b> <br>
                    <b>RINCIAN NERACA ".strtoupper($nama_rek)."</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		if ($rek3==131){
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Sertifikat</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
				</tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) AS kode1, LEFT(kd_rek5,5) AS kode,(SELECT UPPER(nm_rek4_64) FROM ms_rek4_64 WHERE kd_rek4_64 = LEFT(kd_rek5,5)) AS nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset  where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (kd_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  sert, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' AS kode1, '' AS kode,(SELECT 'TOTAL '+UPPER(nm_rek4_64) FROM ms_rek4_64 WHERE kd_rek4_64 = LEFT(kd_rek5,5)) AS nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $sert = $row->sert;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
			
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sert</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
                    }
					
				$sql = "SELECT   SUM(sal_awal) as sal_awal,  sum(kurang) as kurang,  SUM(tambah) as tambah, sum(tahun_n) as tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }
					   
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL TANAH</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
                    }	
					
					
				$cRet .="</table>";
				} else if (($rek3==133) or ($rek3==136) or ($rek3==134)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\"  bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\"  bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\"  bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                    }
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
                    }
				$cRet .="</table>";
				}else if ($rek3==132){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No Polisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\"  bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\"  bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\"  bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,'' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1,kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}  
				$sql = "SELECT SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL PERALATAN DAN MESIN</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==117){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"4\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">X</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, 0 jumlah, 0 jumlah_akhir, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, 0 jumlah_akhir, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk,0 jumlah, 0 jumlah_akhir,'' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, jumlah, kondisi_b+kondisi_rr+kondisi_rb jumlah_akhir, satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb, kondisi_x, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, 0 jumlah_akhir, '' satuan, 0 harga_satuan,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $jumlah = $row->jumlah;
                       $jumlah_akhir = $row->jumlah_akhir;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $kondisi_x = $row->kondisi_x;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   //$jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   if($jumlah==0){
							$jumlah='';
					   }else if(stripos($jumlah, '.00') !== FALSE){
							$jumlah=number_format($jumlah,"0",",",".");
					   }else{
							$jumlah=number_format($jumlah,1);
					   }
					   
					   if($jumlah_akhir==0){
							$jumlah_akhir='';
					   }else if(stripos($jumlah_akhir, '.00') !== FALSE){
							$jumlah_akhir=number_format($jumlah_akhir,"0",",",".");
					   }else{
							$jumlah_akhir=number_format($jumlah_akhir,1);
					   }
					   
					   if($kondisi_b==0){
							$kondisi_b='';
					   }else if(stripos($kondisi_b, '.00') !== FALSE){
							$kondisi_b=number_format($kondisi_b,"0",",",".");
					   }else{
							$kondisi_b=number_format($kondisi_b,1);
					   }
					   
					   if($kondisi_rr==0){
							$kondisi_rr='';
					   }else if(stripos($kondisi_rr, '.00') !== FALSE){
							$kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   }else{
							$kondisi_rr=number_format($kondisi_rr,1);
					   }
					   
					   if($kondisi_rb==0){
							$kondisi_rb='';
					   }else if(stripos($kondisi_rb, '.00') !== FALSE){
							$kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   }else{
							$kondisi_rb=number_format($kondisi_rb,1);
					   }
					   
					   if($kondisi_x==0){
							$kondisi_x='';
					   }else if(stripos($kondisi_x, '.00') !== FALSE){
							$kondisi_x=number_format($kondisi_x,"0",",",".");
					   }else{
							$kondisi_x=number_format($kondisi_x,1);
					   }
					   
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_x</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}	
				$cRet .="</table>";
				}else if ($rek3==135){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}	
				$cRet .="</table>";
				}else if ($rek3==116){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun<br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jenis Aset</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nama<br>Perusahaan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nomor<br>Perjanjian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Realisasi<br>Perjanjian</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tanggal Jatuh<br>Tempo</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Waktu<br>Perjanjian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Sisa Hari<br>Perjanjian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Akhir</td>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' tahun, '' jenis_aset, '' nama_perusahaan, '' no_polis, 0 realisasi_janji, '' tgl_awal, '' tgl_akhir, '' jam, 0 sisa_hari, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' tahun, '' jenis_aset, '' nama_perusahaan, '' no_polis, 0 realisasi_janji, '' tgl_awal, '' tgl_akhir, '' jam, 0 sisa_hari, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jenis_aset, nama_perusahaan, no_polis, realisasi_janji, cast(tgl_awal as char(10)) tgl_awal, cast(tgl_akhir as char(10)) tgl_akhir, jam, case when (DateDiff (Day,tgl_awal,tgl_akhir)-DateDiff (Day,tgl_awal,'$lntahunang-12-31')) < 0 then 0 else (DateDiff (Day,tgl_awal,tgl_akhir)-DateDiff (Day,tgl_awal,'$lntahunang-12-31')) end as sisa_hari, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' tahun, '' jenis_aset, '' nama_perusahaan, '' no_polis, 0 realisasi_janji, '' tgl_awal, '' tgl_akhir, '' jam, 0 sisa_hari,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jenis_aset = $row->jenis_aset;
                       $nama_perusahaan = $row->nama_perusahaan;
					   $no_polis = $row->no_polis;
                       $realisasi_janji = $row->realisasi_janji;
                       $tgl_awal = $row->tgl_awal;
                       $tgl_akhir = $row->tgl_akhir;
                       $jam = $row->jam;
                       $sisa_hari = $row->sisa_hari;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $no_lamp = $row->no_lamp;
					   
					   $hh				= substr($jam,0,2);
					   $mm				= substr($jam,3,5);
					   $jam_std			= ((12-$hh)*3600)+((-$mm)*60);
					   
					   //$ta_awal 		= substr($tgl_awal,0,4);
					   //$ta_akhir 		= substr($tgl_akhir,0,4);
					   
					   if($jam_std<=0 && $sisa_hari!=0){
					   $sisa_hari=$sisa_hari-0.5;
					   } else if($jam_std>0 && $sisa_hari!=0){
					   $sisa_hari=$sisa_hari;
					   } else{
					   $sisa_hari=0;
					   }
					   
					   
					   $realisasi_janji==0 ? $realisasi_janji = '' : $realisasi_janji=number_format($realisasi_janji,"2",",",".");
					   
					   if($no_lamp==''){
					   $sisa_hari='';
					   }
					   else if($no_lamp=='x'){
					   $sisa_hari='';
					   } else{
					   $sisa_hari=number_format($sisa_hari,"0",",",".");
					   }
					   
					   if($tgl_awal==''){
					   $tgl_awal='';
					   } else{
					   $tgl_awal=$this->tukd_model->tanggal_ind($tgl_awal);
					   }
					   
					   if($tgl_akhir==''){
					   $tgl_akhir='';
					   } else{
					   $tgl_akhir=$this->tukd_model->tanggal_ind($tgl_akhir);
					   }
					   					   
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jenis_aset</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nama_perusahaan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polis</td> 
							   <td align=\"right\" style=\"font-size:12px\">$realisasi_janji</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tgl_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tgl_akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jam</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sisa_hari</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					} 
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah,SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>  
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}			
				$cRet .="</table>";
				}else if ($rek3==114){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Piutang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Piutang<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
					<td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Koreksi</td>
					<td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Sudah</td>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jumlah,  piutang_awal, piutang_koreksi, piutang_sudah, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $piutang_awal = $row->piutang_awal;
                       $piutang_koreksi = $row->piutang_koreksi;
                       $piutang_sudah = $row->piutang_sudah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $piutang_awal==0 ? $piutang_awal = '' : $piutang_awal=number_format($piutang_awal,"2",",",".");
					   $piutang_koreksi==0 ? $piutang_koreksi = '' : $piutang_koreksi=number_format($piutang_koreksi,"2",",",".");
					   $piutang_sudah==0 ? $piutang_sudah = '' : $piutang_sudah=number_format($piutang_sudah,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_koreksi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_sudah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==113){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Piutang<br>Awal</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Piutang<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, lokasi, tahun, jumlah,  piutang_awal, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $piutang_awal = $row->piutang_awal;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $piutang_awal==0 ? $piutang_awal = '' : $piutang_awal=number_format($piutang_awal,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"left\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}		
				$cRet .="</table>";
				}else if (($rek3==112) or ($rek3==121) or ($rek3==122)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Dasar<br>Hukum</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kepemilikan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Investasi<br>Awal</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Investasi<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, hukum, tahun, kepemilikan, jumlah,  investasi_awal, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $hukum = $row->hukum;
                       $jumlah = $row->jumlah;
                       $kepemilikan = $row->kepemilikan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $investasi_awal = $row->investasi_awal;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $investasi_awal==0 ? $investasi_awal = '' : $investasi_awal=number_format($investasi_awal,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"left\" style=\"font-size:12px\">$hukum</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kepemilikan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$investasi_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
					
					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==111){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Setoran<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td>

                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama,  ''  tahun,  0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jumlah, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama,  ''  tahun,  0 jumlah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}   
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}	
				
				$cRet .="</table>";
				}else if ($rek3==141){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Dasar<br>Hukum</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td>
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' hukum, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  hukum, jumlah, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' hukum,0 jumlah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $hukum = $row->hukum;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$hukum</td>
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td>
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}

					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}	
									
				$cRet .="</table>";
					
					
				} else if (($rek3==151) or ($rek3==152) or ($rek3==153) or ($rek3==154)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $fungsi = $row->fungsi;
                       $alamat = $row->alamat;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                    
					
					}
					
					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,SUM(kurang) kurang,SUM(tambah) tambah,SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}    
                        
										
				$cRet .="</table>";
				}else if ($rek3==15){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">Bertambah</td>
					<td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek2 as kode1, kd_rek2 as kode, nm_rek2 as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM ms_rek2_64 where kd_rek2='$rek3'
						UNION
						SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, nm_rek3 as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT nm_rek4_64 from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, case when (kd_rek6<>'') then kd_rek5 end as kode1, case when (kd_rek6<>'') then kd_rek5 end as kode, case when (kd_rek6<>'') then nm_rek5 end as nama, case when (kd_rek6<>'') then '' end tahun,  case when (kd_rek6<>'') then '' end merk, case when (kd_rek6<>'') then '' end no_polisi, case when (kd_rek6<>'') then '' end fungsi, case when (kd_rek6<>'') then '' end lokasi, case when (kd_rek6<>'') then '' end alamat, case when (kd_rek6<>'') then 0 end jumlah, case when (kd_rek6<>'') then '' end satuan, case when (kd_rek6<>'') then 0 end harga_satuan,  case when (kd_rek6<>'') then 0 end sal_awal, case when (kd_rek6<>'') then 0 end kurang, case when (kd_rek6<>'') then 0 end tambah, case when (kd_rek6<>'') then 0 end tahun_n, case when (kd_rek6<>'') then 0 end koreksi, case when (kd_rek6<>'') then '' end kondisi_b, case when (kd_rek6<>'') then '' end kondisi_rr, case when (kd_rek6<>'') then '' end kondisi_rb, case when (kd_rek6<>'') then '' end keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
					$total_sal_awal=0;
                    foreach ($hasil->result() as $row)
                    {
					   $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $fungsi = $row->fungsi;
                       $alamat = $row->alamat;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $total_sal_awal=$total_sal_awal + $sal_awal;
					   //$total_sal_awal=number_format($total_sal_awal,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
				$sql = "SELECT (SELECT UPPER(nm_rek2) from ms_rek2_64 where kd_rek2 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah)  tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
					$total_sal_awal=0;
                    foreach ($hasil->result() as $row)
                    {
					  
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $total_sal_awal=$total_sal_awal + $sal_awal;
					   //$total_sal_awal=number_format($total_sal_awal,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else{
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:12px\" align=\"center\">
                    BELUM ADA CETAKAN                                        
                    </td>           
                </tr>
				</table>";
					
				}
				

		$data['prev']= $cRet;
		$judul  = "Laporan_Lampiran_Aset_$skpd";
        $this->template->set('title', 'Rincian Neraca $nama_rek');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
	
	function ctk_no_lamp_aset($skpd='',$rek3='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');       
        if($rek3==15){
			$nama_rek='Aset Lainnya';
		}else{
			$nama_rek=$this->tukd_model->get_nama($rek3,'nm_rek3','ms_rek3_64','kd_rek3');
		}
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');  
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH PROVINSI KALIMANTAN BARAT</b> <br>
                    <b>RINCIAN NERACA ".strtoupper($nama_rek)."</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		if ($rek3==131){
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No. Sertifikat</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" width=\"5%\"  bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
				</tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) AS kode1, LEFT(kd_rek5,5) AS kode,(SELECT UPPER(nm_rek4_64) FROM ms_rek4_64 WHERE kd_rek4_64 = LEFT(kd_rek5,5)) AS nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset  where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (kd_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  sert, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' AS kode1, '' AS kode,(SELECT 'TOTAL '+UPPER(nm_rek4_64) FROM ms_rek4_64 WHERE kd_rek4_64 = LEFT(kd_rek5,5)) AS nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $sert = $row->sert;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
			
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sert</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
                    }
					
				$sql = "SELECT   SUM(sal_awal) as sal_awal,  sum(kurang) as kurang,  SUM(tambah) as tambah, sum(tahun_n) as tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }
					   
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL TANAH</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
                    }	
					
					
				$cRet .="</table>";
				} else if (($rek3==133) or ($rek3==136) or ($rek3==134)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                    }
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
                    }
				$cRet .="</table>";
				}else if ($rek3==132){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No Polisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,'' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1,kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}  
				$sql = "SELECT SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL PERALATAN DAN MESIN</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==117){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"4\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">X</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, 0 jumlah, 0 jumlah_akhir, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, 0 jumlah_akhir, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk,0 jumlah, 0 jumlah_akhir,'' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, jumlah, kondisi_b+kondisi_rr+kondisi_rb jumlah_akhir, satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb, kondisi_x, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, 0 jumlah_akhir, '' satuan, 0 harga_satuan,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, 0 kondisi_x, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $jumlah = $row->jumlah;
                       $jumlah_akhir = $row->jumlah_akhir;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $kondisi_x = $row->kondisi_x;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   //$jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   if($jumlah==0){
							$jumlah='';
					   }else if(stripos($jumlah, '.00') !== FALSE){
							$jumlah=number_format($jumlah,"0",",",".");
					   }else{
							$jumlah=number_format($jumlah,1);
					   }
					   
					   if($jumlah_akhir==0){
							$jumlah_akhir='';
					   }else if(stripos($jumlah_akhir, '.00') !== FALSE){
							$jumlah_akhir=number_format($jumlah_akhir,"0",",",".");
					   }else{
							$jumlah_akhir=number_format($jumlah_akhir,1);
					   }
					   
					   if($kondisi_b==0){
							$kondisi_b='';
					   }else if(stripos($kondisi_b, '.00') !== FALSE){
							$kondisi_b=number_format($kondisi_b,"0",",",".");
					   }else{
							$kondisi_b=number_format($kondisi_b,1);
					   }
					   
					   if($kondisi_rr==0){
							$kondisi_rr='';
					   }else if(stripos($kondisi_rr, '.00') !== FALSE){
							$kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   }else{
							$kondisi_rr=number_format($kondisi_rr,1);
					   }
					   
					   if($kondisi_rb==0){
							$kondisi_rb='';
					   }else if(stripos($kondisi_rb, '.00') !== FALSE){
							$kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   }else{
							$kondisi_rb=number_format($kondisi_rb,1);
					   }
					   
					   if($kondisi_x==0){
							$kondisi_x='';
					   }else if(stripos($kondisi_x, '.00') !== FALSE){
							$kondisi_x=number_format($kondisi_x,"0",",",".");
					   }else{
							$kondisi_x=number_format($kondisi_x,1);
					   }
					   
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_x</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}	
				$cRet .="</table>";
				}
				else if ($rek3==135){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   //$jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   if($jumlah==0){
							$jumlah='';
					   }else if(stripos($jumlah, '.00') !== FALSE){
							$jumlah=number_format($jumlah,"0",",",".");
					   }else{
							$jumlah=number_format($jumlah,1);
					   }
					   
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}	
				$cRet .="</table>";
				}else if ($rek3==116){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun<br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jenis Aset</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nama<br>Perusahaan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nomor<br>Perjanjian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Realisasi<br>Perjanjian</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tanggal Jatuh<br>Tempo</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Waktu<br>Perjanjian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Sisa Hari<br>Perjanjian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Akhir</td>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' tahun, '' jenis_aset, '' nama_perusahaan, '' no_polis, 0 realisasi_janji, '' tgl_awal, '' tgl_akhir, '' jam, 0 sisa_hari, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' tahun, '' jenis_aset, '' nama_perusahaan, '' no_polis, 0 realisasi_janji, '' tgl_awal, '' tgl_akhir, '' jam, 0 sisa_hari, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jenis_aset, nama_perusahaan, no_polis, realisasi_janji, cast(tgl_awal as char(10)) tgl_awal, cast(tgl_akhir as char(10)) tgl_akhir, jam, case when (DateDiff (Day,tgl_awal,tgl_akhir)-DateDiff (Day,tgl_awal,'$lntahunang-12-31')) < 0 then 0 else (DateDiff (Day,tgl_awal,tgl_akhir)-DateDiff (Day,tgl_awal,'$lntahunang-12-31')) end as sisa_hari, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' tahun, '' jenis_aset, '' nama_perusahaan, '' no_polis, 0 realisasi_janji, '' tgl_awal, '' tgl_akhir, '' jam, 0 sisa_hari,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jenis_aset = $row->jenis_aset;
                       $nama_perusahaan = $row->nama_perusahaan;
					   $no_polis = $row->no_polis;
                       $realisasi_janji = $row->realisasi_janji;
                       $tgl_awal = $row->tgl_awal;
                       $tgl_akhir = $row->tgl_akhir;
                       $jam = $row->jam;
                       $sisa_hari = $row->sisa_hari;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $no_lamp = $row->no_lamp;
					   
					   $hh				= substr($jam,0,2);
					   $mm				= substr($jam,3,5);
					   $jam_std			= ((12-$hh)*3600)+((-$mm)*60);
					   
					   //$ta_awal 		= substr($tgl_awal,0,4);
					   //$ta_akhir 		= substr($tgl_akhir,0,4);
					   
					   if($jam_std<=0 && $sisa_hari!=0){
					   $sisa_hari=$sisa_hari-0.5;
					   } else if($jam_std>0 && $sisa_hari!=0){
					   $sisa_hari=$sisa_hari;
					   } else{
					   $sisa_hari=0;
					   }
					   
					   
					   $realisasi_janji==0 ? $realisasi_janji = '' : $realisasi_janji=number_format($realisasi_janji,"2",",",".");
					   
					   if($no_lamp==''){
					   $sisa_hari='';
					   }
					   else if($no_lamp=='x'){
					   $sisa_hari='';
					   } else{
					   $sisa_hari=number_format($sisa_hari,"0",",",".");
					   }
					   
					   if($tgl_awal==''){
					   $tgl_awal='';
					   } else{
					   $tgl_awal=$this->tukd_model->tanggal_ind($tgl_awal);
					   }
					   
					   if($tgl_akhir==''){
					   $tgl_akhir='';
					   } else{
					   $tgl_akhir=$this->tukd_model->tanggal_ind($tgl_akhir);
					   }
					   					   
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jenis_aset</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nama_perusahaan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polis</td> 
							   <td align=\"right\" style=\"font-size:12px\">$realisasi_janji</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tgl_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tgl_akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jam</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sisa_hari</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					} 
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah,SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>  
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}			
				$cRet .="</table>";
				}else if ($rek3==114){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Piutang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Piutang<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Sudah</td>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jumlah,  piutang_awal, piutang_koreksi, piutang_sudah, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $piutang_awal = $row->piutang_awal;
                       $piutang_koreksi = $row->piutang_koreksi;
                       $piutang_sudah = $row->piutang_sudah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $piutang_awal==0 ? $piutang_awal = '' : $piutang_awal=number_format($piutang_awal,"2",",",".");
					   $piutang_koreksi==0 ? $piutang_koreksi = '' : $piutang_koreksi=number_format($piutang_koreksi,"2",",",".");
					   $piutang_sudah==0 ? $piutang_sudah = '' : $piutang_sudah=number_format($piutang_sudah,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_koreksi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_sudah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==113){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\"  align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Piutang<br>Awal</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Piutang<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, lokasi, tahun, jumlah,  piutang_awal, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $piutang_awal = $row->piutang_awal;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $piutang_awal==0 ? $piutang_awal = '' : $piutang_awal=number_format($piutang_awal,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"left\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}		
				$cRet .="</table>";
				}else if (($rek3==112) or ($rek3==121) or ($rek3==122)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Dasar<br>Hukum</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kepemilikan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Investasi<br>Awal</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Investasi<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, hukum, tahun, kepemilikan, jumlah,  investasi_awal, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $hukum = $row->hukum;
                       $jumlah = $row->jumlah;
                       $kepemilikan = $row->kepemilikan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $investasi_awal = $row->investasi_awal;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $investasi_awal==0 ? $investasi_awal = '' : $investasi_awal=number_format($investasi_awal,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"left\" style=\"font-size:12px\">$hukum</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kepemilikan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$investasi_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
					
					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==111){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Setoran<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td>

                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama,  ''  tahun,  0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jumlah, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama,  ''  tahun,  0 jumlah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}   
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
					";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}	
				
				$cRet .="</table>";
				}else if ($rek3==141){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Dasar<br>Hukum</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td>
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' hukum, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  hukum, jumlah, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' hukum,0 jumlah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $hukum = $row->hukum;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$hukum</td>
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td>
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}

					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
					";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}	
									
				$cRet .="</table>";
					
					
				} else if (($rek3==151) or ($rek3==152) or ($rek3==153) or ($rek3==154)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">23</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $fungsi = $row->fungsi;
                       $alamat = $row->alamat;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                    
					
					}
					
					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,SUM(kurang) kurang,SUM(tambah) tambah,SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}    
                        
										
				$cRet .="</table>";
				}else if ($rek3==15){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Lampiran</td>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">23</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek2 as kode1, kd_rek2 as kode, nm_rek2 as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM ms_rek2_64 where kd_rek2='$rek3'
						UNION
						SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, nm_rek3 as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT nm_rek4_64 from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, case when (kd_rek6<>'') then kd_rek5 end as kode1, case when (kd_rek6<>'') then kd_rek5 end as kode, case when (kd_rek6<>'') then nm_rek5 end as nama, case when (kd_rek6<>'') then '' end tahun,  case when (kd_rek6<>'') then '' end merk, case when (kd_rek6<>'') then '' end no_polisi, case when (kd_rek6<>'') then '' end fungsi, case when (kd_rek6<>'') then '' end lokasi, case when (kd_rek6<>'') then '' end alamat, case when (kd_rek6<>'') then 0 end jumlah, case when (kd_rek6<>'') then '' end satuan, case when (kd_rek6<>'') then 0 end harga_satuan,  case when (kd_rek6<>'') then 0 end sal_awal, case when (kd_rek6<>'') then 0 end kurang, case when (kd_rek6<>'') then 0 end tambah, case when (kd_rek6<>'') then 0 end tahun_n, case when (kd_rek6<>'') then 0 end koreksi, case when (kd_rek6<>'') then '' end kondisi_b, case when (kd_rek6<>'') then '' end kondisi_rr, case when (kd_rek6<>'') then '' end kondisi_rb, case when (kd_rek6<>'') then '' end keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
					$total_sal_awal=0;
                    foreach ($hasil->result() as $row)
                    {
					   $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $fungsi = $row->fungsi;
                       $alamat = $row->alamat;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $total_sal_awal=$total_sal_awal + $sal_awal;
					   //$total_sal_awal=number_format($total_sal_awal,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$no_lamp</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
				$sql = "SELECT (SELECT UPPER(nm_rek2) from ms_rek2_64 where kd_rek2 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah)  tambah, SUM(tahun_n) tahun_n, sum(isnull(korplus,0)-isnull(kormin,0)) koreksi FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
					$total_sal_awal=0;
                    foreach ($hasil->result() as $row)
                    {
					  
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $total_sal_awal=$total_sal_awal + $sal_awal;
					   //$total_sal_awal=number_format($total_sal_awal,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else{
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:12px\" align=\"center\">
                    BELUM ADA CETAKAN                                        
                    </td>           
                </tr>
				</table>";
					
				}
				

		$data['prev']= $cRet;
		$judul  = "Laporan_Lampiran_Aset_$skpd";
        $this->template->set('title', 'Rincian Neraca $nama_rek');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
	
	function ctk_amortisasi($skpd='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');       
        
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
		$rek3 = 153;
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH PROVINSI KALIMANTAN BARAT</b> <br>
                    <b>AMORTISASI ASET TIDAK BERWUJUD</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Akumulasi Amortisasi Per<br>01 Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Amortisasi <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">23</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">24</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">25</td>
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyuk, 0 akum_penyub, '' status, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyuk, 0 akum_penyub, '' status, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when status in ('9','10') then akum_penyub when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu, case when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when len(tahun)<>4 then 0 when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-(case when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi and status not in ('9','10') then akum_penyuk when tambah=sal_awal+tambah-kurang+tahun_n+koreksi and status not in ('9','10') then akum_penyuk when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi and status in ('9','10') then akum_penyub when tambah=sal_awal+tambah-kurang+tahun_n+koreksi and status in ('9','10') then akum_penyub else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*a.usia as decimal(20,0)) end) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah, satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_amortisasi where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(akum_penyu,0) akum_penyuk, isnull(akum_penyub,0) akum_penyub, status FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT '' no_lamp, LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, '' masa, '' usia, sum(akum_penyuk) akum_penyuk, sum(akum_penyub) akum_penyub, '' status, sum(akum_penyu) akum_penyu, sum(akum_penyu_n) akum_penyu_n, sum(nilai_buku) nilai_buku FROM (
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when status in ('9','10') then akum_penyub when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu, case when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when len(tahun)<>4 then 0 when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-(case when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi and status not in ('9','10') then akum_penyuk when tambah=sal_awal+tambah-kurang+tahun_n+koreksi and status not in ('9','10') then akum_penyuk when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi and status in ('9','10') then akum_penyub when tambah=sal_awal+tambah-kurang+tahun_n+koreksi and status in ('9','10') then akum_penyub else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*a.usia as decimal(20,0)) end) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah, satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_amortisasi where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(akum_penyu,0) akum_penyuk, isnull(akum_penyub,0) akum_penyub, status FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode1 = $row->kode1;
					   $kode = $row->kode;
                       $nama = $row->nama;
					   $merk = $row->merk;
                       $tahun = $row->tahun;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
					   $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $usia = $row->usia;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   if (strlen($kode1)>7){$akhir=number_format($akhir,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akhir==0) {$akhir = '';}
					   else{$akhir=number_format($akhir,"2",",",".");}
					   if (strlen($kode1)>7){$akum_penyuk=number_format($akum_penyuk,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akum_penyuk==0) {$akum_penyuk = '';}
					   else{$akum_penyuk=number_format($akum_penyuk,"2",",",".");}
					   if (strlen($kode1)>7){$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akum_penyu==0) {$akum_penyu = '';}
					   else{$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   if (strlen($kode1)>7){$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akum_penyu_n==0) {$akum_penyu_n = '';}
					   else{$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   if (strlen($kode1)>7){$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   elseif(strlen($kode1)<7 && $nilai_buku==0) {$nilai_buku = '';}
					   else{$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td>
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                    }
				$sql = "SELECT '' no_lamp, (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(akum_penyuk) akum_penyuk, SUM(akum_penyub) akum_penyub, '' status, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) as akum_penyu_n, SUM(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when status in ('9','10') then akum_penyub when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu, case when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when len(tahun)<>4 then 0 when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-(case when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi and status not in ('9','10') then akum_penyuk when tambah=sal_awal+tambah-kurang+tahun_n+koreksi and status not in ('9','10') then akum_penyuk when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi and status in ('9','10') then akum_penyub when tambah=sal_awal+tambah-kurang+tahun_n+koreksi and status in ('9','10') then akum_penyub else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*a.usia as decimal(20,0)) end) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah, satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_amortisasi where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(akum_penyu,0) akum_penyuk, isnull(akum_penyub,0) akum_penyub, status FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   
					   $akhir=number_format($akhir,"2",",",".");
					   $akum_penyuk=number_format($akum_penyuk,"2",",",".");
					   $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku=number_format($nilai_buku,"2",",",".");
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
                    }
				$cRet .="</table>";

		$data['prev']= $cRet;
		$judul  = "Laporan_Amortisasi_$skpd";
        $this->template->set('title', 'Rincian Neraca Akumulasi Amortisasi Aset Tidak Berwujud');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca Akumulasi Amortisasi Aset Tidak Berwujud</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka4perkadaII', $data);
        break;
        } 
		
		
	}
    
	
	function ctk_penyu_lamp_aset($skpd='',$rek3='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');
		$lntahunangn = $lntahunang-1;	
        if($rek3==15){
			$nama_rek='Aset Lainnya';
		}else{
			$nama_rek=$this->tukd_model->get_nama($rek3,'nm_rek3','ms_rek3_64','kd_rek3');
		}
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
	
		$usernm= $this->session->userdata('pcNama');
		
		if($usernm=='SETDA6'){
			$nambah = "BIRO UMUM";
		}ELSE{
			$nambah = "";
		}
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH PROVINSI KALIMANTAN BARAT</b> <br>
                    <b>RINCIAN NERACA ".strtoupper($nama_rek)."</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    OPD </td> 
					<td> :</td>
					<td> $skpd - $nambah $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		if ($rek3==133){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Sisa Masa Manfaat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Penambahan Masa Manfaaat</td>
					<td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Akumulasi Penyusutan<br>Tahun $lntahunangn</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Penyusutan <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
				   
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then 0 when sisa_umur<=0 then 0 when (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi-akum_penyu)<=0 then 0 else cast(((a.sal_awal+a.tambah-a.kurang+tahun_n+koreksi)-akum_penyu)/(sisa_umur+tmasa) as decimal(20,0)) end as akum_penyu_n
						from (SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, 
						case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end masa,
						case when (case when tmasa<>0 and kd_rek3='$rek3' then (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek3=tmasa) 
						else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end)
						+sisa_umur>=(case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end) then (case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end)-sisa_umur else (case when tmasa<>0 and kd_rek3='$rek3' then (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek3=tmasa) 
						else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end) end tmasa,
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(sisa_umur,masa) sisa_umur, isnull(akum_penyu,0) akum_penyuk, 
						case when len(tahun)<>4 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sisa_umur<=0 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sal_awal=sal_awal-kurang+tambah+tahun_n-kormin+korplus then akum_penyu when sal_awal-kurang+tambah+tahun_n-kormin+korplus=0 then 0 when $lntahunang-tahun>=masa and sal_awal=0 then sal_awal-kurang+tambah+tahun_n-kormin+korplus when (sal_awal-kurang+tambah+tahun_n-kormin+korplus)<sal_awal then cast((isnull(akum_penyu,0))*((sal_awal-kurang+tambah+tahun_n-kormin+korplus)/sal_awal) as decimal(20,0)) when sal_awal>0 and tambah>0 then akum_penyu+(case when ($lntahunang-tahun)>masa then tambah else tambah/masa*($lntahunang-tahun) end) when sal_awal=0 and tahun_n=0 then cast(($lntahunang-tahun)*(sal_awal-kurang+tambah+tahun_n-kormin+korplus)/masa as decimal(20,0)) when status in ('9','10') then isnull(akum_penyub,0) else isnull(akum_penyu,0) end as akum_penyu FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, sum(akum_penyuk) akum_penyuk, sum(akum_penyu) akum_penyu, sum(akum_penyu_n) akum_penyu_n, sum(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then 0 when sisa_umur<=0 then 0 when (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi-akum_penyu)<=0 then 0 else cast(((a.sal_awal+a.tambah-a.kurang+tahun_n+koreksi)-akum_penyu)/(sisa_umur+tmasa) as decimal(20,0)) end as akum_penyu_n
						from (SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, 
						case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end masa,
						case when (case when tmasa<>0 and kd_rek3='$rek3' then (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek3=tmasa) 
						else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end)
						+sisa_umur>=(case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end) then (case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end)-sisa_umur else (case when tmasa<>0 and kd_rek3='$rek3' then (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek3=tmasa) 
						else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end) end tmasa,
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(sisa_umur,masa) sisa_umur, isnull(akum_penyu,0) akum_penyuk, 
						case when len(tahun)<>4 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sisa_umur<=0 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sal_awal=sal_awal-kurang+tambah+tahun_n-kormin+korplus then akum_penyu when sal_awal-kurang+tambah+tahun_n-kormin+korplus=0 then 0 when $lntahunang-tahun>=masa and sal_awal=0 then sal_awal-kurang+tambah+tahun_n-kormin+korplus when (sal_awal-kurang+tambah+tahun_n-kormin+korplus)<sal_awal then cast((isnull(akum_penyu,0))*((sal_awal-kurang+tambah+tahun_n-kormin+korplus)/sal_awal) as decimal(20,0)) when sal_awal>0 and tambah>0 then akum_penyu+(case when ($lntahunang-tahun)>masa then tambah else tambah/masa*($lntahunang-tahun) end) when sal_awal=0 and tahun_n=0 then cast(($lntahunang-tahun)*(sal_awal-kurang+tambah+tahun_n-kormin+korplus)/masa as decimal(20,0)) when status in ('9','10') then isnull(akum_penyub,0) else isnull(akum_penyu,0) end as akum_penyu FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $tmasa = $row->tmasa;
					   $usia = $row->usia;
					   $sisa_umur = $row->sisa_umur;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $tmasa==0 ? $tmasa = '' : $tmasa=number_format($tmasa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   $sisa_umur==0 ? $sisa_umur = '' : $sisa_umur=number_format($sisa_umur,"0",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $no_lamp=='' ? $akum_penyuk = '' : $akum_penyuk=number_format($akum_penyuk,"2",",",".");
					   $no_lamp=='' ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $no_lamp=='' ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $no_lamp=='' ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td>
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td>
							   <td align=\"center\" style=\"font-size:12px\">$sisa_umur</td>
							   <td align=\"center\" style=\"font-size:12px\">$tmasa</td>
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyuk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                    }
				$sql = "SELECT '' no_lamp, (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, SUM(akum_penyuk) akum_penyuk, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) as akum_penyu_n, SUM(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then 0 when sisa_umur<=0 then 0 when (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi-akum_penyu)<=0 then 0 else cast(((a.sal_awal+a.tambah-a.kurang+tahun_n+koreksi)-akum_penyu)/(sisa_umur+tmasa) as decimal(20,0)) end as akum_penyu_n
						from (SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, 
						case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end masa,
						case when (case when tmasa<>0 and kd_rek3='$rek3' then (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek3=tmasa) 
						else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end)
						+sisa_umur>=(case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end) then (case when tmasa<>0 and kd_rek3='$rek3' then (select masa from ms_penyu where kd_rek3=tmasa) else (select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) end)-sisa_umur else (case when tmasa<>0 and kd_rek3='$rek3' then (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek3=tmasa) 
						else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end) end tmasa,
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(sisa_umur,masa) sisa_umur, isnull(akum_penyu,0) akum_penyuk, 
						case when len(tahun)<>4 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sisa_umur<=0 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sal_awal=sal_awal-kurang+tambah+tahun_n-kormin+korplus then akum_penyu when sal_awal-kurang+tambah+tahun_n-kormin+korplus=0 then 0 when $lntahunang-tahun>=masa and sal_awal=0 then sal_awal-kurang+tambah+tahun_n-kormin+korplus when (sal_awal-kurang+tambah+tahun_n-kormin+korplus)<sal_awal then cast((isnull(akum_penyu,0))*((sal_awal-kurang+tambah+tahun_n-kormin+korplus)/sal_awal) as decimal(20,0)) when sal_awal>0 and tambah>0 then akum_penyu+(case when ($lntahunang-tahun)>masa then tambah else tambah/masa*($lntahunang-tahun) end) when sal_awal=0 and tahun_n=0 then cast(($lntahunang-tahun)*(sal_awal-kurang+tambah+tahun_n-kormin+korplus)/masa as decimal(20,0)) when status in ('9','10') then isnull(akum_penyub,0) else isnull(akum_penyu,0) end as akum_penyu FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $akum_penyuk==0 ? $akum_penyuk = '' : $akum_penyuk=number_format($akum_penyuk,"2",",",".");
                       $akum_penyu==0 ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n==0 ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku==0 ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyuk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
                    }
				$cRet .="</table>";
				}if ($rek3==134){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Sisa Masa Manfaat</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Penambahan Masa Manfaaat</td>
					<td colspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Akumulasi Penyusutan<br>Tahun $lntahunangn</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Penyusutan <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
				   
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then 0 when sisa_umur<=0 then 0 when (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi-akum_penyu)<=0 then 0 else cast(((a.sal_awal+a.tambah-a.kurang+tahun_n+koreksi)-akum_penyu)/(sisa_umur+tmasa) as decimal(20,0)) end as akum_penyu_n
						from (SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, 
						(select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) masa,
						case when (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5))
						+sisa_umur>=(select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) then (select masa from ms_penyu where kd_rek4=left(kd_rek5,5))-sisa_umur else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end tmasa,
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(sisa_umur,masa) sisa_umur, isnull(akum_penyu,0) akum_penyuk, 
						case when len(tahun)<>4 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sisa_umur<=0 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sal_awal=sal_awal-kurang+tambah+tahun_n-kormin+korplus then akum_penyu when sal_awal-kurang+tambah+tahun_n-kormin+korplus=0 then 0 when $lntahunang-tahun>=masa and sal_awal=0 then sal_awal-kurang+tambah+tahun_n-kormin+korplus when (sal_awal-kurang+tambah+tahun_n-kormin+korplus)<sal_awal then cast((isnull(akum_penyu,0))*((sal_awal-kurang+tambah+tahun_n-kormin+korplus)/sal_awal) as decimal(20,0)) when sal_awal>0 and tambah>0 then akum_penyu+(case when ($lntahunang-tahun)>masa then tambah else tambah/masa*($lntahunang-tahun) end) when sal_awal=0 and tahun_n=0 then cast(($lntahunang-tahun)*(sal_awal-kurang+tambah+tahun_n-kormin+korplus)/masa as decimal(20,0)) when status in ('9','10') then isnull(akum_penyub,0) else isnull(akum_penyu,0) end as akum_penyu FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 tmasa, 0 usia, 0 sisa_umur, sum(akum_penyuk) akum_penyuk, sum(akum_penyu) akum_penyu, sum(akum_penyu_n) akum_penyu_n, sum(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then 0 when sisa_umur<=0 then 0 when (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi-akum_penyu)<=0 then 0 else cast(((a.sal_awal+a.tambah-a.kurang+tahun_n+koreksi)-akum_penyu)/(sisa_umur+tmasa) as decimal(20,0)) end as akum_penyu_n
						from (SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, 
						(select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) masa,
						case when (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5))
						+sisa_umur>=(select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) then (select masa from ms_penyu where kd_rek4=left(kd_rek5,5))-sisa_umur else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end tmasa,
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(sisa_umur,masa) sisa_umur, isnull(akum_penyu,0) akum_penyuk, 
						case when len(tahun)<>4 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sisa_umur<=0 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sal_awal=sal_awal-kurang+tambah+tahun_n-kormin+korplus then akum_penyu when sal_awal-kurang+tambah+tahun_n-kormin+korplus=0 then 0 when $lntahunang-tahun>=masa and sal_awal=0 then sal_awal-kurang+tambah+tahun_n-kormin+korplus when (sal_awal-kurang+tambah+tahun_n-kormin+korplus)<sal_awal then cast((isnull(akum_penyu,0))*((sal_awal-kurang+tambah+tahun_n-kormin+korplus)/sal_awal) as decimal(20,0)) when sal_awal>0 and tambah>0 then akum_penyu+(case when ($lntahunang-tahun)>masa then tambah else tambah/masa*($lntahunang-tahun) end) when sal_awal=0 and tahun_n=0 then cast(($lntahunang-tahun)*(sal_awal-kurang+tambah+tahun_n-kormin+korplus)/masa as decimal(20,0)) when status in ('9','10') then isnull(akum_penyub,0) else isnull(akum_penyu,0) end as akum_penyu FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $tmasa = $row->tmasa;
					   $usia = $row->usia;
					   $sisa_umur = $row->sisa_umur;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $tmasa==0 ? $tmasa = '' : $tmasa=number_format($tmasa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   $sisa_umur==0 ? $sisa_umur = '' : $sisa_umur=number_format($sisa_umur,"0",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $no_lamp=='' ? $akum_penyuk = '' : $akum_penyuk=number_format($akum_penyuk,"2",",",".");
					   $no_lamp=='' ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $no_lamp=='' ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $no_lamp=='' ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td>
							   <td align=\"center\" style=\"font-size:12px\">$audited</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td>
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td>
							   <td align=\"center\" style=\"font-size:12px\">$sisa_umur</td>
							   <td align=\"center\" style=\"font-size:12px\">$tmasa</td>
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyuk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                    }
				$sql = "SELECT '' no_lamp, (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, SUM(akum_penyuk) akum_penyuk, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) as akum_penyu_n, SUM(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then 0 when sisa_umur<=0 then 0 when (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi-akum_penyu)<=0 then 0 else cast(((a.sal_awal+a.tambah-a.kurang+tahun_n+koreksi)-akum_penyu)/(sisa_umur+tmasa) as decimal(20,0)) end as akum_penyu_n
						from (SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, 
						(select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) masa,
						case when (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5))
						+sisa_umur>=(select masa from ms_penyu where kd_rek4=left(kd_rek5,5)) then (select masa from ms_penyu where kd_rek4=left(kd_rek5,5))-sisa_umur else (select case when sal_awal=0 then 0 when ((tahun_n+tambah)/sal_awal)>0 and ((tahun_n+tambah)/sal_awal)<=p1 then m1 when ((tahun_n+tambah)/sal_awal)>p1 and ((tahun_n+tambah)/sal_awal)<=p2 then m2 when ((tahun_n+tambah)/sal_awal)>p2 and ((tahun_n+tambah)/sal_awal)<=p3 then m3 when ((tahun_n+tambah)/sal_awal)>p3 and ((tahun_n+tambah)/sal_awal)<=p4 then m4 when ((tahun_n+tambah)/sal_awal)>p4 and ((tahun_n+tambah)/sal_awal)<=p5 then m5 when ((tahun_n+tambah)/sal_awal)>p5 then m5 else 0 end from ms_penyu where kd_rek4=left(kd_rek5,5)) end tmasa,
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(sisa_umur,masa) sisa_umur, isnull(akum_penyu,0) akum_penyuk, 
						case when len(tahun)<>4 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sisa_umur<=0 then cast(sal_awal-kurang+tambah+tahun_n-kormin+korplus as decimal(20,0)) when sal_awal=sal_awal-kurang+tambah+tahun_n-kormin+korplus then akum_penyu when sal_awal-kurang+tambah+tahun_n-kormin+korplus=0 then 0 when $lntahunang-tahun>=masa and sal_awal=0 then sal_awal-kurang+tambah+tahun_n-kormin+korplus when (sal_awal-kurang+tambah+tahun_n-kormin+korplus)<sal_awal then cast((isnull(akum_penyu,0))*((sal_awal-kurang+tambah+tahun_n-kormin+korplus)/sal_awal) as decimal(20,0)) when sal_awal>0 and tambah>0 then akum_penyu+(case when ($lntahunang-tahun)>masa then tambah else tambah/masa*($lntahunang-tahun) end) when sal_awal=0 and tahun_n=0 then cast(($lntahunang-tahun)*(sal_awal-kurang+tambah+tahun_n-kormin+korplus)/masa as decimal(20,0)) when status in ('9','10') then isnull(akum_penyub,0) else isnull(akum_penyu,0) end as akum_penyu FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $akum_penyuk==0 ? $akum_penyuk = '' : $akum_penyuk=number_format($akum_penyuk,"2",",",".");
                       $akum_penyu==0 ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n==0 ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku==0 ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $audited==0 ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyuk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
                    }
				$cRet .="</table>";
				}else if ($rek3==132){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Koreksi BPK</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Audited</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Akumulasi Penyusutan Per<br>Tahun $lntahunangn</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Penyusutan <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">Koreksi</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
                </tr>
				</thead>";
				
				$sql = "SELECT '' no_lamp, kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,'' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT '' no_lamp, kd_rek5 as kode1,kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, 0 koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyuk, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu, case when len(tahun)<>4 then 0 when a.usia>=a.masa then 0 when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-(case when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(akum_penyu,0) akum_penyuk FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT 'x' no_lamp, LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, 0 kondisi_b, 0 kondisi_rr, 0 kondisi_rb, '' keterangan, 0 masa, 0 usia, sum(akum_penyuk), sum(akum_penyu), sum(akum_penyu_n), sum(nilai_buku) FROM (
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu, case when len(tahun)<>4 then 0 when a.usia>=a.masa then 0 when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-(case when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(akum_penyu,0) akum_penyuk FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)	
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $usia = $row->usia;
					   $akum_penyuk = $row->akum_penyuk;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $kondisi_b==0 ? $kondisi_b = '' : $kondisi_b=number_format($kondisi_b,"0",",",".");
					   $kondisi_rr==0 ? $kondisi_rr = '' : $kondisi_rr=number_format($kondisi_rr,"0",",",".");
					   $kondisi_rb==0 ? $kondisi_rb = '' : $kondisi_rb=number_format($kondisi_rb,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   $no_lamp = $row->no_lamp;
					   $no_lamp=='' ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $no_lamp=='' ? $akum_penyuk = '' : $akum_penyuk=number_format($akum_penyuk,"2",",",".");
					   $no_lamp=='' ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $no_lamp=='' ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $no_lamp=='' ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyuk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                        
					}  
				$sql = "SELECT '' no_lamp, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(koreksi) koreksi, SUM(akum_penyuk) akum_penyuk, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) akum_penyu_n, SUM(nilai_buku) nilai_buku FROM (
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu, case when len(tahun)<>4 then 0 when a.usia>=a.masa then 0 when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)-(case when len(tahun)<>4 then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi as decimal(20,0)) when sal_awal=sal_awal+tambah-kurang+tahun_n+koreksi then akum_penyuk when a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi=0 then 0 else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa*(a.usia-1) as decimal(20,0))+cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n+koreksi)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT no_lamp, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, isnull(korplus,0)-isnull(kormin,0) koreksi, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia, isnull(akum_penyu,0) akum_penyuk FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah+$tahun_n;
                       $akum_penyuk = $row->akum_penyuk;
                       $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $koreksi = $row->koreksi;
					   $audited = $akhir+$koreksi;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $akum_penyuk==0 ? $akum_penyuk = '' : $akum_penyuk=number_format($akum_penyuk,"2",",",".");
                       $akum_penyu==0 ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n==0 ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku==0 ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   
					   if ($koreksi < 0){
                       $min001="("; $koreksi=$koreksi*-1; $min002=")";
                       }else {
                       $min001=""; $koreksi; $min002="";
                       }			
		
					   $koreksi==0 ? $koreksi = '' : $koreksi=number_format($koreksi,"2",",",".");
					   $no_lamp=='' ? $audited = '' : $audited=number_format($audited,"2",",",".");
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL PERALATAN DAN MESIN</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$min001$koreksi$min002</td> 
							   <td align=\"center\" style=\"font-size:12px\">$audited</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyuk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else{
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:12px\" align=\"center\">
                    BELUM ADA CETAKAN                                        
                    </td>           
                </tr>
				</table>";
					
				}
				/* if($ctk==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,0,1,'');
} */

		$data['prev']= $cRet;
		$judul  = "Laporan_Lampiran_Aset_Penyusutan_$skpd";
        $this->template->set('title', 'Rincian Neraca Akumulasi Penyusutan $nama_rek');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca Akumulasi Penyusutan $nama_rek</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
    
	function load_rek3_lamp_aset(){
		$sql = "select kd_rek3,nm_rek3 FROM ms_rek3_64 WHERE left(kd_rek3,1)='1' UNION 
				select '15' as kd_rek3, 'Aset Lainnya' as ms_rek3 ORDER BY kd_rek3";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek3' => $resulte['kd_rek3'],  
                        'nm_rek3' => $resulte['nm_rek3']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}	
	
	function load_rek3_penyu_lamp_aset(){
		$sql = "select kd_rek3,nm_rek3 FROM ms_rek3_64 WHERE kd_rek3 in ('132','133','134')";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek3' => $resulte['kd_rek3'],  
                        'nm_rek3' => $resulte['nm_rek3']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}		 
	
	
     function load_spp() {
		$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
		$kd_skpd  = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = " AND jns_spp <> '1' AND jns_spp <> '2' ";
        if ($kriteria <> ''){                               
            $where="where (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhspp WHERE kd_skpd = '$kd_skpd' $where ";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
		//alert('aaa');
		
        $sql = "SELECT TOP $rows * from trhspp WHERE kd_skpd = '$kd_skpd' $where and no_spp not in (SELECT TOP $offset no_spp from trhspp WHERE kd_skpd = '$kd_skpd' $where) order by no_spp,kd_skpd";
       // $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'jns_beban' => $resulte['jns_beban'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan'],
                        'no_tagih'=>$resulte['no_tagih'],
                        'tgl_tagih'=>$resulte['tgl_tagih'],
                        'alamat'=>$resulte['alamat'],
                        'lanjut'=>$resulte['lanjut'],
                        'kontrak'=>$resulte['kontrak'],
                        'tgl_mulai'=>$resulte['tgl_mulai'],
                        'tgl_akhir'=>$resulte['tgl_akhir'],
                        'sts_tagih'=>$resulte['sts_tagih']     
                        );
                        $ii++;
        }
		$result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
	}
    
    function spd1_up() {
        $result   = array();
        { 
            $result[] = array(
                        'id'       => '0',        
                        'kdrek5'   => '1110302',
                        'nmrek5'   => 'Uang Persediaan'
                        );
        }
        echo json_encode($result);
    }
    
    function load_spp_up() {

		$kd_skpd  = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="and jns_spp='1'";
        if ($kriteria <> ''){                               
            $where="where (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status']                                                                                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	$query1->free_result();   
	}
    
     function bank() {

            //$lcskpd  = $this->session->userdata('kdskpd');
            
            $sql = "select * from ms_bank order by kode" ;    
            //echo $sql;    
            $query1 = $this->db->query($sql);  
            $result = array();
            $ii = 0;
            foreach($query1->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kode' => $resulte['kode'],  
                            'nama' => $resulte['nama']
                            );
                            $ii++;
            }
               
            echo json_encode($result);
        	   
    	}
    
    function load_spp_gu() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where jns_spp='2'";
        if ($kriteria <> ''){                               
            $where="where (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhspp $where order by no_spp,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'no_bukti' =>$resulte['no_bukti']                                                                                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	$query1->free_result();    
	}
    
   function tambah_spp()
	{
		
		$config = array(
               array(
                     'field'   => 'no_spp',
                     'label'   => 'no spp',
                     'rules'   => 'trim|required'
                    ),
                
               array(
                     'field'   => 'kd_skpd',
                     'label'   => 'Kd skpd',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'keperluan',
                     'label'   => 'keperluan',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'jns_spp',
                     'label'   => 'Jns spp',
                     'rules'   => 'trim|required'
               )
                  
            );
			
		$this->form_validation->set_message('required', '%s harus diisi !');
		$this->form_validation->set_rules($config);
		$this->form_validation->set_error_delimiters('<div class="single_error">', '</div>');

		if ($this->form_validation->run() == FALSE)
		{
			$data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            //$lc = "select kd_program,nm_program from m_prog order by kd_program";
//            $query = $this->db->query($lc);
//            $data["program"]=$query->result();
            //$data["jumrow"]=$this->db->get('m_prog')->num_rows();
		}
		else
		{		
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('skpd');
                        $tgl_spp = $this->input->post('dd');
                        $jns_kegiatan = $this->input->post('jns_beban');
                        $bulan = $this->input->post('kebutuhan_bulan');
                        $keperluan = $this->input->post('ketentuan');
						
						
			//$this->tukd_model->save('trhspp',$data);
            $query = $this->db->query(" insert into trhspp(no_spp,kd_skpd,tgl_spp,jns_kegiatan,bulan,keperluan) values('$no_spp','$kd_skpd','$tgl_spp','$jns_kegiatan','$bulan','$keperluan') ");
            echo"$query";						
			$this->session->set_flashdata('notify', 'Data Berita berhasil disimpan !');
			
			redirect('tukd/spp');

		}
		
		$this->template->set('title', 'Master Data Kegiatan &raquo; Tambah Data');
		$this->template->load('template', 'tukd/spp/tambah_spp_v2', $data);
	}
   
   
   function load_sum_lpj(){
		$xlpj = $this->input->post('lpj');
		$kd_skpd = $this->input->post('kode');
        //$query1 = $this->db->query("SELECT SUM(b.nilai)AS jml FROM trhtransout a INNER JOIN trdtransout b ON a.no_bukti=b.no_bukti 
        //          INNER JOIN trlpj c ON b.no_bukti=c.no_bukti WHERE no_lpj='$xlpj' ");  
		
		$query1 = $this->db->query("SELECT SUM(a.nilai)AS jml FROM trlpj a INNER JOIN trhlpj b ON a.no_lpj=b.no_lpj 
					AND a.kd_skpd=b.kd_skpd
                  WHERE b.no_lpj='$xlpj' AND a.kd_skpd='$kd_skpd' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'cjumlah'  =>  $resulte['jml']                       
                        );
                        $ii++;
        }
		echo json_encode($result);
        $query1->free_result();	
	}

   
   function tambah()
	{
		
		$config = array(
               array(
                     'field'   => 'no_spp',
                     'label'   => 'no spp',
                     'rules'   => 'trim|required'
                    ),
                
               array(
                     'field'   => 'kd_skpd',
                     'label'   => 'Kd skpd',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'keperluan',
                     'label'   => 'keperluan',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'jns_spp',
                     'label'   => 'Jns spp',
                     'rules'   => 'trim|required'
               )
                  
            );
			
		$this->form_validation->set_message('required', '%s harus diisi !');
		$this->form_validation->set_rules($config);
		$this->form_validation->set_error_delimiters('<div class="single_error">', '</div>');

		if ($this->form_validation->run() == FALSE)
		{
			$data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            //$lc = "select kd_program,nm_program from m_prog order by kd_program";
//            $query = $this->db->query($lc);
//            $data["program"]=$query->result();
            //$data["jumrow"]=$this->db->get('m_prog')->num_rows();
		}
		else
		{		
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('skpd');
                        $tgl_spp = $this->input->post('dd');
                        $jns_kegiatan = $this->input->post('jns_beban');
                        $bulan = $this->input->post('kebutuhan_bulan');
                        $keperluan = $this->input->post('ketentuan');
						
						
			//$this->tukd_model->save('trhspp',$data);
            $query = $this->db->query(" insert into trhspp(no_spp,kd_skpd,tgl_spp,jns_kegiatan,bulan,keperluan) values('$no_spp','$kd_skpd','$tgl_spp','$jns_kegiatan','$bulan','$keperluan') ");
            echo"$query";						
			$this->session->set_flashdata('notify', 'Data Berita berhasil disimpan !');
			
			redirect('tukd/spp');

		}
		
		$this->template->set('title', 'Master Data Kegiatan &raquo; Tambah Data');
		$this->template->load('template', 'tukd/spp/tambah_spp', $data);
	}
    
    function simpan()
	{
			
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('cskpd');
                        $keperluan = $this->input->post('keperluan');
                        $jns_spp = $this->input->post('jns_spp');
                        $tgl_spp = $this->input->post('tgl_spp');//                        
                        $bulan = $this->input->post('bulan');                        
                        $spd = $this->input->post('cspd');
                        $bank= $this->input->post('bank');
                        $nmrekan= $this->input->post('rekanan');
                        $no_rek= $this->input->post('rekening');
                        $npwp= $this->input->post('npwp');
                        $nm_skpd= $this->input->post('nmskpd');
                        $nilai= $this->input->post('nilai');
                        $no_bukti= $this->input->post('bukti');
                        $giat = $this->input->post('kegi');
                        $nmgiat = $this->input->post('nmkegi');
                        $prog = $this->input->post('prog');
                        $nmprog = $this->input->post('nmprog');
                        $dir = $this->input->post('dir');
                        $usernm= $this->session->userdata('pcNama');
                        $no_tagih=$this->input->post('notagih');
                        $tgl_tagih=$this->input->post('tgltagih');
                        $sts_tagih=$this->input->post('sttagih');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                        
           $sql = "delete from trhspp where kd_skpd='$kd_skpd' and no_spp='$no_spp' and status='0'";
           $asg = $this->db->query($sql);
           	
                    $query ="insert into trhspp(no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai,no_bukti,kd_kegiatan,nm_kegiatan,kd_program,nm_program,pimpinan,no_tagih,tgl_tagih,sts_tagih) 
                    values('$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai','$no_bukti','$giat','$nmgiat','$prog','$nmprog','$dir','$no_tagih','$tgl_tagih','$sts_tagih') ";
                    $asg = $this->db->query($query);                    				
			
        echo '1';
      // $asg->free_result(); 
	} 
    
    function simpan_tukd(){
        
        $tabel   = $this->input->post('tabel');
        $lckolom = $this->input->post('kolom');
        $lcnilai = $this->input->post('nilai');
        $cid     = $this->input->post('cid');
        $lcid    = $this->input->post('lcid');
        $lcnotagih = $this->input->post('tagih');
        
        $sql = "select $cid from $tabel where $cid='$lcid'";
        $res = $this->db->query($sql);
        if($res->num_rows()>0){
            echo '1';
        }else{
            $sql = "insert into $tabel $lckolom values $lcnilai";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            }
        }
        if($tabel=='trhspp'){
            $sql1 = " UPDATE trhtagih SET sts_tagih='1' where no_bukti='$lcnotagih'";
            $asg1 = $this->db->query($sql1);
        }
        if($tabel=='trhspm'){
            $sql1 = " UPDATE trhspp SET status='1' where no_spp='$lcnotagih'";
            $asg1 = $this->db->query($sql1);
        }
    }
    
	
	
    function update_tukd(){
        
        $tabel   = $this->input->post('tabel');
        $cid     = $this->input->post('cid');
        $lcid    = $this->input->post('lcid');
        $lcid_h  = $this->input->post('lcid_h');
        
        if (  $lcid <> $lcid_h ) {
            
           $sql     = "select $cid from $tabel where $cid='$lcid'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '1';
                exit();
           } 
        }
        
        $query   = $this->input->post('st_query');
        $asg     = $this->db->query($query);
        if ( $asg > 0 ){
           echo '2';
        } else {
           echo '0';
        }
    
    }
	
	
    function update_sp2d_tukd(){
        
        $tabel   = $this->input->post('tabel');
        $cid     = $this->input->post('cid');
        $lcid    = $this->input->post('lcid');
        $lcid_h  = $this->input->post('lcid_h');

        $tabel2   = $this->input->post('tabel2');
        $cid_spm     = $this->input->post('cid_spm');
        $lcid_spm    = $this->input->post('lcid_spm');
        $lcid_h_spm  = $this->input->post('lcid_h_spm');

        $tabel3   = $this->input->post('tabel3');
        $cid_sp2d     = $this->input->post('cid_sp2d');
        $lcid_sp2d    = $this->input->post('lcid_sp2d');
        $lcid_h_sp2d  = $this->input->post('lcid_h_sp2d');
        if (  $lcid <> $lcid_h ) {
            
           $sql     = "select $cid from $tabel where $cid='$lcid'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '1';
                exit();
           } 
        }
//cek spm
        if (  $lcid_spm <> $lcid_h_spm ) {
            
           $sql     = "select $cid_spm from $tabel2 where $cid_spm='$lcid_spm'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '4';
                exit();
           } 
        }
// cek sp2d
        if (  $lcid_sp2d <> $lcid_h_sp2d ) {
            
           $sql     = "select $cid_sp2d from $tabel3 where $cid_sp2d='$lcid_sp2d'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '5';
                exit();
           } 
        }
		
        $query   = $this->input->post('st_query');
        $asg     = $this->db->query($query);
        if ( $asg < 1 ){
			echo '0';
			exit();
	   }
    
	    $query   = $this->input->post('st_query_spm');
        $asg     = $this->db->query($query);
        if ( $asg < 1 ){
           echo '0';
		   exit();
        }
		
        $query   = $this->input->post('st_query_sp2d');
        $asg     = $this->db->query($query);
        if ( $asg < 1 ){
			echo '0';
			exit();
        }
		echo '2';
		
		// sp2d ini sementara manual dulu by tox
		/* 
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sementara' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            } */

	}
    
    function simpan_spp()
	{
                        $no_spp = $this->input->post('no_spp');
                        $no_spm = $this->input->post('no_spm');
						$no_sp2d = $this->input->post('no_sp2d');
						$kd_skpd = $this->input->post('cskpd');
                        $keperluan = $this->input->post('keperluan');
                        $jns_spp = $this->input->post('jns_spp');
                        $tgl_spp = $this->input->post('tgl_spp');
                        $tgl_spm = $this->input->post('tgl_spm');
                        $tgl_sp2d = $this->input->post('tgl_sp2d');                        
                        $bulan = $this->input->post('bulan');                        
                        $spd = $this->input->post('cspd');
                        $bank= $this->input->post('bank');
                        $nmrekan= $this->input->post('rekanan');
                        $no_rek= $this->input->post('rekening');
                        $npwp= $this->input->post('npwp');
                        $nm_skpd= $this->input->post('nmskpd');
                        $nilai= $this->input->post('nilai');
                        $no_bukti= $this->input->post('bukti');
                        $giat = $this->input->post('kegi');
                        $nmgiat = $this->input->post('nmkegi');
                        $prog = $this->input->post('prog');
                        $nmprog = $this->input->post('nmprog');
                        $dir = $this->input->post('dir');
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                        
                        
                    $sql = "delete from trhspp where kd_skpd='$kd_skpd' and no_spp='$no_spp' ";
                    $asg = $this->db->query($sql);
                    $sql1 = "delete from trhspm where kd_skpd='$kd_skpd' and no_spm='$no_spm' ";
                    $asg1 = $this->db->query($sql1);
                    $sql2 = "delete from trhsp2d where kd_skpd='$kd_skpd' and no_sp2d='$no_sp2d'";
                    $asg2 = $this->db->query($sql2);
                    
           	
                    $query ="insert into trhspp(no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai,no_bukti,kd_kegiatan,nm_kegiatan,kd_program,nm_program,pimpinan) 
                    values('$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai','$no_bukti','$giat','$nmgiat','$prog','$nmprog','$dir') ";
                    $asg1 = $this->db->query($query);                    				
			
                    $query1 ="insert into trhspm(no_spm,tgl_spm,no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai) 
                    values('$no_spm','$tgl_spm','$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai') ";
                    $asg2 = $this->db->query($query1);                    				
		
                    $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai) 
                    values('$no_sp2d','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai') ";
                    $asg3 = $this->db->query($query2);                     				
		
       
        echo '1';
       //$asg->free_result(); 
	}     
    
    function dsimpan()
	{
						$no_spp      = trim($this->input->post('cno_spp'));
						$kd_skpd     = $this->input->post('cskpd');
                        $kd_kegiatan = $this->input->post('cgiat');
                        $kd_rek5     = $this->input->post('crek');
                        $nm_kegiatan = $this->input->post('ngiat');
                        $nm_rek5     = $this->input->post('nrek');
                        $nilai       = $this->input->post('nilai');
                        $sis         = $this->input->post('sis');
                        $kd          = $this->input->post('kd');
                        $vno_bukti   = $this->input->post('no_bukti1');
                        
           $sql = "delete from trdspp where no_spp='$no_spp' and kd_kegiatan='$kd_kegiatan' and kd_rek5='$kd_rek5' and no_bukti='$vno_bukti' ";
           
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                    $query ="insert into trdspp(no_spp,kd_skpd,kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5,nilai,sisa,kd,no_bukti) values('$no_spp','$kd_skpd','$kd_kegiatan','$kd_rek5','$nm_kegiatan','$nm_rek5','$nilai','$sis','$kd','$vno_bukti') ";                    
                    $asg = $this->db->query($query);
					
                    					
			} else {
            echo '0';
            exit();
        }
        echo '1';
	}
    
	
    function dsimpan_hapus_pajak()
	{
           $no_spm  = trim($this->input->post('cno_spm'));
           $kd_skpd    = $this->input->post('kode');

               $sql     = " delete from trspmpot where no_spm='$no_spm' and kd_skpd='$kd_skpd' ";
               $asg     = $this->db->query($sql);
               if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
   
	}
	
    function dsimpan_pajak()
	{
		
		   $skpd    = $this->input->post('cskpd');
           $spm     = $this->input->post('spm');
           $kd_rek5 = $this->input->post('kd_rek5');
           $nm_rek5 = $this->input->post('nmrek');
           $nilai   = $this->input->post('nilai');
           $pot     = $this->input->post('pot');                            
  
           $sql = "delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'";
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                $query = " insert into trspmpot(no_spm,kd_skpd,kd_rek5,nm_rek5,nilai,pot) values('$spm','$skpd','$kd_rek5','$nm_rek5','$nilai','$pot') ";                    
                $asg   = $this->db->query($query) ;
			} else {
                echo '0';
                exit();
            }
        echo '1';
	}
	
    function hapus_tukd(){

        $ctabel = $this->input->post('tabel');
        $cid    = $this->input->post('cid');
        $cnid   = $this->input->post('cnid');
        $csql   = "delete from $ctabel where $cid = '$cnid'";
                
        $asg = $this->db->query($csql);
        if ( $asg > 0 ) {
            echo '1'; 
        } else {
            echo '0';
        }
                       
    }
    
    
    function dsimpan_hapus()
	{
           $no_spp  = trim($this->input->post('cno_spp'));
           $lcid    = $this->input->post('lcid');
           $lcid_h  = $this->input->post('lcid_h');
           
           if (  $lcid <> $lcid_h ) {
               $sql     = " delete from trdspp where no_spp='$no_spp' ";
               $asg     = $this->db->query($sql);
               if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
          }     
	}
    
    function dsimpan_trmpot()
	{
			
						$no_bukti = $this->input->post('no_bukti');						
                        $kd_rek5 = $this->input->post('crek');                       
                        $nm_rek5 = $this->input->post('nrek');
                        $nilai = $this->input->post('nilai');      

           
             	
           $query ="insert into trdtrmpot(no_bukti,kd_rek5,nm_rek5,nilai) values('$no_bukti','$kd_rek5','$nm_rek5','$nilai') ";                    
           $asg1 = $this->db->query($query);
                    					
			
        echo '1';
        
     
       //$asg->free_result();  
	}
    
    function psimpan() {
	
        $bukti=$this->input->post('bukti');
        $kd_rek5=$this->input->post('kd_rek5');        
        $nm_rek5=$this->input->post('nm_rek5');        
        $nilai=$this->input->post('nilai');
                                        
		$query1 = $this->db->query(" delete from trdtrmpot where no_bukti='$bukti' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trdtrmpot(no_bukti,kd_rek5,nm_rek5,nilai) values('$bukti','$kd_rek5','$nm_rek5','$nilai') ");	

		//$this->select_data($spd);
        
    }
    
    function psimpan_str() {
	
        $bukti=$this->input->post('bukti');
        $kd_rek5=$this->input->post('kd_rek5');        
        $nm_rek5=$this->input->post('nm_rek5');        
        $nilai=$this->input->post('nilai');
                                        
		$query1 = $this->db->query(" delete from trdstrpot where no_bukti='$bukti' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trdstrpot(no_bukti,kd_rek5,nm_rek5,nilai) values('$bukti','$kd_rek5','$nm_rek5','$nilai') ");	

		//$this->select_data($spd);
        
    }
    
	function skpd_2() {
		//$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}

	function skpd_2_dth() {
        $lccr   = $this->input->post('q');
        //$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where (upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();      
    }

	
	function skpd_ppkd() {
		$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd = '$kd_skpd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}


	function skpd_3() {
		$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd WHERE kd_skpd='$kd_skpd'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	
    function skpd() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	   
	}
    
     function list_skpd() {
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
	
	    $result = array();	
	    $rs = mysql_query("select count(*) from ms_skpd");
	    $row = mysql_fetch_row($rs);
	    $result["total"] = $row[0];
	
	    $rs = mysql_query("select * from ms_skpd limit $offset,$rows");
 
	    $rows = array();
	    while($row = mysql_fetch_object($rs)){
		  array_push($rows, $row);
	    }
	    $result["rows"] = $rows;
	
	    echo json_encode($result);
      
	}
    
    function kegiatan($cskpd='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan FROM trskpd a inner join m_giat b on a.kd_kegiatan1=b.kd_kegiatan where a.kd_skpd='$cskpd' and 
        (upper(a.kd_kegiatan) like upper('%$lccr%') or upper(b.nm_kegiatan) like upper('%$lccr%'))";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function spd($cgiat='') {        
        $sql = "select no_spd,kd_kegiatan from trdspd where kd_kegiatan='$cgiat'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	

    function spd1() {

        $skpd  = $this->input->post('kode');
        $v_ats_beban  = $this->input->post('v_ats_beban');
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd' and jns_beban='$v_ats_beban'";
       // $sql   = " select no_spd, tgl_spd from trhspd ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'tgl_spd' => $resulte['tgl_spd']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
        
	function spd_ppkd() {

        $skpd  = $this->session->userdata('kdskpd');
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'tgl_spd' => $resulte['tgl_spd']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
 function kegi() {
        $spd=$this->input->post('spd');
        $lccr = $this->input->post('q');
        $sql  = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,c.nm_program,a.nilai FROM trdspd a INNER JOIN m_giat b ON 
                a.kd_kegiatan=b.kd_kegiatan INNER JOIN m_prog c ON a.kd_program = c.kd_program where a.no_spd='$spd' and 
                (upper(a.kd_kegiatan) like upper('%$lccr%') or upper(b.nm_kegiatan) like upper('%$lccr%')) order by  a.kd_kegiatan ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'kd_program' => $resulte['kd_program'], 
                        'nm_program' => $resulte['nm_program'], 
                        'nilai_spd' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	   
	}
	
    function trans($cskpd='') {
        //$cskpd = $this->input->post('dns');
        $sql = "select no_bukti,tgl_bukti from trhtransout where kd_skpd='$cskpd'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],  
                        'tgl_bukti' => $resulte['tgl_bukti'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function select_rka($kegiatan='') {
    //$kegiatan = $this->uri->segment(3);
        $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'total' => $resulte['total']  
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data($spd='') {
    $spd=$this->input->post('spd');
        $sql = "SELECT a.kd_kegiatan,c.nm_kegiatan,a.kd_rek5,b.nm_rek5,a.nilai,(SELECT SUM(nilai) FROM trdspp WHERE kd_kegiatan =a.kd_kegiatan AND kd_rek5=a.kd_rek5)AS total 
                FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 INNER JOIN trskpd d ON a.kd_kegiatan=d.kd_kegiatan INNER JOIN m_giat c ON d.kd_kegiatan1=c.kd_kegiatan
                WHERE a.kd_kegiatan IN(SELECT kd_kegiatan FROM trdspd WHERE no_spd='$spd') ORDER BY a.kd_kegiatan";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],       
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'total' => number_format($resulte['total']),
                        'a' => $resulte['nilai'],
                        'b' => $resulte['total']
                       
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data1($spp='') {
    //$kegiatan = $this->uri->segment(3);
		
		$spp=$this->input->post('spp');
        $sql = "SELECT kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,sisa FROM trdspp WHERE no_spp='$spp' ORDER BY kd_kegiatan,kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'idx' => $ii,
                        'kdkegiatan' => $resulte['kd_kegiatan'],
                        'nmkegiatan' => $resulte['nm_kegiatan'],       
                        'kdrek5' => $resulte['kd_rek5'],  
                        'nmrek5' => $resulte['nm_rek5'],  
                        'nilai1' => $resulte['nilai'],
                        'nilai' => number_format($resulte['nilai'],"2",",","."),
                        'sisa' => number_format($resulte['sisa'],"2",",","."),                        
                        'sis' => $resulte['sisa'] 
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data2() {
    $kegi=$this->input->post('giat');
        $sql = "SELECT a.kd_kegiatan,c.nm_kegiatan,a.kd_rek5,b.nm_rek5,a.nilai,(SELECT SUM(nilai) FROM trdspp WHERE kd_kegiatan =a.kd_kegiatan AND kd_rek5=a.kd_rek5)AS total 
                FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 INNER JOIN trskpd d ON a.kd_kegiatan=d.kd_kegiatan INNER JOIN m_giat c ON d.kd_kegiatan1=c.kd_kegiatan
                WHERE a.kd_kegiatan ='$kegi' ORDER BY a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],       
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",",","."),
                        'total' => number_format($resulte['total'],"2",",","."),
                        'a' => $resulte['nilai'],
                        'b' => $resulte['total']                        
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data_tran($no_bukti='') {
    //$kegiatan = $this->uri->segment(3);
    $no_bukti=$this->input->post('no_bukti');
        $sql = "SELECT kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai FROM trdtransout WHERE no_bukti='$no_bukti' ORDER BY kd_kegiatan,kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'idx' => $ii,
                        'kdkegiatan' => $resulte['kd_kegiatan'],
                        'nmkegiatan' => $resulte['nm_kegiatan'],       
                        'kdrek5' => $resulte['kd_rek5'],  
                        'nmrek5' => $resulte['nm_rek5'],  
                        'nilai1' => $resulte['nilai']
                        
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
   
    function ld_rek($giat='') {
    
        $sql = " SELECT a.kd_rek6 as kd_rek6,b.nm_rek6 as nm_rek6 FROM trdrka a inner join ms_rek6 b on a.kd_rek6=b.kd_rek6 where a.kd_sub_kegiatan='$giat' order by a.kd_rek6 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek6' => $resulte['kd_rek6'],  
                        'nm_rek6' => $resulte['nm_rek6']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function tsimpan() {
		$skpd=$this->input->post('cskpd');
        $spp=$this->input->post('cspp');
        $rek=$this->input->post('crek');
        $giat=$this->input->post('cgiat');
        $nmrek=$this->input->post('cnmrek');
        $nmgiat=$this->input->post('cnmgiat');
        $sisa=$this->input->post('sspp');
                                        
		//$query = $this->db->query(" delete from trdspp where kd_skpd='$skpd' and no_spp='$spp' and kd_rek5='$rek' and kd_kegiatan='$giat' ");
		$query = $this->db->query(" insert into trdspp(no_spp,kd_skpd,kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5,nilai,sisa) values('$spp','$skpd','$giat','$rek','$nmgiat','$nmrek',0,'$sisa') ");	

		$this->select_data($spd);
        
    }
   
   function hapus_keluar_lain(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from TRHOUTLAIN where NO_BUKTI='$nomor' and KD_SKPD = '$skpd'";
        $asg = $this->db->query($sql);
        
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
    }
    
   
function cek_simpan(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');
	    $kd_skpd  = $this->session->userdata('kdskpd');
	    
		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' and kd_skpd = '$kd_skpd' ");
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
		$msg = array('pesan'=>'1');
        echo json_encode($msg);
		} else{
		$msg = array('pesan'=>'0');
        echo json_encode($msg);
		}
		
	}
	 
   
  function hhapus() {    	
		$nomor = $this->input->post('no');        
        $query = $this->db->query("delete from trhspp where no_spp='$nomor'");
		$query = $this->db->query("delete from trdspp where no_spp='$nomor'");
         $query->free_result();
    }
   function hhapus_pkd() {    	
		$spp = $this->input->post('spp');
        $spm = $this->input->post('spm');
        $sp2d = $this->input->post('sp2d');        
        $this->db->query("delete from trhspp where no_spp='$spp'");
		$this->db->query("delete from trdspp where no_spp='$spp'");
        $this->db->query("delete from trhspm where no_spm='$spm'");
		$this->db->query("delete from trhsp2d where no_sp2d='$sp2d'");
        
         //$query->free_result();
    }
  function thapus($spp='',$kegiatan='',$rek='') {
    	
		$id=str_replace('123456789','/',$spp);
		$query = $this->db->query(" delete from trdspp where no_spp='$id' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");			
		$this->select_data1($id);
        // $query->free_result();
    }
  
  function hapus_spp($spp='')
	{		
		$id=str_replace('123456789','/',$spp);
		$query = $this->db->query("delete from trhspp where no_spp='$id'");
		$query = $this->db->query("delete from trdspp where no_spp='$id'");
			
		$this->spp();
         $query->free_result();
	}
    
    function cetak_spp() {
        $this->template->set('title', 'SPP &raquo; Ubah Data');
		$this->template->load('template', 'tukd/spp/cetak_spp');    	   
	}
    
    function pilih_spp() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_spp,kd_skpd,tgl_spp,jns_spp FROM trhspp where upper(no_spp) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'tgl_spp' => $resulte['tgl_spp'],
                        'jns_spp' => $resulte['jns_spp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
    function pilih_ttd($dns='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kd_skpd ='$dns' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	
    function pilih_ttd_bud() {
		
        $sql = "SELECT nip,nama,jabatan FROM ms_ttd where kode='BUD' group by  nip,nama,jabatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan']
                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	function pilih_ttd_tox($dns='') {
        $kd = $this->input->post('kd');
        $sql = "SELECT nip,nama,jabatan,kd_skpd,npwp FROM ms_ttd where kd_skpd='$dns' and kode='$kd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd'],
						'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }	
           
        echo json_encode($result);
     $query1->free_result();	   
	}

	
    
    function load_sum_spp(){

		$spp = $this->input->post('spp');
        $id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdspp where no_spp='$id'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }           
           //return $result;
		   echo json_encode($result);
         $query1->free_result();	
	}

    function load_sum_tran(){

		$id = $this->input->post('no_bukti');
        
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdtransout where no_bukti='$id'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	}
    
 ///////////akhir dari spp
 
 //////////SPM milai
 
    function spm()
    {
        $data['page_title']= 'INPUT S P M';
        $this->template->set('title', 'INPUT S P M');   
        $this->template->load('template','tukd/spm/spm',$data) ; 
    }
    
    function load_spm() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where kd_skpd='1.20.05.01'";
        if ($kriteria <> ''){                               
            $where="where  kd_skpd='1.20.05.01' and ((upper(no_spm) like upper('%$kriteria%') or tgl_spm like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%'))) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhspm $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT * from trhspm $where order by no_spm,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status']                                                                                   
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();	   
	}
    
    function config_spm($jns2){
        $skpd     = $this->session->userdata('kdskpd');
        $nospm   = $this->input->post('nospm1');
		if($jns2=='BL'){
			$where = "and jns_spp in ('1','2','3','6')";
		}else{
			$where = "and jns_spp in ('4','5')";
		}

        $sql = "SELECT max(a.urut) as nilai FROM trhspm a WHERE a.kd_skpd = '$skpd' $where and no_spm<>'$nospm'"; 
        $query1 = $this->db->query($sql);  
		
		foreach($query1->result_array() as $resulte)
        { 
            $result = array(                                
                        'nomor' => $resulte['nilai'] + 1
                        );
                        
        }
        echo json_encode($result); 	
    }

function rek_pot_trans() {
        $kd_skpd     = $this->session->userdata('kdskpd');
        $lccr   = $this->input->post('q') ;
        $spp=$this->input->post('nospp_pot');

        $sql    = " SELECT kd_rek5,nm_rek5 FROM trdspp where no_spp = '$spp' AND kd_skpd ='$kd_skpd' and ( upper(kd_rek5) like upper('%$lccr%')
                    OR upper(nm_rek5) like upper('%$lccr%') )  ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}

    function nospp_2() {
		$kd_skpd ='1.20.05.01';
        //$lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhspp WHERE status <> '1' and kd_skpd = '$kd_skpd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function nospp() {
        $lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhspp where kd_skpd='1.20.05.01' and (upper(no_spp) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function pilih_spm() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_spm,kd_skpd,no_spp FROM trhspm where upper(no_spm) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spm' => $resulte['no_spm'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spp' => $resulte['no_spp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function simpan_spm()
	{
                        $no_spm = $this->input->post('no_spm');
                        $tgl_spm = $this->input->post('tgl_spm');
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('cskpd');
                        $keperluan = $this->input->post('keperluan');
                        $jns_spp = $this->input->post('jns_spp');
                        $tgl_spp = $this->input->post('tgl_spp');//                        
                        $bulan = $this->input->post('bulan');                        
                        $spd = $this->input->post('cspd');
                        $bank= $this->input->post('bank');
                        $nmrekan= $this->input->post('rekanan');
                        $no_rek= $this->input->post('rekening');
                        $npwp= $this->input->post('npwp');
                        $nm_skpd= $this->input->post('nmskpd');
                        $nilai= $this->input->post('nilai');
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                        
           $sql = "delete from trhspm where kd_skpd='$kd_skpd' and no_spm='$no_spm'";
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                    $query ="insert into trhspm(no_spm,tgl_spm,no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai) 
                    values('$no_spm','$tgl_spm','$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai') ";
                    $asg = $this->db->query($query);                    				
			} else {
            echo '0';
            exit();
        }
        echo '1';
     $query1="update trhspp set status='1' where no_spp='$no_spp'";
     $asg1 = $this->db->query($query1);
      //  $asg->free_result();
//       $query1->free_result();  
	}
     function hapus_spm() {    	
		$nom = $this->input->post('no');
        $spp = $this->input->post('spp');        
        $query = $this->db->query("delete from trhspm where no_spm='$nom'");
        $query = $this->db->query("delete from trspmpot where no_spm='$nom'");
		$query = $this->db->query("update trhspp set status='0' where no_spp='$spp'");
        $query->free_result();
    }    
     
	function rek_pot2() {
        $lccr   = $this->input->post('q') ;
        $sql    = " SELECT kd_rek5,nm_rek5 FROM ms_pot where ( upper(kd_rek5) like upper('%$lccr%')
                    OR upper(nm_rek5) like upper('%$lccr%') )  ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
	 
    function rek_pot() {
        
        $sql = "SELECT kd_rek5,nm_rek5 FROM ms_rek5 where left(kd_rek5,1)='2'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function pot_simpan() {
		$skpd=$this->input->post('cskpd');
        $spm=$this->input->post('spm');
        $kd_rek5=$this->input->post('kd_rek5');
        $nm_rek5=$this->input->post('nmrek');                                     
		$query = $this->db->query("delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trspmpot(no_spm,kd_skpd,kd_rek5,nm_rek5,nilai,pot) values('$spm','$skpd','$kd_rek5','$nm_rek5','0','0') ");	

		$this->select_data($spd);
        // $query->free_result();
    }
    
	
    function dsimpan_pot_delete_ar()
	{
		   $skpd    = $this->input->post('cskpd');
           $spm     = $this->input->post('spm');
           $kd_rek5 = $this->input->post('kd_rek5');
   
           $sql = "delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'";
           $asg = $this->db->query($sql);
            if ($asg > 0) { 
                 echo '1' ;
                 exit();
			} else {
                 echo '0' ;
                 exit();
            }
	}
	
    function pot() {
        $spm=$this->input->post('spm');
        $sql = "SELECT * FROM trspmpot where no_spm='$spm' order by kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'pot' => $resulte['pot'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 //$query1->free_result();   
	}
    
    function pot_in() {
        $bukti=$this->input->post('bukti');
        $sql = "SELECT * FROM trdtrmpot where no_bukti='$bukti'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 //$query1->free_result();   
	}
    
    function pot1() {
        $bukti=$this->input->post('bukti');
        $sql = "SELECT * FROM trdtrmpot where no_bukti='$bukti'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	// $query1->free_result();   
	}
    
    function pot_out() {
        $bukti=$this->input->post('bukti');
        $sql = "SELECT * FROM trdstrpot where no_bukti='$bukti'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	// $query1->free_result();   
	}
    
    function potsimpan() {
		$skpd=$this->input->post('cskpd');
        $spm=$this->input->post('spm');
        $kd_rek5=$this->input->post('kd_rek5');
        $nm_rek5=$this->input->post('nmrek');
        $nilai=$this->input->post('nilai');
        $pot=$this->input->post('ket');                                     
		$query = $this->db->query("delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trspmpot(no_spm,kd_skpd,kd_rek5,nm_rek5,nilai,pot) values('$spm','$skpd','$kd_rek5','$nm_rek5','$nilai','$pot') ");	

		$this->pot();
        $query->free_result();
    }
    
     function hapus_pot() {    	
		$sp = $this->input->post('no');
        $r = $this->input->post('rek');        
        $query = $this->db->query("delete from trspmpot where no_spm='$sp' and kd_rek5='$r'");
        $query->free_result();
    }
    
    function load_sum_spm(){

		$spp = $this->input->post('spp');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rekspm from trdspp where no_spp='$spp'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           //number_format($resulte['rekspm'],"2",",","."),
            $result[] = array(
                        'id' => $ii,        
                        'rekspm' => number_format($resulte['rekspm'],2,'.',','),
                        'rekspm1' => $resulte['rekspm']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	}
    
    function load_sum_pot(){

		$spm = $this->input->post('spm');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trspmpot where no_spm='$spm'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
     function load_trm_pot(){

		$bukti = $this->input->post('bukti');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdtrmpot where no_bukti='$bukti'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
    
    function load_str_pot(){

		$bukti = $this->input->post('bukti');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdstrpot where no_bukti='$bukti'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
    
    function ld_giat($skpd='') { 
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM trskpd where kd_skpd='$skpd' and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    

    
//////---------------Akhir SPM
//////------- Awal SP2D  

    function sp2d()
    {
        $data['page_title']= 'INPUT S P 2 D';
        $this->template->set('title', 'INPUT S P 2 D');   
        $this->template->load('template','tukd/sp2d/sp2d',$data) ; 
    }

	function sp2d_up(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D UP');   
        $this->template->load('template','tukd/sp2d/sp2d_up',$data) ; 
    }

	function sp2d_ls(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D LS');   
        $this->template->load('template','tukd/sp2d/sp2d_ls',$data) ; 
    }
	
	function sp2d_gu(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D GU');   
        $this->template->load('template','tukd/sp2d/sp2d_gu',$data) ; 
    }

	function sp2d_gj()
    {
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D Gaji');   
        $this->template->load('template','tukd/sp2d/sp2d_gj',$data) ; 
    }

	function edit_sp2d()
    {
        $data['page_title']= 'EDIT S P 2 D';
        $this->template->set('title', 'EDIT S P 2 D');   
        $this->template->load('template','tukd/sp2d/sp2d_edit',$data) ; 
    }
	
	function sp2d_tu(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D TU');   
        $this->template->load('template','tukd/sp2d/sp2d_tu',$data) ; 
    }
	
	 function sp2d_manual()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL';
        $this->template->set('title', 'INPUT S P 2 D MANUAL');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual',$data) ; 
    }
    
	 function sp2d_manual_gj()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL GAJI';
        $this->template->set('title', 'INPUT S P 2 D MANUAL GAJI');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual_gj',$data) ; 
    }
	 function sp2d_manual_up()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL UP';
        $this->template->set('title', 'INPUT S P 2 D MANUAL UP');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual_up',$data) ; 
    }
	 function sp2d_manual_gu()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL GU';
        $this->template->set('title', 'INPUT S P 2 D MANUAL GU');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual_gu',$data) ; 
    }

	 function lpj_tu()
    {
        $data['page_title']= 'INPUT LPJ TU';
        $this->template->set('title', 'INPUT LPJ TU');   
        $this->template->load('template','tukd/sp2d/lpj_tu',$data) ; 
    }

	 function lpj_up()
    {
        $data['page_title']= 'PENGESAHAN LPJ UP';
        $this->template->set('title', 'PENGESAHAN LPJ UP/GU');   
        $this->template->load('template','tukd/sp2d/lpj_up',$data) ; 
    }
	
	function lpj_up_ang()
    {
        $data['page_title']= 'PENGESAHAN LPJ UP ANGGARAN';
        $this->template->set('title', 'PENGESAHAN LPJ UP/GU ANGGARAN');   
        $this->template->load('template','tukd/sp2d/lpj_up_ang',$data) ; 
    }
    
     function sp2d_ppkd()
    {
        $data['page_title']= 'INPUT S P 2 D - P P K D';
        $this->template->set('title', 'INPUT S P 2 D - P P K D');   
        $this->template->load('template','tukd/sp2d/sp2d_ppkd',$data) ; 
    }
    
    function sp2d_pkd()
    {
        $data['page_title']= 'INPUT S P 2 D';
        $this->template->set('title', 'INPUT S P 2 D');   
        $this->template->load('template','tukd/sp2d/sp2d_pkd',$data) ; 
    }
    
    function sp2d_gu_pkd()
    {
        $data['page_title']= 'INPUT S P 2 D - G U';
        $this->template->set('title', 'INPUT S P 2 D - GU');   
        $this->template->load('template','tukd/sp2d/sp2d_gu_pkd',$data) ; 
    }
    
    function sp2d_up_pkd()
    {
        $data['page_title']= 'INPUT S P 2 D - U P';
        $this->template->set('title', 'INPUT S P 2 D - UP');   
        $this->template->load('template','tukd/sp2d/sp2d_up_pkd',$data) ; 
    }
    
	 function load_sp2d_edit() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd<>'' ";
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd WHERE a.no_sp2d NOT IN (select no_sp2d FROM trduji)) z where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd WHERE a.no_sp2d NOT IN (select no_sp2d FROM trduji)) z where $where and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd WHERE a.no_sp2d NOT IN (select no_sp2d FROM trhuji)) z where $where) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	
	
	
    function load_sp2d() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd<>'' ";
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%') or upper(no_spp) like upper('%$kriteria%') or upper(no_spm) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	function load_sp2d_up() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        
        if ($kriteria <> ''){                               
            $where=" (upper(z.no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%' ) or upper(no_spp) like upper('%$kriteria%') or upper(no_spm) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp='1'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner 
				join trhspd c on a.no_spd=c.no_spd) z join nomor_sp2d e on z.no_sp2d=e.no_sp2d where $where  AND jns_spp='1' and z.no_sp2d not in 
				(SELECT TOP $offset z.no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z 
				join nomor_sp2d d on z.no_sp2d=d.no_sp2d 
				where $where  AND jns_spp='1' order by d.nomor,tgl_sp2d,z.no_sp2d,kd_skpd) order by e.nomor,tgl_sp2d,z.no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
	
    function load_sp2d_gu() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%') or upper(no_spp) like upper('%$kriteria%') or upper(no_spm) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp='2'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='2' and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='2' order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	 function load_sp2d_tu() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        
        if ($kriteria <> ''){                               
            $where=" (upper(z.no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%') or upper(no_spp) like upper('%$kriteria%') or upper(no_spm) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp='3'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows * from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner 
				join trhspd c on a.no_spd=c.no_spd) z join nomor_sp2d e on z.no_sp2d=e.no_sp2d where $where  AND jns_spp='3' and z.no_sp2d not in 
				(SELECT TOP $offset z.no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z 
				join nomor_sp2d d on z.no_sp2d=d.no_sp2d where $where  AND jns_spp='3' order by d.nomor,tgl_sp2d,z.no_sp2d,kd_skpd) order by e.nomor,tgl_sp2d,z.no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	 function load_sp2d_gj() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		//$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
       // $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        $where =" kd_skpd <>'' ";
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%') or upper(no_spp) like upper('%$kriteria%') or upper(no_spm) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp = '4' AND no_sp2d LIKE '%GJ%'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end) jns_spd FROM trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp = '4' AND no_sp2d LIKE '%GJ%'and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp = '4' AND no_sp2d LIKE '%GJ%' order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
	
	
	
	function load_sp2d_ls() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" (upper(z.no_sp2d) like upper('%$kriteria%') or z.tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%') or upper(no_spp) like upper('%$kriteria%') or upper(no_spm) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp IN ('4','5','6') AND no_sp2d NOT LIKE '%GJ%'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT TOP $rows * from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end) jns_spd FROM trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c 
				on a.no_spd=c.no_spd) z join nomor_sp2d e on z.no_sp2d=e.no_sp2d where $where  AND jns_spp IN ('4','5','6') AND z.no_sp2d NOT LIKE '%GJ%' and z.no_sp2d not in 
				(SELECT TOP $offset z.no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z join nomor_sp2d d on z.no_sp2d=d.no_sp2d
				where $where AND jns_spp IN ('4','5','6') AND z.no_sp2d NOT LIKE '%GJ%' order by d.nomor,tgl_sp2d,z.no_sp2d,kd_skpd) order by e.nomor,tgl_sp2d,z.no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
	
	
function perusahaan() {                 
        $lccr = $this->input->post('q');
		$kd_skpd  = $this->session->userdata('kdskpd');        
        $sql = "SELECT nmrekan, pimpinan, npwp, alamat FROM trhspp WHERE kd_skpd = '$kd_skpd' AND LEN(nmrekan)>1 AND UPPER(nmrekan) LIKE UPPER('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'nmrekan' => $resulte['nmrekan'],  
                        'pimpinan' => $resulte['pimpinan'],      
                        'npwp' => $resulte['npwp'],
                        'alamat' => $resulte['alamat'],
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();
    }
	
	
    function load_sp2d_manual() {
		
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
//		$kd_skpd  = $this->session->userdata('kdskpd');
        $tanda_m='1';
		$tanda_m=$this->input->post('tanda_m');
		$kriteria = '';
        $kriteria = $this->input->post('cari');
		
		switch ($tanda_m) {
			case '1':
			//LS TU
				
         $where =" jns_spp in ('3','5','6') ";
				break;
			case '2':
			// LS GAJI
			
         $where =" jns_spp in ('4') ";
				break;
			case '3':
			//UP
				
         $where =" jns_spp in ('1') ";
				break;
			case '4':
			//GU
				
         $where =" jns_spp in ('2') ";
				break;
				}
		
		
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
         $sql = "SELECT count(*) as tot from (select a.*,pimpinan,no_tagih,tgl_tagih,alamat,lanjut,kontrak,tgl_mulai,tgl_akhir,sts_tagih from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm  inner join trhspp c on a.no_spp=c.no_spp) x where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
		//alert('aaa');
		
        $sql = "SELECT TOP $rows * from (select a.*,pimpinan,no_tagih,tgl_tagih,alamat,lanjut,kontrak,tgl_mulai,tgl_akhir,sts_tagih,kd_kegiatan,nm_kegiatan from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm  inner join trhspp c on a.no_spp=c.no_spp) x where $where and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.*,pimpinan,no_tagih,tgl_tagih,alamat,lanjut,kontrak,tgl_mulai,tgl_akhir,sts_tagih,kd_kegiatan,nm_kegiatan from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm  inner join trhspp c on a.no_spp=c.no_spp) x where $where) order by no_sp2d,kd_skpd";
       // $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
		
		 /*
'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
						*/
           
            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],						
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status_bud'],                       
                        'dir'=>$resulte['pimpinan'],
                        'no_tagih'=>$resulte['no_tagih'],
                        'tgl_tagih'=>$resulte['tgl_tagih'],
                        'alamat'=>$resulte['alamat'],
                        'lanjut'=>$resulte['lanjut'],
                        'kontrak'=>$resulte['kontrak'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'tgl_mulai'=>$resulte['tgl_mulai'],
                        'tgl_akhir'=>$resulte['tgl_akhir'],
                        'sts_tagih'=>$resulte['sts_tagih']     
                        );
                        $ii++;
        }
		$result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
	}
	
	
function total_spd() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdskpd  = $this->input->post('kd_skpd');
        $tglspd   = $this->input->post('tglspd');
        
        $query1   = $this->db->query(" SELECT  a.kd_kegiatan, SUM(a.nilai) as nilai FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd 
			where kd_skpd = '$ckdskpd' and  a.kd_kegiatan = '$ckdkegi' and b.status='1' GROUP BY a.kd_kegiatan ");   
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['nilai'],2,'.',','),
                       // 'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
	
    }

	
function pakai_spd() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdskpd  = $this->input->post('kd_skpd');
       // $tglspd   = $this->input->post('tglspd');
        
        $query1   = $this->db->query(" Select SUM(nilai) as nilai from (SELECT a.nilai FROM  trdspp a INNER JOIN trhspp b ON a.no_spp=b.no_spp
					inner join trhspm  c on c.no_spp=b.no_spp
					inner join trhsp2d d on d.no_spm=c.no_spm   
					WHERE b.jns_spp IN ('3','4','5','6') AND a.kd_skpd = '$ckdskpd' AND a.kd_kegiatan = '$ckdkegi' and d.status='1'					
					UNION
					SELECT a.nilai FROM  trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
					WHERE jns_spp IN ('1','2') AND b.kd_skpd = '$ckdskpd' AND a.kd_kegiatan = '$ckdkegi') z
			");   
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['nilai'],2,'.',','),
                       // 'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
	
    }	
	
	
    function load_sp2d_ppkd() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where kd_skpd='1.20.05.01'";
        if ($kriteria <> ''){                               
            $where="where kd_skpd='1.20.05.01' and (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhsp2d $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT * from trhsp2d $where order by no_sp2d,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status']                                                                                   
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
    
    function load_pot_in() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhtrmpot $where order by no_bukti,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],        
                        'ket' => $resulte['ket'],
                        'no_sp2d' => $resulte['no_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'npwp' => $resulte['npwp'],
                        'status' => $resulte['status']
                                                                                                     
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function load_pot_out() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhstrpot $where order by no_bukti,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'no_terima' => $resulte['no_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],        
                        'ket' => $resulte['ket'],                       
                        'nilai' => $resulte['nilai'],
                        'npwp' => $resulte['npwp']
                        
                                                                                                     
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	} 
     
     
    function load_sp2d_pkd($jns='') {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where a.jns_spp='$jns'";
        if ($kriteria <> ''){                               
            $where="where a.jns_spp='$jns' and (upper(a.no_sp2d) like upper('%$kriteria%') or a.tgl_sp2d like '%$kriteria%' or upper(a.kd_skpd) like 
                    upper('%$kriteria%') or upper(a.jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT a.*,b.kd_kegiatan,b.nm_kegiatan,b.kd_program,b.nm_program,b.pimpinan FROM trhsp2d a INNER JOIN trhspp b ON a.no_spp=b.no_spp $where order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan']                                                                                                    
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function load_sp2d_ls_tu_pkd() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where a.jns_spp not in('1','2')";
        if ($kriteria <> ''){                               
            $where="where a.jns_spp not in('1','2') and (upper(a.no_sp2d) like upper('%$kriteria%') or a.tgl_sp2d like '%$kriteria%' or upper(a.kd_skpd) like 
                    upper('%$kriteria%') or upper(a.jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT a.*,b.kd_kegiatan,b.nm_kegiatan,b.kd_program,b.nm_program,b.pimpinan FROM trhsp2d a INNER JOIN trhspp b ON a.no_spp=b.no_spp $where order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan']                                                                                                    
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
     function nospm() {
        $lccr = $this->input->post('q');	
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			
		}
		
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd
		join trhspp c on a.no_spp=c.no_spp and a.jns_spp=c.jns_spp
		where a.kd_skpd NOT IN ('3.10.01.01','1.20.02.01') AND a.status = '0' and (c.sp2d_batal<>'1' or c.sp2d_batal is null) and a.jns_spp='4' AND a.jenis_beban IN ('1','7')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))
		UNION ALL
		SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd
		join trhspp c on a.no_spp=c.no_spp and a.jns_spp=c.jns_spp
		where a.kd_skpd='3.10.01.01' AND a.keperluan NOT LIKE '%anggota dprd%' AND a.keperluan NOT LIKE '%BPOP%' AND a.status = '0' and (c.sp2d_batal<>'1' or c.sp2d_batal is null) and a.jns_spp='4' AND a.jenis_beban IN ('1','7') 
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))
		UNION ALL
		SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd
		join trhspp c on a.no_spp=c.no_spp and a.jns_spp=c.jns_spp
		where a.kd_skpd IN ('1.20.02.01') AND a.no_spm not like '%BTL%' AND a.status = '0' and (c.sp2d_batal<>'1' or c.sp2d_batal is null) and a.jns_spp='4' AND a.jenis_beban IN ('1','7')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm_gj() {
		$id  = $this->session->userdata('pcUser'); 
       // $lccr = $this->input->post('q');
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='4' 
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm_up() {
		$id  = $this->session->userdata('pcUser'); 
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//echo $bulan;
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp 
		where a.status = '0' AND a.jns_spp='1'  and (c.sp2d_batal!='1' or c.sp2d_batal is null)  AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='1' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}
		*/
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}

	function nospm_gu() {
		$id  = $this->session->userdata('pcUser'); 
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp 
		where a.status = '0' AND a.jns_spp='2' and (c.sp2d_batal!='1' or c.sp2d_batal is null) AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='2' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}*/
		
		
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	
	function nospm_tu() {
		$id  = $this->session->userdata('pcUser'); 
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp
		where a.status = '0' AND a.jns_spp='3' and (c.sp2d_batal!='1' or c.sp2d_batal is null)  AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='3' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}
		*/
		
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm_ls(){
		$id  = $this->session->userdata('pcUser');        
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp 
		where a.status = '0' AND a.jns_spp IN ('5','6') AND (c.sp2d_batal!='1' or c.sp2d_batal is null)  AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))
		UNION ALL
		SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp 
		where a.status = '0' AND a.jns_spp IN ('4') AND a.jenis_beban NOT IN ('1','7') and (c.sp2d_batal!='1' or c.sp2d_batal is null)  AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))
		UNION ALL
		SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp 
		where a.kd_skpd IN ('5.02.01.01') AND (a.keperluan LIKE '%anggota dprd%' OR a.keperluan LIKE '%BPOP%') AND a.status = '0' AND a.jns_spp IN ('4') AND a.jenis_beban IN ('1','7') and (c.sp2d_batal!='1' or c.sp2d_batal is null)  AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))
		UNION ALL
		SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when b.jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
	   join trhspp c on a.no_spp=c.no_spp 
		where a.kd_skpd IN ('5.01.01.00') AND a.no_spm like '%BTL%' AND a.status = '0' AND a.jns_spp IN ('4') AND a.jenis_beban IN ('1','7') and (c.sp2d_batal!='1' or c.sp2d_batal is null)  AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(a.no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte){ 
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	
	
	
	function nospm1() {
        $lccr = $this->input->post('q');
//		$sql = "SELECT * FROM trhspm ";       
	   $sql = "SELECT a.*,(case when b.jns_beban in ('51','62') then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd join trhspp c on a.no_spp=c.no_spp where 
				(c.sp2d_batal is null or sp2d_batal<>'1')";
//
	   $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'jns_beban' => $resulte['jenis_beban'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
    function nosp2d() {
        $lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhsp2d where upper(no_sp2d) like upper('%$lccr%')  ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'], 
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],
                        'npwp' => $resulte['npwp'],
                        'jns_spp' => $resulte['jns_spp'],
                        'npwp' => $resulte['npwp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	} 
    
    function trmpot_() {
        $lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhtrmpot where upper(no_bukti) like upper('%$lccr%')  ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'], 
                        'ket' => $resulte['ket'],
                        'no_sp2d' => $resulte['no_sp2d'],
                        'npwp' => $resulte['npwp'],
                        'jns_spp' => $resulte['jns_spp'],
                        'npwp' => $resulte['npwp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	} 
    
     function hapus_sp2d() {    	
		$nom = $this->input->post('no');
        $spm = $this->input->post('spm');        
        $query = $this->db->query("delete from trhsp2d where no_sp2d='$nom'");        
		$query = $this->db->query("update trhspm set status='0' where no_spm='$spm'");
		$query = $this->db->query("delete from nomor_sp2d where no_sp2d='$nom'");
        $query->free_result();

		 }
		 
	function batal_sp2d() {    	
        $sp2d = $this->input->post('sp2d');
        $spp = $this->input->post('no');
        $ket = $this->input->post('ket');
		$usernm      = $this->session->userdata('pcNama');
		$last_update=  date('d-m-y H:i:s');
		
		$query = $this->db->query("update trhspp set sp2d_batal='1',ket_batal='$ket',user_batal='$usernm', tgl_batal='$last_update' where no_spp='$spp'");
		$query = $this->db->query("update trhsp2d set sp2d_batal='1' where no_sp2d='$sp2d'");
        //$query->free_result();

		 }
    
	
     function hapus_trmpot() {    	
		$nom = $this->input->post('no');            
        $query = $this->db->query("delete from trhtrmpot where no_bukti='$nom'");
        $query1 = $this->db->query("delete from trdtrmpot where no_bukti='$nom'");        
	
    }
    
    function hapus_strpot() {    	
		$nom = $this->input->post('no');            
        $query = $this->db->query("delete from trhstrpot where no_bukti='$nom'");
        $query1 = $this->db->query("delete from trdstrpot where no_bukti='$nom'");        
	
    }    
    
    
    function simpan_trmpot()
	{
                       
                        $no_bukti = $this->input->post('no_bukti');
                        $tgl_bukti = $this->input->post('tgl_bukti');
						$no_sp2d = $this->input->post('no_sp2d');
						$jns_spp = $this->input->post('jns_spp');
                        $ket = $this->input->post('ket');
                        $kd_skpd = $this->input->post('kd_skpd');
                        $nm_skpd = $this->input->post('nm_skpd');
                        $npwp = $this->input->post('npwp');
                        $nilai= $this->input->post('nilai');                         
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                       
                        
           $sql = "delete from trhtrmpot where no_bukti='$no_bukti' ";
           $asg = $this->db->query($sql);       
           $query2 ="insert into trhtrmpot(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,no_sp2d,npwp,jns_spp,status,nilai) 
                    values('$no_bukti','$tgl_bukti','$ket','$usernm','$last_update','$kd_skpd','$nm_skpd','$no_sp2d','$npwp','$jns_spp','0','$nilai') ";
                    $asg2 = $this->db->query($query2);           
         
          echo '1';
          //$asg->free_result();
//          $query1->free_result();  
	}
    
    function simpan_strpot()
	{
                       
                        $no_bukti = $this->input->post('no_bukti');
                        $tgl_bukti = $this->input->post('tgl_bukti');
						$no_terima = $this->input->post('no_terima');
						$jns_spp = $this->input->post('jns_spp');
                        $ket = $this->input->post('ket');
                        $kd_skpd = $this->input->post('kd_skpd');
                        $nm_skpd = $this->input->post('nm_skpd');
                        $npwp = $this->input->post('npwp');
                        $nilai= $this->input->post('nilai');                         
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                       
                        
           $sql = "delete from trhstrpot where no_bukti='$no_bukti' ";
           $asg = $this->db->query($sql);       
           $query2 ="insert into trhstrpot(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,no_terima,npwp,jns_spp,nilai) 
                    values('$no_bukti','$tgl_bukti','$ket','$usernm','$last_update','$kd_skpd','$nm_skpd','$no_terima','$npwp','$jns_spp','$nilai') ";
                    $asg2 = $this->db->query($query2);           
         
          echo '1';
          //$asg->free_result();
//          $query1->free_result();  
	}
    
    function pilih_sp2d() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_sp2d,kd_skpd,no_spm FROM trhsp2d where upper(no_sp2d) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spm' => $resulte['no_spm']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
         $query1->free_result();	   
	}
	
	
	 function pilih_sp2d_ls() {
        $lccr = $this->input->post('q');
        $sql = "SELECT TOP 10 no_sp2d,kd_skpd,no_spm FROM trhsp2d where jns_spp IN ('4','6') AND no_sp2d NOT LIKE '%GJ%' AND (upper(no_sp2d) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spm' => $resulte['no_spm']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
	}
	
    function pilih_trmpot() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_bukti,kd_skpd,tgl_bukti,no_sp2d FROM trhtrmpot where upper(no_bukti) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'no_sp2d' => $resulte['no_sp2d']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
         $query1->free_result();	   
	}
    
    
    /////Pencairan SP2D wahyu-------------------------------------------------------
	function manreal(){
		 $jk=$this->rka_model->combo_skpd();
         $ry=$this->rka_model->combo_giat();
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>MANAGEMENT REALISASI$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
         $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'MANAGEMENT REALISASI';
        $this->template->set('title', 'MANAGEMENT REALISASI');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','tukd/realisasi/manreal',$data) ;	
	}

   function select_real($kegiatan='',$skpd='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah,a.sumber from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   


        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
				$rk=$resulte['kd_rek5'];

				$query = $this->db->query(" SELECT SUM(a.nilai) AS nilai FROM trdspp a 
											LEFT JOIN trhspp b ON a.no_spp=b.no_spp
											LEFT JOIN trhspm c ON c.no_spp=b.no_spp
											LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
											WHERE a.kd_skpd='$skpd' AND a.kd_kegiatan='$kegiatan' AND a.kd_rek5='$rk' ");  
				foreach($query->result_array() as $res){
					$sp2d=$res['nilai'];
				}

				$query = $this->db->query("SELECT SUM(a.rupiah) AS nilai FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts WHERE a.kd_skpd='$skpd' AND b.kd_kegiatan='$kegiatan' AND a.kd_rek5='$rk' ");  
				foreach($query->result_array() as $res){
					$cp=$res['nilai'];
				}
				

				$result[] = array(
							'id' => $ii,        
							'kd_rek5' => $resulte['kd_rek5'],  
							'nm_rek5' => $resulte['nm_rek5'],  
							'nilai' => number_format($resulte['nilai']),
							'nilai_ubah' => number_format($resulte['nilai_ubah']),                             
							'real' => number_format($sp2d-$cp),                             
							'sisa' => number_format($resulte['nilai_ubah']-($sp2d-$cp))                             
							);
							$ii++;
        }
           
           echo json_encode($result);
    }	

	function ctk_manreal($skpd='',$giat='',$rek=''){

			$cRet ='<TABLE width="100%">
					<TR>
						<TD align="center" >MANAGEMENT REALISASI</TD>
					</TR>
					</TABLE>';
			//$kg=trim(substr($giat,5,strlen($giat)-4));
			$nmrek5=$this->tukd_model->get_nama($rek,'nm_rek5','ms_rek5','kd_rek5');			
			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');			
			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');			

			$cRet .='<center><TABLE >
					 <TR>
						<TD width="80" align="left" >OPD</TD>
						<TD width="5" align="center" >:</TD>
						<TD width="120" align="left" >'.$skpd.'</TD>
						<TD width="300" align="left" >'.$nmskpd.'</TD>
					 </TR>
					 <TR>
						<TD width="80" align="left" >KEGIATAN</TD>
						<TD width="5" align="center" >:</TD>
						<TD width="120" align="left" >'.$giat.'</TD>
						<TD width="300" align="left" >'.$nmgiat.'</TD>
					 </TR>					 
					 <TR>
						<TD width="80" align="left" >REKENING</TD>
						<TD width="5" align="center" >:</TD>
						<TD width="120" align="left" >'.$rek.'</TD>
						<TD width="500" align="left" >'.$nmrek5.'</TD>
					 </TR>					 
					 </TABLE>';
			$cRet .='<TABLE border="1" cellspacing="0" cellpadding="0" >
					 <TR>
						<TD width="40" align="center" >NO</TD>
						<TD width="250" align="center" >NO SP2D / NO STS / NO KAS</TD>
						<TD width="100" align="center" >TANGGAL</TD>
						<TD width="140" align="center" >DEBET</TD>
						<TD width="140" align="center" >KREDIT</TD>
						<TD width="140" align="center" >SALDO</TD>
					 </TR>';
			
				$idx=1;
              
					

				$query = $this->db->query(" SELECT d.no_sp2d,d.tgl_sp2d,a.nilai FROM trdspp a 
											LEFT JOIN trhspp b ON a.no_spp=b.no_spp
											LEFT JOIN trhspm c ON c.no_spp=b.no_spp
											LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
											WHERE a.kd_skpd='$skpd' AND a.kd_kegiatan='$giat' AND a.kd_rek5='$rek' ");  
				foreach($query->result_array() as $res){
										
					$cetak[$idx][1]=$res['tgl_sp2d'];
					$cetak[$idx][2]=$res['no_sp2d'];
					$cetak[$idx][3]=$res['nilai'];
                    $cetak[$idx][4]=0;
					$idx++;

				}

				$query = $this->db->query(" SELECT a.no_sts,b.tgl_sts,a.rupiah AS nilai FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts 
											WHERE b.kd_skpd='$skpd' AND b.kd_kegiatan='$giat' AND a.kd_rek5='$rek' ");  
				foreach($query->result_array() as $res){

					$cetak[$idx][1]=$res['tgl_sts'];
					$cetak[$idx][2]=$res['no_sts'];
                    $cetak[$idx][3]=0;
					$cetak[$idx][4]=$res['nilai'];
					$idx++;


				}
                
                $query = $this->db->query(" SELECT a.no_bukti,b.tgl_bukti,a.nilai  FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
											WHERE b.kd_skpd='$skpd' AND a.kd_kegiatan='$giat' AND a.kd_rek5='$rek' and b.jns_spp='1' ");  
				foreach($query->result_array() as $res){

					$cetak[$idx][1]=$res['tgl_bukti'];
					$cetak[$idx][2]=$res['no_bukti'];
                    $cetak[$idx][3]=$res['nilai'];
					$cetak[$idx][4]=0;
					$idx++;


				}

				asort($cetak);
				$i=0;
				$saldo=0;
				foreach ($cetak as $key => $val) {
					$i++;
					$saldo=$saldo+$cetak[$key][3]-$cetak[$key][4];
					$cRet .='<TR>
								<TD width="40" align="left" >'.$i.'</TD>
								<TD width="250" align="left" >'.$cetak[$key][2].'</TD>
								<TD width="100" align="center" >'.$this->tukd_model->rev_date($cetak[$key][1]).'</TD>
								<TD width="140" align="right" >'.number_format($cetak[$key][3]).'</TD>
								<TD width="140" align="right" >'.number_format($cetak[$key][4]).'</TD>
								<TD width="140" align="right" >'.number_format($saldo).'</TD>
							 </TR>';					
				}
			
			$cRet .='</TABLE></center>';

			$data['prev']= 'MANAGEMENT REALISASI';
            $this->tukd_model->_mpdf('',$cRet,5,5,10,'0');	
	
	}
	
    function cetakb9($dcetak='',$ttd='') {
            $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
				
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
			 $cRet='
					<TABLE width="100%" cellpadding="0" cellspacing="0" border="0" >
					<TR>
						<TD align="right" >B - IX</TD>
					</TR>
					<TR>
						<TD align="center">'.$this->tukd_model->get_sclient('kab_kota','sclient').'</TD>
					</TR>
					<TR>
						<TD align="center" >BUKU KAS PENERIMAAN DAN PENGELUARAN</TD>
					</TR>
					<TR>
						<TD align="center" >TAHUN ANGGARAN'.$this->session->userdata('pcThang').'</TD>
					</TR>
					<TR>
						<TD align="left" style="font-size:12px;border: solid 1px white;border-bottomolid 1px black;" >Tanggal : '.$this->tukd_model->tanggal_format_indonesia($dcetak).'</TD>
					</TR>
					</TABLE>
			       ';
			 $cRet.='
					<TABLE width="100%" cellpadding="0" cellspacing="0" border="1" >
					<TR>
						<TD align="center" width="7%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >NO KAS</TD>
						<TD align="center" width="23%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Uraian Penerimaan Dan Pengeluaran</TD>
						<TD align="center" width="15%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Kode Rekening</TD>
						<TD align="center" width="25%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Rincian Objek Penerimaan Dan Pengeluaran</TD>
						<TD align="center" width="15%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Penerimaan</TD>
						<TD align="center" width="15%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Pengeluaran</TD>
					</TR>
			       ';			 

			$query1 = $this->db->query(" SELECT a.no_sts,b.keterangan,b.kd_kegiatan,a.kd_rek5,c.nm_rek5,a.rupiah FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_sts='$dcetak' ");  
			$result = array();
			$ii = 0;
			$tnokas='';
			$tket='';
			$tot_in=0;
			foreach($query1->result_array() as $resulte){
				$nokas=$resulte['no_sts'];
				$ket=$resulte['keterangan'];
				$kdrek=$resulte['kd_kegiatan'].'.'.$resulte['kd_rek5'];
				$nmrek=$resulte['nm_rek5'];
				$nilai=$resulte['rupiah'];
				$a=$nokas;
				$b=$ket;

				if ($tnokas==$nokas){
					$a='';
				}
				if ($tket==$ket){
					$b='';
				}
				$cRet.='
					<TR>
						<TD valign="top" align="left" width="7%"  style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$a.'</TD>
						<TD valign="top" align="left" width="25%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$b.'</TD>
						<TD valign="top" align="center" width="20%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$kdrek.'</TD>
						<TD valign="top" align="left" width="28%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$nmrek.'</TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.number_format($nilai).'</TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" ></TD>
					</TR>
			       ';			 			
				$tnokas=$nokas;
				$tket=$ket;
				$tot_in=$tot_in+$nilai;
			} 



			$query1 = $this->db->query(" SELECT a.no_kas,b.ket,a.kd_kegiatan,a.kd_rek5,c.nm_rek5,a.nilai,b.no_sp2d FROM trdkasout_pkd a LEFT JOIN trhkasout_pkd b ON a.no_kas=b.no_kas LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_kas='$dcetak' ");  
			$result = array();
			$ii = 0;
			$tnokas='';
			$tket='';
			$tot_out=0;
			foreach($query1->result_array() as $resulte){
				$nokas=$resulte['no_kas'];
				$ket='SP2D No : '.$resulte['no_sp2d'].'<br>'.$resulte['ket'];
				$kdrek=$resulte['kd_kegiatan'].'.'.$resulte['kd_rek5'];
				$nmrek=$resulte['nm_rek5'];
				$nilai=$resulte['nilai'];
				$a=$nokas;
				$b=$ket;

				if ($tnokas==$nokas){
					$a='';
				}
				if ($tket==$ket){
					$b='';
				}
				$cRet.='
					<TR>
						<TD valign="top" align="left" width="7%"  style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$a.'</TD>
						<TD valign="top" align="left" width="25%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$b.'</TD>
						<TD valign="top" align="center" width="20%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$kdrek.'</TD>
						<TD valign="top" align="left" width="28%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$nmrek.'</TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" ></TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.number_format($nilai).'</TD>
					</TR>
			       ';			 			
				$tnokas=$nokas;
				$tket=$ket;
				$tot_out=$tot_out+$nilai;
			}

				$cRet.='
					<TR  >
						<TD height="20" colspan="4" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Jumlah Tanggal : '.$this->tukd_model->tanggal_format_indonesia($dcetak).' </TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_in).'</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_out).'</TD>
					</TR>
			       ';			 			

				$query1 = $this->db->query(" SELECT sum(a.rupiah) as nilai FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_sts<'$dcetak' ");  
				foreach($query1->result_array() as $resulte){
					$nilai_in=$resulte['nilai'];
				}
				$query1 = $this->db->query(" SELECT sum(a.nilai) as nilai FROM trdkasout_pkd a LEFT JOIN trhkasout_pkd b ON a.no_kas=b.no_kas LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_kas<'$dcetak' ");  
				foreach($query1->result_array() as $resulte){
					$nilai_out=$resulte['nilai'];
				}
				$cRet.='
					<TR  >
						<TD height="20" colspan="4" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Jumlah Sampai Tanggal Kemaren </TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($nilai_in).'</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($nilai_out).'</TD>
					</TR>
			       ';
				$cRet.='
					<TR  >
						<TD height="20" colspan="4" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Jumlah Sampai Tanggal : '.$this->tukd_model->tanggal_format_indonesia($dcetak).' </TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_in+$nilai_in).'</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_out+$nilai_out).'</TD>
					</TR>
			       ';
				$cRet.='
					<TR  >
						<TD height="25" colspan="5" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Sisa KAS</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:12px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" ><b>'.number_format(($tot_in+$nilai_in)-($tot_out+$nilai_out)).'</b></TD>
					</TR>
			       ';

			$cRet.='</TABLE><br>';

			$cRet.='<TABLE border="0" >
					<TR>
						<TD style="font-size:11px;" >Pada hari ini,tanggal '.$this->tukd_model->tanggal_format_indonesia($dcetak).'</TD>
					</TR>					
					<TR>
						<TD style="font-size:11px;" >Oleh kami didapat dalam kas Rp. '.number_format(($tot_in+$nilai_in)-($tot_out+$nilai_out)).'</TD>
					</TR>					
					<TR>
						<TD style="font-size:11px;" ><i>'.$this->tukd_model->terbilang(($tot_in+$nilai_in)-($tot_out+$nilai_out)).'</i></TD>
					</TR>					
					</TABLE><br>
					';

			$cRet.='<TABLE border="0" width="100%" >
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >'.$this->tukd_model->get_sclient('daerah','sclient').', '.$this->tukd_model->tanggal_format_indonesia($dcetak).'</TD>
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >'.$jabatan.'</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >'.$nama.'</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >NIP: '.$nip.'</TD> 
					</TR>					
					</TABLE>
					';


			$data['prev']= $cRet;
            echo $cRet;
            //$this->tukd_model->_mpdf('',$cRet,5,7,10,'0');
	}

    function list_ttd() {
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kode in ('PA','KPA') order by nama";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	function buku_b9(){
	
        $data['page_title']= 'CETAK BUKU KAS B-IX';
        $this->template->set('title', 'BUKU KAS B-IX');   
        $this->template->load('template','tukd/sp2d_cair/buku_b9',$data) ; 	
	
	}

    function sp2d_cair()
    {
        $data['page_title']= 'PENCAIRAN S P 2 D';
        $this->template->set('title', 'PENCAIRAN S P 2 D');   
        $this->template->load('template','tukd/sp2d_cair/sp2d_cair',$data) ; 
    }
    
    function sp2d_cair_ppkd()
    {
        $data['page_title']= 'PENCAIRAN S P 2 D';
        $this->template->set('title', 'PENCAIRAN S P 2 D PPKD');   
        $this->template->load('template','tukd/sp2d_cair/terima_sp2d',$data) ; 
    }
    
    function trmpot()
    {
        $data['page_title']= 'P O T O N G A N';
        $this->template->set('title', 'PENERIMAAN POTONGAN');   
        $this->template->load('template','tukd/transaksi/trmpot',$data) ; 
    }
    
    function strpot()
    {
        $data['page_title']= 'P O T O N G A N';
        $this->template->set('title', 'PENERIMAAN POTONGAN');   
        $this->template->load('template','tukd/transaksi/strpot',$data) ; 
    }

  function load_sp2d_cair() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd <> ''";
        if ($kriteria <> ''){                               
            $where=" (upper(a.no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(a.no_sp2d) as tot from trhsp2d a INNER JOIN trduji b ON a.no_sp2d=b.no_sp2d where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
         $sql = "SELECT TOP $rows a.no_sp2d,tgl_sp2d, no_spm, tgl_spm,no_spp, tgl_spp, kd_skpd,nm_skpd,jns_spp, keperluan, bulan,
				no_spd, bank, nmrekan, no_rek, npwp, no_kas, no_kas_bud, tgl_kas, tgl_kas_bud,
				nocek, status_bud,jenis_beban,no_spd,no_uji FROM trhsp2d a INNER JOIN trduji b on a.no_sp2d=b.no_sp2d where $where and  a.no_sp2d not in 
		(SELECT TOP $offset a.no_sp2d from trhsp2d a INNER JOIN trduji b on a.no_sp2d=b.no_sp2d where $where order by a.no_sp2d,kd_skpd) order by a.no_sp2d,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
			if ($resulte['status_bud']=='1'){
				$s='Sudah Cair';
			}else{
				$s='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $this->tukd_model->rev_date($resulte['tgl_sp2d']),
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'nokas' => $resulte['no_kas'],
                        'nokasbud' => $resulte['no_kas_bud'],
                        'dkas' => $resulte['tgl_kas'],
                        'dkasbud' => $resulte['tgl_kas_bud'],
                        'nocek' => $resulte['nocek'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'no_spd' => $resulte['no_spd'],
                        'no_uji' => $resulte['no_uji'],
                        'status' => $s                                                                                   
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    	   
	} 

	
    function simpan_cair(){
		$no_sp2d = $this->input->post('nsp2d');
		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');
		//$cskpd = $this->input->post('skpd');
		$cket = $this->input->post('ket');
		$advice = $this->input->post('advice');
		$beban = $this->input->post('beban');
        $usernm= $this->session->userdata('pcNama');
        $cskpd= $this->session->userdata('kdskpd');
		$last_update=  "";
		//$last_update=  date('Y-m-d H:i:s');


		$total = str_replace(",","",$total);
		
		$nmskpd=$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd');

        $sql = " update trhsp2d set status_bud='1', no_kas_bud='$nokas', tgl_kas_bud='$tglkas',no_advice='$advice' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);


        $sql3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,kd_unit,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$cskpd','$total','$total','0')";
        $asg3 = $this->db->query($sql3);
        


        $sql = " SELECT a.no_spp,a.kd_skpd,a.kd_kegiatan,a.kd_rek5,a.nilai,b.bulan,c.no_spm,d.no_sp2d,b.sts_tagih FROM trdspp a 
				 LEFT JOIN trhspp b ON a.no_spp=b.no_spp
				 LEFT JOIN trhspm c ON c.no_spp=b.no_spp
				 LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
				 WHERE d.no_sp2d='$no_sp2d' ";
        $query1 = $this->db->query($sql);  
        $ii = 0;
        $jum=0;
        foreach($query1->result_array() as $resulte){

			$sp2d=$no_sp2d;
            $jns=$beban;
			$skpd=$resulte['kd_skpd'];
			$giat=$resulte['kd_kegiatan'];
			$rek5=$resulte['kd_rek5'];
            
			//$rek9='9'.substr($rek5,1,7);//$resulte['kd_rek5'];
			
			$rek9=$this->tukd_model->get_nama($rek5,'map_lo','ms_rek5','kd_rek5');
			$nmrek9=$this->tukd_model->get_nama($rek9,'nm_rek5','ms_rek5','kd_rek5');
            
            $rek64=$this->tukd_model->get_nama($rek5,'kd_rek64','ms_rek5','kd_rek5');
			$nmrek64=$this->tukd_model->get_nama($rek64,'nm_rek64','ms_rek5','kd_rek64');

			$nilai=$resulte['nilai'];
			$tagih=$resulte['sts_tagih'];
			
			if ($beban=='1'){
				$rek3=$rek5;			
			}else{
				$rek3=substr($rek5,0,3);
			}

			$jum=$jum+$nilai;

			$rekutang=$this->tukd_model->get_nama($rek64,'piutang_utang','ms_rek5','kd_rek64');

			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
			$nmrek5=$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5');
			$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');
			


		} 


		if ($tagih=='1'){
			     $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1180101','RK SKPD','$jum','0','D','','1','1','$cskpd') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1110101','KAS DI KAS DAERAH','0','$jum','K','','2','1','$cskpd') ");
            
            
		}else{
			if (($jns=='1') or ($jns=='2') or ($jns=='3')){
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1180101','RK SKPD','$jum','0','D','','1','1','$cskpd') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1110101','KAS DI KAS DAERAH','0','$jum','K','','2','1','$cskpd') ");
                                  
			
			}else{
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1180101','RK SKPD','$jum','0','D','','1','1','$cskpd') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1110101','KAS DI KAS DAERAH','0','$jum','K','','2','1','$cskpd') ");
                
               			
			}
		}
		
		echo '1';		
	}

    function simpan_cair_ppkd(){
       
        
		$no_sp2d = $this->input->post('nsp2d');
		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');
		$cskpd = $this->input->post('skpd');
		$cket = $this->input->post('ket');
		$beban = $this->input->post('beban');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');


		$total = str_replace(",","",$total);

		$nmskpd=$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd');

        $sql = " update trhsp2d set status='1',no_kas='$nokas',tgl_kas='$tglkas',nocek='$nocek' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);

 	    $sql1 = " insert into trhkasout_pkd(no_kas,tgl_kas,no_sp2d,no_cek,kd_skpd,nilai,ket,nm_skpd,jns_beban,username,tgl_update) 
				  values('$nokas','$tglkas','$no_sp2d','$nocek','$cskpd',$total,'$cket','$nmskpd','$beban','$usernm','$last_update') ";
        $asg1 = $this->db->query($sql1);
        if (($beban=='4') or ($beban=='5') or ($beban=='6')){
        $sql2 = " insert into trhtransout(no_bukti,tgl_bukti,no_sp2d,kd_skpd,nm_skpd,total,ket,jns_spp,username,tgl_update)
                  values('$nokas','$tglkas','$no_sp2d','$cskpd','$nmskpd',$total,'$cket','$beban','$usernm','$last_update') ";
        $asg2 = $this->db->query($sql2);
        }
        $sql3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$total','$total','0')";
        $asg3 = $this->db->query($sql3);
        
        $sql31 = " insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$total','$total','0')";
        $asg31 = $this->db->query($sql31);
        
        $sql4 = " insert into trhju(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$total','$total','0')";
        $asg4 = $this->db->query($sql4);

        $sql = " SELECT a.no_spp,a.kd_skpd,a.kd_kegiatan,a.kd_rek5,a.nilai,b.bulan,c.no_spm,d.no_sp2d,b.sts_tagih FROM trdspp a 
				 LEFT JOIN trhspp b ON a.no_spp=b.no_spp
				 LEFT JOIN trhspm c ON c.no_spp=b.no_spp
				 LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
				 WHERE d.no_sp2d='$no_sp2d' ";
        $query1 = $this->db->query($sql);  
        $ii = 0;
        $jum=0;
        foreach($query1->result_array() as $resulte){

			$sp2d=$no_sp2d;
            $jns=$beban;
			$skpd=$resulte['kd_skpd'];
			$giat=$resulte['kd_kegiatan'];
			$rek5=$resulte['kd_rek5'];
            
			//$rek9='9'.substr($rek5,1,7);//$resulte['kd_rek5'];
			$kdrek4=$this->tukd_model->get_nama($kdrek5,'kd_rek4','ms_rek5','kd_rek5');
			$rek9=$this->tukd_model->get_nama($rek5,'map_lo','ms_rek5','kd_rek5');
			$nmrek9=$this->tukd_model->get_nama($rek9,'nm_rek5','ms_rek5','kd_rek5');
            
            $rek64=$this->tukd_model->get_nama($rek5,'kd_rek64','ms_rek5','kd_rek5');
			$nmrek64=$this->tukd_model->get_nama($rek64,'nm_rek64','ms_rek5','kd_rek64');

			$nilai=$resulte['nilai'];
			$tagih=$resulte['sts_tagih'];
			
			if ($beban=='1'){
				$rek3=$rek5;			
			}else{
				$rek3=substr($rek5,0,3);
			}

			$jum=$jum+$nilai;

			$rekutang=$this->tukd_model->get_nama($rek64,'piutang_utang','ms_rek5','kd_rek64');

			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
			$nmrek5=$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5');
			$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');
			
            if($kdrek4=='52201' || $kdrek4=='52201' ){
                $kdrek_p=$this->tukd_model->get_nama($kdrek5,'persed_kdp','ms_rek5','kd_rek5');
                $nmrek_p=$this->tukd_model->get_nama($kdrek_p,'nm_rek5','ms_rek5','kd_rek5');    
            }

			$this->db->query("insert trdkasout_pkd(no_kas,kd_skpd,kd_kegiatan,kd_rek5,nilai,nm_skpd,nm_kegiatan,nm_rek5) 
                              values('$nokas','$skpd','$giat','$rek5',$nilai,'$nmskpd','$nmgiat','$nmrek5') ");
            if (($jns=='4') or ($jns=='5') or ($jns=='6')){
            $this->db->query("insert trdtransout(no_bukti,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,no_sp2d) 
                              values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'$sp2d') ");
            }
            if (($jns=='4') or ($jns=='5') or ($jns=='6')){
    
    			if ($tagih=='1'){
    
    			     	
    				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$jns','3','1') ");  				
    				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','5','1') "); 
                                                  
                    $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$jns','3','1') ");  				
    				$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','5','1') ");
                    
                    $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$jns','3','1') ");  				
    				$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'0','D','$jns','5','1') ");
                    
                    
    			}else{
    				if ($jns!='1') {
                
    					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','3','1') ");             
    					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek9','$nmrek9',$nilai,'0','D','$jns','5','1') ");
                        
                        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','3','1') ");             
    					$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek9','$nmrek9',$nilai,'0','D','$jns','5','1') ");
                                          
                        $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'0','D','$jns','3','1') ");             
    					$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek9','$nmrek9',$nilai,'0','D','$jns','5','1') "); 
                               				
    				}
    			}
            }
		} 


		if ($tagih=='1'){
			$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','0','$jum','K','','4','1') ");
			$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','6','0') ");
                              
            $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','0','$jum','K','','4','1') ");
			$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','6','0') ");
            
            $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','0','$jum','K','','4','1') ");
			$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','6','0') ");
		}else{
			if (($jns=='1') or ($jns=='2') or ($jns=='3')){
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','$jum','0','D','','1','1') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','2','1') ");
                                  
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','$jum','0','D','','1','1') ");		
				$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','2','1') ");
                                  
                $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','$jum','0','D','','1','1') ");		
				$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','2','1') ");			
			}else{
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','4','0') ");
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','6','1') ");
                
               	$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','4','0') ");
				$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','6','1') ");
                
                $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','4','0') ");
				$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','6','1') ");			
			}
		}
		echo '1';
 	}


    function batal_cair(){
		$no_sp2d = $this->input->post('nsp2d');
		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');
        $cskpd= $this->session->userdata('kdskpd');
        $sql = " update trhsp2d set status_bud='0',no_kas_bud='',tgl_kas_bud='',nocek='' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);
		$sql = " DELETE FROM trhju_pkd WHERE no_voucher='$nokas' AND kd_skpd='$cskpd' ";
        $asg = $this->db->query($sql);
		$sql = " DELETE FROM trdju_pkd WHERE no_voucher='$nokas' AND kd_unit='$cskpd' ";
        $asg = $this->db->query($sql);
		if (($asg>0)and($asg1>0)){ 
			echo '1';
		}
	}
    
    function batal_cair_ppkd()
	{
		$no_sp2d = $this->input->post('nsp2d');

		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');

        $sql = " update trhsp2d set status='0',no_kas='',tgl_kas='',nocek='' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);

        $sql1 = " delete from trhkasout_pkd where no_kas='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdkasout_pkd where no_kas='$nokas' ";
        $asg1 = $this->db->query($sql1);
        
        $sql1 = " delete from trhtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

        $sql1 = " delete from trhju_pkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdju_pkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);
        
         $sql1 = " delete from trhju_ppkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdju_ppkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);
        
        $sql1 = " delete from trhju where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdju where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);
		
		if (($asg>0)and($asg1>0)){ 
			echo '1';
		}
	}
    
   // function simpan_cair_skpd()
//	{
//	   
//		$no_sp2d = $this->input->post('nsp2d');
//
//		$nokas = $this->input->post('nkas');
//		$tglkas = $this->input->post('tcair');
//		$nocek = $this->input->post('ncek');
//		$total = $this->input->post('tot');
//		$cskpd = $this->input->post('skpd');
//		$cket = $this->input->post('ket');
//		$beban = $this->input->post('beban');
//		$usernm= $this->session->userdata('pcNama');
//        //date_default_timezone_set('Asia/Bangkok');
//        $last_update=  date('Y-m-d H:i:s');
//
//
//		$total = str_replace(",","",$total);
//
//		$nmskpd=$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd');
//
//        $sql = " update trhsp2d set status='1',no_kas='$nokas',tgl_kas='$tglkas',nocek='$nocek' where no_sp2d='$no_sp2d' ";
//        $asg = $this->db->query($sql);
//
// 	    $sql1 = " insert into trhtransout(no_bukti,tgl_bukti,no_sp2d,kd_skpd,nm_skpd,total,ket,jns_spp,username,tgl_update)
//          values('$nokas','$tglkas','$no_sp2d','$cskpd','$nmskpd',$total,'$cket','$beban','$usernm','$last_update') ";
//        $asg1 = $this->db->query($sql1);
//
//
//        $sql = " SELECT a.no_spp,a.kd_skpd,a.kd_kegiatan,a.kd_rek5,a.nilai,b.bulan,c.no_spm,d.no_sp2d FROM trdspp a 
//				 LEFT JOIN trhspp b ON a.no_spp=b.no_spp
//				 LEFT JOIN trhspm c ON c.no_spp=b.no_spp
//				 LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
//				 WHERE d.no_sp2d='$no_sp2d' ";
//        $query1 = $this->db->query($sql);  
//        $ii = 0;
//        foreach($query1->result_array() as $resulte){
//			$sp2d=$no_sp2d;
//			$skpd=$resulte['kd_skpd'];
//			$giat=$resulte['kd_kegiatan'];
//			$rek5=$resulte['kd_rek5'];
//			$nilai=$resulte['nilai'];
//
//			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
//			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
//			$nmrek5=$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5');
//			
//			$this->db->query("insert trdtransout(no_bukti,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,no_sp2d) 
//            values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'$sp2d') ");
//		} 
//
//
//		
//			echo '1';
//		
//	}
//




    function batal_cair_skpd()
	{
		$no_sp2d = $this->input->post('nsp2d');

		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');

        $sql = " update trhsp2d set status='0',no_kas='',tgl_kas='',nocek='' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);

        $sql1 = " delete from trhtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

		
		if (($asg>0)and($asg1>0)){ 
			echo '1';
		}
	}


/////---------------------------------------------------------------------------
    
////////--Akhir dr SP2D
///////smua cetakan di bawah sini
        function  tanggal_format_indonesia($tgl){
        $tanggal  = explode('-',$tgl); 
        $bulan  = $this-> getBulan($tanggal[1]);
        $tahun  =  $tanggal[0];
        return  $tanggal[2].' '.$bulan.' '.$tahun;

        }
         
		function  tanggal_format_indonesia_kasda($tgl){
			$tanggal  = explode('-',$tgl); 
			$bulan  = $this-> getBulan_kasda($tanggal[1]);
			$tahun  =  $tanggal[0];
			return  $tanggal[2].' '.$bulan.' '.$tahun;
        } 
		
		function  tanggal_format_indonesia_kasda2($tgl){
			$tanggal  = explode('-',$tgl); 
			$bulan  = $this-> getBulan_kasda($tanggal[1]);
			$tahun  =  $tanggal[0];
			return  $tanggal[2].' '.$bulan;
        }
		 
        function  tanggal_indonesia($tgl){
        $tanggal  =  substr($tgl,8,2);
        $bulan  = substr($tgl,5,2);
        $tahun  =  substr($tgl,0,4);
        return  $tanggal.'-'.$bulan.'-'.$tahun;

        }
           
        function  getBulan($bln){
        switch  ($bln){
        case  1:
        return  "Januari";
        break;
        case  2:
        return  "Februari";
        break;
        case  3:
        return  "Maret";
        break;
        case  4:
        return  "April";
        break;
        case  5:
        return  "Mei";
        break;
        case  6:
        return  "Juni";
        break;
        case  7:
        return  "Juli";
        break;
        case  8:
        return  "Agustus";
        break;
        case  9:
        return  "September";
        break;
        case  10:
        return  "Oktober";
        break;
        case  11:
        return  "November";
        break;
        case  12:
        return  "Desember";
        break;
    }
    }
	
		function  getBulan_kasda($bln){
        switch  ($bln){
        case  1:
        return  "JANUARI";
        break;
        case  2:
        return  "FEBRUARI";
        break;
        case  3:
        return  "MARET";
        break;
        case  4:
        return  "APRIL";
        break;
        case  5:
        return  "MEI";
        break;
        case  6:
        return  "JUNI";
        break;
        case  7:
        return  "JULI";
        break;
        case  8:
        return  "AGUSTUS";
        break;
        case  9:
        return  "SEPTEMBER";
        break;
        case  10:
        return  "OKTOBER";
        break;
        case  11:
        return  "NOVEMBER";
        break;
        case  12:
        return  "DESEMBER";
        break;
		}
    }
	
    function  dotrek($rek){
				$nrek=strlen($rek);
				switch ($nrek) {
                case 1:
				$rek = $this->left($rek,1);								
       			 break;
    			case 2:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1);								
       			 break;
    			case 3:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1);								
       			 break;
    			case 5:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2);								
        		break;
    			case 7:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2).'.'.substr($rek,5,2);								
        		break;
                case 12:
                    $rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,2).'.'.substr($rek,4,2).'.'.substr($rek,6,2).'.'.substr($rek,8,4);                             
                break;
    			default:
				$rek = "";	
				}
				return $rek;
    }
    
    
    function right($value, $count){
    return substr($value, ($count*-1));
    }

    function left($string, $count){
    return substr($string, 0, $count);
    }    
	
    
    
    function cetakspp1(){
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        $nomor=str_replace('123456789','/',$this->uri->segment(3));
        if ($jns==1){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">OPD : </td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomer ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">OPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      if ($jns==2){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-GU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">OPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomor ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">OPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      
      if ($jns==3){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-TU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">OPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomor ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">OPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      
        if ($jns==4){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS GAJI DAN TUNJANGAN)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">OPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomer ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">OPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
            $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      if ($jns==6){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS BARANG DAN JASA)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">OPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomer ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">OPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";                 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";                    
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
             $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }            
    }
    
    function cetakspp2(){
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        $nomor=str_replace('123456789','/',$this->uri->segment(3));
        if ($jns==1){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                $query = $this->db->query($sql1);                                                 
                foreach ($query->result() as $row)
                {
                   
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;                   
                    $nilai=number_format($row->nilai,"0",",",".");
                    $nilai1=$row->nilai;                    
                    $a=$this->tukd_model->terbilang($nilai1);
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                                  
                    //echo($a);
                }    
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Berdasarkan Keputusan Gubernur/Bupati/Walikota Nomer ...... Tanggal
                    ...... tentang penetapan jumlah uang persediaan untuk OPD   $nm_skpd sejumlah Rp $nilai</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Terbilang:  $a</td></tr>                    
                  </table>";

       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
       
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
           
         if ($jns==2){                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='52' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-GU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-OPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-OPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$nilai_ang</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='52' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='6' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns6     = $row->nilai;
                    $jns6_    = number_format($jns6,"2",".",",");                   
                    } 
                    $sqlspptup="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND (a.jns_spp='1' or a.jns_spp='2') AND a.no_spp < '$nomor'";
                    $sqlsppup=$this->db->query($sqlspptup);
                    foreach ($sqlsppup->result() as $row)
                    {
                    $jns1     = $row->nilai;
                    $jns1_    = number_format($jns1,"2",".",",");                   
                    }
                    $sqlsppttu="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='3' AND a.no_spp < '$nomor'";
                    $sqlspptu=$this->db->query($sqlsppttu);
                    foreach ($sqlspptu->result() as $row)
                    {
                    $jns3     = $row->nilai;
                    $jns3_    = number_format($jns3,"2",".",",");                   
                    } 
                    $jmlblj = $jns6 + $jns1 + $jns3;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja UP/GU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns1_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja TU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns3_</td></tr>";                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Pengadaan Barang dan Jasa</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns6_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
           
        if ($jns==3){                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='52' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-TU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-OPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-OPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">$nilai_ang.</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='52' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='6' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns6     = $row->nilai;
                    $jns6_    = number_format($jns6,"2",".",",");                   
                    } 
                    $sqlspptup="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND (a.jns_spp='1' or a.jns_spp='2') AND a.no_spp < '$nomor'";
                    $sqlsppup=$this->db->query($sqlspptup);
                    foreach ($sqlsppup->result() as $row)
                    {
                    $jns1     = $row->nilai;
                    $jns1_    = number_format($jns1,"2",".",",");                   
                    }
                    $sqlsppttu="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='3' AND a.no_spp < '$nomor'";
                    $sqlspptu=$this->db->query($sqlsppttu);
                    foreach ($sqlspptu->result() as $row)
                    {
                    $jns3     = $row->nilai;
                    $jns3_    = number_format($jns3,"2",".",",");                   
                    } 
                    $jmlblj = $jns6 + $jns1 + $jns3;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja UP/GU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns1_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja TU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns3_</td></tr>";                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Pengadaan Barang dan Jasa</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns6_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
        if ($jns==4){                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='51' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS GAJI DAN TUNJANGAN)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-OPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-OPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$nilai_ang</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='51' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='4' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns4     = $row->nilai;
                    $jns4_    = number_format($jns4,"2",".",",");                   
                    } 
                    
                    $jmlblj = $jns4;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";                                 
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Gaji dan Tunjangan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns4_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
           if ($jns==6){
        
        $sqlhspp="select * from trhspp where no_spp='$nomor'";
                 $sqlspp=$this->db->query($sqlhspp);
                 foreach ($sqlspp->result() as $rows)
                {
                    $prog  = $rows->nm_program;
                    $kdgiat  = $rows->kd_kegiatan;
                    $giat  = $rows->nm_kegiatan;
                    $rekan = $rows->nmrekan;
                    $bentuk=substr($rekan,0,2);
                    $dir   = $rows->pimpinan;
                    $kbank = $rows->bank;
                     switch ($kbank) 
                        {
                            case '01': //UP
                            $bank = "BRI";
                             break;
                            case '02': //GU
                                $bank = "MANDIRI";
                                break;
                            case '03': //TU
                                $bank = "BNI";
                                break;
                            default:
                                $bank = "BCA";                                
                        }
                    $rek    = $rows->no_rek;
                    $ket    = $rows->keperluan;
                }
                
        //$sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where kd_kegiatan='$kdgiat'";
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='52' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS BARANG DAN JASA)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>                                       
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                                      
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\"> ";
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN KEGIATAN</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >1. Program </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$prog</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >2. Kegiatan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$giat.</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >3. Nomor dan Tanggal DPA/DPPA/DPPAL-OPD </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:.</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >4. Nama Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$rekan</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >5. Bentuk Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$bentuk</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >6. Alamat Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >7. Nama Pimpinan Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$dir</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >8. Nama dan Nomor Rekening Bank </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$bank - $rek</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >9. Nomor Kontrak </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >10. Kegiatan Lanjutan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";    
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >11. Waktu Pelaksanaan Kegiatan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >12. Deskripsi Pekerjaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$ket</td></tr>";
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-OPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-OPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $nilai_ang</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    //$sql1="SELECT a.no_spd,a.tgl_spd,b.nilai FROM trdspd b INNER JOIN trhspd a ON b.no_spd=a.no_spd
//                           WHERE b.kd_kegiatan='$kdgiat' AND kd_skpd='$kd'";
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='52' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='6' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns6     = $row->nilai;
                    $jns6_    = number_format($jns6,"2",".",",");                   
                    } 
                    $sqlspptup="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND (a.jns_spp='1' or a.jns_spp='2') AND a.no_spp < '$nomor'";
                    $sqlsppup=$this->db->query($sqlspptup);
                    foreach ($sqlsppup->result() as $row)
                    {
                    $jns1     = $row->nilai;
                    $jns1_    = number_format($jns1,"2",".",",");                   
                    }
                    $sqlsppttu="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='3' AND a.no_spp < '$nomor'";
                    $sqlspptu=$this->db->query($sqlsppttu);
                    foreach ($sqlspptu->result() as $row)
                    {
                    $jns3     = $row->nilai;
                    $jns3_    = number_format($jns3,"2",".",",");                   
                    } 
                    $jmlblj = $jns6 + $jns1 + $jns3;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja UP/GU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns1_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja TU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns3_</td></tr>";                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Pengadaan Barang dan Jasa</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns6_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,15,5,10,'0'); 
           }            
    }
    
    function cetakspp3(){
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        $nomor=str_replace('123456789','/',$this->uri->segment(3));
        if ($jns==1){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RENCANA PENGGUNA ANGGARAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
       }
        if ($jns==2){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-GU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN PENGGUNAAN ANGGARAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>     
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                 $lcno = 0;
                 $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$giat.$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');  
       }
       
       if ($jns==3){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-TU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN </strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>     
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\"><strong>RENCANA PENGGUNAAN </strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');  
       }
        
        if ($jns==4){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS GAJI DAN TUNJANGAN)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>
                    <tr><td align=\"left\">BULAN :$bln </td></tr>                    
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                 $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');  
       }
       if ($jns==6){
        
        $sqltgl="SELECT tgl_spp FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS BARANG DAN JASA)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>                    
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>  
                    <tr><td align=\"center\"><strong>RINCIAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                                        
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                      
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"35%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",",",".");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"35%\">$giat.$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",",",".");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"35%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">&nbsp;</td></tr>
                    <tr><td align=\"center\">Mengetahui</td>
                    <td align=\"center\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\">Pejabat Pelaksana Teknis Kegiatan</td>
                    <td align=\"center\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">&nbsp;</td></tr>                                       
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">$nama</td></tr>
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">NIP. $nip</td></tr>
                    
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
       }                  
    }
    
     function cetak_spm(){
        $lcnospm = str_replace('123456789','/',$this->uri->segment(3));
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT a.nama as nm,a.nip as nip,a.jabatan as jab,a.kd_skpd,b.nm_skpd FROM ms_ttd a inner join ms_skpd b on 
                    a.kd_skpd=b.kd_skpd where a.kd_skpd='$kd' and kode='PT'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $skpd = $rowttd ->kd_skpd;
                    $nmskpd = $rowttd->nm_skpd;
                }
        //$thn_ang	   = $this->session->userdata('pcThang');
        
        
        
        $csql = "SELECT a.*,(SELECT nilai FROM trhspp WHERE no_spp = a.no_spp) AS nil_spp,
                (SELECT tgl_spd FROM trhspd WHERE no_spd=a.no_spd) AS tgl_spd,
                (SELECT IF(jns_beban='52','Belanja Langsung','Belanja Tidak Langsung')
                FROM trhspd WHERE no_spd=a.no_spd) AS jns_beban
                FROM trhspm a WHERE a.no_spm = '$lcnospm' ";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
        
        switch ($jns) 
        {
            case '1': //UP
                $lcbeban = "UP/<strike>GU/TU/LS</strike>";
                break;
            case '2': //GU
                $lcbeban = "<strike>UP</strike>/GU/<strike>TU/LS</strike>";
                break;
            case '3': //TU
                $lcbeban = "<strike>UP/GU</strike>/TU/<strike>LS</strike>";
                break;
            default:
                $lcbeban = "<strike>UP/GU/TU</strike>/LS";
                
        }
        
        $lcpemda = "PEMERINTAH KABUPATEN $kab";
        $lcskpd = $nmskpd;
        $lcbend = '';
        $lcrekbank = $trh->no_rek;
        $lctahun = $this->session->userdata('pcThang');
        $lcnpwp = $trh->npwp;
        $lctglspd = $trh->tgl_spd;
        $lcnospd = $trh->no_spd;
        $lckeperluan = $trh->keperluan;
        $lcjnsbelanja = $trh->jns_beban;       
        $lnterbilang =$trh->nil_spp; 
        $lcterbilang = $this->tukd_model->terbilang($lnterbilang);
        $lcnospp = $trh->no_spp;
        $ldtglspp =$this->tukd_model->tanggal_format_indonesia($trh->tgl_spp);
        
        $cRet = "";
       
       
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"-1\" cellpadding=\"-1\">
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:14px;border: solid 1px white;\">
                            <b>$lcpemda</b>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:15px;border: solid 1px white;\">
                            <b>SURAT PERINTAH MEMBAYAR (SPM)</b>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:14px;border: solid 1px white;\">
                            <b>TAHUN ANGGARAN $lctahun</b>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"right\" style=\"font-size:10px;border-right: none;border-top: none;border-left: none;\">
                            $lcbeban<br>Nomor SPM : $lcnospm
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:14px\">(disi oleh PPK-OPD)</td>
                     </tr>
                     <tr>
                         <td width=\"50%\" style=\"font-size:14px\">
                            <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        KUASA BENDAHARA UMUM DAERAH
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        $lcpemda
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Supaya menerbitkan SP2D kepada:
                                    </td>
                                </tr>
                            </table>
                         </td>
                         <td width=\"50%\" style=\"font-size:14px\" valign=\"top\">Potongan-potongan :</td>
                     </tr>
                     <tr>
                         <td width=\"50%\" style=\"font-size:14px\" valign=\"top\">
                            <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        OPD : <b>$lcskpd</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Bendahara Pengeluaran/Pihak Ketiga :<b> $lcbend</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Nomor Rekening Bank :<b> $lcrekbank</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        NPWP :<b>$lcnpwp</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Dasar Pembayaran/No dan Tanggal SPD :<b>$lcnospd , $lctglspd</b> 
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px;border-bottom: solid 1px black;border-top: solid 1px black;\">
                                     Untuk keperluan : <b>$lckeperluan<br>
                                     $lcjnsbelanja </b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                         Pembebanan pada kode rekening :
                                         <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                                            ";
                                        
                                        $sql = "select * from trdspp where no_spp='$lcnospp'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotal = $lntotal + $row->nilai;
                                           $cRet .="     
                                           <tr>
                                                <td style=\"font-size:12px\">
                                                    $lcno. $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek5)."
                                                </td>
                                                <td style=\"font-size:12px\">
                                                    : $row->nm_rek5 
                                                </td>
                                                <td style=\"font-size:12px\">
                                                    Rp
                                                </td>
                                                <td style=\"font-size:12px\" align=\"right\">
                                                    ".number_format($row->nilai)."
                                                </td>
                                            </tr>";    
                                            
                                        }
                                            
                                            
                                    $cRet .="</table>";
                                    if($lcno<=15)
                                       {
                                         for ($i = $lcno; $i <= 15; $i++) 
                                          {
                                            $cRet .="<br>";     
                                          }                                                   
                                       }
                                         
                                                                                  
                                    $cRet .="</td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px;border-bottom: solid 1px black;border-top: solid 1px black;\">
                                    Jumlah SPP yang diminta Rp.".number_format($lnterbilang)."<br>
                                    <i>($lcterbilang)</i><br>
                                    Nomor dan Tanggal SPP :$lcnospp dan $ldtglspp                                   
                                    </td>
                                </tr>
                                 <tr>
                                    <td width=\"100%\" style=\"font-size:14px;border-bottom: none;border-top: solid 1px black;\">
                                        *) coret yang tidak perlu<br>
                                        **)pilih yang sesuai                                                      
                                    </td>
                                </tr>
                            </table>
                         </td>
                         <td width=\"50%\" style=\"font-size:14px\" valign=\"top\">
                            <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">
                                <tr><thead>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">No.</td>
                                    <td width=\"50%\" style=\"font-size:14px\" align=\"center\">Uraian<br>(No. Rekening)</td>
                                    <td width=\"20%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">Jumlah</td>
                                    <td width=\"20%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">Keterangan</td>
                                    </thead>
                                </tr>";
                                 $sql = "select * from trspmpot where no_spm='$lcnospm' and pot='0'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotalpot = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotalpot = $lntotalpot + $row->nilai;
                                            $cRet .="<tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">$lcno</td>
                                                        <td align=\"left\" style=\"font-size:14px\">$row->nm_rek5</td>
                                                        <td align=\"right\">".number_format($row->nilai)."</td>
                                                        <td></td>
                                                    </tr>";    
                                        }
                                        
                                       if($lcno<=6)
                                       {
                                         for ($i = $lcno; $i <= 6; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">&nbsp;</td>
                                                        <td align=\"left\" style=\"font-size:14px\"></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                
                              
                                $cRet .="
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\"></td>
                                    <td align=\"left\" style=\"font-size:14px\">Jumlah Potongan</td>
                                    <td align=\"right\">".number_format($lntotalpot)."</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\" colspan=\"4\">
                                    Informasi :<i>(tidak mengurangi jumlah pembayaran SPM)</i>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">No.</td>
                                    <td align=\"center\" style=\"font-size:14px\">Uraian</td>
                                    <td align=\"center\" style=\"font-size:14px\">Jumlah</td>
                                    <td align=\"center\" style=\"font-size:14px\">Keterangan</td>
                                </tr>";
                                
                                
                                 $sql = "select * from trspmpot where no_spm='$lcnospm' and pot='1'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotalpot_not = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lntotalpot_not = $lntotalpot_not + $row->nilai; 
                                           $lcno = $lcno + 1;
                                            $cRet .="
                                                    <tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">$lcno</td>
                                                        <td align=\"left\" style=\"font-size:14px\">$row->nm_rek5</td>
                                                        <td align=\"right\">".number_format($row->nilai)."</td>
                                                        <td></td>
                                                    </tr>";    
                                        }
                                        
                                       if($lcno<=3)
                                       {
                                         for ($i = $lcno; $i <= 3; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">&nbsp;</td>
                                                        <td align=\"left\" style=\"font-size:14px\"></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                
                                
                                $cRet .="
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\"></td>
                                    <td align=\"left\" style=\"font-size:14px\">Jumlah</td>
                                    <td align=\"right\">".number_format($lntotalpot_not)."</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan=\"2\" width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\"> Jumlah SPM</td>
                                    <td align=\"right\">".number_format($lntotal-$lntotalpot)."</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px;border-bottom: none;\" align=\"left\" valign=\"top\" colspan=\"4\">
                                    Uang Sejumlah : <i>(".$this->tukd_model->terbilang($lntotal-$lntotalpot).")</i>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px;border-bottom: none;border-top: none;\" align=\"Center\" valign=\"top\" colspan=\"4\">
                                    <br><br>
                                    Bandung, tanggal 20 Januari 2012 <br>
                                    Kepala OPD <br><br><br>
                                    (nama lengkap)<br>
                                    NIP.
                                    <br>
                                    <br>                                    
                                    </td>
                                </tr>
                            </table>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" style=\"font-size:12px\" align=\"center\">
                         <i>SPM ini sah apabila telah di tandatangani dan distempel oleh Kepala OPD</i>
                         </td>
                     </tr>
                  </table>";
                     
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');               
        
    }
   
 function cetak_sp2d(){
		//$jns = $this->uri->segment(3);
		$lntahunang = $this->session->userdata('pcThang');
        $lcnosp2d = str_replace('123456789','/',$this->uri->segment(3));
       // $lcttd = str_replace('123456789','/',$this->uri->segment(5));
        $lcttd = str_replace('abc',' ',$this->uri->segment(5));
	    $banyak = $this->uri->segment(6);
		$jns_cetak = $this->uri->segment(7);
        $a ='*'.$lcnosp2d.'*';
        $csql = "SELECT a.*,
				(SELECT nmrekan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS nmrekan,
				(SELECT pimpinan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS pimpinan,
				(SELECT alamat FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS alamat
                 FROM trhsp2d a WHERE a.no_sp2d = '$lcnosp2d'";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
		$lckd_skpd  = $trh->kd_skpd;
        $lcnospm    = $trh->no_spm;
        $ldtglspm   = $trh->tgl_spm;
        $lcnmskpd   = $trh->nm_skpd;
        $lckdskpd   = $trh->kd_skpd;
        $alamat     = $trh->alamat;
        $lcnpwp     = $trh->npwp;
        $rekbank    = $trh->no_rek;
        $lcperlu    = $trh->keperluan;
        $lcnospp    = $trh->no_spp;
        $tgl        = $trh->tgl_sp2d;
        //$n          = $trh->nilai;
		$pimpinan	= $trh->pimpinan;
        $nmrekan	=$trh->nmrekan;
		$jns_bbn	=$trh->jenis_beban;
		$jns		=$trh->jns_spp;
        $bank=$trh->bank;
		$banyak_kar = strlen($lcperlu);
        $tanggal    = $this->tanggal_format_indonesia($tgl);
		//$banyak = $banyak_kar > 400 ? 14 :23;                     

        $csqlnilai = "SELECT sum(nilai) [nilai] from  trdspp WHERE no_spp = '$lcnospp'";
        $hasiln = $this->db->query($csqlnilai);
		$trhn = $hasiln->row();
		$n          = $trhn->nilai;
        
		$sqlrek="SELECT bank,rekening, npwp FROM ms_skpd WHERE kd_skpd = '$lckd_skpd' ";
                 $sqlrek=$this->db->query($sqlrek);
                 foreach ($sqlrek->result() as $rowrek)
                {
                    $bank_ben=$rowrek->bank;                    
                    $rekben=$rowrek->rekening;                    
                    $npwp_ben= $rowrek->npwp;
                }
			$rek_ben = empty($rekben) || $rekben == 0 ? '' :$rekben;
			$npwp_ben = empty($npwp_ben) || $npwp_ben == 0 ? '' :$npwp_ben;
			$nama_bank = empty($bank) ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank,'nama','ms_bank','kode');
			$nama_bank_ben = empty($bank_ben) ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank_ben,'nama','ms_bank','kode');
			//$nama_bank_ben = $this->rka_model->get_nama(12,'nama','ms_bank','kode');		
			$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
		$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$lckdskpd' AND kode='BK' ";
                 $sqlnam=$this->db->query($sqlnam);
                 foreach ($sqlnam->result() as $rownam)
                {
                    $nama_ben=$rownam->nama;                    
                    $jabat_ben=$rownam->jabatan;                    
                }
		$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
		$jabat_ben = empty($jabat_ben) ? ' ' :$jabat_ben;
        
		if (($jns == '1') or ($jns == '2')  or ($jns == '4') or ($jns == '5')){
		$kd_kegi = '';                    
		$nm_kegi = ''; 
		$kd_prog = ''; 
		$nm_prog = '';	
		}
		else {
		$sql12="SELECT kd_kegiatan FROM trdspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp AND a.kd_skpd=b.kd_skpd 
				WHERE b.kd_skpd = '$lckdskpd' AND no_sp2d='$lcnosp2d' group by kd_kegiatan ";
                 $sqlrek12=$this->db->query($sql12);
                 foreach ($sqlrek12->result() as $rowrek)
                {
                    $kd_kegi=$rowrek->kd_kegiatan;                    
                }
		$nm_kegi = " - ".$this->rka_model->get_nama($kd_kegi,'nm_kegiatan','trskpd','kd_kegiatan') ; 
		$kd_prog = $this->left($kd_kegi,18); 
		$nm_prog = " - ".$this->rka_model->get_nama($kd_prog,'nm_program','trskpd','kd_program'); 
		}
		if($jns_cetak=='2'){
			$tinggi='150px';
			//$banyak=9;
			$banyak=10;
		} else 
		if($jns_cetak=='1'){
			//$tinggi='80px';
			$tinggi='10px';
			//$banyak=15;
			$banyak=16;
		}else{
			$tinggi='10px';
			$banyak=$banyak;
		}		
		
		$cRet = '';
                 $cRet .="<!--<table style=\"font-family: Tahoma; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td rowspan=\"4\" align=\"right\">
                        <img src=\"".base_url()."/image/logo.bmp\"  width=\"75\" height=\"100\" />
                        </td>
					<td align=\"center\" style=\"font-size:14px\"><strong>PEMERINTAH PROVINSI KALIMANTAN BARAT </strong></td></tr>
                    <tr><td align=\"center\" style=\"font-size:15px\"><strong>BADAN PENGELOLAAN KEUANGAN DAN PENDAPATAN DAERAH</strong></tr>
					<tr><td align=\"center\" style=\"font-size:12px\">Jalan Ahmad Yani Telepon (0561) 736541 Fax. (0561) 738428</tr>
                    <tr><td align=\"center\">P O N T I A N A K</td></tr>
					<tr><td colspan=\"2\" style=\"border-bottom: hidden;\" align=\"right\" >Kode Pos: 78124 &nbsp; &nbsp;</td></tr>
                    <tr></td><td colspan=\"2\" style=\"border-top: 2px solid black;border-bottom: 1px solid black;font-size:1px;\"  align=\"right\" >&nbsp;</td></tr>
                    </table>
                    &nbsp;<br><br>-->
					";
        $cRet .= "<br><br><br><br><br><br><br>
		<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px;\"  width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">";
        $cRet .="
		<tr>
            <td align=\"center\" width=\"50%\" style=\"border-collapse:collapse;font-weight:bold; font-size:12px\"> PROVINSI KALIMANTAN BARAT
            </td>
            <td align=\"center\" width=\"50%\">
                <table style=\"border-collapse:collapse;font-size:12px; font-weight: bold;\" width=\"100%\" align=\"center\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td align=\"right\">
                            <b>Nomor : $lcnosp2d</b>
                        </td>
                    </tr>
                    <tr>
                        <td align=\"center\">
                            SURAT PERINTAH PENCAIRAN DANA<br>(SP2D)
                        </td>
                    </tr>
                </table>
            </td>
        </tr>   
        <tr>
            <td style=\"border-left:solid 1px black;\" >
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" valign=\"top\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
      					<tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"25%\" align=\"left\" valign=\"top\">&nbsp;Nomor SPM</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"2%\" valign=\"top\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"73%\" valign=\"top\">$lcnospm</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">&nbsp;Tanggal</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\" >:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">".$this->tanggal_format_indonesia($ldtglspm)."</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">&nbsp;OPD</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\" height=\"60px\">$lckd_skpd $lcnmskpd</td>
                    </tr>
                </table>
            </td>
            <td>
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\"  valign=\"top\" border=\"0\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td valign=\"top\">&nbsp;Dari &nbsp; : Kuasa Bendahara Umum Daerah (Kuasa BUD)</td>
                    </tr>
					 <tr>
                        <td valign=\"top\" >&nbsp;Tahun Anggaran : &nbsp;$lntahunang</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
			<tr>
		<td colspan=\"2\">
			<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12x\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" width=\"120px\">&nbsp;Bank/Pos</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;PT. Bank Kalbar Cabang Utama Pontianak</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden;\" colspan=\"2\" >&nbsp;Hendaklah mencairkan / memindahbukukan dari baki Rekening Nomor 1001002201</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" >&nbsp;Uang sebesar Rp</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;".number_format($n,'2',',','.')."  (".$this->tukd_model->terbilang($n).") </td>
			</tr>
			</table>
        </td>
		</tr>	
        <tr>
            <td colspan=\"2\">";
		if(($jns==6) && ($jns_bbn==3)){

             $cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td valign=\"top\" width=\"120px\">&nbsp;Kepada</td>
					<td valign=\"top\" width=\"10px\" >:</td>
                    <td valign=\"top\" >$pimpinan, $nmrekan, $alamat</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;NPWP</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$lcnpwp</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;No.Rekening Bank</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$rekbank</td>
                </tr>
                <tr>
                    <td valign=\"top\">&nbsp;Bank/Pos</td>
					<td valign=\"top\">:</td>
                    <td valign=\"top\">$nama_bank</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td height=\"$tinggi\" valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu
					<br>".$this->right($kd_prog,2)."$nm_prog
					<br>".$this->right($kd_kegi,2)."$nm_kegi
					</td>

				</tr>
                </table> ";
		}
		else if($jns==5 ){

             $cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td valign=\"top\" width=\"120px\">&nbsp;Kepada</td>
					<td valign=\"top\" width=\"10px\" >:</td>
                    <td valign=\"top\" >$nmrekan, $alamat</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;NPWP</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$lcnpwp</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;No.Rekening Bank</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$rekbank</td>
                </tr>
                <tr>
                    <td valign=\"top\">&nbsp;Bank/Pos</td>
					<td valign=\"top\">:</td>
                    <td valign=\"top\">$nama_bank</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td height=\"$tinggi\" valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu
					<br>".$this->right($kd_prog,2)."$nm_prog
					<br>".$this->right($kd_kegi,2)."$nm_kegi
					</td>

				</tr>
                </table> ";
		}else{
			$cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td valign=\"top\" width=\"120px\">&nbsp;Kepada </td>
					<td valign=\"top\" width=\"10px\">:&nbsp;</td>
                    <td valign=\"top\" font-family: Arial; >$nama_ben - $jabat_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;NPWP</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$npwp_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;No.Rekening Bank</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$rek_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Bank/Pos</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$nama_bank_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td height=\"$tinggi\" valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu
					<br>".$this->right($kd_prog,2)."$nm_prog
					<br>".$this->right($kd_kegi,2)."$nm_kegi
					</td>
				</tr>
                </table> ";
			
		}
         $cRet	.="  </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"5%\" align=\"center\"><b>NO</b></td>
                        <td width=\"28%\" align=\"center\"><b>KODE REKENING</b></td>
                        <td align=\"center\"><b>URAIAN</b></td>
                        <td width=\"15%\" align=\"center\"><b>JUMLAH (Rp)</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">1</td>
                        <td align=\"center\">2</td>
                        <td align=\"center\">3</td>
                        <td align=\"center\">4</td>
                    </tr>";
			$sql_total="SELECT sum(nilai)total FROM trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                 $sql_x=$this->db->query($sql_total);
                 foreach ($sql_x->result() as $row_x)
                {
                    $lntotal=$row_x->total;                    
                }
				if(($jns==1) || ($jns==2)){
                                        $sql = "select SUM(nilai) nilai from trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotal = $lntotal + $row->nilai;
										    $cRet .="<tr>
                                                        <td style=\"border-bottom: hidden;\" align=\"center\">&nbsp;1</td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $lckd_skpd  </td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $lcnmskpd</td>
                                                        <td style=\"border-bottom: hidden;\" align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                                    </tr>"; 
                                          
										}  
											if($lcno<=$banyak)
											   {
												 for ($i = $lcno; $i <= $banyak; $i++) 
												  {
													 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";    
												  }                                                   
											   } 
										   }
				else{
				
				
				
				$sql1 = "select COUNT(*) as jumlah from 
							(select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd' 
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox";
						$hasil1 = $this->db->query($sql1);
						$row1 = $hasil1->row();
						$jumlahbaris = $row1->jumlah;  
						if($jumlahbaris<=$banyak){
							$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox order by kd_rek";
						}else{
							$sql = "select * from (select '1' urut, kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select '2' as urut, '' as kd_kegiatan, '' kd_rek, '(Rincian Terlampir)' as nm_rek, 0 as nilai
							) tox order by urut,kd_rek";	
						}
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
										$lcno_baris = 0;
                                       // $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {	
											$lcno_baris = $lcno_baris + 1;										
											if (strlen($row->kd_rek)>=7){
											$lcno = $lcno + 1;
											$lcno_x = $lcno;
											}
											else {
												$lcno_x ='';
											}
//                                           $lntotal = $lntotal + $row->nilai;                                           
                                           $cRet .="<tr>
                                                        <td style=\"border-bottom: hidden;\" align=\"center\">&nbsp;$lcno_x</td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek)." </td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->nm_rek</td>
                                                        <td style=\"border-bottom: hidden;\" align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                                    </tr>";    
                                            
                                        }
                                        if($lcno_baris<=$banyak)
                                       {
                                         for ($i = $lcno_baris; $i <= $banyak; $i++) 
                                          {
                                            $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";    
                                          }                                                   
                                       }
                                       
				}     
             $cRet .="<tr>
                        <td align=\"right\" colspan=\"3\">&nbsp;<b>JUMLAH&nbsp;</b></td>
                        <td align=\"right\"><b>".number_format($lntotal,"2",",",".")."</b>&nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan=\"4\">&nbsp;Potongan-potongan</td>
                    </tr>
                    <tr>
                        <td  align=\"center\"><b>NO</b></td>
                        <td  align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td  align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td  align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                    
                    $sql = "select * from trspmpot where no_spm='$lcnospm' AND kd_rek5 IN('2111001','4140611','2110501','2110701','2110702','2110703','2110801','2110901','4140612','2111501')";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpot = 0;
                            foreach ($hasil->result() as $row){
                               $lcno = $lcno + 1;
                               $lntotalpot = $lntotalpot + $row->nilai;
                                $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td>&nbsp; $row->nm_rek5</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                        
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpot,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     <tr>
                        <td colspan=\"4\">&nbsp;Informasi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>(tidak mengurangi jumlah pembayaran SP2D)</i></td>
                    </tr>
            
                    <tr>
                        <td align=\"center\"><b>NO</b></td>
                        <td align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                     $sql = "select 1 urut, * from trspmpot where no_spm='$lcnospm' AND kd_rek5 IN('2130301')
							UNION ALL
							select 2 urut, * from trspmpot where no_spm='$lcnospm' AND kd_rek5 NOT IN('2111001','4140611','2130301','2110501','2110701','2110702','2110703','2110801','2110901','4140612','2111501')
							ORDER BY urut,kd_rek5";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpott = 0;
                            foreach ($hasil->result() as $row)
                            {
                               $lcno = $lcno + 1;
                               $lntotalpott = $lntotalpott + $row->nilai;
                               $kode_rek=$row->kd_rek5;
							   if($kode_rek=='2130101'){
								   $nama_rek='PPh 21';
							   } else if ($kode_rek=='2130201'){
								   $nama_rek='PPh 22';
							   } else if($kode_rek=='2130301'){
								   $nama_rek='PPN';
							   } else if($kode_rek=='2130401'){
								   $nama_rek='PPh 23';
							   } else if($kode_rek=='2130501'){
								   $nama_rek='PPh Pasal 4';
							   } else{
								    $nama_rek=$row->nm_rek5;
							   }
							   $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td> &nbsp; $nama_rek</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
							
							
							
							$jum_bayar=strval($lntotal-$lntotalpot);
							$bil_bayar = strval($lntotal-($lntotalpot+$lntotalpott));
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpott,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     
                </table>  
            </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"-1\" cellpadding=\"-1\">
                   <tr>
                        <td colspan=\"4\" valign=\"bottom\" style=\"font-weight: bold;\">&nbsp;SP2D yang Dibayarkan</td>
                    </tr>
				   <tr>
				   
                        <td width=\"28%\" align=\"left\">&nbsp;Jumlah yang Diterima</td>
                        <td style=\"border-left: hidden;\" width=\"4%\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" width=\"50%\" align=\"right\">&nbsp;".number_format($lntotal,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" width=\"20%\" align=\"center\">&nbsp;</td>
						</tr>
                    <tr > 
                        <td align=\"left\">&nbsp;Jumlah Potongan</td>
                        <td style=\"border-left: hidden;\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" align=\"right\" >&nbsp; ".number_format($lntotalpot+$lntotalpott,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>
                    <tr style=\"font-weight: bold;\">
                        <td align=\"left\">&nbsp;<b>Jumlah yang Dibayarkan</b></td>
                        <td style=\"border-left: hidden;\" align=\"left\"><b>&nbsp;RP</b></td>
                        <td style=\"border-left: hidden;font-size:11px;\" align=\"right\"><b>&nbsp; ".number_format($lntotal-($lntotalpot+$lntotalpott),"2",",",".")."</b></td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>                    
                </table>  
            </td>
        </tr>
        
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-weight: bold;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			<tr>
                        <td colspan=\"2\" align=\"left\" >&nbsp;Uang Sejumlah :
                        (&nbsp;".$this->tukd_model->terbilang($bil_bayar)."&nbsp;)</td>
						
	
                    </tr>
				<tr>
                        <td width=\"70%\" align=\"left\" style=\"font-size:10px\" valign=\"top\">
                        <br>&nbsp;Lembar 1 : Bank Yang Ditunjukan<br>
                        &nbsp;Lembar 2 : Pengguna Anggaran/Kuasa Pengguna Anggaran<br>
                        &nbsp;Lembar 3 : Arsip Kuasa BUD<br>
                        &nbsp;Lembar 4 : Pihak Ketiga<br>
                               
                        </td>
                        <td width=\"30%\" align=\"center\">
                        <br>
                        Pontianak, $tanggal<br>
                        $jabatan<br>Kuasa Bendahara Umum Daerah
                        <br>
                        <br>
                        <br>
                        <br>
                        <u>$nama</u><br>
                        $pangkat<br>
                        NIP. $nip                
                        </td>
                   </tr>
                </table>  
            </td>
        </tr>
        
        
        </table>";
        $data['prev']= $cRet;
        //echo "$cRet"  ;  
        $this->_mpdf_sp2d2('',$cRet,10,5,5,'0');
    }

 
   
	function cetak_lamp_sp2d(){
		//$jns = $this->uri->segment(3);
		$lntahunang = $this->session->userdata('pcThang');
        $lcnosp2d = str_replace('123456789','/',$this->uri->segment(3));
		
       // $lcttd = str_replace('123456789','/',$this->uri->segment(5));
        $lcttd = str_replace('abc',' ',$this->uri->segment(5));
	    $banyak = $this->uri->segment(6);
		$jns_cetak = $this->uri->segment(7);
        $a ='*'.$lcnosp2d.'*';
         $csql = "SELECT a.*,
				(SELECT nmrekan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS nmrekan,
				(SELECT pimpinan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS pimpinan,
				(SELECT alamat FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS alamat
                 FROM trhsp2d a WHERE a.no_sp2d = '$lcnosp2d'";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
		$lckd_skpd  = $trh->kd_skpd;
        $lcnospm    = $trh->no_spm;
        $ldtglspm   = $trh->tgl_spm;
        $lcnmskpd   = $trh->nm_skpd;
        $lckdskpd   = $trh->kd_skpd;
        $alamat     = $trh->alamat;
        $lcnpwp     = $trh->npwp;
        $rekbank    = $trh->no_rek;
        $lcperlu    = $trh->keperluan;
        $lcnospp    = $trh->no_spp;
        $tgl        = $trh->tgl_sp2d;
        $n          = $trh->nilai;
		$pimpinan	= $trh->pimpinan;
        $nmrekan	=$trh->nmrekan;
		$jns_bbn	=$trh->jenis_beban;
		$jns		=$trh->jns_spp;
        $bank=$trh->bank;
		$banyak_kar = strlen($lcperlu);
        $tanggal    = $this->tanggal_format_indonesia($tgl);
		//$banyak = $banyak_kar > 400 ? 14 :23;

		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
				
		 $cRet ="";
		 $cRet	.="<br><br><br><br><br><br><br>  
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:13px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"100%\" align=\"center\"><b>Daftar Lampiran SP2D Nomor: $lcnosp2d </b></td>
                    </tr>
					<tr>
                        <td align=\"center\"><b>Tanggal : $tanggal</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">&nbsp;</td>
                    </tr>
				</table>";
         $cRet	.="  
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"5%\" align=\"center\"><b>NO</b></td>
                        <td width=\"28%\" align=\"center\"><b>KODE REKENING</b></td>
                        <td align=\"center\"><b>URAIAN</b></td>
                        <td width=\"15%\" align=\"center\"><b>JUMLAH (Rp)</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">1</td>
                        <td align=\"center\">2</td>
                        <td align=\"center\">3</td>
                        <td align=\"center\">4</td>
                    </tr>";
		
			$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(kd_rek5,2),nm_rek2,kd_kegiatan
			union all
			select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(kd_rek5,3),nm_rek3,kd_kegiatan
			union all
			select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(kd_rek5,5),nm_rek4,kd_kegiatan
			union all
			select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
			) tox order by kd_rek";
		
			$hasil = $this->db->query($sql);
			$lcno = 0;
			$lcno_baris = 0;
			$lntotal = 0;
			foreach ($hasil->result() as $row)
		   {	
				$lcno_baris = $lcno_baris + 1;										
				if (strlen($row->kd_rek)>=7){
				$lcno = $lcno + 1;
				$lcno_x = $lcno;
				$lntotal = $lntotal+$row->nilai;
				}
				else {
					$lcno_x ='';
				}
//                                           $lntotal = $lntotal + $row->nilai;                                           
			   $cRet .="<tr>
							<td align=\"center\">&nbsp;$lcno_x</td>
							<td >&nbsp; $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek)." </td>
							<td >&nbsp; $row->nm_rek</td>
							<td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
						</tr>";    
			}
             $cRet .="<tr>
                        <td align=\"right\" colspan=\"3\">&nbsp;<b>JUMLAH&nbsp;</b></td>
                        <td align=\"right\"><b>".number_format($lntotal,"2",",",".")."</b>&nbsp;</td>
                    </tr>
        </table>";
		 $cRet .="<table style=\"border-collapse:collapse; font-family:Tahoma; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\"></td>
                    <td width=\"50%\" align=\"center\">Pontianak, $tanggal</td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\"></td>
                    <td width=\"50%\" align=\"center\">$jabatan<br>Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
					</tr>                              
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
					</tr>                                       
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\"><b><u>$nama</u></b></td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">$pangkat</td>
					</tr>

                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">NIP. $nip</td>
					</tr>
                    
                  </table>";
        $data['prev']= $cRet;
        //echo "$cRet"  ;  
				//$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'0');
				$this->_mpdf_sp2d2('',$cRet,10,5,5,'0');
    }
  
      
	function cetak_sp2d_lama(){
		$prv = $this->db->query("SELECT * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->kab_kota;       
		$kab = $prvn->provinsi;       
		$daerah = $prvn->daerah;       
		//$jns = $this->uri->segment(3);
		$lntahunang = $this->session->userdata('pcThang');
        $lcnosp2d = str_replace('123456789','/',$this->uri->segment(3));
       // $lcttd = str_replace('123456789','/',$this->uri->segment(5));
        $lcttd = str_replace('abc',' ',$this->uri->segment(5));
//	    $lcttd = $this->uri->segment(5);
        $a ='*'.$lcnosp2d.'*';
        $csql = "SELECT a.*,
				(SELECT nmrekan FROM trhspp WHERE no_spp = a.no_spp) AS nmrekan,
				(SELECT pimpinan FROM trhspp WHERE no_spp = a.no_spp) AS pimpinan
                 FROM trhsp2d a WHERE a.no_sp2d = '$lcnosp2d'";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
		
		$lckd_skpd  = $trh->kd_skpd;
        $lcnospm    = $trh->no_spm;
        $ldtglspm   = $trh->tgl_spm;
        $lcnmskpd   = $trh->nm_skpd;
        $lckdskpd   = $trh->kd_skpd;
        //$lckpd      = $trh->nmrekan;
        $lcnpwp     = $trh->npwp;
        $rekbank    = $trh->no_rek;
        $lcperlu    = $trh->keperluan;
        $lcnospp    = $trh->no_spp;
        $tgl        = $trh->tgl_sp2d;
        $n          = $trh->nilai;
		$pimpinan	= $trh->pimpinan;
        $nmrekan	=$trh->nmrekan;
		$jns_bbn	=$trh->jenis_beban;
		$jns		=$trh->jns_spp;
        $bank=$trh->bank;
		$banyak_kar = strlen($lcperlu);
        $tanggal    = $this->tanggal_format_indonesia($tgl);
		$banyak = $banyak_kar > 400 ? 14 :22;                     

        
		$sqlrek="SELECT bank,rekening, npwp FROM ms_skpd WHERE kd_skpd = '$lckdskpd' ";
                 $sqlrek=$this->db->query($sqlrek);
                 foreach ($sqlrek->result() as $rowrek)
                {
                    $bank_ben=$rowrek->bank;                    
                    $rekben=$rowrek->rekening;                    
                    $npwp_ben= $rowrek->npwp;
                }
		$rek_ben = empty($rekben) || $rekben == 0 ? '' :$rekben;
		$npwp_ben = empty($npwp_ben) || $npwp_ben == 0 ? '' :$npwp_ben;
		$nama_bank = empty($bank) || $bank == 0 ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank,'nama','ms_bank','kode');
		$nama_bank_ben = empty($bank_ben) || $bank_ben == 0 ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank_ben,'nama','ms_bank','kode');		
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
				
		$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$lckdskpd' AND kode='BK' ";
                 $sqlnam=$this->db->query($sqlnam);
                 foreach ($sqlnam->result() as $rownam)
                {
                    $nama_ben=$rownam->nama;                    
                    $jabat_ben=$rownam->jabatan;                    
                }
		$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
		$jabat_ben = empty($jabat_ben) || $jabat_ben == 0 ? ' ' :$jabat_ben;
        $cRet = '';
        $cRet = "<br><br><br><br><br><br><br>
		<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px;\"  width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">";
        $cRet .="
		<tr>
            <td align=\"center\" width=\"50%\" style=\"border-collapse:collapse;font-weight:bold; font-size:12px\">PROVINSI KALIMANTAN BARAT
            </td>
            <td align=\"center\" width=\"50%\">
                <table style=\"border-collapse:collapse;font-size:12px; font-weight: bold;\" width=\"100%\" align=\"center\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td align=\"right\">
                            <b>Nomor : $lcnosp2d</b>
                        </td>
                    </tr>
                    <tr>
                        <td align=\"center\">
                            SURAT PERINTAH PENCAIRAN DANA<br>(SP2D)
                        </td>
                    </tr>
                </table>
            </td>
        </tr>   
        <tr>
            <td style=\"border-left:solid 1px black;\" >
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" valign=\"top\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
      					<tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"30%\" align=\"left\">&nbsp;Nomor SPM</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"2%\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"69%\">$lcnospm</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >&nbsp;Tanggal</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >".$this->tanggal_format_indonesia($ldtglspm)."</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">&nbsp;OPD</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >$lckd_skpd $lcnmskpd</td>
                    </tr>
                </table>
            </td>
            <td>
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\"  valign=\"top\" border=\"0\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td valign=\"top\">&nbsp;Dari &nbsp; : Kuasa Bendahara Umum Daerah (Kuasa BUD)</td>
                    </tr>
					 <tr>
                        <td valign=\"top\" >&nbsp;Tahun Anggaran : &nbsp;$lntahunang</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
			<tr>
		<td colspan=\"2\">
			<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" width=\"30%\">&nbsp;Bank/Pos</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;PT. Bank Kalbar Cabang Utama Pontiana</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden;\" colspan=\"2\" >&nbsp;Hendaklah mencairkan / memindahbukukan dari baki Rekening Nomor 1001002201</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" >&nbsp;Uang sebesar Rp</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;".number_format($n,'2',',','.')."  </td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" >&nbsp;</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;(".$this->tukd_model->terbilang($n).") </td>
			</tr>
			</table>
        </td>
</tr>	
        <tr>
            <td colspan=\"2\">";
		if(($jns==6) && ($jns_bbn==3) ){

             $cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td width=\"30%\">&nbsp;Kepada</td>
					<td width=\"1%\">:</td>
                    <td>&nbsp;$pimpinan $nmrekan</td>
                </tr>
                <tr>
                    <td >&nbsp;NPWP</td>
					<td >:</td>
                    <td>&nbsp;$lcnpwp</td>
                </tr>
                <tr>
                    <td >&nbsp;No.Rekening Bank</td>
					<td >:</td>
                    <td>&nbsp;$rekbank</td>
                </tr>
                <tr>
                    <td >&nbsp;Bank/Pos</td>
					<td >:</td>
                    <td>&nbsp;$nama_bank</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td >:</td>
                    <td valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >&nbsp;$lcperlu</td>

				</tr>
                </table> ";
		}else{
			$cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td width=\"30%\">&nbsp;Kepada </td>
					<td width=\"2%\">:</td>
                    <td width=\"68%\">$nama_ben $jabat_ben</td>
                </tr>
                <tr>
                    <td >&nbsp;NPWP</td>
					<td >:</td>
                    <td>$npwp_ben</td>
                </tr>
                <tr>
                    <td >&nbsp;No.Rekening Bank</td>
					<td >:</td>
                    <td>$rek_ben</td>
                </tr>
                <tr>
                    <td >&nbsp;Bank/Pos</td>
					<td >:</td>
                    <td>$nama_bank_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu</td>

				</tr>
                </table> ";
			
		}
         $cRet	.="  </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"5%\" align=\"center\"><b>NO</b></td>
                        <td width=\"28%\" align=\"center\"><b>KODE REKENING</b></td>
                        <td align=\"center\"><b>URAIAN</b></td>
                        <td width=\"15%\" align=\"center\"><b>JUMLAH (Rp)</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">1</td>
                        <td align=\"center\">2</td>
                        <td align=\"center\">3</td>
                        <td align=\"center\">4</td>
                    </tr>";
			$sql_total="SELECT sum(nilai)total FROM trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                 $sql_x=$this->db->query($sql_total);
                 foreach ($sql_x->result() as $row_x)
                {
                    $lntotal=$row_x->total;                    
                }
				if(($jns==1) || ($jns==2)){
                                        $sql = "select SUM(nilai) nilai from trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotal = $lntotal + $row->nilai;
										   
                                           $cRet .="   
											  <tr>
                                                <td>
                                                  1  
                                                </td>
                                                <td>
                                                    $lckd_skpd 
                                                </td>
                                                <td>
                                                    $lcnmskpd
                                                </td>
                                                <td style=\"font-size:12px\" align=\"right\">
                                                    ".number_format($row->nilai,"2",",",".")."
                                                </td>
                                            </tr>"; 
										}  
											if($lcno<=$banyak)
											   {
												 for ($i = $lcno; $i <= $banyak; $i++) 
												  {
													$cRet .="<tr>
                                                        <td align=\"center\">&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td align=\"right\"></td>
                                                    </tr>";    
												  }                                                   
											   } 
										   }
				else{
				
				
				
				$sql1 = "select COUNT(*) as jumlah from 
							(select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd' 
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox";
						$hasil1 = $this->db->query($sql1);
						$row1 = $hasil1->row();
						$jumlahbaris = $row1->jumlah;  
						if($jumlahbaris<=$banyak){
							$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox order by kd_rek";
						}else{
							$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							) tox order by kd_rek";	
						}
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
										$lcno_baris = 0;
                                       // $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {	
											$lcno_baris = $lcno_baris + 1;										
											if (strlen($row->kd_rek)>=7){
											$lcno = $lcno + 1;
											$lcno_x = $lcno;
											}
											else {
												$lcno_x ='';
											}
//                                           $lntotal = $lntotal + $row->nilai;                                           
                                           $cRet .="<tr>
                                                        <td style=\"border-bottom: hidden;\" align=\"center\">&nbsp;$lcno_x</td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek)." </td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->nm_rek</td>
                                                        <td style=\"border-bottom: hidden;\" align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                                    </tr>";    
                                            
                                        }
                                        if($lcno_baris<=3)
                                       {
                                         for ($i = $lcno_baris; $i <= $banyak; $i++) 
                                          {
                                            $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";    
                                          }                                                   
                                       }
                                       for ($i = 0; $i <= 10; $i++){
									    $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";
										}			
										 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										$cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										$cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 													
				}     
             $cRet .="<tr>
                        <td align=\"right\" colspan=\"3\">&nbsp;<b>JUMLAH&nbsp;</b></td>
                        <td align=\"right\"><b>".number_format($lntotal,"2",",",".")."</b>&nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan=\"4\">&nbsp;Potongan-potongan</td>
                    </tr>
                    <tr>
                        <td  align=\"center\"><b>NO</b></td>
                        <td  align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td  align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td  align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                    
                    $sql = "select * from trspmpot where no_spm='$lcnospm' AND kd_rek5 IN('2110501','2110701','2110702','2110703','2110801','2110901','4140612')";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpot = 0;
                            foreach ($hasil->result() as $row){
                               $lcno = $lcno + 1;
                               $lntotalpot = $lntotalpot + $row->nilai;
							   $kode_rek=$row->kd_rek5;
							   $nama_rek=$row->nm_rek5;
							   /*if($kode_rek=='2110901'){
								   $nama_rek='IWP PPNPN';
							   } else {
								    $nama_rek=$row->nm_rek5;
							   }*/
                                $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td>&nbsp; $nama_rek</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                        
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpot,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     <tr>
                        <td colspan=\"4\">&nbsp;Informasi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>(tidak mengurangi jumlah pembayaran SP2D)</i></td>
                    </tr>
            
                    <tr>
                        <td align=\"center\"><b>NO</b></td>
                        <td align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                     $sql = "select * from trspmpot where no_spm='$lcnospm' AND kd_rek5 NOT IN('2110501','2110701','2110702','2110703','2110801','2110901','4140612') order by kd_rek5";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpott = 0;
                            foreach ($hasil->result() as $row)
                            {
                               $lcno = $lcno + 1;
                               $lntotalpott = $lntotalpott + $row->nilai;
                                $kode_rek=$row->kd_rek5;
							   if($kode_rek=='2130101'){
								   $nama_rek='PPh 21';
							   } else if ($kode_rek=='2130201'){
								   $nama_rek='PPh 22';
							   } else if($kode_rek=='2130301'){
								   $nama_rek='PPN';
							   } else if($kode_rek=='2130401'){
								   $nama_rek='PPh 23';
							   } else if($kode_rek=='2130501'){
								   $nama_rek='PPh Pasal 4';
							   } else{
								    $nama_rek=$row->nm_rek5;
							   }
							   $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td> &nbsp; $nama_rek</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
							
							
							
							$jum_bayar=strval($lntotal-$lntotalpot);
                    
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpott,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     
                </table>  
            </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"-1\" cellpadding=\"-1\">
                   <tr>
                        <td colspan=\"4\" valign=\"bottom\" style=\"font-weight: bold;\">&nbsp;SP2D yang Dibayarkan</td>
                    </tr>
				   <tr>
				   
                        <td width=\"28%\" align=\"left\">&nbsp;Jumlah yang Diterima</td>
                        <td style=\"border-left: hidden;\" width=\"4%\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" width=\"50%\" align=\"right\">&nbsp;".number_format($lntotal,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" width=\"20%\" align=\"center\">&nbsp;</td>
						</tr>
                    <tr > 
                        <td align=\"left\">&nbsp;Jumlah Potongan</td>
                        <td style=\"border-left: hidden;\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" align=\"right\" >&nbsp; ".number_format($lntotalpot+$lntotalpott,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>
                    <tr style=\"font-weight: bold;\">
                        <td align=\"left\">&nbsp;<b>Jumlah yang Dibayarkan</b></td>
                        <td style=\"border-left: hidden;\" align=\"left\"><b>&nbsp;RP</b></td>
                        <td style=\"border-left: hidden;font-size:11px;\" align=\"right\"><b>&nbsp; ".number_format($lntotal-($lntotalpot+$lntotalpott),"2",",",".")."</b></td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>                    
                </table>  
            </td>
        </tr>
        
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-weight: bold;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			<tr>
                        <td colspan=\"2\" align=\"left\" >&nbsp;Uang Sejumlah :
                        (&nbsp;".$this->tukd_model->terbilang($jum_bayar)."&nbsp;)</td>
						
	
                    </tr>
				<tr>
                        <td width=\"70%\" align=\"left\" style=\"font-size:10px\" valign=\"top\">
                        <br>&nbsp;Lembar 1 : Bank Yang Ditunjukan<br>
                        &nbsp;Lembar 2 : Pengguna Anggaran/Kuasa Pengguna Anggaran<br>
                        &nbsp;Lembar 3 : Arsip Kuasa BUD<br>
                        &nbsp;Lembar 4 : Pihak Ketiga<br>
                               
                        </td>
                        <td width=\"30%\" align=\"center\">
                        <br>
                        $daerah, $tanggal<br>
                        $jabatan<br>
						Kuasa Bendahara Umum Daerah
                        <br>
                        <br>
                        <br>
                        <br>
                        <u>$nama </u><br>
                        $pangkat <br>
                        NIP. $nip                
                        </td>
                   </tr>
                </table>  
            </td>
        </tr>
        
        
        </table>";
        $data['prev']= $cRet;
        //echo "$cRet"  ;  
        $this->_mpdf_sp2d2('',$cRet,10,5,5,'0');
    }
    
      
     function cetak_register_spp(){
		$kd_skpd     = $this->session->userdata('kdskpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$kd_skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
$cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
$cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>REGISTER SPP-UP/SPP-GU/SPP-TU/SPP-LS</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>$a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"3\"><b>Tanggal</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Nomor SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"19%\" rowspan=\"3\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Jumlah SPP<br>(Rp)</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
          </tr>
          <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
          </tr>
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"6%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"19%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>5</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT tgl_spp,no_spp,nilai,keperluan,jns_spp FROM trhspp $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                   $lcno = $lcno + 1;
                    switch ($row->jns_spp) 
                    {
                        case '1': //UP
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '2': //GU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '3': //TU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '4': //LS gaji
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '5': //LS PPKD
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                              </tr>  "; 
                            break;
                        case '6': //LS barang dan jasa
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                            
                    }
                   
                }
				
				
				$sql = "SELECT '' tgl_spp,'' no_spp,SUM(nilai) as nilai,''keperluan,jns_spp FROM trhspp $where  GROUP BY jns_spp ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                   $lcno = $lcno + 1;
                    switch ($row->jns_spp) 
                    {
                        case '1': //UP
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '2': //GU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '3': //TU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '4': //LS gaji
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '5': //LS PPKD
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                              </tr>  "; 
                            break;
                        case '6': //LS barang dan jasa
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai,"2",",",".")."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                            
                    }
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        //$this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');   
		echo $cRet;
	}
   
    function cetak_register_spm(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
$cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
$cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>REGISTER SPM-UP/SPM-GU/SPM-TU/SPM-LS</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>$a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"3\"><b>Tanggal</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Nomor SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"19%\" rowspan=\"3\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Jumlah SPP<br>(Rp)</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
          </tr>
          <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
          </tr>
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"6%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"19%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>5</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT tgl_spm,no_spm,nilai,keperluan,jns_spp FROM trhspm $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                   $lcno = $lcno + 1;
                    switch ($row->jns_spp) 
                    {
                        case '1': //UP
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '2': //GU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '3': //TU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '4': //LS gaji
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '5': //LS PPKD
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                              </tr>  "; 
                            break;
                        case '6': //LS barang dan jasa
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                            
                    }
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet; 
		echo $cRet;
       // $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');   
    }
    
    function cetak_register_sp2d(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"12\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"12\"><b>REGISTER SPP/SPM/SP2D</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"2\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jenis Belanja</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"25%\" rowspan=\"2\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jumlah <br>(Rp)</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"7%\" rowspan=\"2\"><b>Keterangan</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"25%\"><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>11</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,a.no_spp,a.tgl_spp,a.jns_spp,b.tgl_sp2d,b.no_sp2d,b.keperluan,
                b.nilai FROM TRHSPM a LEFT JOIN TRHSP2D b ON a.no_spm=b.no_spm $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                    $beban= $row->jns_spp;
                    $tgl_spp=$row->tgl_spp;
                    $spp= $row->no_spp;
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n= $row->nilai;
                    $lcno = $lcno + 1;
                    switch ($beban) 
                    {
                        case '1': //UP
                            $jns='UP';
                            break;
                        case '2': //GU
                            $jns='GU';
                            break;
                        case '3': //TU
                            $jns='TU';
                            break;
                        case '4': //LS gaji
                           $jns='LS gaji';
                            break;
                        case '5': //LS PPKD
                            $jns='LS PPKD';
                            break;
                        case '6': //LS barang dan jasa
                            $jns='LS barang & jasa';
                            break;
                            
                    }
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"center\" width=\"7%\" style=\"font-size:12px\">$jns</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spp)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spp</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spm</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$sp2d</td>

                                <td align=\"left\" width=\"25%\" style=\"font-size:12px\">$kkeperluan</td>
                                <td align=\"right\" width=\"10%\" style=\"font-size:12px\">".number_format($n)."</td>
                                <td align=\"right\" width=\"7%\" style=\"font-size:12 px\"></td>
                              </tr>  "; 
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');
        //echo("$cRet");   
    }
    
  	
  // awal fungsi fungsi sts
   function panjar()
    {
        $data['page_title']= 'PANJAR';
        $this->template->set('title', 'INPUT PANJAR');   
        $this->template->load('template','tukd/transaksi/panjar',$data) ; 
    }
    
   function sts()
    {
        $data['page_title']= 'INPUT S T S';
        $this->template->set('title', 'INPUT S T S');   
        $this->template->load('template','tukd/pendapatan/sts',$data) ; 
    }
    
    function sts_ppkd()
    {
        $data['page_title']= 'INPUT S T S';
        $this->template->set('title', 'INPUT S T S');   
        $this->template->load('template','tukd/pendapatan/sts_ppkd',$data) ; 
    }
	
	function restitusi_ppkd()
    {
        $data['page_title']= 'INPUT RESTITUSI';
        $this->template->set('title', 'INPUT RESTITUSI');   
        $this->template->load('template','tukd/pendapatan/restitusi_ppkd',$data) ; 
    }
    
	function sts_ppkd2(){
        $data['page_title']= 'INPUT STS NON RETRIBUSI';
        $this->template->set('title', 'INPUT STS NON RETRIBUSI');   
        $this->template->load('template','tukd/pendapatan/sts_ppkd2',$data) ; 
    }
	
    function penetapan()
    {
        $data['page_title']= 'INPUT PENETAPAN';
        $this->template->set('title', 'INPUT PENETAPAN');   
        $this->template->load('template','tukd/pendapatan/penetapan',$data) ; 
    }
    
    function penetapan_ppkd()
    {
        $data['page_title']= 'INPUT PENETAPAN';
        $this->template->set('title', 'INPUT PENETAPAN');   
        $this->template->load('template','tukd/pendapatan/penetapan_ppkd',$data) ; 
    }
    
    function penerimaan()
    {
        $data['page_title']= 'INPUT PENERIMAAN';
        $this->template->set('title', 'INPUT PENERIMAAN');   
        $this->template->load('template','tukd/pendapatan/penerimaan',$data) ; 
    }
    
    function penerimaan_ppkd()
    {
        $data['page_title']= 'INPUT PENERIMAAN';
        $this->template->set('title', 'INPUT PENERIMAAN');   
        $this->template->load('template','tukd/pendapatan/penerimaan_ppkd',$data) ; 
    }
    
    function Penagihan()
    {
        $data['page_title']= 'INPUT PENAGIHAN';
        $this->template->set('title', 'INPUT PENAGIHAN');   
        $this->template->load('template','tukd/transaksi/penagihan',$data) ; 
    }
    
    function pemakaian()
    {
        $data['page_title']= 'PEMAKAIAN ASET';
        $this->template->set('title', 'INPUT PEMAKAIAN ASET');   
        $this->template->load('template','tukd/transaksi/pemakaian_aset',$data) ; 
    }
    
    function penyusutan()
    {
        $data['page_title']= 'PENYUSUTAN ASET';
        $this->template->set('title', 'INPUT PENYUSUTAN ASET');   
        $this->template->load('template','tukd/transaksi/penyusutan_aset',$data) ; 
    }
    
    function reklas_utang()
    {
        $data['page_title']= 'INPUT PENETAPAN';
        $this->template->set('title', 'INPUT PENETAPAN');   
        $this->template->load('template','tukd/transaksi/reklas_utang',$data) ; 
    }
  

	function load_sts_non_restibusi() {
    
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria == ''){                               
             $where=" WHERE a.no_cek='1' "; 
             	 
        } else{
			$where="WHERE a.no_cek='1' AND (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%'))";
			
		}
        
       $sql = "SELECT count(*) as tot from trhkasin_ppkd " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();
        
        $sql = " SELECT TOP $rows a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd,
				(SELECT ISNULL(nm_pengirim,'') FROM ms_pengirim WHERE kd_pengirim = a.sumber) AS nm_pengirim
				from trhkasin_ppkd a $where AND no_kas NOT in (SELECT TOP $offset no_kas 
				FROM trhkasin_ppkd a $where order by tgl_kas,no_kas) order by a.tgl_kas,no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total']),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'nm_skpd' => $resulte['nm_skpd'],                                                                                           
                        'sumber' => $resulte['sumber'],                                                                                           
                        'nm_pengirim' => $resulte['nm_pengirim']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	} 
    
	    function load_dnonretribusi() {    
       // $kriteria = '0012.a/1.20.05';
        $kriteria = $this->input->post('no');
        //$kriteria = $this->uri->segment(3);
        $sql = "SELECT LEFT(a.kd_rek5,5) AS kd_rek5, b.nm_rek4 as nm_rek5,
				SUM(a.rupiah) rupiah FROM trdkasin_ppkd a 
				LEFT JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4
				where a.no_kas = '$kriteria'
				GROUP BY no_kas,LEFT(a.kd_rek5,5), b.nm_rek4
				order by a.no_kas";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek5'],
                        'rupiah' =>  number_format($resulte['rupiah'])
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function ambil_rek_non_retribusi() {
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
		$sql = "SELECT a.kd_rek5,a.nm_rek5,nm_rek4
				FROM (SELECT kd_rek5,nm_rek5,nm_rek4
				from trdrka_pend a 
				LEFT JOIN ms_rek4 c ON LEFT(a.kd_rek5,5)=c.kd_rek4
				WHERE LEFT(a.kd_rek5,3) IN ('411','431','414') 
				AND a.kd_skpd='$lckdskpd' 
				 ) a
				ORDER BY kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,           
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5'],                                                                                          
                        'nm_rek4' => $resulte['nm_rek4']                                                                                          
                                                                                                                
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
	
    
	function ambil_rek_non_retribusi_lama() {
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
		$sql = "SELECT a.kd_rek5,a.nm_rek5,rupiah,isnull(realisasi,0) as realisasi, rupiah-isnull(realisasi,0) as sisa
				FROM (SELECT LEFT(b.kd_rek5,5) as kd_rek5,c.nm_rek4 as nm_rek5,SUM(b.rupiah) as rupiah 
				from trhkasin_pkd a 
				INNER JOIN trdkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
				LEFT JOIN ms_rek4 c ON LEFT(b.kd_rek5,5)=c.kd_rek4 WHERE LEFT(b.kd_rek5,3) IN ('411','431') 
				AND a.kd_skpd='$lckdskpd' 
				AND a.tgl_sts<='$tgl_sts' 
				GROUP BY LEFT(b.kd_rek5,5), nm_rek4 ) a
				LEFT JOIN(
				SELECT LEFT(b.kd_rek5,5) as kd_rek5,ISNULL(SUM(b.rupiah),0) as realisasi 
				from trhkasin_ppkd a 
				INNER JOIN trdkasin_ppkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
				WHERE LEFT(b.kd_rek5,3) IN ('411','431') 
				AND a.kd_skpd='$lckdskpd' 
				AND a.tgl_kas<='$tgl_sts' 
				GROUP BY LEFT(b.kd_rek5,5)) b
				ON a.kd_rek5=b.kd_rek5 
				ORDER BY kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,           
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5'],                                                                                          
                        'rupiah' => $resulte['rupiah'],                                                                                          
                        'realisasi' => $resulte['realisasi'] ,                                                                                         
                        'sisa' => $resulte['sisa']                                                                                          
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
	
	function simpan_kas_non_retribusi(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $pengirim  = $this->input->post('pengirim');
        $kegi  = $this->input->post('kegi');
        $skpd  = $this->input->post('skpd');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "insert into trhkasin_ppkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,no_kas,tgl_kas,sumber,no_cek) 
                        values('$nokas','$skpd','$ttd','$ket','$nilai','$kegi','4','$nokas','$ttd','$pengirim','1')";
            $asg = $this->db->query($sql);
            
			 $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan) values ('$skpd','$nokas','$jns','$nilai','$nokas','$kegi')";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }
	
	function update_kas_non_retribusi(){
        
		$nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
		$pengirim  = $this->input->post('pengirim');
        $kegi  = $this->input->post('kegi');
        $skpd  = $this->input->post('skpd');
        $usernm = $this->session->userdata('pcNama');		
		
             $sql = "update trhkasin_ppkd set tgl_sts='$ttd',keterangan='$ket',total='$nilai',tgl_kas='$ttd',kd_kegiatan='$kegi',sumber='$pengirim',kd_skpd='$skpd' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
            
			 $sql = "update trdkasin_ppkd set kd_rek5='$jns',rupiah='$nilai',kd_kegiatan='$kegi' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '1';
            }else{
                echo '0';
            }
        }
		
	function hapus_penerimaan_non_retribusi() {    	
		$no_kas = $this->input->post('no_kas');
		//$tgl = $this->input->post('tgl_kas');
		//$nilai = $this->input->post('nilai');
        $query = "delete from trhkasin_ppkd where no_kas='$no_kas'";
		$asg = $this->db->query($query);
		$query = "delete from trdkasin_ppkd where no_kas='$no_kas'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }

function load_restitusi_ppkd() {
    
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria == ''){                               
             $where=" WHERE "; 
             $where1="  "; 
			 $sql = "SELECT count(*) as tot from trhrestitusi WHERE jns_trans=3 " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();			 
        } else{
			$where="WHERE (upper(a.no_kas) like upper('%$kriteria%') or upper(a.no_sts) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND ";
			$where1="WHERE (upper(a.no_kas) like upper('%$kriteria%') or upper(a.no_sts) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND a.jns_trans=3 ";
			$sql = "SELECT count(*) as tot from trhrestitusi a WHERE (upper(a.no_kas) like upper('%$kriteria%') or upper(a.no_sts) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();
		}
        
       
        
        $sql = " SELECT TOP $rows a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd from trhrestitusi a $where no_kas NOT in (SELECT TOP $offset no_kas FROM trhrestitusi a $where1 order by tgl_kas,no_kas) AND a.jns_trans=3 order by a.tgl_kas,no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total'],2,'.',','),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'sumber' => $resulte['sumber'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	} 

  
function load_sts_ppkd() {
    
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria == ''){                               
             $where=" WHERE "; 
             $where1="  "; 
			 $sql = "SELECT count(*) as tot from trhkasin_ppkd " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();			 
        } else{
			$where="WHERE (upper(a.no_kas) like upper('%$kriteria%') or upper(a.no_sts) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND ";
			$where1="WHERE (upper(a.no_kas) like upper('%$kriteria%') or upper(a.no_sts) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) ";
			$sql = "SELECT count(*) as tot from trhkasin_ppkd a WHERE (upper(a.no_kas) like upper('%$kriteria%') or upper(a.no_sts) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();
		}
        
       
        
        $sql = " SELECT TOP $rows a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd from trhkasin_ppkd a $where no_kas NOT in (SELECT TOP $offset no_kas FROM trhkasin_ppkd a $where1 order by tgl_kas,no_kas) order by a.tgl_kas,no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total'],2,'.',','),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'sumber' => $resulte['sumber'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	} 
    
      function load_dsts_ppkd() {    
       // $kriteria = '0012.a/1.20.05';
        $kriteria = $this->input->post('no');
        //$kriteria = $this->uri->segment(3);
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek, b.nm_pengirim 
        from trdkasin_ppkd a left join ms_pengirim b on a.sumber=b.kd_pengirim where a.no_kas = '$kriteria' order by a.no_kas";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_kas'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'sumber' => $resulte['sumber'],
						'nmsumber' =>  $resulte['nm_pengirim'],
                        'rupiah' =>  number_format($resulte['rupiah'],2,'.',',')
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

    function load_drestitusi_ppkd() {    
       // $kriteria = '0012.a/1.20.05';
        $kriteria = $this->input->post('no');
        //$kriteria = $this->uri->segment(3);
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek, b.nm_pengirim 
        from trdrestitusi a left join ms_pengirim b on a.sumber=b.kd_pengirim where a.no_kas = '$kriteria' order by a.no_kas";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_kas'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'sumber' => $resulte['sumber'],
						'nmsumber' =>  $resulte['nm_pengirim'],
                        'rupiah' =>  number_format($resulte['rupiah'],2,'.',',')
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	
	function load_dsts() {    
        $kriteria = $this->input->post('no');
		$skpd = $this->input->post('kd_skpd');
		$jnst = $this->input->post('jnst');
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek, b.nm_pengirim, c.nm_rek4
        from trdkasin_pkd a inner join trhkasin_pkd d on a.kd_skpd=d.kd_skpd and a.no_sts=d.no_sts and a.kd_kegiatan=d.kd_kegiatan 
		                    left join ms_pengirim b on a.sumber=b.kd_pengirim 
							left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4 
        where a.no_sts = '$kriteria' and a.kd_skpd='$skpd' and d.jns_trans='$jnst'
		UNION ALL
		SELECT KD_SKPD, NO_BUKTI no_sts, '' kd_rek5, nilai as rupiah, '' kd_kegiatan, '' no_terima,  (CASE WHEN thnlalu='1' THEN 'y' ELSE 'n' END) sumber, 
		'' nm_rek, '' nm_pengirim, '' nm_rek4
		FROM TRHOUTLAIN
		WHERE KD_SKPD='$skpd' AND jns_beban<>7 AND NO_BUKTI='$kriteria'
		order by a.no_sts";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'rupiah' =>  number_format($resulte['rupiah'],2,'.',','),
                        'sumber' =>  $resulte['sumber'],
                        'nmsumber' =>  $resulte['nm_pengirim'],
                        'nm_rek4' =>  $resulte['nm_rek4']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

    function ambil_rek() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
        $lcgiat = $this->uri->segment(4);
        $lcfilt = $this->uri->segment(5);
        $lc = '';
        if ($lcfilt!=''){
            $lcfilt = str_replace('A',"'",$lcfilt);
            $lcfilt = str_replace('B',",",$lcfilt);
            $lc = " and a.kd_rek5 not in ($lcfilt)";
        }
      // $sql = "SELECT a.kd_rek5,(SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5=a.kd_rek5) AS nm_rek FROM trdrka a";
        
        $sql = "SELECT a.kd_rek5,(SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5=a.kd_rek5) AS nm_rek FROM 
        trdrka a where a.kd_skpd = '$lckdskpd' and a.kd_kegiatan = '$lcgiat' and 
        upper(a.kd_rek5) like upper('%$lccr%') $lc";
        
        
        //echo $sql;
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

    function ambil_simpanan_ar()
    {
        $data['page_title']= 'INPUT AMBIL SIMPANAN';
        $this->template->set('title', 'INPUT AMBIL SIMPANAN');   
        $this->template->load('template','tukd/transaksi/ambil_simpanan_ar',$data) ; 
    }
    
        function ambil_rek_utang() {
        $lccr = $this->input->post('q');
       
        
        $sql = "SELECT * from ms_rek5 where left(kd_rek5,1)='2'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    
     function ambil_rek_tetap() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT a.kd_kegiatan,a.kd_rek5 as kd_rek5,b.nm_rek5 AS nm_rek,b.map_lo as kd_rek FROM 
        trdrka a left join ms_rek5 b on a.kd_rek5=b.kd_rek5 where a.kd_skpd = '$lckdskpd' and left(a.kd_rek5,1)='4' and 
        (upper(a.kd_rek5) like upper('%$lccr%') or b.nm_rek5 like '%$lccr%')";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	 function ambil_rek_terima() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT a.kd_kegiatan,a.kd_rek5 as kd_rek5,b.nm_rek5 AS nm_rek,b.map_lo as kd_rek FROM 
        trdrka a left join ms_rek5 b on a.kd_rek5=b.kd_rek5 where a.kd_skpd = '$lckdskpd' and (left(a.kd_rek5,1)='4' or left(a.kd_rek5,2)='61')and 
        upper(a.kd_rek5) like upper('%$lccr%') order by kd_rek5";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
     function ambil_rek_tagih($a) {
        $lccr = $this->input->post('q');
        //$lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT kd_rek5,nm_rek5,map_lo FROM ms_rek5 WHERE  LEFT(kd_rek5,1) IN ($a) and 
        (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%'))";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'kd_rek_lo' => $resulte['map_lo']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function ambil_rek_t_sts() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT DISTINCT a.kd_rek5, (SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5 = a.kd_rek5) AS nm_rek FROM tr_terima a
                WHERE kd_skpd = '$lckdskpd' and upper(a.kd_rek5) like upper('%$lccr%')";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function get_sts(){
    $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	$offset = ($page-1)*$rows;
	$result = array();


	$rs = mysql_query("select count(*) from trhkasin_pkd");
	$row = mysql_fetch_row($rs);
	$result["total"] = $row[0];
	$rs = mysql_query("select * from trhkasin_pkd limit $offset,$rows");
	
	$items = array();
	while($row = mysql_fetch_object($rs)){
		array_push($items, $row);
	}
	$result["rows"] = $items;

	echo json_encode($result);
    }  
  
  
function tambah_sts()
	{
		$config = array(
               array(
                     'field'   => 'no_sts',
                     'label'   => 'NO STS',
                     'rules'   => 'trim|required'
                    ),
                
               array(
                     'field'   => 'kd_skpd',
                     'label'   => 'KODE SKPD',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'keterangan',
                     'label'   => 'KETERANGAN',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'jns_trans',
                     'label'   => 'JNS. TRANSAKSI',
                     'rules'   => 'trim|required'
               )
                  
            );
			
		$this->form_validation->set_message('required', '%s harus diisi !');
		$this->form_validation->set_rules($config);
		$this->form_validation->set_error_delimiters('<div class="single_error">', '</div>');

		if ($this->form_validation->run() == FALSE)
		{
			$data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            //$lc = "select kd_program,nm_program from m_prog order by kd_program";
//            $query = $this->db->query($lc);
//            $data["program"]=$query->result();
            //$data["jumrow"]=$this->db->get('m_prog')->num_rows();
             $query = "select kode,nama from ms_bank";
             $data_pilih = $this->master_model->viewdata($query);
                             
             foreach($data_pilih->result()as $dt_bk){
               $data['option'][$dt_bk->kode]=$dt_bk->nama;
             }    
		}
		else
		{		
						$no_sts = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('skpd');
                        $tgl_sts = $this->input->post('dd');
                        $jns_trans = $this->input->post('jns_trans');
                        $keterangan = $this->input->post('keterangan');
						
						
			//$this->tukd_model->save('trhspp',$data);
            $query = $this->db->query(" insert into trhspp(no_spp,kd_skpd,tgl_spp,jns_kegiatan,bulan,keperluan) values('$no_spp','$kd_skpd','$tgl_spp','$jns_kegiatan','$bulan','$keperluan') ");
            echo"$query";						
			$this->session->set_flashdata('notify', 'Data Berita berhasil disimpan !');
			
			redirect('tukd/spp');

		}
		
		$this->template->set('title', 'Master Data Kegiatan &raquo; Tambah Data');
		$this->template->load('template', 'tukd/sts/tambah_sts_v2', $data);
	}
    
     function load_trskpd1($cskpd='') {
            $lccr='';        
            $lccr = $this->uri->segment(3);
            if(strlen($lccr)==1){
                $lcpj = 1;
            }else{
                $lcpj = 2;
            }
            
            $lcskpd = $this->uri->segment(4);
            $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                    WHERE left(a.jns_kegiatan,$lcpj)='$lccr' and a.kd_skpd = '$lcskpd'" ;    
            //echo $sql;    
            $query1 = $this->db->query($sql);  
            $result = array();
            $ii = 0;
            foreach($query1->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan']
                            );
                            $ii++;
            }
               
            echo json_encode($result);
        	   
    	}
        
    function load_jns_rek(){
        $lccr ='[{  
        "id":"4",  
        "text":"Pendapatan"  
    },{  
        "id":"5",  
        "text":"Belanja"  
    },{  
        "id":"61",  
        "text":"Penerimaan Pembiayaan"  
    },{  
        "id":"62",  
        "text":"Pengeluaran Pembiayaan"  
    },{  
        "id":"1",  
        "text":"Rekening Kas"  
    }]';  
    echo $lccr;
    }    
    
    
    function load_jns_tetap(){
        $lccr ='[{  
        "id":"1",  
        "text":"Ya"  
    },{  
        "id":"0",  
        "text":"Tidak"  
    }]';  
    echo $lccr;
    }    
    
    
     function simpan_sts(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        $rekbank= $this->input->post('rekbank');
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   =$this->input->post('sts');  
                      
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_pkd') {
            $sql = "delete from trhkasin_pkd where kd_skpd='$skpd' and no_sts='$nomor'";
            $asg = $this->db->query($sql);
            if ($asg){
                $sql = "insert into trhkasin_pkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber) 
                        values('$nomor','$skpd','$tgl','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$sumber')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_pkd where no_sts='$nomor'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_pkd(kd_skpd,no_sts,kd_rek5,rupiah) values $lcnilaidet";
                        $asg = $this->db->query($sql); 
                    }                
                }            
            } 
            echo '1';
        }
        
         if ($sumber=='1'){
            $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg1 = $this->db->query($sql1);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$total,$total,'5')";
            $asg1 = $this->db->query($sql1);
            
            $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
            $asg2 = $this->db->query($sql2);
            
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1610101','RK PPKD',$total,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',0,$total,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
            
        } 

    }
    
    function simpan_sts_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $tglkas = $this->input->post('tglkas');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   = $this->input->post('sumber');
        $kd_skpd  = $this->session->userdata('kdskpd');
		
				
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
		$last_update=  '';
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_ppkd') {
            $sql = "delete from trhkasin_ppkd where kd_skpd='$skpd' and no_kas='$nokas'";
            $asg = $this->db->query($sql);
            if ($asg){
               
			   $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber,kd_bank) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket',$total,'$giat','$jnsrek','$sumber','$bank')";
                $asg = $this->db->query($sql);
				
				$sql = "update trhkasin_pkd set no_cek=1 where no_sts='$nomor' AND kd_skpd='$skpd' and kd_kegiatan='$giat' and jns_trans='$jnsrek'";
                $asg = $this->db->query($sql);
				
				if($sumber=='y'){
					$sql = "update trhkasin_ppkd set kd_skpd='$kd_skpd', kd_kegiatan=LEFT('$kd_skpd',4)+'.'+'$kd_skpd'+'.00.04' where no_kas='$nokas' AND kd_skpd='$skpd'";
					$asg = $this->db->query($sql); 
				}
				
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
				
                if ($asg){
										
                    $sql = "delete from trdkasin_ppkd where no_kas='$nokas' and kd_skpd='$skpd'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan,sumber) values $lcnilaidet";
                        $asg = $this->db->query($sql);

						if($sumber=='n'){
							$sql = "update trdkasin_ppkd set kd_rek5='1110301' where no_kas='$nokas' AND kd_skpd='$skpd'";
							$asg = $this->db->query($sql); 
						}else if($sumber=='y'){
							$sql = "update trdkasin_ppkd set kd_skpd='$kd_skpd', kd_kegiatan=LEFT('$kd_skpd',4)+'.'+'$kd_skpd'+'.00.04', kd_rek5='4141009' where no_kas='$nokas' AND kd_skpd='$skpd'";
							$asg = $this->db->query($sql); 
						}
                    }                
                }            
            } 
            echo '1';
        }
    }

 function simpan_restitusi_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $tglkas = $this->input->post('tglkas');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   = $this->input->post('sumber');
        $kd_skpd  = $this->session->userdata('kdskpd');
		
				
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
		$last_update=  '';
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhrestitusi') {
            $sql = "delete from trhrestitusi where kd_skpd='$skpd' and no_kas='$nokas'";
            $asg = $this->db->query($sql);
            if ($asg){
               
			   $sql = "insert into trhrestitusi(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber,kd_bank) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket',$total,'$giat','$jnsrek','$sumber','$bank')";
                $asg = $this->db->query($sql);
				
				$sql = "update trhrestitusi set no_cek=1 where no_sts='$nomor' AND kd_skpd='$skpd' and kd_kegiatan='$giat' and jns_trans='$jnsrek'";
                $asg = $this->db->query($sql);
				
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
				
                if ($asg){
										
                    $sql = "delete from trdrestitusi where no_kas='$nokas' and kd_skpd='$skpd'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdrestitusi(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan,sumber) values $lcnilaidet";
                        $asg = $this->db->query($sql);
                    }                
                }            
            } 
            echo '1';
        }
    }

 
    function simpan_tetap(){
        
       // $tabel  = $this->input->post('tabel');
//        $nomor  = $this->input->post('no');
//        $tgl    = $this->input->post('tgl');
//        $skpd   = $this->input->post('skpd');
//        $ket    = $this->input->post('ket');
//        $kd_rek5 = $this->input->post('kdrek');
//        $kd_rek_lo = $this->input->post('rek');
//        $lnil_rek = $this->input->post('nilai');
//        
//        $sql = "delete from tr_tetap where kd_skpd='$skpd' and no_tetap='$nomor'";
//        $asg = $this->db->query($sql);
//        if($asg){
//            $sql = "insert into tr_tetap(no_tetap,tgl_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
//            values('$nomor','$tgl','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket')";
//            $asg = $this->db->query($sql);
//        }
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $kd_rek_lo = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_tetap where kd_skpd='$skpd' and no_tetap='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
       
            $sql = "insert into tr_tetap(no_tetap,tgl_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'3')";
            $asg1 = $this->db->query($sql1);
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1130101','Piutang Pajak',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek5','$nmrek',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
       
    }
    
    function simpan_utang(){

        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek_d = $this->input->post('kdrek');
        $kd_rek_k = $this->input->post('kdrek1');
        $lnil_rek = $this->input->post('nilai');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_d,'nm_rek5','ms_rek5','kd_rek5');
        $nmrek1=$this->tukd_model->get_nama($kd_rek_k,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_utang where kd_skpd='$skpd' and no_dok='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
       
            $sql = "insert into tr_utang(no_dok,tgl,kd_skpd,kd_rek_d,kd_rek_k,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek_d','$kd_rek_k',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
            $sql1 = "insert into trhju_ppkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'8')";
            $asg1 = $this->db->query($sql1);
            $sql2 = "insert into trdju_ppkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_d','$nmrek',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_ppkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_k','$nmrek1',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
       
    }
    
        function simpan_tetap_ppkd(){
        


        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $giat    = $this->input->post('giat');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $kd_rek_lo = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_tetap where kd_skpd='$skpd' and no_tetap='$nomor'";
        $asg = $this->db->query($sql);
               
       
            $sql = "insert into tr_tetap(no_tetap,tgl_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan,kd_kegiatan) 
            values('$nomor','$tgl','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket','$giat')";
            $asg = $this->db->query($sql);
            
       
    }
    
    function simpan_terima(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('rek');
        $kd_rek_lo = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $no_tetap = $this->input->post('nottp');
        $tgl_tetap = $this->input->post('tglttp');
        $sts_tetap = $this->input->post('sts');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_terima where kd_skpd='$skpd' and no_terima='$nomor'";
        $asg = $this->db->query($sql);
        $sql = "insert into tr_terima(no_terima,tgl_terima,no_tetap,tgl_tetap,sts_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
        values('$nomor','$tgl','$no_tetap','$tgl_tetap','$sts_tetap','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket')";
        $asg = $this->db->query($sql);
        if ($sts_tetap=='1'){
            $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg1 = $this->db->query($sql1);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'4')";
            $asg1 = $this->db->query($sql1);
            
            $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
            $asg2 = $this->db->query($sql2);
            
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1130101','Piutang Pajak',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
            
            $sql4 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','3','0')";
            $asg4 = $this->db->query($sql4);
            $sql5 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_lo','$nmrek',0,$lnil_rek,'K','','4','1')";
            $asg5 = $this->db->query($sql5);
        }else{
            $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg1 = $this->db->query($sql1);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'4')";
            $asg1 = $this->db->query($sql1);
            
            $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
            $asg2 = $this->db->query($sql2);
            
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek5','$nmrek',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
            
            $sql4 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','3','0')";
            $asg4 = $this->db->query($sql4);
            $sql5 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_lo','$nmrek',0,$lnil_rek,'K','','4','1')";
            $asg5 = $this->db->query($sql5);
        }
               
    }
    
    function simpan_terima_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $giat  = $this->input->post('giat');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('rek');
        $kd_rek_lo = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $no_tetap = $this->input->post('nottp');
        $tgl_tetap = $this->input->post('tglttp');
        $sts_tetap = $this->input->post('sts');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek_lo=$this->tukd_model->get_nama($kd_rek5,'nm_rek5','ms_rek5','kd_rek5');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $kd_rek64=$this->tukd_model->get_nama($kd_rek5,'kd_rek64','ms_rek5','kd_rek5');
        $nmrek64=$this->tukd_model->get_nama($kd_rek5,'nm_rek64','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_terima where kd_skpd='$skpd' and no_terima='$nomor'";
        $asg = $this->db->query($sql);
        $sql = "insert into tr_terima(no_terima,tgl_terima,no_tetap,tgl_tetap,sts_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan,kd_kegiatan) 
        values('$nomor','$tgl','$no_tetap','$tgl_tetap','$sts_tetap','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket','$giat')";
        $asg = $this->db->query($sql);
               
    }
    
    function simpan_tagih(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $rek = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        
        $sql = "delete from tr_tagih where kd_skpd='$skpd' and no_tagih='$nomor'";
        $asg = $this->db->query($sql);
        if($asg){
            $sql = "insert into tr_tagih(no_tagih,tgl_tagih,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek5','$rek',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
        }
       
    }
    
    function simpan_pakai(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd =$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $nmrek5 =$this->tukd_model->get_nama($kd_rek5,'nm_rek5','ms_rek5','kd_rek5');
        $kd_aset = $this->input->post('kdaset');
        $nmaset =$this->tukd_model->get_nama($kd_aset,'nm_rek5','ms_rek5','kd_rek5');
        $rek = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s'); 
        
        $sql = "delete from tr_pakai where kd_skpd='$skpd' and no_po='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql2);
        if($asg){
            $sql = "insert into tr_pakai(no_po,tgl_po,kd_skpd,kd_rek5,kd_aset,kd_rek_lo,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek5','$kd_aset','$rek',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
             $asq2 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$lnil_rek','$lnil_rek','6')";
            $asg = $this->db->query($asq2);
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_rek5','$nmrek5',$lnil_rek,'0','D','9','1','1') ");                   
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_aset','$nmaset','0',$lnil_rek,'K','1','2','1') ");
        }
       
    }
    
    function simpan_susut(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd =$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $nmrek5 =$this->tukd_model->get_nama($kd_rek5,'nm_rek5','ms_rek5','kd_rek5');
        $kd_aset = $this->input->post('kdaset');
        $nmaset =$this->tukd_model->get_nama($kd_aset,'nm_rek5','ms_rek5','kd_rek5');
        $rek = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s'); 
        
        $sql = "delete from tr_susut where kd_skpd='$skpd' and no_po='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql2);
        if($asg){
            $sql = "insert into tr_susut(no_po,tgl_po,kd_skpd,kd_rek5,kd_rek_lo,kd_aset,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek5','$rek','$kd_aset',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
            
            $asq2 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$lnil_rek','$lnil_rek','6')";
            $asg = $this->db->query($asq2);
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_rek5','$nmrek5',$lnil_rek,'0','D','9','1','1') ");                   
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_aset','$nmaset','0',$lnil_rek,'K','1','2','1') ");  
        }
       
    }
    
    function update_tetap(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    function update_terima(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    function update_tagih(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    
     function update_pakai(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    
    function update_susut(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    
	function update_sts_ppkd(){
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $nosimpan  = $this->input->post('nosimpan');
        $tglkas = $this->input->post('tglkas');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        $rekbank= $this->input->post('rekbank');
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber = $this->input->post('sumber');
       // $sumber   = 'BUD';//$this->input->post('sts');  
        //$skpd= $this->session->userdata('kdskpd');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
        $usernm= $this->session->userdata('pcNama');
		//$last_update=  date('Y-m-d H:i:s');
		$last_update=  '';
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_ppkd') {
            $sql = "delete from trhkasin_ppkd where kd_skpd='$skpd' and no_kas='$nosimpan'";
            $asg = $this->db->query($sql);
            if ($asg){
               /* $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$sumber')";
               */
			   $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket',$total,'$giat','$jnsrek','$sumber')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_ppkd where no_kas='$nosimpan' and kd_skpd='$skpd'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan,sumber) values $lcnilaidet";
                        $asg = $this->db->query($sql); 
                    }                
                }            
            } 
            echo '1';
        }
    }

    
     function hapus_sts_ppkd(){
        $nomor = $this->input->post('no');
        $sts = $this->input->post('sts');
        $skpd     = $this->session->userdata('skpd');    
        $kd_skpd     = $this->input->post('kdskpd');   
       
		$sql = "update trhkasin_pkd set no_cek=0 where kd_skpd='$kd_skpd' AND no_sts='$sts'";
        $asg = $this->db->query($sql);

 	    $sql = "delete from trhkasin_ppkd where no_kas='$nomor' and kd_skpd='$kd_skpd'";
        $asg = $this->db->query($sql);
		
        if ($asg > 0){
            $sql = "delete from trdkasin_ppkd where no_kas='$nomor' and kd_skpd='$kd_skpd' ";
            $asg = $this->db->query($sql);
            
            if (asg < 0){
                echo '0';
                break;
            } 

        } else {
            echo '0';
            break;
        }
        echo '1';                
    }

	function hapus_sts_ppkd2(){
        $nomor = $this->input->post('no');
        $jns = $this->input->post('jns');
        $skpd = $this->input->post('skpd');   
       
 	    $sql = "delete from trhkasin_pkd where no_sts='$nomor' and kd_skpd='$skpd' and jns_trans=$jns";
        $asg = $this->db->query($sql);
		
        if ($asg > 0){
            $sql = "delete from trdkasin_pkd where no_sts='$nomor' and kd_skpd='$skpd' and LEFT(kd_rek5,1)<>'4'";
            $asg = $this->db->query($sql);
            
            if (asg < 0){
                echo '0';
                break;
            } 

        } else {
            echo '0';
            break;
        }
        echo '1';                
    }

	
function hapus_restitusi_ppkd(){
        $nomor = $this->input->post('no');
        $sts = $this->input->post('sts');
        $skpd     = $this->session->userdata('skpd');    
        $kd_skpd     = $this->input->post('kdskpd');   
       
		$sql = "update trhkasin_pkd set no_cek=0 where kd_skpd='$kd_skpd' AND no_sts='$sts' and jns_trans='3'";
        $asg = $this->db->query($sql);
	   
 	    $sql = "delete from trhrestitusi where no_kas='$nomor' and kd_skpd='$kd_skpd'";
        $asg = $this->db->query($sql);
		
        if ($asg > 0){
            $sql = "delete from trdrestitusi where no_kas='$nomor' and kd_skpd='$kd_skpd'";
            $asg = $this->db->query($sql);
            
            if (asg < 0){
                echo '0';
                break;
            } 

        } else {
            echo '0';
            break;
        }
        echo '1';                
    }

    
    function hapus_sts(){
        $nomor = $this->input->post('no');
        
        $sql = "delete from trhkasin_pkd where no_sts='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where no_voucher='$nomor' ";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trhju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if (asg > 0){
            $sql = "delete from trdkasin_pkd where no_sts='$nomor'";
            $asg = $this->db->query($sql);
            
            if (asg < 0){
                echo '0';
                break;
            } 

        } else {
            echo '0';
            break;
        }
        echo '1';                
    }
    
     function hapus_tetap(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_tetap where no_tetap='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        $sql3 = "delete from trhju where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg3 = $this->db->query($sql3);
        $sql4 = "delete from trdju where no_voucher='$nomor'";
        $asg4 = $this->db->query($sql4);
        $sql5 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg5 = $this->db->query($sql5);
        $sql6 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg6 = $this->db->query($sql6);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_utang(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_utang where no_dok='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_panjar(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_panjar where no_panjar='$nomor' ";
        $asg = $this->db->query($sql);
        
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_tetap_ppkd(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_tetap where no_tetap='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_terima(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_terima where no_terima='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_terima_ppkd(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_terima where no_terima='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        
        
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_tagih(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_tagih where no_tagih='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_pakai(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_pakai where no_po='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor' ";
        $asg = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_susut(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_susut where no_po='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor' ";
        $asg = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function load_panjar() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_panjar) like upper('%$kriteria%') or tgl_panjar like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_panjar $where order by no_panjar";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_panjar' => $resulte['no_panjar'],
                        'tgl_panjar' => $this->tukd_model->rev_date($resulte['tgl_panjar']),
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'pengguna' => $resulte['pengguna']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
     function load_tetap() {
		$skpd  = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd='$skpd'";
        if ($kriteria <> ''){                               
            $where=" (upper(no_tetap) like upper('%$kriteria%') or tgl_tetap like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_tetap where $where order by no_tetap";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_tetap'],
                        'tgl_tetap' => $this->tukd_model->rev_date($resulte['tgl_tetap']),
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek_lo']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    
    function load_terima() {
        $skpd  = $this->session->userdata('kdskpd');
		$kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd='$skpd'";
        if ($kriteria <> ''){                               
            $where=" (upper(no_terima) like upper('%$kriteria%') or tgl_terima like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_terima where $where order by no_terima";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_terima' => $resulte['no_terima'],
                        'no_tetap' => $resulte['no_tetap'],
                        'tgl_terima' => $resulte['tgl_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek_lo'],
                        'sts_tetap' =>$resulte['sts_tetap']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function load_utang() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_dok) like upper('%$kriteria%') or tgl like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_utang $where order by no_dok";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_dok' => $resulte['no_dok'],
                        'tgl' => $this->tukd_model->rev_date($resulte['tgl']),
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek_d' => $resulte['kd_rek_d'],
                        'kd_rek_k' => $resulte['kd_rek_k']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_tagih() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_tagih) like upper('%$kriteria%') or tgl_tagih like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_tagih $where order by no_tagih";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tagih' => $resulte['no_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_no_tetap() { //wahyu
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='where ';
        if ($kriteria <> ''){                               
            $where=" (upper(no_tetap) like upper('%$kriteria%') or tgl_tetap like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%')) and ";            
        }

		$where2 =' no_tetap not in(select no_tetap from tr_terima)';

        $sql = "SELECT * from tr_tetap $where $where2 order by no_tetap";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_tetap'],
                        'tgl_tetap' => $resulte['tgl_tetap'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => $resulte['nilai'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek_lo' => $resulte['kd_rek_lo']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
 
    
    function load_pakai() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_po) like upper('%$kriteria%') or tgl_po like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_pakai $where order by no_po";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],
                        'tgl_po' => $resulte['tgl_po'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_aset' => $resulte['kd_aset']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
     function load_susut() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_po) like upper('%$kriteria%') or tgl_po like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_susut $where order by no_po";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],
                        'tgl_po' => $resulte['tgl_po'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_aset' => $resulte['kd_aset']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_tagih_trans() {
        $cskpd = $this->input->post('kd');
        $lccr = $this->input->post('q');
        
        $sql = "SELECT no_tagih,tgl_tagih,kd_skpd,kd_rek5,kd_rek_lo,nilai from tr_tagih where upper(kd_skpd) like upper('%$lccr%') or  
        upper(no_tagih) like upper('%$lccr%') or upper(kd_rek5) like upper('%$lccr%') order by no_tagih";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tagih' => $resulte['no_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek_lo'],
                        'nila' => number_format($resulte['nilai'],2,',','.'),
                        'nil' => $resulte['nilai']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_no_penagihan() { //wahyu
        $cskpd = $this->session->userdata('kdskpd');
        $lccr = $this->input->post('q');
        
        $sql = "SELECT no_bukti,tgl_bukti,kd_skpd,total,ket from trhtagih where kd_skpd='$cskpd' and (upper(kd_skpd) like upper('%$lccr%') or  
				upper(no_bukti) like upper('%$lccr%')) and no_bukti not in(SELECT no_tagih as no_bukti FROM trhtransout WHERE no_tagih<>'') and sts_tagih='0' order by no_bukti";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tagih' => $resulte['no_bukti'],
                        'tgl_tagih' => $resulte['tgl_bukti'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'ket' => $resulte['ket'],
                        'nila' => number_format($resulte['total'],2,',','.'),
                        'nil' => $resulte['total']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
     function load_tetap_sts() {
        //$kriteria = '';
        //$kriteria = $this->input->post('cari');
        $skpd = $this->uri->segment(3);
        $kd_rek5 = $this->uri->segment(4);
        
        //$where ='';
//        if ($kriteria <> ''){                               
//            $where="where kd_skpd = '$skpd' and kd_rek5 = '$kd_rek5' and (upper(no_tetap) like upper('%$kriteria%') or
//            upper(keterangan) like upper('%$kriteria%'))";            
//        }
//        
        $sql = "SELECT * from tr_terima where kd_skpd = '$skpd' and kd_rek5 = '$kd_rek5' order by no_tetap";
        //echo $sql;
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_terima'],
                        'tgl_tetap' => $resulte['tgl_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 

	function cetak_sts(){
        //$b = $this->uri->segment(3);
        $lcnosts = str_replace('123456789','/',$this->uri->segment(3));
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $cRet='';
        $lcpemda = $kab;

        $sql = "SELECT a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd,
                (SELECT nama FROM ms_bank WHERE kode = a.kd_bank) AS nm_bank
                FROM trhkasin_pkd a WHERE no_sts = '$lcnosts'";
                
        $hasil = $this->db->query($sql);
        $trh = $hasil->row();

        $rupiah = $this->tukd_model->terbilang($trh->total);
        $lcbank = $trh->nm_bank;
        $lcrek = $trh->rek_bank;
        $lcskpd = $trh->nm_skpd;
        $lctglsts = $trh->tgl_sts;

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>
                        <tr><td colspan=\"2\" style=\"text-align:center;border: solid 1px white;border-bottom:solid 1px black;\">$lcpemda</td></tr>
                        <tr><td colspan=\"2\" style=\"text-align:center;border: solid 1px white;border-bottom:solid 1px black;\">SURAT TANDA SETORAN</td></tr>
                        <tr><td colspan=\"2\" style=\"text-align:center;border: solid 1px white;border-bottom:solid 1px black;\">(STS)</td></tr>
                     </thead></table><br>";       
              
        
     
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
          <tr>
            <td>
                <table  style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"10%\">No STS</td>
                        <td width=\"50%\">: $lcnosts</td>
                        <td width=\"10%\">Bank</td>
                        <td width=\"40%\">: $lcbank</td>
                    </tr>
                    <tr>
                        <td width=\"10%\">OPD</td>
                        <td width=\"50%\">: $lcskpd</td>
                        <td width=\"10%\">No Rekening</td>
                        <td width=\"40%\">: $lcrek</td>
                    </tr>
                </table>      
            </td>
          </tr>
          <tr>
            <td>
                <table  style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"30%\">Harap diterima uang sebesar <br>(dengan huruf)</td>
                        <td width=\"70%\" valign=\"top\"><i>( $rupiah )</i></td>
                    </tr>
                </table>      
            </td>
          </tr>
          <tr>
            <td valign=\"top\">Dengan rincian penerimaan sebagai berikut<br>
            <table  style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
              <tr>
                <td width=\"4%\" height=\"28\" bgcolor=\"#CCCCCC\" align=\"center\"><b>No</b></td>
                <td colspan=\"5\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>
                <td width=\"48%\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian Rincian Objek</b></td>
                <td width=\"50%\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Jumlah</b></td>
              </tr>";
           
           $sql = "SELECT a.*,(SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5 = a.kd_rek5) AS nm_rek5
                    FROM trdkasin_pkd a WHERE no_sts = '$lcnosts'";
                
        $hasil = $this->db->query($sql);
        $lcno = 0;
        $lntotal = 0;
        foreach ($hasil->result() as $row)
        {
           $lntotal = $lntotal + $row->rupiah;     
           $lcno = $lcno + 1;
           $cRet .=" <tr>
                        <td align=\"center\">$lcno</td>
                        <td width=\"3%\">".substr($row->kd_rek5,0,1)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,1,1)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,2,1)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,3,2)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,5,2)."</td>
                        <td>$row->nm_rek5</td>
                        <td align=\"right\">".number_format($row->rupiah)."</td>
                      </tr>";     
            
        }
            $cRet .="
            <tr>
                <td colspan=\"7\" align=\"right\">Jumlah</td>                
                <td align=\"right\">".number_format($lntotal)."</td>
                
            </tr>
            </table>
            </td>
          </tr>
          <tr>
            <td height=\"30\" align=\"center\" style=\"font-size:12px\">Uang tersebut diterima pada tanggal ".$this->tukd_model->tanggal_format_indonesia($lctglsts)."</td>
          </tr>
          <tr>
            <td height=\"60\" align=\"center\"></td>
          </tr>
          <tr>
            <td height=\"56\">
                <table style=\"border-collapse:collapse;\" width=\"700\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                  <tr>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Mengetahui<br>Pengguna Anggaran/Kuasa Pengguna Anggaran</b></td>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Bendahara Penerimaan<br>Bendahara Penerimaan Pembantu</b></td>
                  </tr>
                  <tr>
                  <td height=\"60\" colspan =\"2\" ></td>
                  </tr>
                  <tr>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Nama Lengkap<br>NIP.</b></td>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Nama Lengkap<br>NIP.</b></td>
                  </tr>                  
                </table>
            </td>
          </tr>
        </table>";

        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
        
    }
    
    // akhir fungsi fungsi sts   
   //register
   
    function reg_spp()
    {
        $data['page_title']= 'REGISTER S P P';
        $this->template->set('title', 'REGISTER S P P');   
        $this->template->load('template','tukd/register/spp',$data) ; 
    }
     function reg_spm()
    {
        $data['page_title']= 'REGISTER S P M';
        $this->template->set('title', 'REGISTER S P M');   
        $this->template->load('template','tukd/register/spm',$data) ; 
    }
     function reg_sp2d()
    {
        $data['page_title']= 'REGISTER S P 2 D';
        $this->template->set('title', 'REGISTER S P 2 D');   
        $this->template->load('template','tukd/register/sp2d',$data) ; 
    }

    function rekap_gj()
    {
        $data['page_title']= 'REGISTER S P 2 D';
        $this->template->set('title', 'REGISTER S P 2 D');   
        $this->template->load('template','tukd/register/rekapgj',$data) ; 
    }
    
     function reg_sp2d_ppkd()
    {
        $data['page_title']= 'REGISTER S P 2 D';
        $this->template->set('title', 'REGISTER S P 2 D');   
        $this->template->load('template','tukd/register/sp2d_ppkd',$data) ; 
    }
    ///////transout rendy
    function transout()
    {
        $data['page_title']= 'INPUT PEMBAYARAN TRANSAKSI';
        $this->template->set('title', 'INPUT PEMBAYARAN TRANSAKSI');   
        $this->template->load('template','tukd/transaksi/transout',$data) ; 
    }
    
    function simpan_transout(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = trim($this->input->post('beban'));
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama'); 
        $xpay     = $this->input->post('cpay');
           
        $update     = date('y-m-d H:i:s');      
        $msg        = array();

		// Simpan Header //
        if ($tabel == 'trhtransout_ppkd') {
            $sql = "delete from trhtransout_ppkd where kd_skpd='$skpd' and no_bukti='$nomor'";
			$asg = $this->db->query($sql);
            $sqlx = "delete from trhtransout where kd_skpd='$skpd' and no_bukti='$nomor'";
			$asgx = $this->db->query($sqlx);
			if ($beban=='1'){
	           $sql = "delete from trhju_ppkd where kd_skpd='$skpd' and no_voucher='$nomor'";
			   $asg = $this->db->query($sql);
               
               $sqlxx = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
			   $asgxx = $this->db->query($sqlxx);
               $sqlxxx = "delete from trhju where kd_skpd='$skpd' and no_voucher='$nomor'";
			   $asgxxx = $this->db->query($sqlxxx);
			}

            if ($asg){
                
				$sql = "insert into trhtransout_ppkd(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp,pay) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban','$xpay')";
                $asg = $this->db->query($sql);
                
                $sqltrhtransout = "insert into trhtransout(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp,pay) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban','$xpay')";
                $asgtrhtransout = $this->db->query($sqltrhtransout);

				if ($beban=='1'){
					$sql3 = " insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asg3 = $this->db->query($sql3);
                    
                    $sqltrhju_pkd = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asgtrhju_pkd= $this->db->query($sqltrhju_pkd);
                    
                    $sqltrhju = " insert into trhju(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asgtrhju = $this->db->query($sqltrhju);
				}



                if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        }elseif($tabel == 'trdtransout_ppkd') {
            
            // Simpan Detail //                       
                $sql = "delete from trdtransout_ppkd where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
                $sqlx = "delete from trdtransout where no_bukti='$nomor'";
                $asgx = $this->db->query($sqlx);
				if ($beban=='1'){
					$sql = "delete from trdju_ppkd where no_voucher='$nomor'";
					$asg = $this->db->query($sql);
                    
                    $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
					$asg2 = $this->db->query($sql2);
                    $sql3x = "delete from trdju where no_voucher='$nomor'";
					$asg3x = $this->db->query($sql3x);
				}
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdtransout_ppkd(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai)"; 
                    $asg = $this->db->query($sql.$csql);
                    $sql4 = "insert into trdtransout(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai)"; 
                    $asg4 = $this->db->query($sql4.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }

				$hasil=$this->db->query(" select * from trdtransout_ppkd where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek5'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
	  			    
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
                    $kdrek64=$this->tukd_model->get_nama($kdrek5,'kd_rek64','ms_rek5','kd_rek5');
					$nmrek64=$this->tukd_model->get_nama($kdrek64,'nm_rek64','ms_rek5','kd_rek64');
					$rek3=substr($kdrek5,0,3);
	  			    $rekutang=$this->tukd_model->get_nama($kdrek64,'piutang_utang','ms_rek5','kd_rek64');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					if ($beban=='1'){
						if ($status=='1'){
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");
                                             
                           //permen 64
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek64','$nmrek64',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");
                           
                          //permen  21 
                           $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");		
					    }else{
					   
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','3120501','Estimasi Perubahan SAL','0','$nilai','K','','4','0') ");
                           //permen 64
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek64','$nmrek64',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','3120501','Estimasi Perubahan SAL','0','$nilai','K','','4','0') ");
                           //permen  21 
                           $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','3120501','Estimasi Perubahan SAL','0','$nilai','K','','4','0') ");							   
					    }
					}

				}   
									 				
				
        }
         
        //$asg->free_result();
    }
    
     function simpan_penagihan(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = $this->input->post('beban');
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s');      
        $msg        = array();
        // Simpan Header //
        if ($tabel == 'trhtagih') {
            $sql = "delete from trhtagih where kd_skpd='$skpd' and no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if ($asg){
                $sql = "insert into trhtagih(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban')";
                $asg = $this->db->query($sql);

				$asq3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
				$asg3 = $this->db->query($asq3);

				if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        } else if ($tabel == 'trdtagih') {
            
            // Simpan Detail //                       
                $sql = "delete from trdtagih where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
                $sql = "delete from trdju_pkd where no_voucher='$nomor'";
                $asg = $this->db->query($sql);
                
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdtagih(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,kd_rek,nm_rek5,nilai)"; 
    
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }            
				
				$hasil=$this->db->query(" select * from trdtagih where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
					
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
					
					$rek3=substr($kdrek5,0,3);	  			    
					$rekutang=$this->tukd_model->get_nama($rek3,'kd_rek5','ms_rek5','map_lo');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$jns','1','1') ");                   
					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang','0',$nilai,'K','$jns','2','1') ");  

				} 

        }
         
        //$asg->free_result();	
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);	
	}
    
    function hapus_transout(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtransout where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

		$sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtransout where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			
			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function hapus_penagihan(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtagih where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

        $sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtagih where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function load_transout(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where=" and (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhtransout where jns_spp in ('1','3') $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtransout where jns_spp in ('1','3') $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp'],
                        'pay' => $resulte['pay']                                                                                                        
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
    

    function load_penagihan(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhtagih  $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtagih   $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp']                                                                                              
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
    
	
    
    function load_dtransout(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout a INNER JOIN
                trdtransout b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_dtagih(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek) AS anggaran FROM trhtagih a INNER JOIN
                trdtagih b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'kd_rek'        => $resulte['kd_rek'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_sp2d_transout(){
       //$beban='',$giat=''
       $beban   = $this->input->post('jenis');
       $giat    = $this->input->post('giat');
       $kode    = $this->input->post('kd');
       $bukti   = $this->input->post('bukti');
       $where = '';
       if ($beban=='1'){
        $sisa = "c.nilai + (SELECT IF(SUM(v.nilai) IS NULL,0,SUM(v.nilai)) FROM trhspp z INNER JOIN trhspm s ON z.no_spp=s.no_spp 
                INNER JOIN trhsp2d v ON s.no_spm=v.no_spm WHERE z.jns_spp='1' AND z.kd_skpd=c.kd_skpd )
                -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";
       }else{
        $sisa = "c.nilai -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";   
       }
       if (($beban != '' && $giat == '') || ($beban == '1')){
            $where = " and a.jns_spp='$beban'"; 
       }
       if ($giat !='' && $beban != '1'){
            $where = " and a.jns_spp='$beban' and d.kd_kegiatan='$giat'";
       }
        $kriteria = $this->input->post('q');
            $sql = "SELECT DISTINCT c.no_sp2d,c.tgl_sp2d,c.nilai,
                    $sisa                   
                    FROM trhspp a INNER JOIN trhspm b ON a.no_spp=b.no_spp
                    INNER JOIN trhsp2d c ON b.no_spm=c.no_spm
                    INNER JOIN trdspp d ON a.no_spp=d.no_spp
                    WHERE c.kd_skpd = '$kode' AND c.status = 1 $where ORDER BY c.no_sp2d,c.tgl_sp2d";
       //and UPPER(no_sp2d) LIKE '%$kriteria%'  
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'sisa' => $resulte['sisa']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
    
 
        
     function load_trskpd() {        
        $jenis =$this->input->post('jenis');
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        
        $jns_beban='';
        $cgiat = '';
        if ($jenis !=''){
            $jns_beban = "and a.jns_kegiatan='$jenis'";
        }
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd='$cskpd' $jns_beban $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

	function load_total_spd(){
	   $kode    = $this->input->post('kode');
       $giat    = $this->input->post('giat');
       $rek    = $this->input->post('kode_rek');
       
            $sql = "SELECT
						SUM (a.nilai) AS total_spd
					FROM
						trdspd a
					JOIN trhspd b ON a.no_spd = b.no_spd
					WHERE
						b.kd_skpd = '$kode'
					AND a.kd_kegiatan = '$giat'
					AND a.kd_rek5 = '$rek'
					AND b.status = '1'";
       
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'total_spd' => number_format($resulte['total_spd'],2,'.',',') 
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
	
	function load_total_trans(){
	   $kode    = $this->input->post('kode');
       $giat    = $this->input->post('giat');
       $rek    = $this->input->post('kode_rek');
       
            $sql = "Select SUM(nilai) as nilai from (SELECT a.nilai FROM  trdspp a INNER JOIN trhspp b ON a.no_spp=b.no_spp AND a.kd_skpd=b.kd_skpd
					WHERE b.jns_spp IN ('3','4','5','6') AND a.kd_skpd = '$kode' AND a.kd_kegiatan = '$giat' and a.kd_rek5 = '$rek' AND (sp2d_batal<>'1' or sp2d_batal is null )					
					UNION ALL
					SELECT a.nilai FROM  trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
					WHERE jns_spp IN ('1','2') AND b.kd_skpd = '$kode' AND a.kd_kegiatan = '$giat' and a.kd_rek5 = '$rek') z";
       
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'nilai' => number_format($resulte['nilai'],2,'.',','),
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
	
	
	function load_dsts_ppkd_2() {    
        $lcskpd  = $this->session->userdata('kdskpd');
        $kriteria = $this->input->post('no');
        //$kriteria = $this->uri->segment(3);
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek 
        from trdkasin_pkd a where a.no_sts = '$kriteria'  AND a.kd_skpd = '$lcskpd' and LEFT(kd_rek5,1)<>'4' order by a.no_sts";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'rupiah' =>  number_format($resulte['rupiah'],2,'.',','),
                        'no_terima' => $resulte['no_terima']
						);
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
	
    function load_trskpd_ppkd() {        
        $cskpd = $this->input->post('kd');
        
       
                    
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd='$cskpd'  and a.jns_kegiatan not in('4','61') AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
	function ambil_rek_t_sts_ppkd() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT DISTINCT a.kd_rek5, (SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5 = a.kd_rek5) AS nm_rek FROM tr_terima a
                WHERE kd_skpd = '$lckdskpd' and upper(a.kd_rek5) like upper('%$lccr%')";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
	
    function load_trskpd_ar_2() { 
        $cskpd  =  '' ;
        $cskpd  =  $this->input->post('kdskpd');
        $sql    = "SELECT kd_kegiatan, nm_kegiatan FROM trskpd where kd_skpd = '$cskpd' order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
	
	
	
	
  function ambil_sts() {        
        $lccr = $this->input->post('q'); 
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
        $sql = "SELECT no_sts, tgl_sts,kd_skpd, keterangan,sumber,kd_kegiatan,jns_trans,total FROM trhkasin_pkd WHERE no_sts NOT IN(SELECT no_sts FROM trhkasin_ppkd) AND (upper(no_sts) like upper('%$lccr%') or upper(total) like upper('%$lccr%'))
                and kd_skpd='$lckdskpd'
				and tgl_sts<='$tgl_sts'";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],  
                        'tgl_sts' => $resulte['tgl_sts'],
						'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],
						'sumber' => $resulte['sumber'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'total'       => number_format($resulte['total'],2,'.',',')        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
 

 function ambil_sts_retribusi() {        
        $lccr = $this->input->post('q'); 
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
        $kd_skpd  = $this->session->userdata('kdskpd');
		
		if ($lckdskpd=='3.13.01.02' or $lckdskpd=='3.13.01.03' or $lckdskpd=='3.13.01.04' or $lckdskpd=='3.13.01.05' or $lckdskpd=='3.13.01.06' or $lckdskpd=='3.13.01.07' or $lckdskpd=='3.13.01.08' or $lckdskpd=='3.13.01.09' or $lckdskpd=='3.13.01.10' or $lckdskpd=='3.13.01.11' or $lckdskpd=='3.13.01.12' or $lckdskpd=='3.13.01.13' or $lckdskpd=='3.13.01.14' or $lckdskpd=='3.13.01.15' or $lckdskpd=='3.13.01.16'){
			$AND = "AND status=1";
		}else{
			$AND = "";
		}	
		
		$sql = "SELECT no_sts, tgl_sts,kd_skpd, keterangan,sumber,kd_kegiatan,jns_trans,total 
				FROM trhkasin_pkd WHERE no_sts+kd_skpd+jns_trans NOT IN(SELECT a.no_sts+kd_skpd+jns_trans FROM trhkasin_ppkd a where kd_skpd='$lckdskpd' and a.jns_trans=4 ) 
                and kd_skpd='$lckdskpd'
				and tgl_sts='$tgl_sts' 
				and jns_trans=4 $AND
				UNION ALL
				SELECT no_sts, tgl_sts,kd_skpd, keterangan,sumber,kd_kegiatan,jns_trans,total 
				FROM trhkasin_pkd WHERE no_sts+kd_skpd+jns_trans NOT IN(SELECT a.no_sts+kd_skpd+jns_trans FROM trhkasin_ppkd a where kd_skpd='$lckdskpd' and a.jns_trans NOT IN (4,3)) 
                and kd_skpd='$lckdskpd'
				and tgl_sts='$tgl_sts' 
				and jns_trans NOT IN (4,3)
				UNION ALL
				SELECT NO_BUKTI no_sts, TGL_BUKTI tgl_sts, KD_SKPD, KET keterangan, (CASE WHEN thnlalu='1' THEN 'y' ELSE 'n' END) sumber, 
				'' kd_kegiatan, '' jns_trans, nilai as total
				FROM TRHOUTLAIN
				WHERE KD_SKPD='$lckdskpd' AND TGL_BUKTI='$tgl_sts'
				AND jns_beban<>7
				AND NO_BUKTI NOT IN (select no_sts from trhkasin_ppkd where kd_skpd='$lckdskpd' and sumber='y')";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],  
                        'tgl_sts' => $resulte['tgl_sts'],
						'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],
						'sumber' => $resulte['sumber'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'total'       => number_format($resulte['total'],2,'.',',')        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
 
 
 function ambil_restitusi_ppkd() {        
        $lccr = $this->input->post('q'); 
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
        $kd_skpd  = $this->session->userdata('kdskpd');
		
		$sql = "SELECT no_sts, tgl_sts,kd_skpd, keterangan,sumber,kd_kegiatan,jns_trans,total 
				FROM trhkasin_pkd WHERE no_sts+kd_skpd NOT IN(SELECT a.no_sts+kd_skpd FROM trhrestitusi a where kd_skpd='$lckdskpd' and a.jns_trans=3 ) 
				AND (upper(no_sts) like upper('%$lccr%') or upper(total) like upper('%$lccr%'))
                and kd_skpd='$lckdskpd'
				and tgl_sts='$tgl_sts' 
				and jns_trans=3";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],  
                        'tgl_sts' => $resulte['tgl_sts'],
						'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],
						'sumber' => $resulte['sumber'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'total'       => number_format($resulte['total'],2,'.',',')        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
 
 
	function load_trskpd_penagihan() {        
        
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        $cgiat = '';
       
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd= '$cskpd'  $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

    function load_rek() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        $sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
        
        if ($jenis=='1'){
            $sql = "SELECT a.kd_rek5,a.nm_rek5,
                    (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek5=a.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    0 AS sp2d,nilai AS anggaran  FROM trdrka a WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";
                    
        } else {
            $sql = "SELECT b.kd_rek5,b.nm_rek5,
                    (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    a.nilai AS sp2d,(SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran 
                    FROM trhspp a INNER JOIN trdspp b ON a.no_spp=b.no_spp INNER JOIN trhspm c ON b.no_spp=c.no_spp INNER JOIN trhsp2d d ON c.no_spm=d.no_Spm
                    WHERE d.no_sp2d = '$sp2d' and b.kd_kegiatan='$giat' $notIn ";
        }        
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function load_rek_ar() {  
        
        $ckdkegi  = $this->input->post('kdkegiatan');
        //$ckdkegi  = '1.20.1.20.12.01.00.51';
        $ckdrek   = $this->input->post('kdrek');
        
        if (  $ckdrek != '' ){
            $NotIn = " and kd_rek5 not in ($ckdrek) " ;
        } else {
            $NotIn = " " ;
        }
        
        $sql      = "SELECT kd_rek5, nm_rek5 FROM trdrka where kd_kegiatan = '$ckdkegi' $NotIn order by kd_rek5 ";
        $query1   = $this->db->query($sql);  
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'      => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    function jumlah_ang_spp() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdrek   = $this->input->post('kdrek5');
        $ckdskpd  = $this->input->post('kd_skpd');
        $cnospp   = $this->input->post('no_spp');
        
                           
        $query1   = $this->db->query(" SELECT SUM(nilai) as rektotal, 
        ( select sum(a.nilai) from trdspp a inner join trhspp b on a.no_spp=b.no_spp
          inner join trhspm  c on c.no_spp=b.no_spp
          inner join trhsp2d d on d.no_spm=c.no_spm   
          where a.kd_kegiatan='$ckdkegi' and a.kd_rek5='$ckdrek' and a.kd_skpd='$ckdskpd' and a.no_spp <> '$cnospp' and d.status='1' )
          as rektotal_spp_lalu
          FROM trdrka WHERE kd_rek5='$ckdrek' and kd_kegiatan='$ckdkegi' and kd_skpd='$ckdskpd' ");   
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['rektotal'],2,'.',','),
                        'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
	
    }
    
    function load_rek_penagihan() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        //$sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
            $sql = "SELECT a.kd_rek5,a.nm_rek5,e.map_lo,
                    (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek=a.kd_rek5 AND c.no_bukti <> '$nomor' ) AS lalu,
                    0 AS sp2d,a.nilai AS anggaran  FROM trdrka a LEFT JOIN ms_rek5 e ON a.kd_rek5=e.kd_rek5  WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";

        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['map_lo'],
                        'kd_rek' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function out_lalu(){
         $giat = $this->input->post('giat');
         $sp2d = $this->input->post('sp2d');
         $rek  = $this->input->post('rek');
         $nomor  = $this->input->post('nomor');
         $tgl  = $this->input->post('tgl');
         $skpd  = $this->input->post('skpd');
         $jenis  = $this->input->post('jenis');
         $sql = "SELECT b.no_bukti,b.no_sp2d,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.nm_rek5,
                (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_kegiatan=b.kd_kegiatan AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> b.no_bukti AND d.tgl_bukti<=a.tgl_bukti AND d.jns_spp = a.jns_spp) AS lalu,
                (SELECT SUM(g.nilai) FROM trdspp g INNER JOIN trhspm h ON g.no_spp=h.no_spp INNER JOIN trhsp2d i ON h.no_spm=i.no_spm WHERE i.no_sp2d=b.no_sp2d) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout a INNER JOIN trdtransout b ON a.no_bukti=b.no_bukti
                WHERE a.kd_skpd = '$skpd' AND b.kd_kegiatan = '$giat' AND b.kd_rek5 = '$rek' AND a.tgl_bukti <> '$tgl' AND 
                b.no_sp2d = '$sp2d' AND a.no_bukti = '$nomor'";                           
         $query1 = $this->db->query($sql);        
         $row = $query1->row();
         $result[] = array('lalu' =>$row->rp);
         //$result = $row->rp;
         echo json_encode($result);
         //echo $result;
         $query1->free_result();
    }
    
     ////////////akhir transout rendy 
     function rincian_objek()
    {
        $data['page_title']= 'RINCIAN PEROBJEK';
        $this->template->set('title', 'RINCIAN PEROBJEK');   
        $this->template->load('template','tukd/transaksi/rincian_objek',$data) ; 
    }
    
	    
	function ld_giat_rinci_objek($skpd='') { 
		//$skpd = $this->session->userdata('kdskpd');
        $lccr = $this->input->post('q');
        $sql = "SELECT DISTINCT kd_kegiatan,nm_kegiatan FROM trdtransout where kd_skpd='$skpd' and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
     function ld_rek_rinci_objek($giat='') {
        $lccr = $this->input->post('q');
        $sql = " SELECT DISTINCT kd_rek5, nm_rek5 FROM trdtransout where kd_kegiatan='$giat' and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) order by kd_rek5 ";       
       $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function cetak_rincian_objek($dcetak='',$ttd1='',$skpd='',$rek5='',$dcetak2='',$giat='',$tgl_ctk='',$ttd2='',$ctk='',$spasi=''){
           $ttd1 = str_replace('123456789',' ',$ttd1);
			$ttd2 = str_replace('123456789',' ',$ttd2);
			$sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $nm_prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode in ('PA','KPA') and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		   if($giat<>''){
                $keg='1';
                $giat=$giat;
                $nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
                //$nm_prov=$this->tukd_model->get_sclient('provinsi','sclient');
				}else{
                $keg='0';
                $giat='';
                $nm_giat='KESELURUHAN';
            }
            			
            //echo $dcetak .'/'. $ttd.'/'.$skpd.'/'.$rek5.'/'.$dcetak2.'/'.$giat.'/'.$keg;
		

			$cRet ='<TABLE width="100%">
					 <TR>                        
						<TD colspan="2" align="center" ><b>'.$nm_prov.'</TD>					
					 </TR>
					 <TR>                        
						<TD colspan="2" align="center" ><b>BUKU PEMBANTU RINCIAN OBJEK </TD>					
					 </TR>
					 </TABLE>
					 <TABLE style="font-size:12px" width="100%">
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp; </TD>					
					 </TR>
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
                     <TR>                        
						<TD align="left" width="15%" >OPD </TD>
						<TD align="left" width="85%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd').'</TD>
					 </TR>
                     <TR>
						<TD align="left" width="15%" >Kegiatan</TD>
						<TD align="left" width="85%" >: '.$giat.' '.$nm_giat.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Rekening </TD>
						<TD align="left" width="85%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5').'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Periode</TD>
						<TD align="left" width="85%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
					 </TR>
                     <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
					 </TABLE>';

			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="'.$spasi.'" width="100%" >
					<THEAD>
					 <TR>
						<TD width="40%" rowspan="2" colspan="2"  align="center" ><b>Nomor dan Tanggal BKU</b></TD>
						<TD width="60%" colspan="4"  align="center" ><b>Pengeluaran (Rp)</b></TD>					
					 </TR>
                     <TR>
 		                <TD width="15%" align="center"><b>LS</b></TD>
                        <TD width="15%"  align="center"><b>UP/GU</b></TD>
                        <TD width="15%"  align="center"><b>TU</b></TD>
                        <TD width="15%"  align="center"><b>JUMLAH</b></TD>
                     </TR>
					 </THEAD>';   
                   
                    $query = $this->db->query("SELECT ISNULL(a.no_bukti,'') as no_bukti
												,b.tgl_bukti
												,ISNULL(a.no_sp2d,'') as no_sp2d
												,SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti>='$dcetak' 
												and b.tgl_bukti<='$dcetak2' 
												GROUP BY a.no_bukti, b.tgl_bukti,a.no_sp2d
												ORDER BY b.tgl_bukti,a.no_bukti
												");
				$i=0;
				$jumls=0;
				$jumup=0;
				$jumgu=0;
   	            $jml=0;  
				foreach($query->result_array() as $res){					
        							$cetak[1] = empty($res['no_bukti']) || $res['no_bukti']== null ?'&nbsp;' :$res['no_bukti'];
        							$cetak[2] = empty($res['no_sp2d']) || $res['no_sp2d']== null ?'&nbsp;' :$res['no_sp2d'];
        							$cetak[3] = empty($res['ls']) || $res['ls'] == null ?'&nbsp;' :$res['ls'];
        							$cetak[4] = empty($res['up']) || $res['up'] == null ?0 :$res['up'];
        							$cetak[5] = empty($res['gu']) || $res['gu'] == null ?0 :$res['gu'];
        							$cetak[6] = empty($res['tgl_bukti']) || $res['tgl_bukti'] == null ?0 :$res['tgl_bukti'];
                        $cRet .='<tr>
    								<td style="border-bottom:hidden;border-right:hidden;" align="left" ><b>&nbsp;'.$cetak[1].'</b> </td>
    								<td style="border-bottom:hidden;border-left:hidden;" align="right" >'.$this->tukd_model->tanggal_format_indonesia($cetak[6]).'&nbsp;</td>
									<td rowspan="2" align="right" >'.number_format($cetak[3],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[4],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[5],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[3]+$cetak[4]+$cetak[5],"2",",",".").'</td></tr>
								 <tr>
									<td colspan="2" align="left" ><i>&nbsp;SP2D: '.$cetak[2].'</i> </td>
    								
    							 </tr>';
                                     
                $jumls=$jumls+$cetak[3];
				$jumup=$jumup+$cetak[4];
				$jumgu=$jumgu+$cetak[5];
                $jml=$jml+$cetak[3]+$cetak[4]+$cetak[5];        
						
						
				}  
               
               
				$cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah</i></b></TD>
					<TD align="right" ><b>'.number_format($jumls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumup,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumgu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml,"2",",",".").'</b></TD>					
				 </TR>';
				 
                $query = $this->db->query("SELECT SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS lalu_up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS lalu_gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS lalu_ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti<'$dcetak' 
												");
                foreach($query->result_array() as $res){										
					$lalu_up=$res['lalu_up'];
					$lalu_gu=$res['lalu_gu'];
					$lalu_ls=$res['lalu_ls'];
				}
                $jml_lalu=$lalu_up+$lalu_gu+$lalu_ls;
                $tot=$jumup+$lalu_up;
                $tot1=$jumgu+$lalu_gu;
                $tot2=$jumls+$lalu_ls;
                $total=$tot+$tot1+$tot2;			 					
                $cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah s/d periode lalu </i></b></TD>
					<TD align="right" ><b>'.number_format($lalu_ls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_up,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_gu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml_lalu,"2",",",".").'</b></TD>					
				 </TR>';
                 $cRet .='<TR>				
					<TD colspan="2" align="left" ><b><i>Jumlah s/d periode ini<i></b></TD>
					<TD align="right" ><b>'.number_format($tot2,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot1,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($total,"2",",",".").'</b></TD>					
				 </TR>';
			$cRet .='</TABLE>';
			$cRet .='<TABLE style="font-size:12px" width="100%" border="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui,</TD>
						<TD align="center" width="50%">'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">'.$jabatan.'</TD>
						<TD align="center" width="50%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><u><b>'.$nama.'</b></u><br>'.$pangkat.'</TD>
						<TD align="center" width="50%"><u><b>'.$nama1.'</b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">NIP. '.$nip.'</TD>
						<TD align="center" width="50%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';
			$data['prev']= 'RINCIAN OBJEK';
            switch ($ctk) {
				case 0;
					echo ("<title> BP RINCIAN OBJEK</title>");
					echo $cRet;
					break;
				case 1;
					$this->_mpdf_margin('',$cRet,10,10,10,'L',0,'',15,15,15,15);
					break;
			}
	} 
    
	
	    function cetak_rincian_objek_kegiatan($dcetak='',$ttd1='',$skpd='',$dcetak2='',$giat='',$tgl_ctk='',$ttd2='',$ctk='',$spasi=''){
            //$this->load->library('mpdf');
			//$this->mpdf = new mPDF('utf-8', array(215,330),12); //folio


		   $ttd1 = str_replace('123456789',' ',$ttd1);
			$ttd2 = str_replace('123456789',' ',$ttd2);
			$sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $nm_prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode in ('PA','KPA') and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		$cRet ='<TABLE style="font-size:16px" width="100%" border="0">
					<TR>
						<TD align="center" width="100%"><BR><BR><BR><b>CETAK BUKU RINCIAN OBJEK<BR>
						KEGIATAN '.strtoupper($this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan')).'<BR>
						'.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak)).' s/d '.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak2)).'</TD>
					</TR>
				</TABLE>';
		
		$sqlww= $this->db->query("SELECT b.kd_rek5 FROM trhtransout a LEFT JOIN trdtransout b ON a.no_bukti=b.no_bukti
			AND a.kd_skpd = b.kd_skpd
			WHERE a.tgl_bukti<='$dcetak2' 
			AND a.kd_skpd='$skpd' 
			AND b.kd_kegiatan='$giat' 
			GROUP BY b.kd_rek5 ORDER BY b.kd_rek5");
 foreach ($sqlww->result() as $row){
 $rek5=$row->kd_rek5;
			$nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');		
                $nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
                //$nm_prov=$this->tukd_model->get_sclient('provinsi','sclient');
				
            
            //echo $rek5;

		$cRet .='		
		<pagebreak type="NEXT-ODD" resetpagenum="1" pagenumstyle="1" suppress="off" />
		<TABLE width="100%">
					 <TR>                        
						<TD colspan="2" align="center" ><b>'.$nm_prov.'</TD>					
					 </TR>
					 <TR>                        
						<TD colspan="2" align="center" ><b>BUKU PEMBANTU RINCIAN OBJEK </TD>					
					 </TR>
					 </TABLE>
					 <TABLE style="font-size:12px" width="100%">
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp; </TD>					
					 </TR>
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
                     <TR>                        
						<TD align="left" width="15%" >OPD </TD>
						<TD align="left" width="85%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd').'</TD>
					 </TR>
                     <TR>
						<TD align="left" width="15%" >Kegiatan</TD>
						<TD align="left" width="85%" >: '.$giat.' '.$nm_giat.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Rekening </TD>
						<TD align="left" width="85%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5').'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Periode</TD>
						<TD align="left" width="85%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
					 </TR>
                     <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
					 </TABLE>';
			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="'.$spasi.'" width="100%" >
					<THEAD>
					 <TR>
						<TD width="40%" rowspan="2" colspan="2"  align="center" ><b>Nomor dan Tanggal BKU</b></TD>
						<TD width="60%" colspan="4"  align="center" ><b>Pengeluaran (Rp)</b></TD>					
					 </TR>
                     <TR>
 		                <TD width="15%" align="center"><b>LS</b></TD>
                        <TD width="15%"  align="center"><b>UP/GU</b></TD>
                        <TD width="15%"  align="center"><b>TU</b></TD>
                        <TD width="15%"  align="center"><b>JUMLAH</b></TD>
                     </TR>
					 </THEAD>';    
                   
                    $query = $this->db->query("SELECT ISNULL(a.no_bukti,'') as no_bukti
												,b.tgl_bukti
												,ISNULL(a.no_sp2d,'') as no_sp2d
												,SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti>='$dcetak' 
												and b.tgl_bukti<='$dcetak2' 
												GROUP BY a.no_bukti, b.tgl_bukti,a.no_sp2d
												ORDER BY b.tgl_bukti,a.no_bukti
												");
				$i=0;
				$jumls=0;
				$jumup=0;
				$jumgu=0;
   	            $jml=0;  
				foreach($query->result_array() as $res){					
        							$cetak[1] = empty($res['no_bukti']) || $res['no_bukti']== null ?'&nbsp;' :$res['no_bukti'];
        							$cetak[2] = empty($res['no_sp2d']) || $res['no_sp2d']== null ?'&nbsp;' :$res['no_sp2d'];
        							$cetak[3] = empty($res['ls']) || $res['ls'] == null ?'&nbsp;' :$res['ls'];
        							$cetak[4] = empty($res['up']) || $res['up'] == null ?0 :$res['up'];
        							$cetak[5] = empty($res['gu']) || $res['gu'] == null ?0 :$res['gu'];
        							$cetak[6] = empty($res['tgl_bukti']) || $res['tgl_bukti'] == null ?0 :$res['tgl_bukti'];
                        $cRet .='<tr>
    								<td style="border-bottom:hidden;border-right:hidden;" align="left" ><b>&nbsp;'.$cetak[1].'</b> </td>
    								<td style="border-bottom:hidden;border-left:hidden;" align="right" >'.$this->tukd_model->tanggal_format_indonesia($cetak[6]).'&nbsp;</td>
									<td rowspan="2" align="right" >'.number_format($cetak[3],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[4],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[5],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[3]+$cetak[4]+$cetak[5],"2",",",".").'</td></tr>
								 <tr>
									<td colspan="2" align="left" ><i>&nbsp;SP2D: '.$cetak[2].'</i> </td>
    								
    							 </tr>';
                                     
                $jumls=$jumls+$cetak[3];
				$jumup=$jumup+$cetak[4];
				$jumgu=$jumgu+$cetak[5];
                $jml=$jml+$cetak[3]+$cetak[4]+$cetak[5];        
						
						
				}  
               
               
				$cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah</i></b></TD>
					<TD align="right" ><b>'.number_format($jumls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumup,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumgu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml,"2",",",".").'</b></TD>					
				 </TR>';
				 
                $query = $this->db->query("SELECT SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS lalu_up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS lalu_gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS lalu_ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti<'$dcetak' 
												");
                foreach($query->result_array() as $res){										
					$lalu_up=$res['lalu_up'];
					$lalu_gu=$res['lalu_gu'];
					$lalu_ls=$res['lalu_ls'];
				}
                $jml_lalu=$lalu_up+$lalu_gu+$lalu_ls;
                $tot=$jumup+$lalu_up;
                $tot1=$jumgu+$lalu_gu;
                $tot2=$jumls+$lalu_ls;
                $total=$tot+$tot1+$tot2;			 					
                $cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah s/d periode lalu </i></b></TD>
					<TD align="right" ><b>'.number_format($lalu_ls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_up,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_gu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml_lalu,"2",",",".").'</b></TD>					
				 </TR>';
                 $cRet .='<TR>				
					<TD colspan="2" align="left" ><b><i>Jumlah s/d periode ini<i></b></TD>
					<TD align="right" ><b>'.number_format($tot2,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot1,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($total,"2",",",".").'</b></TD>					
				 </TR>';
			$cRet .='</TABLE>';
			$cRet .='<TABLE style="font-size:12px" width="100%" border="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui,</TD>
						<TD align="center" width="50%">'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">'.$jabatan.'</TD>
						<TD align="center" width="50%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><u><b>'.$nama.'</b></u><br>'.$pangkat.'</TD>
						<TD align="center" width="50%"><u><b>'.$nama1.'</b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">NIP. '.$nip.'</TD>
						<TD align="center" width="50%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE></pagebreak>';
		//tambahkan bila tak ingin menggunakan mpdf
        //$this->mpdf->AddPage('P','',1,'1','off');
        //$this->mpdf->writeHTML($cRet);         
			
			}

			$data['prev']= 'RINCIAN OBJEK';
		//tambahkan bila tak ingin mpdf
        //$this->mpdf->Output();
            switch ($ctk) {
				case 0;
					echo ("<title> BP RINCIAN OBJEK</title>");
					echo $cRet;
					break;
				case 1;
					//$this->_mpdf('',$cRet,10,10,10,'0',0,'');
					$this->_mpdf('',$cRet,10,10,10,'L',1,'');
					break;
			}
	}
	
	
	function cetak_rincian_objek_all($dcetak='',$ttd1='',$skpd='',$dcetak2='',$tgl_ctk='',$ttd2='',$ctk='',$spasi=''){
            //$this->load->library('mpdf');
			//$this->mpdf = new mPDF('utf-8', array(215,330),12); //folio


		   $ttd1 = str_replace('123456789',' ',$ttd1);
			$ttd2 = str_replace('123456789',' ',$ttd2);
			$sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $nm_prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode in ('PA','KPA') and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		$cRet ='<TABLE style="font-size:16px" width="100%" border="0">
					<TR>
						<TD align="center" width="100%"><BR><BR><BR><b>CETAK BUKU RINCIAN OBJEK<BR>
						'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd')).'<BR>
						'.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak)).' s/d '.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak2)).'</TD>
					</TR>
				</TABLE>';
		
		$sqlww= $this->db->query("SELECT b.kd_kegiatan,b.kd_rek5 FROM trhtransout a LEFT JOIN trdtransout b ON a.no_bukti=b.no_bukti
			AND a.kd_skpd = b.kd_skpd
			WHERE a.tgl_bukti<='$dcetak2' 
			AND a.kd_skpd='$skpd' 
			GROUP BY b.kd_kegiatan,b.kd_rek5 ORDER BY b.kd_kegiatan,b.kd_rek5");
		foreach ($sqlww->result() as $row){
			$giat=$row->kd_kegiatan;
			$rek5=$row->kd_rek5;
			$nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');		
			$nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
			//$nm_prov=$this->tukd_model->get_sclient('provinsi','sclient');
			
            
            //echo $rek5;

		$cRet .='		
		<pagebreak type="NEXT-ODD" resetpagenum="1" pagenumstyle="1" suppress="off" />
		<TABLE width="100%">
					 <TR>                        
						<TD colspan="2" align="center" ><b>'.$nm_prov.'</TD>					
					 </TR>
					 <TR>                        
						<TD colspan="2" align="center" ><b>BUKU PEMBANTU RINCIAN OBJEK </TD>					
					 </TR>
					 </TABLE>
					 <TABLE style="font-size:12px" width="100%">
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp; </TD>					
					 </TR>
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
                     <TR>                        
						<TD align="left" width="15%" >OPD </TD>
						<TD align="left" width="85%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd').'</TD>
					 </TR>
                     <TR>
						<TD align="left" width="15%" >Kegiatan</TD>
						<TD align="left" width="85%" >: '.$giat.' '.$nm_giat.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Rekening </TD>
						<TD align="left" width="85%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5').'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Periode</TD>
						<TD align="left" width="85%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
					 </TR>
                     <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
					 </TABLE>';
			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="'.$spasi.'" width="100%" >
					<THEAD>
					 <TR>
						<TD width="40%" rowspan="2" colspan="2"  align="center" ><b>Nomor dan Tanggal BKU</b></TD>
						<TD width="60%" colspan="4"  align="center" ><b>Pengeluaran (Rp)</b></TD>					
					 </TR>
                     <TR>
 		                <TD width="15%" align="center"><b>LS</b></TD>
                        <TD width="15%"  align="center"><b>UP/GU</b></TD>
                        <TD width="15%"  align="center"><b>TU</b></TD>
                        <TD width="15%"  align="center"><b>JUMLAH</b></TD>
                     </TR>
					 </THEAD>';    
                   
                    $query = $this->db->query("SELECT ISNULL(a.no_bukti,'') as no_bukti
												,b.tgl_bukti
												,ISNULL(a.no_sp2d,'') as no_sp2d
												,SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti>='$dcetak' 
												and b.tgl_bukti<='$dcetak2' 
												GROUP BY a.no_bukti, b.tgl_bukti,a.no_sp2d
												ORDER BY b.tgl_bukti,a.no_bukti
												");
				$i=0;
				$jumls=0;
				$jumup=0;
				$jumgu=0;
   	            $jml=0;  
				foreach($query->result_array() as $res){					
        							$cetak[1] = empty($res['no_bukti']) || $res['no_bukti']== null ?'&nbsp;' :$res['no_bukti'];
        							$cetak[2] = empty($res['no_sp2d']) || $res['no_sp2d']== null ?'&nbsp;' :$res['no_sp2d'];
        							$cetak[3] = empty($res['ls']) || $res['ls'] == null ?'&nbsp;' :$res['ls'];
        							$cetak[4] = empty($res['up']) || $res['up'] == null ?0 :$res['up'];
        							$cetak[5] = empty($res['gu']) || $res['gu'] == null ?0 :$res['gu'];
        							$cetak[6] = empty($res['tgl_bukti']) || $res['tgl_bukti'] == null ?0 :$res['tgl_bukti'];
                        $cRet .='<tr>
    								<td style="border-bottom:hidden;border-right:hidden;" align="left" ><b>&nbsp;'.$cetak[1].'</b> </td>
    								<td style="border-bottom:hidden;border-left:hidden;" align="right" >'.$this->tukd_model->tanggal_format_indonesia($cetak[6]).'&nbsp;</td>
									<td rowspan="2" align="right" >'.number_format($cetak[3],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[4],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[5],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[3]+$cetak[4]+$cetak[5],"2",",",".").'</td></tr>
								 <tr>
									<td colspan="2" align="left" ><i>&nbsp;SP2D: '.$cetak[2].'</i> </td>
    								
    							 </tr>';
                                     
                $jumls=$jumls+$cetak[3];
				$jumup=$jumup+$cetak[4];
				$jumgu=$jumgu+$cetak[5];
                $jml=$jml+$cetak[3]+$cetak[4]+$cetak[5];        
						
						
				}  
               
               
				$cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah</i></b></TD>
					<TD align="right" ><b>'.number_format($jumls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumup,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumgu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml,"2",",",".").'</b></TD>					
				 </TR>';
				 
                $query = $this->db->query("SELECT SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS lalu_up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS lalu_gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS lalu_ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti<'$dcetak' 
												");
                foreach($query->result_array() as $res){										
					$lalu_up=$res['lalu_up'];
					$lalu_gu=$res['lalu_gu'];
					$lalu_ls=$res['lalu_ls'];
				}
                $jml_lalu=$lalu_up+$lalu_gu+$lalu_ls;
                $tot=$jumup+$lalu_up;
                $tot1=$jumgu+$lalu_gu;
                $tot2=$jumls+$lalu_ls;
                $total=$tot+$tot1+$tot2;			 					
                $cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah s/d periode lalu </i></b></TD>
					<TD align="right" ><b>'.number_format($lalu_ls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_up,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_gu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml_lalu,"2",",",".").'</b></TD>					
				 </TR>';
                 $cRet .='<TR>				
					<TD colspan="2" align="left" ><b><i>Jumlah s/d periode ini<i></b></TD>
					<TD align="right" ><b>'.number_format($tot2,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot1,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($total,"2",",",".").'</b></TD>					
				 </TR>';
			$cRet .='</TABLE>';
			$cRet .='<TABLE style="font-size:12px" width="100%" border="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui,</TD>
						<TD align="center" width="50%">'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">'.$jabatan.'</TD>
						<TD align="center" width="50%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><u><b>'.$nama.'</b></u><br>'.$pangkat.'</TD>
						<TD align="center" width="50%"><u><b>'.$nama1.'</b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">NIP. '.$nip.'</TD>
						<TD align="center" width="50%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE></pagebreak>';
		//tambahkan bila tak ingin menggunakan mpdf
        //$this->mpdf->AddPage('P','',1,'1','off');
        //$this->mpdf->writeHTML($cRet);         
			
			}

			$data['prev']= 'RINCIAN OBJEK';
		//tambahkan bila tak ingin mpdf
        //$this->mpdf->Output();
            switch ($ctk) {
				case 0;
					echo ("<title> BP RINCIAN OBJEK</title>");
					echo $cRet;
					break;
				case 1;
					//$this->_mpdf('',$cRet,10,10,10,'0',0,'');
					$this->_mpdf('',$cRet,10,10,10,'L',1,'');
					break;
			}
	}
	
	
	
	
	function kas_bulan()
    {
        $data['page_title']= 'LAPORAN AKHIR KAS ';
        $this->template->set('title', 'LAPORAN AKHIR KAS');   
        $this->template->load('template','tukd/transaksi/kas_akhir',$data) ; 
    }
    
    function cetak_kas_akhir($lcskpd='',$nbulan='',$ctk=''){
        $nomor = str_replace('123456789',' ',$this->uri->segment(6));
		$nip2 = str_replace('123456789',' ',$this->uri->segment(7));
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($this->uri->segment(8));
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
 		$this->db->query("exec recall '$lcskpd'");
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$lcskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip2' AND kd_skpd='$lcskpd' AND kode in ('PA','KPA')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip = '$nomor' AND kd_skpd='$lcskpd' AND kode='BK'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		
			$cRet ='<TABLE style="border-collapse:collapse;font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>'.$prov.' </TD>
					</TR>
					<tr></tr>
                    <TR>
						<TD align="center" ><b>LAPORAN PENUTUPAN KAS BULANAN <br> BULAN '.strtoupper($this->tukd_model->getBulan($nbulan)).' TAHUN '.strtoupper($thn).'</TD>
					</TR>
					</TABLE><br/>';
					
			$csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
             '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
             UNION ALL
             SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b INNER JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             month(z.tgl_kas) < '$nbulan' and year(z.tgl_kas) = $thn AND z.kd_skpd = '$lcskpd'";
             $tox_awal="SELECT isnull(sld_awal,0)+sld_awalpajak AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
             $hasil = $this->db->query($tox_awal);
             $tox = $hasil->row('jumlah');
             $hasil = $this->db->query($csql3);
			 $trh4 = $hasil->row(); 
			 $saldoawal = $trh4->sel;
			 $saldoawal=$saldoawal+$tox;
			 
			 
			 $csql4 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel  FROM (SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b INNER JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             month(z.tgl_kas) = '$nbulan' and year(z.tgl_kas) = $thn AND z.kd_skpd = '$lcskpd'";
             $hasil4 = $this->db->query($csql4);
			 $trh5 = $hasil4->row(); 
			 $terima1 = $trh5->jmter;
			 $keluar1 = $trh5->jm_kel;
			 $saldo_akhir = $saldoawal+$terima1-$keluar1;

			 if($lcskpd=='3.13.01.17'){
				$and = "and jns_cp<>1";
			 }else{
				$and = "";
			 }
			 $esteh="SELECT 
				SUM(case when jns=1 then jumlah else 0 end ) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				FROM (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan UNION ALL
				select tgl_kas as tgl,no_kas as bku,keterangan as ket, nilai as jumlah, '1' as jns,kd_skpd as kode from tr_jpanjar where jns=2 UNION ALL
				select tgl_panjar as tgl,no_panjar as bku,keterangan as ket, nilai as jumlah, '2' as jns,kd_skpd as kode from tr_panjar UNION ALL
				select a.tgl_sts as tgl,a.no_sts as bku, a.keterangan as ket, SUM(b.rupiah) as jumlah, '2' as jns, a.kd_skpd as kode 
					from trhkasin_pkd a INNER JOIN trdkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
					where jns_trans<>4 and pot_khusus =0 $and 
					GROUP BY a.tgl_sts,a.no_sts, a.keterangan,a.kd_skpd				
				UNION ALL
				SELECT	a.tgl_bukti AS tgl,	a.no_bukti AS bku, a.ket AS ket, SUM(z.nilai) - isnull(pot, 0) AS jumlah, '2' AS jns, a.kd_skpd AS kode
					FROM trhtransout a INNER JOIN trdtransout z ON a.no_bukti=z.no_bukti AND a.kd_skpd=z.kd_skpd
					LEFT JOIN trhsp2d b ON z.no_sp2d = b.no_sp2d
					LEFT JOIN (SELECT no_spm, SUM (nilai) pot	FROM trspmpot GROUP BY no_spm) c ON b.no_spm = c.no_spm WHERE pay = 'TUNAI' AND panjar <> 1
					GROUP BY a.tgl_bukti,a.no_bukti,a.ket,a.no_sp2d,z.no_sp2d,a.total,pot,a.kd_skpd
				UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain  WHERE pay='TUNAI' UNION ALL
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_setorsimpanan WHERE jenis ='2' UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='TUNAI'
				) a 
				where month(a.tgl)<='$nbulan' and kode='$lcskpd'";
				 $hasil = $this->db->query($esteh);
				 $okok = $hasil->row();  
				 $tox_awal="SELECT isnull(sld_awal,0)+sld_awalpajak AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
				 $hasil = $this->db->query($tox_awal);					 
				 $tox = $hasil->row('jumlah');
				 $terima = $okok->terima;
				 $keluar = $okok->keluar;					 
				 $saldotunai=($terima+$tox)-$keluar;
				 
			 $asql="select
				SUM(case when jns=1 then jumlah else 0 end) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				from (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_setorsimpanan UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='BANK' UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay='BANK' UNION ALL
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain WHERE pay='BANK') a
				where month(tgl)<='$nbulan' and kode='$lcskpd'";
				$hasil=$this->db->query($asql);
				$bank=$hasil->row();
				$keluarbank=$bank->keluar;
				$terimabank=$bank->terima;
				$saldobank=$terimabank-$keluarbank;
				
			 $csql="select sum(nilai) as total from trhsp2d where month(tgl_terima)='$nbulan' and kd_skpd = '$lcskpd' 
					and status_terima = '1' and month(tgl_kas) > '$nbulan'";
					 $hasil_srt = $this->db->query($csql);
					 $saldoberharga = $hasil_srt->row('total');
					 
			$cRet .="<TABLE width=\"100%\" style=\"font-size:12px\">
					 <TR>
						<TD align=\"left\" width=\"20%\" >Kepada Yth. <br> 
						Di tempat</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Dengan memperhatikan Peraturan Gubernur Kalimantan Barat No. 70 Tahun 2013 Tentang mekanisme pembayaran dan pertarnggungjawaban
						Penggunaan Dana Atas Beban APBD Provinsi Kalimantan Barat, Bersama ini kami sampaikan Laporan Kas Bulanan yang terdapat di Bendahara Pengeluaran 
						OPD $skpd adalah sejumlah Rp.".number_format($saldo_akhir,'2','.',',')." (".ucwords($this->tukd_model->terbilang($saldo_akhir)).") dengan rincian sebagai berikut:</TD>
					 </TR>
					 </TABLE>";
			$cRet .="<TABLE width=\"100%\" style=\"font-size:12px\">
					 <TR>
						<TD align=\"left\" width=\"5%\" >A.</TD>
						<TD align=\"left\" width=\"60%\" >Kas Bendahara Pengeluaran : </TD>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						</TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.1   Saldo Awal </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldoawal,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.2   Jumlah Penerimaan </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($terima1,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.3   Jumlah Pengeluaran </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($keluar1,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.4   Saldo Akhir Bulan </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldo_akhir,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD colspan=\"4\" align=\"left\" width=\"40%\" ><br>
						Saldo Akhir Bulan Tanggal: $tanggal_ttd  Terdiri dari Saldo Kas Tunai sebesar Rp ".number_format($saldotunai,'2','.',',')." <br>
						Saldo di Bank sebesar Rp ".number_format($saldobank,'2','.',',')." dan Saldo Surat Berharga sebesar Rp ".number_format($saldoberharga,'2','.',',')." 
						<br></TD>
					 </TR>
					 </TABLE>";
					 
			$cRet .="<TABLE width=\"100%\" style=\"font-size:12px\">
			<TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >&nbsp; </TD>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						</TR>
					 <TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >B.</TD>
						<TD align=\"left\" width=\"60%\" >Rekapitulasi Posisi Kas di Bendahara Pengeluaran : </TD>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						</TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.1 Saldo di Kas Tunai </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldotunai,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.2 Saldo di Bank </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldobank,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.3 Saldo Surat Berharga</TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldoberharga,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.4   Saldo Total </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format(($saldotunai+$saldobank+$saldoberharga),'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 
					 </TABLE>";
			
			
			$cRet .='<TABLE width="100%" style="font-size:12px" border="0">
					<TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><u><b>'.$nama1.'<b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';

			$data['prev']= 'DTH';
             switch ($ctk)
        {
            case 0;
			echo ("<title>LAPORAN KAS AKHIR BULAN</title>");
				echo $cRet;
				break;
            case 1;
               $this->tukd_model->_mpdf('', $cRet, 10, 10, 0, '0');
               break;
		}
	}
	
	
	
	function realisasi_fisik()
    {
        $data['page_title']= 'LAPORAN REALISASI FISIK ';
        $this->template->set('title', 'LAPORAN REALISASI FISIK');   
        $this->template->load('template','tukd/transaksi/realisasi_fisik',$data) ; 
    }
	
	
	function cetak_real_fisik($lcskpd='',$nbulan='',$ctk=''){
        $nomor = str_replace('123456789',' ',$this->uri->segment(6));
		$nip2 = str_replace('123456789',' ',$this->uri->segment(7));
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($this->uri->segment(8));
		$spasi = $this->uri->segment(9);
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$lcskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where nip='$nip2' AND kd_skpd='$lcskpd' AND kode in ('PA','KPA')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip = '$nomor' AND kd_skpd='$lcskpd' AND kode='BK'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		
			$cRet ='<TABLE style="border-collapse:collapse;font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>'.$prov.' </TD>
					</TR>
					<tr></tr>
                    <TR>
						<TD align="center" ><b>LAPORAN REALISASI FISIK <br> Bulan '.$this->tukd_model->getBulan($nbulan).' Tahun '.$thn.'</TD>
					</TR>
					</TABLE><br/>';
					
			$cRet .="<table style=\"border-collapse:collapse; font-size:12px\" width=\"90%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$spasi\">
            <thead>
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>KODE REKENING</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>URAIAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>ANGARAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>REALISASI</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>SISA ANGGARAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>%</b></td>
            </tr>
			</thead>
           ";
					$tot_nilai=0;
					$tot_realisasi=0;
				$query = $this->db->query("exec realisasi_fisik '$lcskpd',$nbulan");		
                   foreach ($query->result() as $row) {
                    $rek = $row->rek; 
                    $urut = $row->urut;                   
                    $uraian = $row->uraian;                   
                    $nilai = $row->nilai;
                    $realisasi =$row->realisasi;
                    $sisa=$row->sisa;
                    $persen = $row->persen;
					
					$nilai1  = empty($nilai) || $nilai == 0 ? number_format(0,"2",",",".") :number_format($nilai,"2",",",".");	
					$realisasi1  = empty($realisasi) || $realisasi == 0 ? number_format(0,"2",",",".") :number_format($realisasi,"2",",",".");
					$sisa1  = empty($sisa) || $sisa == 0 ? number_format(0,"2",",",".") :number_format($sisa,"2",",",".");
					$persen1  = empty($persen) || $persen == 0 ? number_format(0,"2",",",".") :number_format($persen,"2",",",".");
			if(strlen($rek)==21){
			$cRet .="
				<tr>
                <td align=\"left\" ><b>$urut</b></td>
                <td align=\"left\" ><b>$uraian</b></td>
                <td align=\"right\" ><b>$nilai1</b></td>
                <td align=\"right\" ><b>$realisasi1</b></td>
                <td align=\"right\" ><b>$sisa1</b></td>
                <td align=\"right\" ><b>$persen1</b></td>
				</tr>
				";
				$tot_nilai=$tot_nilai+$nilai;
				$tot_realisasi=$tot_realisasi+$realisasi;
			} else {
				$cRet .="
				<tr>
                <td align=\"left\" >$urut</td>
                <td align=\"left\" >$uraian</td>
                <td align=\"right\" >$nilai1</td>
                <td align=\"right\" >$realisasi1</td>
                <td align=\"right\" >$sisa1</td>
                <td align=\"right\" >$persen1</td>
				</tr>
				";
			}		
            }
			$cRet .="
				<tr>
                <td colspan=\"2\" align=\"center\" >Total</td>
                <td align=\"right\" >".number_format($tot_nilai,"2",",",".")."</td>
                <td align=\"right\" >".number_format($tot_realisasi,"2",",",".")."</td>
                <td align=\"right\" >".number_format($tot_nilai-$tot_realisasi,"2",",",".")."</td>
                <td align=\"right\" >".number_format(($tot_realisasi/$tot_nilai)*100,"2",",",".")."</td>
				</tr>
				";
				
			
			$cRet .="</table>";
			$cRet .='<TABLE width="100%" style="font-size:12px" border="0" cellspacing="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui</TD>
						<TD align="center" width="30%">'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="30%">'.$jabatan.'</TD>
						<TD align="center" width="30%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					 <TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					 <TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					
                    <TR>
						<TD align="center" width="30%"><u><b>'.$nama.' </b><br></u> '.$pangkat.'</TD>
						<TD align="center" width="30%"><u><b>'.$nama1.' </b><br></u> '.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="30%">NIP. '.$nip.'</TD>
						<TD align="center" width="30%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';

			$data['prev']= 'DTH';
             switch ($ctk)
        {
            case 0;
			echo ("<title>LAPORAN REALISASI FISIK</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'L',0,'');
               break;
		}
	}
	
	
	
	
	
	
	
   
    ////////spj
    
    
    function spj()
    {
        $data['page_title']= 'SPJ';
        $this->template->set('title', 'SPJ');   
        $this->template->load('template','tukd/transaksi/spj',$data) ; 
    }
    function spj_skpd()
    {
        $data['page_title']= 'SPJ';
        $this->template->set('title', 'SPJ');   
        $this->template->load('template','tukd/transaksi/spj_skpd',$data) ; 
    }
    
    function pajak()
    {
        $data['page_title']= 'PAJAK';
        $this->template->set('title', 'PAJAK');   
        $this->template->load('template','tukd/transaksi/pajak',$data) ; 
    }
    
    
    function cetak_pajak($lcskpd='',$nbulan=''){
        
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode in ('PA','KPA')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                }
			$cRet ='<TABLE width="100%">
					<TR>
						<TD align="center" >'.$kab.' </TD>
					</TR>
                    <TR>
						<TD align="center" >BUKU PAJAK PPN/PPh </TD>
					</TR>
					</TABLE><br/>';

			$cRet .='<TABLE width="100%">
					 <TR>
						<TD align="left" width="20%" >OPD</TD>
						<TD align="left" width="80%" >: '.$lcskpd.' '.$skpd.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="20%" >Kepala OPD</TD>
						<TD align="left" width="100" >:'.$nama.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="20%" >Bendahara </TD>
						<TD align="left" width="80%" >:'.$nama1.'</TD>
					 </TR>
					 </TABLE>';

			$cRet .='<TABLE border="1" cellspacing="0" cellpadding="0" >
					 <TR>
						<TD width="80" align="center" >NO</TD>
                        <TD width="90" align="center" >Tanggal</TD>
						<TD width="350" align="center" >Uraian</TD>						
						<TD width="100" align="center" >Pomotongan (Rp)</TD>
						<TD width="100" align="center" >Penyetoran (Rp)</TD>
						<TD width="120" align="center" >Saldo</TD>
					 </TR>';
			

			
				$query = $this->db->query("SELECT * FROM(SELECT no_bukti as no,no_bukti AS no_bukti,tgl_bukti AS tgl,CONCAT(ket,'  no sp2d:',no_sp2d) AS keterangan,'0' AS terima,'0' AS keluar,'1' AS ket,'D' as jns FROM trhtrmpot WHERE MONTH(tgl_bukti)='$nbulan' AND kd_skpd='$lcskpd'
	                                       UNION ALL
	                                       SELECT '' as no,a.no_bukti AS no_bukti ,'' AS tgl,CONCAT(a.kd_rek5,' - ',a.nm_rek5) AS keterangan,a.nilai AS terima,'0' AS keluar,'2'AS ket,'D' as jns FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti WHERE MONTH(b.tgl_bukti)='$nbulan' AND b.kd_skpd='$lcskpd'
	                                       UNION ALL
	                                       SELECT no_bukti as no,no_bukti AS no_bukti,tgl_bukti AS tgl,CONCAT(ket,'  terima:',no_terima) AS keterangan,'0' AS terima,'0' AS keluar,'1' AS ket,'K' as jns FROM trhstrpot WHERE MONTH(tgl_bukti)='$nbulan' AND kd_skpd='$lcskpd'
	                                       UNION ALL
	                                       SELECT '' as no,a.no_bukti AS no_bukti ,'' AS tgl,CONCAT(a.kd_rek5,' - ',a.nm_rek5) AS keterangan,'0' AS terima,a.nilai AS keluar,'2'AS ket,'K' as jns FROM trdstrpot  a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti WHERE MONTH(b.tgl_bukti)='$nbulan' AND b.kd_skpd='$lcskpd') a ORDER BY no_bukti,ket ");  
				

			
				$lcno=0;
				$saldo=0;
                $tbukti='';
				foreach ($query->result() as $row) {
					$lcno = $lcno + 1;
                    if ($tbukti != $row->no_bukti){
						$nokas=$row->no_bukti;
					}else{
						$nokas='';					
					}
                    $bukti = $row->no; 
                    $tanggal = $row->tgl;                   
                    $ket = $row->keterangan;
                    $in =$row->terima;
                    $out=$row->keluar;                    
                    $debet = empty($row->terima) || $row->terima == 0 ? '' :number_format($row->terima);                     
                    $kredit = empty($row->keluar) || $row->keluar == 0 ? '' :number_format($row->keluar);
					if ($row->jns=='D'){					
						$saldo=$saldo+$row->terima;
                        $sal = empty($saldo) || $saldo == 0 ? '' :number_format($saldo);
					}else{
						$saldo=$saldo-$row->keluar;
                        $sal = empty($saldo) || $saldo == 0 ? '' :number_format($saldo);
					}

					$cRet .='<TR>
								<TD width="80" align="left" >'.$bukti.'</TD>
                                <TD width="90" align="left" >'.$tanggal.'</TD>
								<TD width="350" align="left" >'.$ket.'</TD>								
								<TD width="100" align="right" >'.$debet.'</TD>
								<TD width="100" align="right" >'.$kredit.'</TD>
								<TD width="120" align="right" >'.$saldo.'</TD>
							 </TR>';					
			
				}

									

			$cRet .='</TABLE>';

			$data['prev']= 'BUKU PAJAK PPN/PPh';
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0');	
	
	}
   
	function cetak_spj($lcskpd='',$nbulan='',$ttd1='',$tgl_ctk='',$ttd2='',$ctk='',$atas='', $bawah='', $kiri='', $kanan='', $jenis=''){
		$ttd1 = str_replace('123456789',' ',$ttd1);
		$ttd2 = str_replace('123456789',' ',$ttd2); 
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where kd_skpd='$lcskpd' and kode in ('PA','KPA') and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama2= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where kd_skpd='$lcskpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
				
				$sqlanggaran1="select case when statu=1 and status_sempurna=1 and status_ubah=1 and $nbulan>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $nbulan>=month(tgl_dpa_sempurna) and $nbulan<month(tgl_dpa_ubah) then 'nilai_akhir_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $nbulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $nbulan>=month(tgl_dpa_sempurna) then 'nilai_akhir_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $nbulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and $nbulan>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd='$lcskpd'";
                 $sqlanggaran=$this->db->query($sqlanggaran1);
                 foreach ($sqlanggaran->result() as $rowttd)
                {
                    $anggaran=$rowttd->anggaran;
                }
				
		$tanda_ang=2;
        $thn_ang	   = $this->session->userdata('pcThang');
        
        $skpd = $lcskpd;
        $nama=  $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $bulan= $this->tukd_model->getBulan($nbulan); 
		$prv = $this->db->query("SELECT * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		if($jenis=='1'){
			$judul='SPJ FUNGSIONAL';
		} else if($jenis=='2'){
			$judul='SPJ ADMINISTRATIF';
		} else {
			$judul='SPJ BELANJA';
		}
        
        $font = 12;
        $fontc = 'font-size:'.$font.'px;';
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="
            
            <tr>
                <td align=\"center\" style=\"font-size:14px;\" colspan=\"2\">
                 <b> $prov<BR></b>
                 <b> SURAT PENGESAHAN PERTANGGUNGJAWABAN BENDAHARA PENGELUARAN<BR></b>
                 <b>(".$judul.")<BR></b>&nbsp;
                </td>
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" width=\"25%\">
                  OPD
                </td> 
                <td width=\"75%\" style=\"font-size:12px;\">:$skpd - $nama
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Pengguna Anggaran/Kuasa Pengguna Anggaran
                </td> 
                <td style=\"font-size:12px;\">:$nama2
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Bendahara Pengeluaran
                </td> 
                <td style=\"font-size:12px;\">:$nama1
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Tahun Anggaran
                </td> 
                <td style=\"font-size:12px;\">:$thn_ang
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Bulan
                </td> 
                <td style=\"font-size:12px;\">:$bulan
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" colspan=\"2\">
                 &nbsp;
                </td> 
            </tr>
            
            </table>
            <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Kode<br>Rekening</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Uraian</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Jumlah<br>Anggaran</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\" style=\"font-size:12px\"><b>SPJ-LS Gaji</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\" style=\"font-size:12px\"><b>SPJ-LS Barang & Jasa</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\" style=\"font-size:12px\"><b>SPJ UP/GU/TU</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Jumlah SPJ<br>(LS+UP/GU/TU)<br>s.d Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Sisa Pagu<br>Anggaran</b></td>
            </tr>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan<br>lalu</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan<br>lalu</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan<br>lalu</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan Ini</b></td>
            </tr>                 
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">1</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">2</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">3</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">4</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">5</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">6</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">7</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">8</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">9</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">10</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">11</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">12</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">13</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">14</td>
            </tr> 
             </thead>
            <tr>
                <td align=\"center\" style=\"font-size:12px\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
            </tr>";


				$att="exec spj_skpd '$lcskpd','$nbulan'";
				$hasil=$this->db->query($att);
				foreach ($hasil->result() as $trh1){
				$bre				=	$trh1->kd_rek;
				$wok				=	$trh1->uraian;
				$nilai				=	$trh1->anggaran;
				$real_up_ini		=	$trh1->up_ini;
				$real_up_ll			=	$trh1->up_lalu;
				$real_gaji_ini		=	$trh1->gaji_ini;
				$real_gaji_ll		=	$trh1->gaji_lalu;
				$real_brg_js_ini	=	$trh1->brg_ini;
				$real_brg_js_ll		=	$trh1->brg_lalu;
				$total	= $real_gaji_ll+$real_gaji_ini+$real_brg_js_ll+$real_brg_js_ini+$real_up_ll+$real_up_ini;
				$sisa	= $nilai-$real_gaji_ll-$real_gaji_ini-$real_brg_js_ll-$real_brg_js_ini-$real_up_ll-$real_up_ini;
				$a=strlen($bre);
			if($a==18){
			$cRet .="
           <tr>
                <td   valign=\"top\" width=\"8%\" align=\"left\" style=\"font-size:12px\" ><b>".$bre."</b></td>
                <td   valign=\"top\" align=\"left\" width=\"25%\" style=\"font-size:12px\"><b>".$wok."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($nilai,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ini,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll+$real_gaji_ini,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ini,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll+$real_brg_js_ini,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ini,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll+$real_up_ini,"2",",",".")."</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",",",".")."</b>&nbsp;</b></td>
                <td   valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($sisa,"2",",",".")."</b></td>
            </tr>";
			}else if($a==21){
			$cRet .="
           <tr>
                <td valign=\"top\" width=\"8%\" align=\"left\" style=\"font-size:12px\" ><b>".$bre."</b></td>
                <td valign=\"top\" align=\"left\" width=\"25%\" style=\"font-size:12px\"><b>".$wok."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($nilai,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ini,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll+$real_gaji_ini,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ini,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll+$real_brg_js_ini,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ini,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll+$real_up_ini,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",",",".")."</b>&nbsp;</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($sisa,"2",",",".")."</b></td>
            </tr>";
			} else{
			$cRet .="
				<tr>
                <td valign=\"top\" width=\"8%\" align=\"left\" style=\"font-size:12px\" >".substr($bre,22,7)."</td>
                <td valign=\"top\" align=\"left\" width=\"25%\" style=\"font-size:12px\">".$wok."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($nilai,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_gaji_ll,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_gaji_ini,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_gaji_ll+$real_gaji_ini,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_brg_js_ll,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_brg_js_ini,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_brg_js_ll+$real_brg_js_ini,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_up_ll,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_up_ini,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_up_ll+$real_up_ini,"2",",",".")."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($total,"2",",",".")."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($sisa,"2",",",".")."</td>
            </tr>";
			}
			}
			$cRet .="

            <tr>
                <td valign=\"top\" align=\"center\" style=\"font-size:12px\" >&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Penerimaan :</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td valign=\"top\" align=\"center\" style=\"font-size:12px\">&nbsp;</td>
            </tr>";
            
			if($lcskpd=='3.13.01.17'){
				$jns_tambah=",'5'";
			}else{
				$jns_tambah="";
			}
			
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)='$nbulan' AND c.jns_spp IN ('1','2','3') AND a.status='1') AS sp2d_up_ini,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)<'$nbulan' AND c.jns_spp IN ('1','2','3') AND a.status='1') AS sp2d_up_ll,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)='$nbulan' AND c.jns_spp IN ('4'$jns_tambah) AND a.status='1') AS sp2d_gj_ini,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)<'$nbulan' AND c.jns_spp IN ('4'$jns_tambah)  AND a.status='1') AS sp2d_gj_ll,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)='$nbulan' AND c.jns_spp ='6'  AND a.status='1') AS sp2d_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)<'$nbulan' AND c.jns_spp ='6' AND a.status='1') AS sp2d_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh1 = $hasil->row(); 
            $totalsp2d = $trh1->sp2d_gj_ll+$trh1->sp2d_gj_ini+$trh1->sp2d_brjs_ll+
                         $trh1->sp2d_brjs_ini+$trh1->sp2d_up_ll+$trh1->sp2d_up_ini;
                         
            $cobacoba = $trh1->sp2d_gj_ll;
            
            
            
            $cRet .="   
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\" >&ensp;&ensp;- SP2D</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_gj_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_gj_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_gj_ll + $trh1->sp2d_gj_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_brjs_ll + $trh1->sp2d_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_up_ll + $trh1->sp2d_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalsp2d,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr> ";           
            
			$csqlsp2d = "SELECT a.no_sp2d,
						SUM(CASE WHEN a.jns_spp IN ('4'$jns_tambah) AND MONTH(a.tgl_kas)<$nbulan THEN b.nilai ELSE 0 END) AS gj_ll,
						SUM(CASE WHEN a.jns_spp IN ('4'$jns_tambah) AND MONTH(a.tgl_kas)=$nbulan THEN b.nilai ELSE 0 END) AS gj_ini,
						SUM(CASE WHEN a.jns_spp IN ('4'$jns_tambah) AND MONTH(a.tgl_kas)<=$nbulan THEN b.nilai ELSE 0 END) AS gj_sdini,
						SUM(CASE WHEN a.jns_spp IN ('6') AND MONTH(a.tgl_kas)<$nbulan THEN b.nilai ELSE 0 END) AS br_ll,
						SUM(CASE WHEN a.jns_spp IN ('6') AND MONTH(a.tgl_kas)=$nbulan THEN b.nilai ELSE 0 END) AS br_ini,
						SUM(CASE WHEN a.jns_spp IN ('6') AND MONTH(a.tgl_kas)<=$nbulan THEN b.nilai ELSE 0 END) AS br_sdini,
						SUM(CASE WHEN a.jns_spp IN ('1','2','3') AND MONTH(a.tgl_kas)<$nbulan THEN b.nilai ELSE 0 END) AS up_ll,
						SUM(CASE WHEN a.jns_spp IN ('1','2','3') AND MONTH(a.tgl_kas)=$nbulan THEN b.nilai ELSE 0 END) AS up_ini,
						SUM(CASE WHEN a.jns_spp IN ('1','2','3') AND MONTH(a.tgl_kas)<=$nbulan THEN b.nilai ELSE 0 END) AS up_sdini
						FROM trhsp2d a INNER JOIN trdspp b 
						ON a.no_spp = b.no_spp INNER JOIN trhspp c
						ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd'
						AND a.status='1' AND MONTH(a.tgl_kas)=$nbulan
						GROUP BY a.no_sp2d";
			
			$hasilsp2d=$this->db->query($csqlsp2d);
				foreach ($hasilsp2d->result() as $trsp2d){
				$xno_sp2d	=	$trsp2d->no_sp2d;
				$xup_ll		=	$trsp2d->up_ll;
				$xup_ini	=	$trsp2d->up_ini;
				$xup_sdini	=	$trsp2d->up_sdini;
				$xbr_ll		=	$trsp2d->br_ll;
				$xbr_ini	=	$trsp2d->br_ini;
				$xbr_sdini	=	$trsp2d->br_sdini;
				$xgj_ll		=	$trsp2d->gj_ll;
				$xgj_ini	=	$trsp2d->gj_ini;
				$xgj_sdini	=	$trsp2d->gj_sdini;
			
			
			$cRet .="   
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp; $xno_sp2d</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xbr_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xbr_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xbr_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xup_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xup_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xup_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_sdini+$xbr_sdini+$xup_sdini,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
		   </tr> "; 
				}
			$cRet .="
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Potongan Pajak</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130301';//'2110401'; // ppn terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh2 = $hasil->row();
            $totalppn = $trh2->jppn_up_ini + $trh2->jppn_up_ll + $trh2->jppn_gaji_ini + 
                        $trh2->jppn_gaji_ll + $trh2->jppn_brjs_ini + $trh2->jppn_brjs_ll;
            
            
            $cRet .=" 
            <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;a. PPN</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_gaji_ll + $trh2->jppn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_brjs_ll + $trh2->jppn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_up_ll + $trh2->jppn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppn,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
			</tr>";
            
            $lcrek = '2130101'; // pph 21 terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh3 = $hasil->row();
            $totalpph21 = $trh3->jpph21_up_ini + $trh3->jpph21_up_ll + $trh3->jpph21_gaji_ini + 
                        $trh3->jpph21_gaji_ll + $trh3->jpph21_brjs_ini + $trh3->jpph21_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;b. PPH 21</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_gaji_ll + $trh3->jpph21_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_brjs_ll + $trh3->jpph21_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_up_ll + $trh3->jpph21_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph21,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130201'; // pph 22 terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh4 = $hasil->row();
            $totalpph22 = $trh4->jpph22_up_ini + $trh4->jpph22_up_ll + $trh4->jpph22_gaji_ini + 
                        $trh4->jpph22_gaji_ll + $trh4->jpph22_brjs_ini + $trh4->jpph22_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;c. PPH 22</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_gaji_ll + $trh4->jpph22_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_brjs_ll + $trh4->jpph22_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_up_ll + $trh4->jpph22_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph22,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
			$lcrek = '2130401'; // pph 23 terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh5 = $hasil->row();
            $totalpph23 = $trh5->jpph23_up_ini + $trh5->jpph23_up_ll + $trh5->jpph23_gaji_ini + 
                        $trh5->jpph23_gaji_ll + $trh5->jpph23_brjs_ini + $trh5->jpph23_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;d. PPH 23</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_gaji_ll + $trh5->jpph23_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_brjs_ll + $trh5->jpph23_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_up_ll + $trh5->jpph23_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph23,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			$lcrek = '2130501'; // pph4
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_sdini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh72 = $hasil->row();
            $totalpph4 = $trh72->up_pph4_sdini + $trh72->gj_pph4_sdini + $trh72->ls_pph4_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;e. PPh Pasal 4</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->gj_pph4_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->gj_pph4_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->gj_pph4_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->ls_pph4_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->ls_pph4_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->ls_pph4_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->up_pph4_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->up_pph4_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->up_pph4_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph4,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";          
			
            
			$lcrek = "('2110701','2110702','2110703')"; // IWP
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS up_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS up_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS up_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS gj_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS gj_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS gj_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS ls_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS ls_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS ls_iwp_sdini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5 in $lcrek AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh70 = $hasil->row();
            $totaliwp = $trh70->up_iwp_sdini + $trh70->gj_iwp_sdini + $trh70->ls_iwp_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. IWP</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->gj_iwp_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->gj_iwp_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->gj_iwp_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->ls_iwp_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->ls_iwp_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->ls_iwp_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->up_iwp_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->up_iwp_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->up_iwp_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaliwp,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			$lcrek = '2110501'; // TAPERUM
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS up_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS up_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS up_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS gj_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_sdini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh71 = $hasil->row();
            $totaltap = $trh71->up_tap_sdini + $trh71->gj_tap_sdini + $trh71->ls_tap_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Taperum</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->gj_tap_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->gj_tap_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->gj_tap_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->ls_tap_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->ls_tap_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->ls_tap_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->up_tap_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->up_tap_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->up_tap_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaltap,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			$lcrek = '2111001'; // PPnPn 2%
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh15 = $hasil->row();
            $totalppnpn = $trh15->ppnpn_up_ini + $trh15->ppnpn_up_ll + $trh15->ppnpn_gaji_ini + 
                        $trh15->ppnpn_gaji_ll + $trh15->ppnpn_brjs_ini + $trh15->ppnpn_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib PPNPN 2%</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_gaji_ll + $trh15->ppnpn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_brjs_ll + $trh15->ppnpn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_up_ll + $trh15->ppnpn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppnpn,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			

            // PPnPn 3% 2111101       
            $hasil = $this->tukd_model->spj_trmpajak_rek($lcskpd,'2111101',$nbulan,'PPnPn3');
            $trhPPnPn3 = $hasil->row();
            $totalPPnPn3 = $trhPPnPn3->PPnPn3_up_ini + $trhPPnPn3->PPnPn3_up_ll + $trhPPnPn3->PPnPn3_gaji_ini + 
                        $trhPPnPn3->PPnPn3_gaji_ll + $trhPPnPn3->PPnPn3_brjs_ini + $trhPPnPn3->PPnPn3_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib PPNPN 3%</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_gaji_ll + $trhPPnPn3->PPnPn3_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_brjs_ll + $trhPPnPn3->PPnPn3_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_up_ll + $trhPPnPn3->PPnPn3_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalPPnPn3,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
            // Iuran JKK 2111201 | Iuran JKM 2111301     
            $hasil = $this->tukd_model->spj_trmpajak_rek($lcskpd,'2111201',$nbulan,'jkk');
            $trhjkk = $hasil->row();
            $totaljkk = $trhjkk->jkk_up_ini + $trhjkk->jkk_up_ll + $trhjkk->jkk_gaji_ini + 
                        $trhjkk->jkk_gaji_ll + $trhjkk->jkk_brjs_ini + $trhjkk->jkk_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib JKK</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_gaji_ll + $trhjkk->jkk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_brjs_ll + $trhjkk->jkk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_up_ll + $trhjkk->jkk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaljkk,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			

            // Iuran JKM 2111301     
            $hasil = $this->tukd_model->spj_trmpajak_rek($lcskpd,'2111301',$nbulan,'jkm');
            $trhjkm = $hasil->row();
            $totaljkm = $trhjkm->jkm_up_ini + $trhjkm->jkm_up_ll + $trhjkm->jkm_gaji_ini + 
                        $trhjkm->jkm_gaji_ll + $trhjkm->jkm_brjs_ini + $trhjkm->jkm_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib JKM</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_gaji_ll + $trhjkm->jkm_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_brjs_ll + $trhjkm->jkm_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_up_ll + $trhjkm->jkm_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaljkm,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
            // Iuran BPJS 2111401         
            $hasil = $this->tukd_model->spj_trmpajak_rek($lcskpd,'2111401',$nbulan,'bpjs');
            $trhbpjs = $hasil->row();
            $totalbpjs = $trhbpjs->bpjs_up_ini + $trhbpjs->bpjs_up_ll + $trhbpjs->bpjs_gaji_ini + 
                        $trhbpjs->bpjs_gaji_ll + $trhbpjs->bpjs_brjs_ini + $trhbpjs->bpjs_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. BPJS</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_gaji_ll + $trhbpjs->bpjs_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_brjs_ll + $trhbpjs->bpjs_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_up_ll + $trhbpjs->bpjs_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalbpjs,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			

            // Denda Keterlambatan 4140611         
            $hasil = $this->tukd_model->spj_trmpajak_rek($lcskpd,'4140611',$nbulan,'dk');
            $trhdk = $hasil->row();
            $totaldk = $trhdk->dk_up_ini + $trhdk->dk_up_ll + $trhdk->dk_gaji_ini + 
                        $trhdk->dk_gaji_ll + $trhdk->dk_brjs_ini + $trhdk->dk_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Denda Keterlambatan</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_gaji_ll + $trhdk->dk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_brjs_ll + $trhdk->dk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_up_ll + $trhdk->dk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaldk,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
            // lain terima //copy2
            $tlainnot = "('2130101','2130201','2130401','2130301','2110701','2110702','2110703','2110702','2110703','2110702','2110703','2110501','2130501','2111201','2111301','2111001','2111101','2111401','4140611')";
            $csql = "SELECT 
					SUM(ISNULL(jlain_up_ll,0)) jlain_up_ll, SUM(ISNULL(jlain_up_ini,0)) jlain_up_ini, 
					SUM(ISNULL(jlain_gaji_ll,0)) jlain_gaji_ll, SUM(ISNULL(jlain_gaji_ini,0)) jlain_gaji_ini, 
					SUM(ISNULL(jlain_brjs_ll,0)) jlain_brjs_ll, SUM(ISNULL(jlain_brjs_ini,0)) jlain_brjs_ini
					 FROM(
					SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN $tlainnot THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN $tlainnot THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN $tlainnot THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN $tlainnot THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN $tlainnot THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN $tlainnot THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd='$lcskpd'
					UNION ALL
					SELECT 
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ini
					FROM TRHINLAIN a WHERE pengurang_belanja !='1'
					AND a.kd_skpd='$lcskpd'
					
					) a ";

			
			
					
					
					
           
            $hasil = $this->db->query($csql);
            $trh6 = $hasil->row();
            $totallain = $trh6->jlain_up_ini + $trh6->jlain_up_ll + $trh6->jlain_gaji_ini + 
                         $trh6->jlain_gaji_ll + $trh6->jlain_brjs_ini + $trh6->jlain_brjs_ll;
            
            //-------- TOTAL PENERIMAAN
            $jmtrmgaji_ll =  $trh1->sp2d_gj_ll+ $trh2->jppn_gaji_ll + $trh3->jpph21_gaji_ll +
                             $trh4->jpph22_gaji_ll + $trh5->jpph23_gaji_ll + $trh6->jlain_gaji_ll+ $trh15->ppnpn_gaji_ll+
							 $trhPPnPn3->PPnPn3_gaji_ll+$trhjkk->jkk_gaji_ll+$trhjkm->jkm_gaji_ll+$trh70->gj_iwp_lalu + $trhbpjs->bpjs_gaji_ll+
                             $trhdk->dk_gaji_ll+$trh71->gj_tap_lalu+$trh72->gj_pph4_lalu;
            
            $jmtrmgaji_ini =  $trh1->sp2d_gj_ini + $trh2->jppn_gaji_ini + $trh3->jpph21_gaji_ini +
                             $trh4->jpph22_gaji_ini + $trh5->jpph23_gaji_ini + $trh6->jlain_gaji_ini+ $trh15->ppnpn_gaji_ini+
							  $trhPPnPn3->PPnPn3_gaji_ini+$trhjkk->jkk_gaji_ini+$trhjkm->jkm_gaji_ini+$trh70->gj_iwp_ini + $trhbpjs->bpjs_gaji_ini+ 
                              $trhdk->dk_gaji_ini+$trh71->gj_tap_ini+$trh72->gj_pph4_ini;
                             
            $jmtrmgaji_sd = $jmtrmgaji_ll + $jmtrmgaji_ini;
            
            
            $jmtrmbrjs_ll =  $trh1->sp2d_brjs_ll + $trh2->jppn_brjs_ll + $trh3->jpph21_brjs_ll +
                             $trh4->jpph22_brjs_ll + $trh5->jpph23_brjs_ll + $trh6->jlain_brjs_ll + $trh15->ppnpn_brjs_ll+
							 $trhPPnPn3->PPnPn3_brjs_ll+$trhjkk->jkk_brjs_ll+$trhjkm->jkm_brjs_ll+$trh70->ls_iwp_lalu + $trhbpjs->bpjs_brjs_ll+
                             $trhdk->dk_brjs_ll+$trh71->ls_tap_lalu+$trh72->ls_pph4_lalu;
                                                                                                 
            $jmtrmbrjs_ini =  $trh1->sp2d_brjs_ini + $trh2->jppn_brjs_ini + $trh3->jpph21_brjs_ini +
                             $trh4->jpph22_brjs_ini + $trh5->jpph23_brjs_ini + $trh6->jlain_brjs_ini + $trh15->ppnpn_brjs_ini +
							 $trhPPnPn3->PPnPn3_brjs_ini +$trhjkk->jkk_brjs_ini +$trhjkm->jkm_brjs_ini +$trhbpjs->bpjs_brjs_ini + 
                             $trhdk->dk_brjs_ini +$trh70->ls_iwp_ini + $trh71->ls_tap_ini + $trh72->ls_pph4_ini;
                             
            $jmtrmbrjs_sd = $jmtrmbrjs_ll + $jmtrmbrjs_ini;
            
            $jmtrmup_ll =  $trh1->sp2d_up_ll + $trh2->jppn_up_ll + $trh3->jpph21_up_ll +
                             $trh4->jpph22_up_ll + $trh5->jpph23_up_ll + $trh6->jlain_up_ll + $trh15->ppnpn_up_ll+
							 $trhPPnPn3->PPnPn3_up_ll+$trhjkk->jkk_up_ll+$trhjkm->jkm_up_ll+$trhbpjs->bpjs_up_ll +
                             $trhdk->dk_up_ll +$trh70->up_iwp_lalu + $trh71->up_tap_lalu + $trh72->up_pph4_lalu;                           
            
            $jmtrmup_ini =  $trh1->sp2d_up_ini + $trh2->jppn_up_ini + $trh3->jpph21_up_ini +
                             $trh4->jpph22_up_ini + $trh5->jpph23_up_ini + $trh6->jlain_up_ini + $trh15->ppnpn_up_ini+
							 $trhPPnPn3->PPnPn3_up_ini+$trhjkk->jkk_up_ini+$trhjkm->jkm_up_ini+$trhbpjs->bpjs_up_ini +
                             $trhdk->dk_up_ini +$trh70->up_iwp_ini + $trh71->up_tap_ini + $trh72->up_pph4_ini;
            
            $jmtrmup_sd = $jmtrmup_ll + $jmtrmup_ini;
            
            
            $cRet .="
                       
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Lain-lain</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_gaji_ll + $trh6->jlain_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_brjs_ll + $trh6->jlain_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_up_ll + $trh6->jlain_up_ini ,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totallain,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Jumlah Penerimaan :</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd + $jmtrmbrjs_sd + $jmtrmup_sd,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr> 
           
           
            
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Pengeluaran :</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
				   $csql = "select sum(gj_ll) as spj_gaji_ll, sum(gj_ini) as spj_gaji_ini, sum(brg_ll) as spj_brjs_ll, sum(brg_ini) as spj_brjs_ini, sum(up_ll) as spj_up_ll, sum(up_ini) as spj_up_ini from
			(
			select kd_skpd,0 [up_ini],0 [up_ll],0 [gj_ini],0 [gj_ll], 0 [brg_ini],0 [brg_ll] from ms_skpd where kd_skpd='$lcskpd' 
			union 
			SELECT a.kd_skpd
			,SUM(CASE WHEN MONTH(b.tgl_bukti)=$nbulan AND jns_spp in (1,2,3) THEN a.nilai ELSE 0 END) AS up_ini
			,SUM(CASE WHEN MONTH(b.tgl_bukti)<$nbulan AND jns_spp in (1,2,3) THEN a.nilai ELSE 0 END) AS up_ll
			,SUM(CASE WHEN MONTH(b.tgl_bukti)=$nbulan AND jns_spp in (4,5) THEN a.nilai ELSE 0 END) AS gj_ini
			,SUM(CASE WHEN MONTH(b.tgl_bukti)<$nbulan AND jns_spp in (4,5) THEN a.nilai ELSE 0 END) AS gj_ll
			,SUM(CASE WHEN MONTH(b.tgl_bukti)=$nbulan AND jns_spp in (6) THEN a.nilai ELSE 0 END) AS brg_ini
			,SUM(CASE WHEN MONTH(b.tgl_bukti)<$nbulan AND jns_spp in (6) THEN a.nilai ELSE 0 END) AS brg_ll
			from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
			WHERE a.kd_skpd='$lcskpd' GROUP BY a.kd_skpd
			UNION ALL
			SELECT b.kd_skpd
			, 0 as up_ini
			,SUM(CASE WHEN MONTH(b.TGL_BUKTI)<=$nbulan and b.pengurang_belanja=1 THEN a.nilai*-1 ELSE 0 END) AS up_ll
			, 0 as gj_ini
			, 0 as gj_ll
			, 0 as brg_ini
			, 0 as brg_ll
			FROM trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
			WHERE b.kd_skpd='$lcskpd'
			GROUP BY b.kd_skpd
			UNION ALL
			SELECT a.kd_skpd
			, 0 up_ini
			, 0 up_ll
			,SUM(CASE WHEN MONTH(b.tgl_sts)=$nbulan and b.jns_trans=5 and b.jns_cp in (1) THEN a.rupiah*-1 ELSE 0 END) AS gj_ini
			,SUM(CASE WHEN MONTH(b.tgl_sts)<$nbulan and b.jns_trans=5 and b.jns_cp in (1) THEN a.rupiah*-1 ELSE 0 END) AS gj_ll
			,SUM(CASE WHEN MONTH(b.tgl_sts)=$nbulan and b.jns_trans=5 and b.jns_cp in (2) THEN a.rupiah*-1 ELSE 0 END) AS brg_ini
			,SUM(CASE WHEN MONTH(b.tgl_sts)<$nbulan and b.jns_trans=5 and b.jns_cp in (2) THEN a.rupiah*-1 ELSE 0 END) AS brg_ll
			from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
			WHERE b.kd_skpd='$lcskpd' AND LEFT(kd_rek5,1)<>4
			GROUP BY a.kd_skpd
			UNION ALL
			SELECT a.kd_skpd
			,SUM(CASE WHEN MONTH(b.tgl_bukti)=$nbulan AND jns_spp in (1,2,3) THEN a.nilai ELSE 0 END) AS up_ini
			,SUM(CASE WHEN MONTH(b.tgl_bukti)<$nbulan AND jns_spp in (1,2,3) THEN a.nilai ELSE 0 END) AS up_ll
			,SUM(CASE WHEN MONTH(b.tgl_bukti)=$nbulan AND jns_spp in (4,5) THEN a.nilai ELSE 0 END) AS gj_ini
			,SUM(CASE WHEN MONTH(b.tgl_bukti)<$nbulan AND jns_spp in (4,5) THEN a.nilai ELSE 0 END) AS gj_ll
			,SUM(CASE WHEN MONTH(b.tgl_bukti)=$nbulan AND jns_spp in (6,7) THEN a.nilai ELSE 0 END) AS brg_ini
			,SUM(CASE WHEN MONTH(b.tgl_bukti)<$nbulan AND jns_spp in (6,7) THEN a.nilai ELSE 0 END) AS brg_ll
			from trdtransout_blud a join trhtransout_blud b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
			WHERE a.kd_skpd='$lcskpd' GROUP BY a.kd_skpd

			)b GROUP BY kd_skpd ";

           
           $hasil = $this->db->query($csql);
           $trh7 = $hasil->row(); 
           $totalspj = $trh7->spj_gaji_ll + $trh7->spj_gaji_ini + $trh7->spj_brjs_ll + 
                       $trh7->spj_brjs_ini + $trh7->spj_up_ll + $trh7->spj_up_ini;
                                                            
           $cRet .="
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;- SPJ(LS + UP/GU/TU)</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_gaji_ini + $trh7->spj_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_brjs_ini + $trh7->spj_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_up_ini + $trh7->spj_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalspj,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;- Penyetoran Pajak</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
           $lcrek = '2130301';//'2110401'; // ppn setor
           $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ll";
            
           $hasil = $this->db->query($csql);
           $trh8 = $hasil->row();
           $totalppn = $trh8->jppn_up_ini + $trh8->jppn_up_ll + $trh8->jppn_gaji_ini + 
                        $trh8->jppn_gaji_ll + $trh8->jppn_brjs_ini + $trh8->jppn_brjs_ll;
            
            $cRet .="
            <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;a. PPN</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_gaji_ll + $trh8->jppn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_brjs_ll + $trh8->jppn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_up_ll + $trh8->jppn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppn,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            
            $lcrek = '2130101'; // pph 21 setor
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh9 = $hasil->row();
            $totalpph21 = $trh9->jpph21_up_ini + $trh9->jpph21_up_ll + $trh9->jpph21_gaji_ini + 
                          $trh9->jpph21_gaji_ll + $trh9->jpph21_brjs_ini + $trh9->jpph21_brjs_ll;
            
            
            $cRet .="
             <tr> <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;b. PPH 21</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_gaji_ll + $trh9->jpph21_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_brjs_ll + $trh9->jpph21_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_up_ll + $trh9->jpph21_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph21,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130201'; // pph 22 setor
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh10 = $hasil->row();
            $totalpph22 = $trh10->jpph22_up_ini + $trh10->jpph22_up_ll + $trh10->jpph22_gaji_ini + 
                        $trh10->jpph22_gaji_ll + $trh10->jpph22_brjs_ini + $trh10->jpph22_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;c. PPH 22</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_gaji_ll + $trh10->jpph22_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_brjs_ll + $trh10->jpph22_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_up_ll + $trh10->jpph22_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph22,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130401'; // pph 23 setor
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh11 = $hasil->row();
            $totalpph23 = $trh11->jpph23_up_ini + $trh11->jpph23_up_ll + $trh11->jpph23_gaji_ini + 
                        $trh11->jpph23_gaji_ll + $trh11->jpph23_brjs_ini + $trh11->jpph23_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;d. PPH 23</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_gaji_ll + $trh11->jpph23_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_brjs_ll + $trh11->jpph23_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_up_ll + $trh11->jpph23_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph23,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

			$lcrek = '2130501'; // pph4
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_sdini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh75 = $hasil->row();
            $totalpph4_setor = $trh75->up_pph4_sdini + $trh75->gj_pph4_sdini + $trh75->ls_pph4_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;e. PPh Pasal 4</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->gj_pph4_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->gj_pph4_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->gj_pph4_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->ls_pph4_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->ls_pph4_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->ls_pph4_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->up_pph4_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->up_pph4_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->up_pph4_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph4_setor,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

			
			$lcrek = "('2110701','2110702','2110703')"; // IWP
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_iwp_sdini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5 in $lcrek AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh73 = $hasil->row();
            $totaliwp_setor = $trh73->up_iwp_sdini + $trh73->gj_iwp_sdini + $trh73->ls_iwp_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. IWP</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->gj_iwp_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->gj_iwp_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->gj_iwp_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->ls_iwp_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->ls_iwp_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->ls_iwp_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->up_iwp_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->up_iwp_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->up_iwp_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaliwp_setor,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			$lcrek = '2110501'; // TAPERUM
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_sdini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh74 = $hasil->row();
            $totaltap_setor = $trh74->up_tap_sdini + $trh74->gj_tap_sdini + $trh74->ls_tap_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Taperum</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->gj_tap_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->gj_tap_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->gj_tap_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->ls_tap_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->ls_tap_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->ls_tap_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->up_tap_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->up_tap_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->up_tap_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaltap_setor,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			
			
			
			 $lcrek = '2111001'; // PPnpn 2%
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh16 = $hasil->row();
            $totalppnpn = $trh16->ppnpn_up_ini + $trh16->ppnpn_up_ll + $trh16->ppnpn_gaji_ini + 
                        $trh16->ppnpn_gaji_ll + $trh16->ppnpn_brjs_ini + $trh16->ppnpn_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib PPNPN 2%</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_gaji_ll + $trh16->ppnpn_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_brjs_ll + $trh16->ppnpn_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_up_ll + $trh16->ppnpn_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppnpn,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            // PPnpn 3% 2111101
            $hasil = $this->tukd_model->spj_strpajak_rek($lcskpd,'2111101',$nbulan,'PPnPn3');
            $trhPPnPn3 = $hasil->row();
            $totalPPnPn3 = $trhPPnPn3->PPnPn3_up_ini + $trhPPnPn3->PPnPn3_up_ll + $trhPPnPn3->PPnPn3_gaji_ini + 
                        $trhPPnPn3->PPnPn3_gaji_ll + $trhPPnPn3->PPnPn3_brjs_ini + $trhPPnPn3->PPnPn3_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib PPNPN 3%</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_gaji_ll + $trhPPnPn3->PPnPn3_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_brjs_ll + $trhPPnPn3->PPnPn3_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhPPnPn3->PPnPn3_up_ll + $trhPPnPn3->PPnPn3_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalPPnPn3,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

            // JKK 2111201   
            $hasil = $this->tukd_model->spj_strpajak_rek($lcskpd,'2111201',$nbulan,'jkk');
            $trhjkk = $hasil->row();
            $totaljkk = $trhjkk->jkk_up_ini + $trhjkk->jkk_up_ll + $trhjkk->jkk_gaji_ini + 
                        $trhjkk->jkk_gaji_ll + $trhjkk->jkk_brjs_ini + $trhjkk->jkk_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib JKK</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_gaji_ll + $trhjkk->jkk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_brjs_ll + $trhjkk->jkk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkk->jkk_up_ll + $trhjkk->jkk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaljkk,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

            // JKM 2111301   
            $hasil = $this->tukd_model->spj_strpajak_rek($lcskpd,'2111301',$nbulan,'jkm');
            $trhjkm = $hasil->row();
            $totaljkm = $trhjkm->jkm_up_ini + $trhjkm->jkm_up_ll + $trhjkm->jkm_gaji_ini + 
                        $trhjkm->jkm_gaji_ll + $trhjkm->jkm_brjs_ini + $trhjkm->jkm_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib JKM</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_gaji_ll + $trhjkm->jkm_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_brjs_ll + $trhjkm->jkm_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhjkm->jkm_up_ll + $trhjkm->jkm_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaljkm,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

            // Pot. BPJS 2111401   
            $hasil = $this->tukd_model->spj_strpajak_rek($lcskpd,'2111401',$nbulan,'bpjs');
            $trhbpjs = $hasil->row();
            $totalbpjs = $trhbpjs->bpjs_up_ini + $trhbpjs->bpjs_up_ll + $trhbpjs->bpjs_gaji_ini + 
                        $trhbpjs->bpjs_gaji_ll + $trhbpjs->bpjs_brjs_ini + $trhbpjs->bpjs_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. BPJS</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_gaji_ll + $trhbpjs->bpjs_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_brjs_ll + $trhbpjs->bpjs_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhbpjs->bpjs_up_ll + $trhbpjs->bpjs_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalbpjs,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
			// HKPG
            $csql = "SELECT 
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<'$nbulan' then a.rupiah else 0 end),0)) AS up_hkpg_lalu,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)='$nbulan' then a.rupiah else 0 end),0)) AS up_hkpg_ini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<='$nbulan' then a.rupiah else 0 end),0)) AS up_hkpg_sdini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<'$nbulan' then a.rupiah else 0 end),0)) AS ls_hkpg_lalu,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)='$nbulan' then a.rupiah else 0 end),0)) AS ls_hkpg_ini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<='$nbulan' then a.rupiah else 0 end),0)) AS ls_hkpg_sdini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<'$nbulan' then a.rupiah else 0 end),0)) AS gj_hkpg_lalu,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)='$nbulan' then a.rupiah else 0 end),0)) AS gj_hkpg_ini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<='$nbulan' then a.rupiah else 0 end),0)) AS gj_hkpg_sdini
				FROM trdkasin_pkd a 
				INNER JOIN trhkasin_pkd b on a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd
				WHERE a.kd_skpd ='$lcskpd' AND jns_trans='5' AND LEFT(kd_rek5,1)<>4";
							
            $hasil = $this->db->query($csql);
            $trhxx = $hasil->row();
            $totalhkpg = $trhxx->up_hkpg_sdini + $trhxx->gj_hkpg_sdini + $trhxx->ls_hkpg_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- HKPG</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->gj_hkpg_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->gj_hkpg_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->gj_hkpg_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->ls_hkpg_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->ls_hkpg_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->ls_hkpg_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->up_hkpg_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->up_hkpg_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->up_hkpg_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalhkpg,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			// Potongan Penghasilan Lainnya
            $csql = "SELECT 
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<'$nbulan'  then a.rupiah else 0 end),0)) AS up_lain_lalu,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)='$nbulan'  then a.rupiah else 0 end),0)) AS up_lain_ini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<='$nbulan'  then a.rupiah else 0 end),0)) AS up_lain_sdini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<'$nbulan'  then a.rupiah else 0 end),0)) AS ls_lain_lalu,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)='$nbulan'  then a.rupiah else 0 end),0)) AS ls_lain_ini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<='$nbulan'  then a.rupiah else 0 end),0)) AS ls_lain_sdini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<'$nbulan'  then a.rupiah else 0 end),0)) AS gj_lain_lalu,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)='$nbulan'  then a.rupiah else 0 end),0)) AS gj_lain_ini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<='$nbulan'  then a.rupiah else 0 end),0)) AS gj_lain_sdini
				FROM trdkasin_pkd a 
				INNER JOIN trhkasin_pkd b on a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd
				WHERE a.kd_skpd ='$lcskpd' AND jns_trans IN ('5','1') AND LEFT(kd_rek5,1)<>4";
							
            $hasil = $this->db->query($csql);
            $trhxy = $hasil->row();
            $totallain = $trhxy->up_lain_sdini + $trhxy->gj_lain_sdini + $trhxy->ls_lain_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Penghasilan Lainnya</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->gj_lain_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->gj_lain_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->gj_lain_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->ls_lain_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->ls_lain_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->ls_lain_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->up_lain_lalu,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->up_lain_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->up_lain_sdini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totallain,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
            // CONTRA POS
            $csql = "select 
			SUM(isnull((case when rtrim(jns_cp)= '3' and MONTH(tgl_sts)='$nbulan' then z.nilai else 0 end),0)) AS cp_spj_up_ini,
			SUM(isnull((case when rtrim(jns_cp)= '3' and MONTH(tgl_sts)<'$nbulan' then z.nilai else 0 end),0)) AS cp_spj_up_ll,
			SUM(isnull((case when rtrim(jns_cp) IN ('1'$jns_tambah) and MONTH(tgl_sts)='$nbulan' then z.nilai else 0 end),0)) AS cp_spj_gaji_ini,
			SUM(isnull((case when rtrim(jns_cp) IN ('1'$jns_tambah) and MONTH(tgl_sts)<'$nbulan' then z.nilai else 0 end),0)) AS cp_spj_gaji_ll,
			SUM(isnull((case when rtrim(jns_cp)= '2' and MONTH(tgl_sts)='$nbulan' then z.nilai else 0 end),0)) AS cp_spj_brjs_ini,
			SUM(isnull((case when rtrim(jns_cp)= '2' and MONTH(tgl_sts)<'$nbulan' then z.nilai else 0 end),0)) AS cp_spj_brjs_ll
			from (select rupiah as nilai,jns_trans,pot_khusus,jns_cp,d.tgl_sts ,d.kd_skpd from 
			trdkasin_pkd c INNER JOIN trhkasin_pkd d ON c.no_sts = d.no_sts AND c.kd_skpd = d.kd_skpd where d.kd_skpd ='$lcskpd' AND 
			pot_khusus='0' AND LEFT(kd_rek5,1)<>4) z";
            
            $hasil = $this->db->query($csql);
            $trh_x = $hasil->row();
            $total_cp = $trh_x->cp_spj_up_ini + $trh_x->cp_spj_up_ll + $trh_x->cp_spj_gaji_ini + 
                        $trh_x->cp_spj_gaji_ll + $trh_x->cp_spj_brjs_ini + $trh_x->cp_spj_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Contra Pos</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_gaji_ll + $trh_x->cp_spj_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_brjs_ll + $trh_x->cp_spj_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_up_ll + $trh_x->cp_spj_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($total_cp,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            // Denda Keterlambatan 4140611   
            $hasil = $this->tukd_model->spj_strpajak_rek($lcskpd,'4140611',$nbulan,'dk');
            $trhdk = $hasil->row();
            $totaldk = $trhdk->dk_up_ini + $trhdk->dk_up_ll + $trhdk->dk_gaji_ini + 
                        $trhdk->dk_gaji_ll + $trhdk->dk_brjs_ini + $trhdk->dk_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Denda Keterlambatan</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_gaji_ll + $trhdk->dk_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_brjs_ll + $trhdk->dk_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_up_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhdk->dk_up_ll + $trhdk->dk_up_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaldk,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            
            // lain lain setoran
            $notlain2 = "('2130101','2130201','2130401','2130301','2110701','2110702','2110703','2110702','2110703','2110501','2130501','2111001','2111101','2111201','2111301','2111401','4140611')";
          $csql = "SELECT 
					SUM(ISNULL(jlain_up_ll,0)) jlain_up_ll, SUM(ISNULL(jlain_up_ini,0)) jlain_up_ini, 
					SUM(ISNULL(jlain_gaji_ll,0)) jlain_gaji_ll, SUM(ISNULL(jlain_gaji_ini,0)) jlain_gaji_ini, 
					SUM(ISNULL(jlain_brjs_ll,0)) jlain_brjs_ll, SUM(ISNULL(jlain_brjs_ini,0)) jlain_brjs_ini
					 FROM(
					SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN $notlain2 THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN $notlain2 THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN $notlain2 THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN $notlain2 THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN $notlain2 THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN $notlain2 THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd='$lcskpd'
					UNION ALL
					SELECT 
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ini
					FROM TRHOUTLAIN a 
					WHERE a.kd_skpd='$lcskpd' and thnlalu=0
					) a ";
            $hasil = $this->db->query($csql);
            $trh12 = $hasil->row();
            $totallain = $trh12->jlain_up_ini + $trh12->jlain_up_ll + $trh12->jlain_gaji_ini + 
                         $trh12->jlain_gaji_ll + $trh12->jlain_brjs_ini + $trh12->jlain_brjs_ll;
            
            /*$tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd' and '1'=$nbulan";
            $hasil = $this->db->query($tox_awal);
			$tox_ini = $hasil->row('jumlah');
			*/
            $tox_ini = 0;
//			echo  $tox_ini;			   
            $tox_ini=(empty($tox_ini)?0:$tox_ini);
			/*
            $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd' and '1'<$nbulan";
            $hasil = $this->db->query($tox_awal);
            $tox_ll = $hasil->row('jumlah');
			*/
			$tox_ll = 0;
            $tox_ll=(empty($tox_ll)?0:$tox_ll);

//			echo  '-'.$tox_ini;
//			echo  '-'.$tox_ll;
			
            $jmsetgaji_ll =  $trh7->spj_gaji_ll+ $trh8->jppn_gaji_ll + $trh9->jpph21_gaji_ll + $trh16->ppnpn_gaji_ll +
                             $trhPPnPn3->PPnPn3_gaji_ll +$trhjkk->jkk_gaji_ll +$trhjkm->jkm_gaji_ll +   $trhbpjs->bpjs_gaji_ll +
                             $trhdk->dk_gaji_ll +$trh10->jpph22_gaji_ll + $trh11->jpph23_gaji_ll + $trh12->jlain_gaji_ll+
                             $trh_x->cp_spj_gaji_ll+
							 $trh73->gj_iwp_lalu + $trh74->gj_tap_lalu+$trh75->gj_pph4_lalu+$trhxx->gj_hkpg_lalu+$trhxy->gj_lain_lalu;
            
            $jmsetgaji_ini = $trh7->spj_gaji_ini + $trh8->jppn_gaji_ini + $trh9->jpph21_gaji_ini + $trh16->ppnpn_gaji_ini +
                             $trhPPnPn3->PPnPn3_gaji_ini +$trhjkk->jkk_gaji_ini +$trhjkm->jkm_gaji_ini +$trhbpjs->bpjs_gaji_ini +
                             $trhdk->dk_gaji_ini +$trh10->jpph22_gaji_ini + $trh11->jpph23_gaji_ini + $trh12->jlain_gaji_ini+
                             $trh_x->cp_spj_gaji_ini+
							 $trh73->gj_iwp_ini + $trh74->gj_tap_ini+$trh75->gj_pph4_ini+$trhxx->gj_hkpg_ini+$trhxy->gj_lain_ini;
                             
            $jmsetgaji_sd = $jmsetgaji_ll + $jmsetgaji_ini;
            
            
            $jmsetbrjs_ll =  $trh7->spj_brjs_ll + $trh8->jppn_brjs_ll + $trh9->jpph21_brjs_ll + $trh16->ppnpn_brjs_ll +
                             $trhPPnPn3->PPnPn3_brjs_ll +  $trhjkk->jkk_brjs_ll + $trhjkm->jkm_brjs_ll + $trhbpjs->bpjs_brjs_ll +
                             $trhdk->dk_brjs_ll +$trh10->jpph22_brjs_ll + $trh11->jpph23_brjs_ll + $trh12->jlain_brjs_ll+$trh_x->cp_spj_brjs_ll+
							 $trh73->ls_iwp_lalu + $trh74->ls_tap_lalu+$trh75->ls_pph4_lalu+$trhxx->ls_hkpg_lalu+$trhxy->ls_lain_lalu;
                                                                                                 
            $jmsetbrjs_ini =  $trh7->spj_brjs_ini + $trh8->jppn_brjs_ini + $trh9->jpph21_brjs_ini + $trh16->ppnpn_brjs_ini +
                             $trhPPnPn3->PPnPn3_brjs_ini +$trhjkk->jkk_brjs_ini +$trhjkm->jkm_brjs_ini +$trhbpjs->bpjs_brjs_ini +
                             $trhdk->dk_brjs_ini +$trh10->jpph22_brjs_ini + $trh11->jpph23_brjs_ini + $trh12->jlain_brjs_ini+
                             $trh_x->cp_spj_brjs_ini+
							 $trh73->ls_iwp_ini + $trh74->ls_tap_ini+$trh75->ls_pph4_ini+$trhxx->ls_hkpg_ini+$trhxy->ls_lain_ini;
                             
            $jmsetbrjs_sd = $jmsetbrjs_ll + $jmsetbrjs_ini;
            /* 
            $jmsetup_ll =  $trh7->spj_up_ll + $trh8->jppn_up_ll + $trh9->jpph21_up_ll +
                             $trh10->jpph22_up_ll + $trh11->jpph23_up_ll + $trh12->jlain_up_ll; */
            
            $jmsetup_ll =  $trh7->spj_up_ll + $trh8->jppn_up_ll + $trh9->jpph21_up_ll + $trh16->ppnpn_up_ll +
                            $trhPPnPn3->PPnPn3_up_ll +$trhjkk->jkk_up_ll +$trhjkm->jkm_up_ll +$trhbpjs->bpjs_up_ll +
                             $trhdk->dk_up_ll +$trh10->jpph22_up_ll + $trh11->jpph23_up_ll + $trh12->jlain_up_ll +$trh_x->cp_spj_up_ll+
							 $trh73->up_iwp_lalu + $trh74->up_tap_lalu+$trh75->up_pph4_lalu+$trhxx->up_hkpg_lalu+$trhxy->up_lain_lalu;                             
            
            $jmsetup_ini =  $trh7->spj_up_ini + $trh8->jppn_up_ini + $trh9->jpph21_up_ini + $trh16->ppnpn_up_ini +
                            $trhPPnPn3->PPnPn3_up_ini +$trhjkk->jkk_up_ini +$trhjkm->jkm_up_ini +$trhbpjs->bpjs_up_ini +
                             $trhdk->dk_up_ini +$trh10->jpph22_up_ini + $trh11->jpph23_up_ini + $trh12->jlain_up_ini+$tox_ini+$trh_x->cp_spj_up_ini+
							 $trh73->up_iwp_ini + $trh74->up_tap_ini+$trh75->up_pph4_ini+$trhxx->up_hkpg_ini+$trhxy->up_lain_ini;
            
            $jmsetup_sd = $jmsetup_ll + $jmsetup_ini;
            
            
            $cRet .="
                       
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Lain-lain</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_gaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_gaji_ll + $trh12->jlain_gaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_brjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_brjs_ll + $trh12->jlain_brjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_up_ll+$tox_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_up_ini+$tox_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_up_ll + $trh12->jlain_up_ini+$tox_ll+$tox_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totallain,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

            $cRet .="
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Jumlah Pengeluaran :</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetbrjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetbrjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetbrjs_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetup_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetup_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetup_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_sd + $jmsetbrjs_sd + $jmsetup_sd,"2",",",".")."</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>"; 

            $tox_awal="SELECT isnull(sld_awal,0) AS jumlah,sld_awalpajak FROM ms_skpd where kd_skpd='$lcskpd'";
            $hasil = $this->db->query($tox_awal);
            $tox = $hasil->row('jumlah');
            $sld_apjk = $hasil->row('sld_awalpajak');
			$t_sldawal = $tox + $sld_apjk;
			
            $hasil = $this->tukd_model->spj_tahunlalu($lcskpd,$nbulan);
            $trhspjthnll = $hasil->row();
            $uyhdthnlalu_ll = $trhspjthnll->jlain_up_ll;
            $uyhdthnlalu_ini = $trhspjthnll->jlain_up_ini;
            $pjkthnlalu_ll = $trhspjthnll->jlain_up_pjkll;
            $pjkthnlalu_ini = $trhspjthnll->jlain_up_pjkini;
            $uyhdthnlalu = $uyhdthnlalu_ll+$uyhdthnlalu_ini;
            $pjkthnlalu = $pjkthnlalu_ll+$pjkthnlalu_ini;
            $t_uyhdthnll = $t_sldawal - ($uyhdthnlalu_ll+$pjkthnlalu_ll);
            $t_uyhdthnini = 0 - ($uyhdthnlalu_ini+$pjkthnlalu_ini);
            $t_uyhdthn = $t_uyhdthnll + $t_uyhdthnini;
            $cRet.="
            <tr>
                <td>&ensp;&ensp;</td>
                <td colspan=\"2\">&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
				<td>&ensp;&ensp;</td>
            </tr>

            <tr>
			<td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\" $fontc \" colspan=\"2\">UYHD Tahun Lalu</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">".number_format($tox,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">".number_format($tox,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($tox,"2",",",".")."</td>
				<td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            <tr>
                <td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\" $fontc \" colspan=\"2\">Pajak Tahun Lalu</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">".number_format($sld_apjk,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">".number_format($sld_apjk,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($sld_apjk,"2",",",".")."</td>
				<td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
            </tr>

            <tr>
			<td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\" $fontc \" colspan=\"2\">Penyetoran UYHD Tahun Lalu</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">".number_format($uyhdthnlalu_ll,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($uyhdthnlalu_ini,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($uyhdthnlalu,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($uyhdthnlalu,"2",",",".")."</td>
				<td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            <tr>
                <td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\" $fontc \" colspan=\"2\">Penyetoran Pajak Tahun Lalu</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">0,00</td>
                <td align=\"right\" style=\" $fontc \">".number_format($pjkthnlalu_ll,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($pjkthnlalu_ini,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($pjkthnlalu,"2",",",".")."</td>
                <td align=\"right\" style=\" $fontc \">".number_format($pjkthnlalu,"2",",",".")."</td>
				<td align=\"left\" style=\" $fontc border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            
            ";
            
            
                        
            $cRet.="<tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Saldo Kas</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ll - $jmsetgaji_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ini - $jmsetgaji_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd - $jmsetgaji_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ll - $jmsetbrjs_ll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ini - $jmsetbrjs_ini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_sd - $jmsetbrjs_sd,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ll - $jmsetup_ll + $t_uyhdthnll,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ini - $jmsetup_ini + $t_uyhdthnini,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_sd - $jmsetup_sd + $t_uyhdthn,"2",",",".")."</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd + $jmtrmbrjs_sd + $jmtrmup_sd - $jmsetgaji_sd - $jmsetbrjs_sd - $jmsetup_sd + $t_uyhdthn,"2",",",".")."</td>
           <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
		   </tr>
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            </table>";
       if($jenis=='1'){
		    $cRet .='<TABLE width="100%" style="font-size:12px">
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" >Mengetahui,</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" >'.$jabatan.'</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" ><b><u>'.$nama2.'</u></b> <br> '.$pangkat.' </TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama1.'</u></b><br> '.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" >NIP. '.$nip.'</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';
	   } else if ($jenis=='2'){
		    $cRet .='<TABLE width="100%" style="font-size:12px">
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" > </TD>
						<TD width="50%" align="center" ><b><u>'.$nama1.'</u></b><br> '.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';
	   } else {
		    $cRet .='<TABLE width="100%" style="font-size:12px">
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" > </TD>
						<TD width="50%" align="center" ><b><u>'.$nama2.'</u></b><br> '.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >NIP. '.$nip.'</TD>
					</TR>
					</TABLE><br/>';
	   }
        
	$data['prev']= $cRet;
	if($ctk==0){
		echo "<title>  SPJ $bulan</title>" ; 
		echo $cRet; 
	}else if($ctk==2){
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=BKU-$lcskpd.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
	}else{
	    $this->_mpdf_margin('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);
	}	
    }

	
    function bku()
    {
        $data['page_title']= 'BKU';
        $this->template->set('title', 'BKU');   
        $this->template->load('template','tukd/transaksi/bku',$data) ; 
    }
    
function cetak_bku(){
        $thn_ang = $this->session->userdata('pcThang');
        $lcskpd = $_REQUEST['kd_skpd'];
        $pilih = $_REQUEST['cpilih'];
        $spasi = $_REQUEST['spasi'];
 		$this->db->query("exec recall '$lcskpd'");
		//$daerah=$this->tukd_model->get_nama($lcskpd,'daerah','sclient','kd_skpd');
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);			
			
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         

         if ($pilih==1){
             $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
             '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
             UNION ALL
             SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             z.tgl_kas < '$lctgl1' and year(z.tgl_kas) = $thn_ang AND z.kd_skpd = '$lcskpd'";
         }else{
             $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
             '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
             UNION ALL
             SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             month(z.tgl_kas) < '$bulan' and year(z.tgl_kas) = $thn_ang AND z.kd_skpd = '$lcskpd'";
             }

             $tox_awal="SELECT isnull(sld_awal,0)+sld_awalpajak AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
             $hasil = $this->db->query($tox_awal);
             $tox = $hasil->row('jumlah');
             
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         
         $saldoawal = $trh4->sel;
         $saldoawal=$saldoawal+$tox;
         
			$prv = $this->db->query("SELECT * from sclient WHERE kd_skpd='$lcskpd'");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;
			
			if ($pilih==1){
			$asql="select
			SUM(case when jns=1 then jumlah else 0 end) AS terima,
			SUM(case when jns=2 then jumlah else 0 end) AS keluar
			from (
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_setorsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='BANK' union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay='BANK' UNION ALL
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain where pay='BANK' ) a
			where tgl<='$lctgl2' and kode='$lcskpd'";		
			}else{
			$asql="select
			SUM(case when jns=1 then jumlah else 0 end) AS terima,
			SUM(case when jns=2 then jumlah else 0 end) AS keluar
			from (
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_setorsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='BANK' union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay='BANK' UNION ALL
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain where pay='BANK' ) a
			where month(tgl)<='$bulan' and kode='$lcskpd'";	
			}

						
		$hasil=$this->db->query($asql);
		$bank=$hasil->row();
		$keluarbank=$bank->keluar;
		$terimabank=$bank->terima;
		$saldobank=$terimabank-$keluarbank;
		/*
		$esteh="SELECT 
				SUM(case when jns=1 then jumlah else 0 end ) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				FROM (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan UNION ALL
				select tgl_kas as tgl,no_kas as bku,keterangan as ket, nilai as jumlah, '1' as jns,kd_skpd as kode from tr_jpanjar where jns=2 UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='TUNAI' UNION ALL
				select tgl_panjar as tgl,no_panjar as bku,keterangan as ket, nilai as jumlah, '2' as jns,kd_skpd as kode from tr_panjar UNION ALL
				select tgl_sts as tgl,no_sts as bku, keterangan as ket, total as jumlah, '2' as jns, kd_skpd as kode from trhkasin_pkd where jns_trans<>4 and pot_khusus =0 union
                SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a left join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay = 'TUNAI' and panjar<>1 UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain WHERE pay='TUNAI') a 
				where month(a.tgl)<='$bulan' and kode='$lcskpd'";
		
					 $hasil = $this->db->query($esteh);
					 $okok = $hasil->row();
		$tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";

		             $hasil = $this->db->query($tox_awal);
					 $tox = $hasil->row('jumlah');
					 $terima = $okok->terima;
					 $keluar = $okok->keluar;

			$querypaj="SELECT
					 sum(case when jns=1 then terima else 0 end) as debet,
					 sum(case when jns=2 then keluar else 0 end ) as kredit
					 FROM(
					 SELECT no_bukti AS bku,tgl_bukti AS tgl,(ket+'  no sp2d:'+no_sp2d) AS ket,nilai AS terima,'0' AS keluar,'1' as jns,kd_skpd FROM trhtrmpot UNION ALL
					 SELECT no_bukti AS bku,tgl_bukti AS tgl,(ket+'  terima:'+no_terima) AS ket,'0' AS terima,nilai AS keluar,'2' as jns,kd_skpd FROM trhstrpot ) a WHERE MONTH(tgl)<='$bulan' AND kd_skpd='$lcskpd'";
					 $querypjk=$this->db->query($querypaj);

					 $debet=$querypjk->row('debet');
					 $kredit=$querypjk->row('kredit');
					 $saldopjk=$debet-$kredit;
					 
					 $saldotunai=($terima+$tox+$saldopjk)-$keluar;
			*/		 		 
		 // SALDO SURAT BERHARGA (SP2D yang tanggal pencairannya beda dengan tanggal sp2dnya) 
		if ($pilih==1){
		$csql="select sum(nilai) as total from trhsp2d where (tgl_terima BETWEEN '$lctgl1' and '$lctgl2')  and kd_skpd = '$lcskpd' and status_terima = '1' and (tgl_kas > '$lctgl2' or no_kas is null or no_kas='')";
		}else{
		$csql="select sum(nilai) as total from trhsp2d where month(tgl_terima)='$bulan' and kd_skpd = '$lcskpd' and status_terima = '1' and (month(tgl_kas) > '$bulan' or no_kas is null or no_kas='')";
		}			 
					 $hasil_srt = $this->db->query($csql);
					 $saldoberharga = $hasil_srt->row('total');
		
		
 $nippa = str_replace('123456789',' ',$_REQUEST['ttd']);		     
 $csql="SELECT nip as nip_pa,nama as nm_pa,jabatan,pangkat FROM ms_ttd WHERE nip = '$nippa' AND kd_skpd = '$lcskpd' AND kode in ('PA','KPA')";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row(); 
 $nipbk = str_replace('123456789',' ',$_REQUEST['ttd2']);		     
 $csql="SELECT nip as nip_bk,nama as nm_bk,jabatan,pangkat FROM ms_ttd WHERE nip = '$nipbk' AND kd_skpd = '$lcskpd' AND kode='BK'";
                
         $hasil3 = $this->db->query($csql);
         $trh3 = $hasil3->row(); 
 $csql="SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = '$lcskpd' ";
                
         $hasil4 = $this->db->query($csql);
         $trh4 = $hasil4->row();
		 
		$cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS UMUM PENGELUARAN</b></td>
            </tr>
            <tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">OPD</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$trh4->nm_skpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$trh2->nm_pa</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Pengeluaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$trh3->nm_bk</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-size:12px;font-weight:bold;\">No.</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-size:12px;font-weight:bold\">Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" colspan=\"10\" width=\"19%\" style=\"font-size:12px;font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"36%\" style=\"font-size:12px;font-weight:bold\">Uraian</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"12%\" style=\"font-size:12px;font-weight:bold\">Penerimaan</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"12%\" style=\"font-size:12px;font-weight:bold\">Pengeluaran</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-size:12px;font-weight:bold\">Saldo</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">2</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" colspan=\"10\" style=\"font-size:12px;border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">4</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">5</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">6</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">7</td>
            </tr>
			</thead>";
           
           if ($pilih==1){
           $sql = "SELECT z.* FROM ((SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
           '' AS rekening,uraian,0 AS terima,0 AS keluar , '' AS st,jns_trans FROM trhrekal a
           where (a.tgl_kas BETWEEN '$lctgl1' AND '$lctgl2') AND
           year(a.tgl_kas) = '$thn_ang'and kd_skpd='$lcskpd')
               UNION ALL
              ( SELECT a.kd_skpd,a.tgl_kas,NULL AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
               b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then '1' else '2' end AS st, b.jns_trans FROM
               trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd where (a.tgl_kas BETWEEN '$lctgl1' AND '$lctgl2')
               AND year(a.tgl_kas) = '$thn_ang' and b.kd_skpd='$lcskpd'))z
               ORDER BY tgl_kas,Cast(REPLACE(no_kas, 'A', '')  as int),jns_trans,st,rekening";
           }else{
       
           $sql = " SELECT z.* FROM ((SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
           '' AS rekening,uraian,0 AS terima,0 AS keluar , '' AS st,jns_trans FROM trhrekal a
           where month(a.tgl_kas) = '$bulan' AND
           year(a.tgl_kas) = '$thn_ang'and kd_skpd='$lcskpd')
               UNION ALL
              ( SELECT a.kd_skpd,a.tgl_kas,NULL AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
               b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then '1' else '2' end AS st, b.jns_trans FROM
               trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd where month(a.tgl_kas) ='$bulan' AND
               year(a.tgl_kas) = '$thn_ang' and b.kd_skpd='$lcskpd'))z
               ORDER BY tgl_kas,Cast(REPLACE(no_kas, 'A', '')  as int),jns_trans,st,rekening";
           
           }
           
                            
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lcterima = 0;
                    $lckeluar = 0;
                    $lhasil = $saldoawal;
                    $saldolalu=number_format($lhasil,"2",",",".");
                    $cRet .= "<tr><td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>";
                    $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>
                                <td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>
                                <td valign=\"top\" colspan=\"1\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\">Saldo Lalu</td>";
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\">$saldolalu</td></tr>";
                    foreach ($hasil->result() as $row)
                    {
                        $cRet .="<tr>";
                        $lhasil = $lhasil + $row->terima - $row->keluar;
                       if(!empty($row->tanggal)){
                         $a=$row->tanggal;
                         $jaka=$this->tukd_model->tanggal_ind($a);
                         $lcno = $lcno + 1;
                         $no_bku = $row->no_kas;
                         $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none 1px gray;border-top:solid 1px gray\">$no_bku</td>
                                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">$jaka</td>
									<td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".($row->kegiatan)."</td>
									<td valign=\"top\" colspan=\"1\"align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".($row->rekening)."</td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">$row->uraian</td>
								";
								 if(empty($row->terima) or ($row->terima)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\"></td>";
                                }else{
                                    $lcterima = $lcterima + $row->terima; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".number_format($row->terima,"2",",",".")."</td>";
                                }
								if(empty($row->keluar) or ($row->keluar)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\"></td>";
                                }else{
                                    $lckeluar = $lckeluar + $row->keluar; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".number_format($row->keluar,"2",",",".")."</td>";
                                }
                                if(empty($row->terima) and empty($row->keluar) or ($row->terima)==0 and ($row->keluar)==0){
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\"></td>";
                                }else{
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".number_format($lhasil,"2",",",".")."</td>";
                                }
                       }else{
                        $cRet .= " <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none 1px gray;border-top:none 1px gray\">&nbsp;</td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">&nbsp;</td>
                                <td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".($row->kegiatan)."</td>
								<td valign=\"top\" colspan=\"1\"align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".($row->rekening)."</td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">$row->uraian</td>
								";
								 if(empty($row->terima) or ($row->terima)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\"></td>";
                                }else{
                                    $lcterima = $lcterima + $row->terima; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".number_format($row->terima,"2",",",".")."</td>";
                                }
								if(empty($row->keluar) or ($row->keluar)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\"></td>";
                                }else{
                                    $lckeluar = $lckeluar + $row->keluar; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".number_format($row->keluar,"2",",",".")."</td>";
                                }
                                if(empty($row->terima) and empty($row->keluar) or ($row->terima)==0 and ($row->keluar)==0){
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\"></td>";
                                }else{
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".number_format($lhasil,"2",",",".")."</td>";
                                }
                       }
                            $cRet .="</tr>";    
                    }

        $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                 </tr>
                  <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Periode $lcperiode </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lcterima+$tox,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lckeluar,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lhasil,"2",",",".")."</td>
                 </tr> ";
                 
                 if ($pilih==1){                 
                 $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b INNER JOIN 
                        trhrekal a ON a.no_kas=b.no_kas and a.kd_skpd = b.kd_skpd WHERE a.tgl_kas < '$lctgl1'  and a.kd_skpd = '$lcskpd'";
                 }else{
                    $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b INNER JOIN 
                        trhrekal a ON a.no_kas=b.no_kas and a.kd_skpd = b.kd_skpd WHERE month(a.tgl_kas) < '$bulan' and year(a.tgl_kas) = $thn_ang and a.kd_skpd = '$lcskpd'";
                 }
                        
                 $hasil = $this->db->query($csql);
                 $trh1 = $hasil->row(); 
                
        $cRet .="<tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Sampai $lcperiode1 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmkeluar,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah s/d $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format(($trh1->jmterima+$lcterima+$tox),"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format(($trh1->jmkeluar+$lckeluar),"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Sisa Kas Pada $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format(($trh1->jmterima+$lcterima-$trh1->jmkeluar-$lckeluar+$tox),"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"2\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><u>Terdiri dari :</u></b></td>
                    <td colspan =\"14\"valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Saldo Tunai</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\"><b>Rp  ".number_format(($trh1->jmterima+$lcterima-$trh1->jmkeluar-$lckeluar+$tox-$saldobank-$saldoberharga),"2",",",".")."</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Saldo Bank</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\"><b>Rp  ".number_format(($saldobank),"2",",",".")."</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Surat Berharga</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\"><b>Rp  ".number_format(($saldoberharga),"2",",",".")."</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
				 </table>";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td valign=\"top\" align=\"center\" width=\"50%\" style=\"font-size:12px;border:\">
					Mengetahui,<br> $trh2->jabatan <br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<u><b>$trh2->nm_pa</b></u><br>$trh2->pangkat<br>NIP. $trh2->nip_pa</td>
                    <td valign=\"top\" align=\"center\" width=\"50%\" style=\"font-size:12px;\">
					".$daerah.",&nbsp;".$this->tukd_model->tanggal_format_indonesia($tgl_ttd)."<br>$trh3->jabatan <br>&nbsp;<br>&nbsp;<br>&nbsp;
					<br>&nbsp;<u><b>$trh3->nm_bk</b></u><br>$trh3->pangkat<br>NIP. $trh3->nip_bk</td>
            
        </table>";
        
        $print = $this->uri->segment(3);
		if($print==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>Buku Kas Umum</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'L',1,'');
}		
     
     }
     


	
    function lpjup()
    {
        $data['page_title']= 'PERTANGGUNG JAWABAN PERSEDIAAN';
        $this->template->set('title', 'PERTANGGUNG JAWABAN PERSEDIAAN');   
        $this->template->load('template','tukd/transaksi/spjup',$data) ; 
    }
    
     function lpjtu()
    {
        $data['page_title']= 'PERTANGGUNG JAWABAN TAMBAH UANG';
        $this->template->set('title', 'PERTANGGUNG JAWABAN TAMBAH UANG(TU)');   
        $this->template->load('template','tukd/transaksi/spjtu',$data) ; 
    }						  

    function cetaklpjup(){
		
		$cskpd =   $this->uri->segment(5);
        //$cttd  =   $this->uri->segment(4);
        $cttd=str_replace('a',' ',$this->uri->segment(4));


		$lctgl1 =   $this->uri->segment(3);
		$lctgl2 =   $this->uri->segment(6);
          $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }

		$cRet  =" <table border='0' width='100%'>
					<tr>
						<td align='center' > $kab</td>
					</tr>
					<tr>
						<td align='center'>LAPORAN PERTANGGUNG JAWABAN UANG PERSEDIAAN</td>
					</tr>
					<tr>
						<td align='center'>BENDAHARA PENGELUARAN</td>
					</tr>
					</table>				
				";

		$cRet .=" <table border='0' width='100%'>
					<tr>
						<td align='left' width='10%'>OPD&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
					</tr>
					<tr>
						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
					</tr>
					</table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>KODE REKENING</td>
						<td align='center' width='50%'>URAIAN</td>
						<td align='center' width='20%'>JUMLAH</td>
					</tr>
				";		


				$sql = "SELECT DISTINCT kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5 FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
                        WHERE b.kd_skpd='$cskpd' AND b.jns_spp=1 ORDER BY kd_kegiatan,kd_rek5";
				$query1 = $this->db->query($sql);  	
				$tkeg="";
				$total=0;
				foreach($query1->result_array() as $resulte){ 
					//	$kd_skpd=$resulte["kd_skpd"];
						$kd_kegiatan=$resulte["kd_kegiatan"];
						$kd_rek5=$resulte["kd_rek5"];
						$nm_kegiatan=$resulte["nm_kegiatan"];
						$nm_rek5=$resulte["nm_rek5"];
						
						if ($tkeg!=$kd_kegiatan){

							$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
									WHERE b.`jns_spp`=1 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' ";
							$queryr = $this->db->query($sqlr);  	
							foreach($queryr->result_array() as $nl){ 
									$nilaik=number_format($nl["nilai"]);
							}
							if($nilaik==0) $nilaik="";

							$cRet .="
									<tr>
										<td align='left' >$kd_kegiatan</td>
										<td align='left' ><b>$nm_kegiatan</b></td>
										<td align='right' ><b>$nilaik</b></td>
									</tr>					
							";
												
						}
						
						$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
								WHERE b.jns_spp=1 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' and a.kd_rek5='$kd_rek5' ";
						$queryr = $this->db->query($sqlr);  	
						foreach($queryr->result_array() as $nl){ 
	  						    $total=$total+$nl["nilai"];
								$nilai=number_format($nl["nilai"]);
						}
						if($nilai==0) $nilai="";
						
						$cRet .="
								<tr>
									<td align='left' >$kd_kegiatan.".$this->tukd_model->dotrek($kd_rek5)."</td>
									<td align='left' >$nm_rek5</td>
									<td align='right' >$nilai</td>
								</tr>					
						";

						$tkeg=$kd_kegiatan;
				}


				$sqlp = "SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						 WHERE b.kd_skpd='$cskpd' AND (b.jns_spp=1 or b.jns_spp=2) AND b.tgl_sp2d<'$lctgl1' ";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total)."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan)."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total)."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				

 		$cRet .=" <table width='100%' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>Jakarta, ".$this->tukd_model->tanggal_format_indonesia(date("Y-m-d"))."</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'><u>".$this->tukd_model->get_nama($cttd,'nama','ms_ttd','nip')."</u></td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>$cttd</td>
					</tr>
				  </table>
				";		



        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'5','5','5','0');		
	} 
    
     function cetaklpjtu(){
		
		$cskpd =   $this->uri->segment(5);
		//$cttd  =   $this->uri->segment(4);
        $cttd=str_replace('a',' ',$this->uri->segment(4));
       

		$lctgl1 =   $this->uri->segment(3);
		$lctgl2 =   $this->uri->segment(6);
          $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }

		$cRet  =" <table border='0' width='100%'>
					<tr>
						<td align='center' >PEMERINTAH $kab</td>
					</tr>
					<tr>
						<td align='center'>LAPORAN PERTANGGUNG JAWABAN TAMBAHAN UANG(TU)</td>
					</tr>
					<tr>
						<td align='center'>BENDAHARA PENGELUARAN</td>
					</tr>
					</table>				
				";

		$cRet .=" <table border='0' width='100%'>
					<tr>
						<td align='left' width='10%'>OPD&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
					</tr>
					<tr>
						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
					</tr>
					</table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>KODE REKENING</td>
						<td align='center' width='50%'>URAIAN</td>
						<td align='center' width='20%'>JUMLAH</td>
					</tr>
				";		


				$sql = "SELECT DISTINCT kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5 FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
                        WHERE b.kd_skpd='$cskpd' AND b.jns_spp=3 ORDER BY kd_kegiatan,kd_rek5";
				$query1 = $this->db->query($sql);  	
				$tkeg="";
				$total=0;
				foreach($query1->result_array() as $resulte){ 
						$kd_skpd=$resulte["kd_skpd"];
						$kd_kegiatan=$resulte["kd_kegiatan"];
						$kd_rek5=$resulte["kd_rek5"];
						$nm_kegiatan=$resulte["nm_kegiatan"];
						$nm_rek5=$resulte["nm_rek5"];
						
						if ($tkeg!=$kd_kegiatan){

							$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
									WHERE b.jns_spp=3 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' ";
							$queryr = $this->db->query($sqlr);  	
							foreach($queryr->result_array() as $nl){ 
									$nilaik=number_format($nl["nilai"]);
							}
							if($nilaik==0) $nilaik="";

							$cRet .="
									<tr>
										<td align='left' >$kd_kegiatan</td>
										<td align='left' ><b>$nm_kegiatan</b></td>
										<td align='right' ><b>$nilaik</b></td>
									</tr>					
							";
												
						}
						
						$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
								WHERE b.jns_spp=3 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' and a.kd_rek5='$kd_rek5' ";
						$queryr = $this->db->query($sqlr);  	
						foreach($queryr->result_array() as $nl){ 
	  						    $total=$total+$nl["nilai"];
								$nilai=number_format($nl["nilai"]);
						}
						if($nilai==0) $nilai="";
						
						$cRet .="
								<tr>
									<td align='left' >$kd_kegiatan.$kd_rek5</td>
									<td align='left' >$nm_rek5</td>
									<td align='right' >$nilai</td>
								</tr>					
						";

						$tkeg=$kd_kegiatan;
				}


				$sqlp = "SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						 WHERE b.kd_skpd='$cskpd' AND b.jns_spp=3 AND b.tgl_sp2d<'$lctgl1' ";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total)."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan)."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total)."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				

 		$cRet .=" <table width='100%' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>Jakarta, ".$this->tukd_model->tanggal_format_indonesia(date("Y-m-d"))."</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'><u>".$this->tukd_model->get_nama($cttd,'nama','ms_ttd','nip')."</u></td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>$cttd</td>
					</tr>
				  </table>
				";		



        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'5','5','5','0');		
	}
    
 // joice ==================================================================================================== 
    function terima_objek()
    {
        $data['page_title']= 'RincianObjek';
        $this->template->set('title', 'Rincian Objek');   
        $this->template->load('template','tukd/pendapatan/terima_objek',$data) ; 
    }
    
    

    function rek5_skpd($lcskpd='') {
        $sql = " SELECT a.kd_rek5 as kd_rek5,b.nm_rek5 as nm_rek5 FROM trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where (left(a.kd_rek5,1)='4' or left(a.kd_rek5,2)='61') and rtrim(a.kd_skpd)='$lcskpd' order by a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	   
	}
    
    
    function cetak_tobjek($lcskpd='',$nbulan='',$crek5=''){
        //$nbulan = 12;
        $thn_ang	   = $this->session->userdata('pcThang');
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode in ('PA','KPA')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
                
        $sqlBP="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='BP'";
                 $sqlttdbp=$this->db->query($sqlBP);
                 foreach ($sqlttdbp->result() as $rowttdbp)
                {
                    $nip2=$rowttdbp->nip;                    
                    $nama2= $rowttdbp->nm;
                    $jabatan2  = $rowttdbp->jab;
                }
                
        $abc="select nm_rek5 from ms_rek5 where kd_rek5='$crek5'";
                $sqlrek=$this->db->query($abc);
                foreach ($sqlrek->result() as $rowrek)
                {
                    $nmrek5=$rowrek->nm_rek5;
                }
        
        $abc2="SELECT SUM(nilai_ubah) as rupiah FROM trdrka  where kd_rek5='$crek5' and kd_skpd='$lcskpd'";
                $sqlang=$this->db->query($abc2);
                foreach ($sqlang->result() as $rowang)
                {
                    $nang=$rowang->rupiah;
                }
                
        //$this->template->set('title', 'CETAK RINCIAN OBYEK');
        $skpd = $lcskpd;
        $nama=  $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $bulan= $this->tukd_model->getBulan($nbulan); 
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"0\">";                 
        $cRet .="
            
            <tr>
                <td align=\"center\" style=\"font-size:16px;\" colspan=\"5\">
                  PROVINSI/KABUPATEN/KOTA<BR>
                  BUKU PEMBANTU<BR>
                  PER RINCIAN OBYEK PENERIMAAN<BR>&nbsp;
                </td>
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" width=\"25%\">
                  OPD
                </td> 
                <td width=\"75%\">: $skpd - $nama
                </td>         
            </tr>
            
            

            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Kode Rekening
                </td> 
                <td>: $crek5
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Nama Rekening
                </td> 
                <td>: $nmrek5
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Jumlah Anggaran
                </td> 
                <td>: $nang
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Tahun Anggaran
                </td> 
                <td>: $thn_ang
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" colspan=\"5\">
                 &nbsp;
                </td> 
            </tr>
            
            </table>
                
    <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"2\">
            <thead> 
            <tr>                        
                <td align=\"center\" style=\"font-size:12px\"><b>No<br>Urut</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>No BKU<br>Penerimaan</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>Tanggal Sektor</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>Nomor STS & Bukti<br>Penerimaan Lainnya</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>Jumlah<br>(Rp)</b></td>                
            </tr>                                                                    
            
            <tr>                          
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">1</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">2</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">3</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">4</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">5 &nbsp;</td>                
            </tr>
            </thead>";                          
       

            $lcjumlah=0;
             $csql="SELECT a.no_sts, a.kd_skpd, a.tgl_sts, a.no_kas, b.kd_rek5, b.rupiah FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) where a.kd_skpd= '$lcskpd' and b.kd_rek5='$crek5' and month(a.tgl_sts)='$nbulan' and year(a.tgl_sts)='$thn_ang' ";
                    $i_urut=1;
                    $hasil = $this->db->query($csql);
                                        
                    foreach ($hasil->result() as $row)
                    {                                                                                                           
                       $cRet .="<tr>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">$i_urut</td>
                                <td valign=\"top\" align=\"left\" width=\"35%\" style=\"font-size:12px\">$row->no_kas</td>
                                <td valign=\"top\" align=\"center\" width=\"10%\" style=\"font-size:12px\">$row->tgl_sts</td>
                                <td valign=\"top\" align=\"left\" width=\"35%\" style=\"font-size:12px\">$row->no_sts</td>
                                <td align=\"right\" width=\"15%\" style=\"font-size:12px\">".number_format($row->rupiah)."&nbsp;</td>";                                
                                $cRet .="</tr> "; 
                       $lcjumlah = $lcjumlah + $row->rupiah;                                                                                                                           
                       $i_urut++;
                        
                    };
             $nlalu=0;
            $csql="SELECT sum(b.rupiah) as xlalu FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) where a.kd_skpd= '$lcskpd' and b.kd_rek5='$crek5' and month(a.tgl_sts)<'$nbulan' and year(a.tgl_sts)='$thn_ang' ";
                    $i_urut=1;
                    $hasil2 = $this->db->query($csql);
                    
                    foreach ($hasil2->result() as $row2)
                    {            
                        $nlalu = $row2->xlalu;
                    };
                    
                    $nsdini=$nlalu+$lcjumlah;
                    

            $cRet .="     <tr>
                    <td colspan=\"4\" valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-left:none;border-right:none;\">Jumlah Bulan Ini</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcjumlah)."</td>
                 </tr>
                 
                 <tr>
                    <td colspan=\"4\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-right: solid 1px black;\">Jumlah s.d. Bulan Lalu</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($nlalu)."</td>
                 </tr>
                 
                 <tr>
                    <td colspan=\"4\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-right: solid 1px black;\">Jumlah s.d. Bulan Ini</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px black;\"><b>".number_format($nsdini)."</b></td>
                 </tr>";
            
                 
            $cRet .="<tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td colspan=\"2\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">                
                  Mengetahui
                </td> 
                <td colspan=\"3\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">
                .............., Tanggal..........
                </td>         
            </tr>
            
             <tr>
                <td colspan=\"2\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">                
                  Pengguna Anggaran/ <br> Kuasa Pengguna Anggaran
                </td> 
                <td colspan=\"3\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">
                Bendahara Penerimaan
                </td>         
            </tr>
            <tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>             
            
            <tr>
                <td colspan=\"2\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">                
                    <u><b>$nama1</b></u><br>Nip. $nip
                </td> 
                <td colspan=\"3\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">
                    <u><b>$nama2</b></u><br>Nip. $nip2
                </td>         
            </tr>";
            
                    
        
        $cRet .= '</TABLE>';
        $data['prev'] = 'RINCIAN OBYEK';                 
        $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');  
    }
        
     
    function rekap_terima()
    {
        $data['page_title']= 'Rekapitulasi Penerimaan';
        $this->template->set('title', 'Rekapitulasi Penerimaan');   
        $this->template->load('template','tukd/pendapatan/terima_rekap',$data) ; 
    }
    
    function cetak_rekapterima()
    { 
         $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode in ('PA','KPA') AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         
         $lcNmPA = $trh2->nama;
         $lcNipPA = $trh2->nip;
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"9\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU REKAPITULASI PENERIMAAN HARIAN</b></td>
            </tr>
            <tr>
                <td align=\"center\" colspan=\"9\" style=\"font-size:14px;border: solid 1px white;\"><b>PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">OPD</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmPA</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmBP</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"5%\" style=\"font-size:12px\">No<br>Urut</td>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Tanggal</td>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Referensi</td>
                <td align=\"center\" colspan=\"2\" width=\"25%\" style=\"font-size:12px\">Pajak Daerah<br>(Rp)</td>
                <td align=\"center\" colspan=\"2\" width=\"25%\" style=\"font-size:12px\">Retribusi Daerah<br>(Rp)</td>
                <td align=\"center\" colspan=\"2\" width=\"25%\" style=\"font-size:12px\">Lain-lain PAD yang Sah<br>(Rp)</td>
            </tr>
            <tr>                
                <td align=\"center\" width=\"15%\" style=\"font-size:12px\">Kode dan Nama Kode Rekening Rincian Obyek</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Rupiah</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px\">Kode dan Nama Kode Rekening Rincian Obyek</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Rupiah</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px\">Kode dan Nama Kode Rekening Rincian Obyek</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Rupiah</td>
            </tr>
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>
                <td align=\"center\" style=\"font-size:12px\">9</td>
            </tr>";
           
           if ($pilih==1){
           $sql = "SELECT a.no_sts, a.tgl_sts, a.kd_skpd, a.keterangan, a.kd_kegiatan, a.jns_trans, b.kd_rek5, b.rupiah, c.nm_rek5 FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts)
                    INNER JOIN ms_rek5 c ON RTRIM(b.kd_rek5)=RTRIM(c.kd_rek5)                               
                    WHERE  (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2') AND a.kd_skpd = '$lcskpd'
                    AND (SUBSTRING(b.kd_rek5,1,3)='411' OR SUBSTRING(b.kd_rek5,1,3)='412' OR SUBSTRING(b.kd_rek5,1,3)='414') 
                    ORDER BY a.tgl_sts,a.no_sts,a.jns_trans,b.kd_rek5";
           }else{
           $sql = "SELECT a.no_sts, a.tgl_sts, a.kd_skpd, a.keterangan, a.kd_kegiatan, a.jns_trans, b.kd_rek5, b.rupiah, c.nm_rek5 FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts)
                    INNER JOIN ms_rek5 c ON RTRIM(b.kd_rek5)=RTRIM(c.kd_rek5)
                    WHERE  (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang') AND a.kd_skpd = '$lcskpd'
                    AND (SUBSTRING(b.kd_rek5,1,3)='411' OR SUBSTRING(b.kd_rek5,1,3)='412' OR SUBSTRING(b.kd_rek5,1,3)='414') 
                    ORDER BY a.tgl_sts,a.no_sts,a.jns_trans,b.kd_rek5";                    
           };
                                       
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lcno_sts_lama="";

                    foreach ($hasil->result() as $row)
                    {
                        $cRet .="<tr>";                        
                       if(($row->no_sts)<>$lcno_sts_lama){
                         $lcno = $lcno + 1;
                         $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lcno</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->tgl_sts</td>";                         
                       }else{
                        $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">&nbsp;</td> 
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">&nbsp;</td>";
                       }
                        
                        $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                
                                if((substr($row->kd_rek5,0,3))=='411'){
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5 - $row->nm_rek5</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->rupiah)."</td>";
                                    }
                                else{
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">0</td>";
                                    }
                                
                                if((substr($row->kd_rek5,0,3))=='412'){
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5 - $row->nm_rek5</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->rupiah)."</td>";
                                    }
                                else{
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">0</td>";
                                    }
                                    
                                if((substr($row->kd_rek5,0,3))=='414'){
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5 - $row->nm_rek5</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->rupiah)."</td>";
                                    }
                                else{
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">0</td>";
                                    }
                       
                       $lcno_sts_lama=$row->no_sts;         
                                    
                    };
                    
                    
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran/<br>Kuasa Pengguna Aggaran</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                </tr>";
                
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         $this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
    }
      
    function buku_terima_ppkd()
    {
        $data['page_title']= 'Buku Kas Penerimaan';
        $this->template->set('title', 'Buku Kas Penerimaan');   
        $this->template->load('template','tukd/pendapatan/kas_terima',$data) ; 
    }
    
    function buku_kas()
    {
        $data['page_title']= 'Buku Kas Penerimaan';
        $this->template->set('title', 'Buku Kas Penerimaan');   
        $this->template->load('template','tukd/pendapatan/kas_harian',$data) ; 
    }
    
    
    
    
    function cetak_terima_ppkd()
    {
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = '1.20.05.01';//$_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode in ('PA','KPA') AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         
         $lcNmPA = $trh2->nama;
         $lcNipPA = $trh2->nip;
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"8\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU PENERIMAAN PPKD <br> BENDAHARA PENERIMAAN PPKD</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
        
            
            <tr>
                <td align=\"center\" width=\"4%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Nomor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Tanggal</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Kode Kredit</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Bukti lain</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Kode Rekening</td>
                <td align=\"center\" width=\"30%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Jumlah<br>(Rp)</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Keterangan</td>                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\"  style=\"font-size:12px\">3</td>
                <td align=\"center\"  style=\"font-size:12px\">4</td>
                <td align=\"center\"  style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>                
            </tr>";
           
           
           $lcterima_lalu =0;
           if ($pilih==1){
                $csql= "select SUM(nilai) AS nilai FROM tr_terima_ppkd  WHERE  tgl_terima < '$lctgl1' AND kd_skpd = '1.20.05.01'";
                $hasil2 = $this->db->query($csql);
                $trh2 = $hasil2->row();          
                $lcterima_lalu = $trh2->nilai;                                              
                
           }else{
                $csql= "select SUM(nilai) AS nilai FROM tr_terima_ppkd WHERE  month(tgl_terima)< '$bulan' AND kd_skpd = '1.20.05.01'";
                $hasil = $this->db->query($csql);
                $trh2 = $hasil->row();          
                $lcterima_lalu = $trh2->nilai;
                                    
           }
                     
           
            if ($pilih==1   ){
           $sql = "SELECT a.no_terima, a.tgl_terima, a.keterangan, a.kd_rek5,a.nilai,b.nm_rek5 FROM tr_terima_ppkd a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5
                    WHERE  (a.tgl_terima >= '$lctgl1' AND a.tgl_terima <= '$lctgl2') AND a.kd_skpd = '1.20.05.01'                    
                    ORDER BY tgl_terima, no_terima";
           }else{
            $sql = "SELECT a.no_terima, a.tgl_terima, a.keterangan, a.kd_rek5,a.nilai,b.nm_rek5 FROM tr_terima_ppkd a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5
                    WHERE  (month(a.tgl_terima)= '$bulan' AND year(a.tgl_terima) = '$thn_ang') AND a.kd_skpd = '1.20.05.01'                     
                    ORDER BY tgl_terima, no_terima "; 
                    
                                                        
           }
           
           
                                       
                    $hasil = $this->db->query($sql);                
                    $lcno_sts_lama="";
                    $lcstatus_lama=0;
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    foreach ($hasil->result() as $row)
                    {
                                            
                        
                        $cRet .="<tr>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->no_terima</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".$this->tanggal_indonesia($row->tgl_terima)."</td>";
                                                                                                                                
                       $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                              <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                              <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5</td>>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->nilai)."</td>
                              <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">$row->keterangan</td>
                              </tr>";                     
                                                                    
                       $lcterima_ini=$lcterima_ini+$row->nilai;
                                  
                    }
                    


        if ($pilih==1){
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">Jumlah tanggal $lcperiode</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah sampai tanggal lalu</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah semua s/d tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu+$lcterima_ini)."</td>
                </tr>";
            
        }else{
                                    
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">Jumlah bulan $lcperiode</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah sampai bulan lalu</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah semua s/d bulan ".$this->tukd_model->getBulan($bulan)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu+$lcterima_ini)."</td>
                </tr>";
        }
                
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Akhir</td>
                    <td align=\"left\" colspan=\"1\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\"></td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu+$lcterima_ini)."</td>
                </tr>";
         $cRet .="
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">PPKD</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan PPKD</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    
	function rincian_sts(){
        $data['page_title']= 'RINCIAN STS';
        $this->template->set('title', 'RINCIAN STS');   
        $this->template->load('template','tukd/pendapatan/rincian_sts',$data) ; 
    }
	
	function cetak_rincian_sts(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
		 $lctgl1 = $_REQUEST['tgl1'];
		 $lctgl2 = $_REQUEST['tgl2']; 
        
         $cRet = '';
		
			$csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
			$hasil = $this->db->query($csql);
			$trh2 = $hasil->row();          
			$lcNmskpd = $trh2->nm_skpd;
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">RINCIAN STS 
				<br> $lcNmskpd <br>
				".$this->tukd_model->tanggal_format_indonesia($lctgl1)." SD ".$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
            </tr>
            </table>";
		 
			$cRet .="
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
           
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>TANGGAL</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>NO STS</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>REKENING</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>URAIAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>JUMLAH</b></td>
            </tr>            
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>1</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>2</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>3</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>4</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>5</b></td>
            </tr>
			</thead>";
           

           
			  $sql  = "
					SELECT  '1' urut, b.tgl_sts,a.no_sts,b.tgl_sts tanggal,  a.no_sts as nomor, '' kd_rek5, b.keterangan nama,SUM(rupiah) as nilai
					FROM trdkasin_pkd a 
					INNER JOIN trhkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd='$lcskpd'
					AND b.tgl_sts BETWEEN '$lctgl1' AND '$lctgl2'
					GROUP BY a.no_sts, b.tgl_sts, keterangan
					UNION ALL
					SELECT '2' urut, b.tgl_sts, a.no_sts,NULL tanggal, '' nomor,a.kd_rek5 kd_rek5,c.nm_rek5 nama, SUM(rupiah) as nilai
					FROM trdkasin_pkd a 
					INNER JOIN trhkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd
					LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5
					WHERE a.kd_skpd='$lcskpd'
					AND b.tgl_sts BETWEEN '$lctgl1' AND '$lctgl2'
					GROUP BY a.no_sts,b.tgl_sts,a.kd_rek5,c.nm_rek5
					ORDER BY b.tgl_sts, a.no_sts, urut"
					;  
		   
                                       
                    $hasil = $this->db->query($sql);                                                      
					$total=0;
                    foreach ($hasil->result() as $row)
                    {
                        $tanggal=$row->tanggal;
                        $nomor=$row->nomor;
                        $kd_rek5=$row->kd_rek5;
                        $nama=$row->nama;
                        $nilai=$row->nilai;
                        $urut=$row->urut;
                       switch ($urut)
						{
							case 1;
								$cRet .="<tr>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$tanggal</td>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$nomor</td>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\"></td>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\"><b>$nama</b></td>
									<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($nilai,"2",".",",")."</b></td>
								</tr>
								";
								break;
							case 2;
								$cRet .="<tr>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$tanggal</td>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$nomor</td>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kd_rek5</td>
									<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$nama</td>
									<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($nilai,"2",".",",")."</td>
								</tr>
								";
								$total=$total+$nilai;
								break;
	
						} 
						
					} 
				$cRet .="<tr>
								<td colspan=\"4\" valign=\"top\" align=\"center\" style=\"font-size:12px\"><b>T O T A L</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",".",",")."</b></td>
							</tr>
							";
        $cRet .='</table>';
		$data['prev']= $cRet;
          $print = $this->uri->segment(3);
		switch ($print)
        {
            case 0;
			 echo ("<title> Register Kasda</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'P',0,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_kasda.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}  
    }
    
    
	
	function reg_kasda(){
        $data['page_title']= 'REGISTER KASDA';
        $this->template->set('title', 'REGISTER KASDA');   
        $this->template->load('template','tukd/pendapatan/register_kasda',$data) ; 
    }

	function cetak_reg_kasda(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
		 $lctgl1 = $_REQUEST['tgl1'];
		 $lctgl2 = $_REQUEST['tgl2']; 
        
         $cRet = '';
		 if($lcskpd=='-'){
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">REGISTER PENDAPATAN DAN CP <br>(INPUTAN SKPD)</td>
            </tr>
            </table>"; 
		 } else{
			$csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
			$hasil = $this->db->query($csql);
			$trh2 = $hasil->row();          
			$lcNmskpd = $trh2->nm_skpd;
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">REGISTER PENDAPATAN DAN CP <br>(INPUTAN SKPD) 
				<br> $lcNmskpd <br>
				".$this->tukd_model->tanggal_format_indonesia($lctgl1)." SD ".$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
            </tr>
            </table>";
		 }	
			$cRet .="
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
           
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>KODE</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>URAIAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>PENDAPATAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>CP</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>JUMLAH</b></td>
            </tr>            
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>1</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>2</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>3</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>4</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>5</b></td>
            </tr>
			</thead>";
           

           if($lcskpd=='-'){
			  $sql  = "SELECT a.kd_skpd as kode,a.nm_skpd as uraian, ISNULL(pend,0) pend, ISNULL(cp,0) cp 
					FROM ms_skpd a 
					LEFT JOIN (select a.kd_skpd, 
					ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1)='4' AND b.jns_trans<>3 THEN rupiah 
					                WHEN LEFT(a.kd_rek5,1)='4' AND b.jns_trans=3 THEN rupiah*-1 END ),0) AS  pend,
					ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1) in ('5','1') THEN rupiah END ),0) AS  cp
					FROM trdkasin_pkd a INNER JOIN trhkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
					WHERE a.kd_skpd !=''
					AND b.tgl_sts BETWEEN '$lctgl1' AND '$lctgl2'
					GROUP BY a.kd_skpd) b 
					ON a.kd_skpd=b.kd_skpd
					ORDER BY a.kd_skpd"
					;  
		   }else{
			  $sql  = " SELECT a.kd_rek5 kode, b.nm_rek5 uraian, ISNULL(pend,0) pend, ISNULL(cp,0) cp  FROM 
						(select a.kd_skpd, a.kd_rek5,
						ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1)='4' AND b.jns_trans<>3 THEN rupiah 
						                WHEN LEFT(a.kd_rek5,1)='4' AND b.jns_trans=3 THEN rupiah*-1 END ),0) AS  pend,
						ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1) in ('5','1') THEN rupiah END ),0) AS  cp
						FROM trdkasin_pkd a INNER JOIN trhkasin_pkd b ON a.kd_skpd=b.kd_skpd AND a.no_sts=b.no_sts
						WHERE a.kd_skpd ='$lcskpd'
						AND b.tgl_sts BETWEEN '$lctgl1' AND '$lctgl2'
						GROUP BY a.kd_skpd,a.kd_rek5) a
						LEFT JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5"
					; 
		   }
            
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $jumlah=0;
					$total=0;
					$total_pend=0;
					$total_cp=0;
                    foreach ($hasil->result() as $row)
                    {
                        $kode=$row->kode;
                        $uraian=$row->uraian;
                        $pend=$row->pend;
                        $cp=$row->cp;
                        $jumlah=$pend+$cp;
						$total_pend=$total_pend+$pend;
						$total_cp=$total_cp+$cp;
						$total=$total+$jumlah;
						$cRet .="<tr>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kode</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$uraian</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($pend,"2",".",",")."</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($cp,"2",".",",")."</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($jumlah,"2",".",",")."</b></td>
							</tr>
							";
					} 
				$cRet .="<tr>
								<td colspan=\"2\" valign=\"top\" align=\"center\" style=\"font-size:12px\"><b>T O T A L</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total_pend,"2",".",",")."</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total_cp,"2",".",",")."</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",".",",")."</b></td>
							</tr>
							";
        $cRet .='</table>';
		$data['prev']= $cRet;
          $print = $this->uri->segment(3);
		switch ($print)
        {
            case 0;
			 echo ("<title> Register Kasda</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'P',0,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_kasda.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}  
    }
    
	function cetak_reg_kasda2(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
		 $lctgl1 = $_REQUEST['tgl1'];
		 $lctgl2 = $_REQUEST['tgl2']; 
        
         $cRet = '';
		 if($lcskpd=='-'){
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">REGISTER PENDAPATAN DAN CP <br>(INPUTAN KASDA)</td>
            </tr>
            </table>"; 
		 } else{
			$csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
			$hasil = $this->db->query($csql);
			$trh2 = $hasil->row();          
			$lcNmskpd = $trh2->nm_skpd;
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">REGISTER PENDAPATAN DAN CP <br>(INPUTAN KASDA) 
				<br> $lcNmskpd <br>
				".$this->tukd_model->tanggal_format_indonesia($lctgl1)." SD ".$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
            </tr>
            </table>";
		 }	
			$cRet .="
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
           
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>KODE</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>URAIAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>PENDAPATAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>CP</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>JUMLAH</b></td>
            </tr>            
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>1</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>2</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>3</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>4</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>5</b></td>
            </tr>
			</thead>";
           

           if($lcskpd=='-'){
			  $sql  = "SELECT a.kd_skpd as kode,a.nm_skpd as uraian, ISNULL(pend,0) pend, ISNULL(cp,0) cp 
					FROM ms_skpd a 
					LEFT JOIN (select a.kd_skpd, 
					ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1)='4' THEN rupiah END ),0) AS  pend,
					ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1) in ('5','1') THEN rupiah END ),0) AS  cp
					FROM trdkasin_ppkd a INNER JOIN trhkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
					WHERE a.kd_skpd !=''
					AND b.tgl_kas BETWEEN '$lctgl1' AND '$lctgl2'
					GROUP BY a.kd_skpd) b 
					ON a.kd_skpd=b.kd_skpd
					ORDER BY a.kd_skpd"
					;  
		   }else{
			  $sql  = " SELECT a.kd_rek5 kode, b.nm_rek5 uraian, ISNULL(pend,0) pend, ISNULL(cp,0) cp  FROM 
						(select a.kd_skpd, a.kd_rek5,
						ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1)='4' THEN rupiah END ),0) AS  pend,
						ISNULL(SUM(CASE WHEN LEFT(a.kd_rek5,1) in ('5','1') THEN rupiah END ),0) AS  cp
						FROM trdkasin_ppkd a INNER JOIN trhkasin_ppkd b ON a.kd_skpd=b.kd_skpd AND a.no_kas=b.no_kas
						WHERE a.kd_skpd ='$lcskpd'
						AND b.tgl_kas BETWEEN '$lctgl1' AND '$lctgl2'
						GROUP BY a.kd_skpd,a.kd_rek5) a
						LEFT JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5
						ORDER BY a.kd_rek5"
					; 
		   }
            
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $jumlah=0;
					$total=0;
					$total_pend=0;
					$total_cp=0;
                    foreach ($hasil->result() as $row)
                    {
                        $kode=$row->kode;
                        $uraian=$row->uraian;
                        $pend=$row->pend;
                        $cp=$row->cp;
                        $jumlah=$pend+$cp;
						$total_pend=$total_pend+$pend;
						$total_cp=$total_cp+$cp;
						$total=$total+$jumlah;
						$cRet .="<tr>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kode</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$uraian</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($pend,"2",".",",")."</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($cp,"2",".",",")."</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($jumlah,"2",".",",")."</b></td>
							</tr>
							";
					} 
				$cRet .="<tr>
								<td colspan=\"2\" valign=\"top\" align=\"center\" style=\"font-size:12px\"><b>T O T A L</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total_pend,"2",".",",")."</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total_cp,"2",".",",")."</b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",".",",")."</b></td>
							</tr>
							";
        $cRet .='</table>';
		$data['prev']= $cRet;
          $print = $this->uri->segment(3);
		switch ($print)
        {
            case 0;
			 echo ("<title> Register Kasda</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'P',0,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_kasda.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}  
    }
    
	
	function cetak_reg_kasda3(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
		 $lctgl1 = $_REQUEST['tgl1'];
		 $lctgl2 = $_REQUEST['tgl2']; 
        
         $cRet = '';
		 if($lcskpd=='-'){
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">REGISTER PENDAPATAN DAN CP <br>(INPUTAN KASDA)</td>
            </tr>
            </table>"; 
		 } else{
			$csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
			$hasil = $this->db->query($csql);
			$trh2 = $hasil->row();          
			$lcNmskpd = $trh2->nm_skpd;
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"5\" style=\"font-size:14px;border: solid 1px white;\">REGISTER PENERIMAAN SKPD 
				<br> $lcNmskpd <br>
				".$this->tukd_model->tanggal_format_indonesia($lctgl1)." SD ".$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
            </tr>
            </table>";
		 }	
			$cRet .="
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
           
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>NO TERIMA</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>KODE REK</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>NILAI</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>REK 4</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>NAMA REK 4</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>NAMA REK 5</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>KETERANGAN</b></td>
            </tr>            
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>1</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>2</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>3</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>4</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>5</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>6</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\"><b>7</b></td>
            </tr>
			</thead>";
           

           if($lcskpd=='-'){
			  $sql  = "select no_terima, a.kd_rek5, nilai, LEFT(a.kd_rek5,5) as kd_rek4, 
						(SELECT nm_rek4 FROM ms_rek4 d WHERE LEFT(a.kd_rek5,5)=d.kd_rek4) as nm_rek3,b.nm_rek5
						from tr_terima a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5
						WHERE  a.tgl_terima BETWEEN '$lctgl1' AND '$lctgl2'
						ORDER BY no_terima"
					;  
		   }else{
			  $sql  = " select no_terima, a.kd_rek5, nilai, LEFT(a.kd_rek5,5) as kd_rek4, 
						(SELECT nm_rek4 FROM ms_rek4 d WHERE LEFT(a.kd_rek5,5)=d.kd_rek4) as nm_rek4,b.nm_rek5
						from tr_terima a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5
						WHERE a.kd_skpd ='$lcskpd' AND a.tgl_terima BETWEEN '$lctgl1' AND '$lctgl2'
						ORDER BY no_terima"
					; 
		   }
            
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $jumlah=0;
					$total=0;
					$total_pend=0;
					$total_cp=0;
                    foreach ($hasil->result() as $row)
                    {
                        $no_terima=$row->no_terima;
                        $kd_rek5=$row->kd_rek5;
                        $nilai=$row->nilai;
                        $kd_rek4=$row->kd_rek4;
                        $nm_rek4=$row->nm_rek4;
                        $nm_rek5=$row->nm_rek5;
						$total=$total+$nilai;
                     
						$cRet .="<tr>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$no_terima</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kd_rek5</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($nilai,"2",".",",")."</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kd_rek4</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$nm_rek4</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">$nm_rek5</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">&nbsp;</td>
							</tr>
							";
					} 
					$cRet .="<tr>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\">TOTAL</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\"></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($total,"2",".",",")."</td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\"></td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\"></td>
								<td valign=\"top\" align=\"left\" style=\"font-size:12px\"></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">&nbsp;</td>
							</tr>
							";
				
        $cRet .='</table>';
		$data['prev']= $cRet;
          $print = $this->uri->segment(3);
		switch ($print)
        {
            case 0;
			 echo ("<title> Register Penerimaan</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'P',0,'');
               break;
			   case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename= register_kasda.xls");
				$this->load->view('anggaran/rka/perkadaII', $data);
				break;	
		}  
    }
    


    function spj_terima()
    {
        $data['page_title']= 'SPJ PENDAPATAN';
        $this->template->set('title', 'SPJ Pendapatan');   
        $this->template->load('template','tukd/pendapatan/spj_terima',$data) ; 
    }
    
     
    function cetak_spjterima()
    {
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode in ('PA','KPA') AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         
         $lcNmPA = $trh2->nama;
         $lcNipPA = $trh2->nip;
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"13\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>
                    LAPORAN PERTANGGUNGJAWABAN BENDAHARA PENERIMAAN<BR>SPJ PENDAPATAN PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">OPD</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmPA</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmBP</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            
            
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Kode<br>Rekening</td>
                <td align=\"center\" rowspan=\"2\" width=\"24%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Sampai dengan Bulan Lalu</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Bulan Ini</td>
                <td align=\"center\" colspan=\"4\" width=\"24%\" style=\"font-size:12px\">Sampai dengan Bulan Ini</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang<br>Terealisasi</td>                
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang telah<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa yang<br>Belum<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">Sisa Anggaran yang<br>Belum<br>Terealisasi/Pelam-<br>pauan Anggaran</td>                                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:10px\">1</td>
                <td align=\"center\" style=\"font-size:10px\">2</td>
                <td align=\"center\" style=\"font-size:10px\">3</td>
                <td align=\"center\" style=\"font-size:10px\">4</td>
                <td align=\"center\" style=\"font-size:10px\">5</td>
                <td align=\"center\" style=\"font-size:10px\">6=(5-4)</td>
                <td align=\"center\" style=\"font-size:10px\">7</td>
                <td align=\"center\" style=\"font-size:10px\">8</td>
                <td align=\"center\" style=\"font-size:10px\">9=(8-7)</td>
                <td align=\"center\" style=\"font-size:10px\">10=(4+7)</td>
                <td align=\"center\" style=\"font-size:10px\">11=(5+8)</td>
                <td align=\"center\" style=\"font-size:10px\">12=(11-10)</td>
                <td align=\"center\" style=\"font-size:10px\">13=(3-10)</td>                
            </tr>";
           

            if ($pilih==1   ){
                $kon_terimaini = " (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2')";
                $kon_keluarini = " (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2')";          
                $kon_terimalalu = " (a.tgl_sts < '$lctgl1')";
                $kon_keluarlalu = " (tgl_sts)";
           }else{
                $kon_terimaini = " (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_keluarini = " (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_terimalalu = " (month(a.tgl_sts)< '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_keluarlalu = " (month(a.tgl_sts)< '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
           }

            
            $kon_skpd="a.kd_skpd = ";
            $sql  = "SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, SUM(z.nilai) AS ang, SUM(z.nilai_ubah) AS ang_ubah,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimaini) AS terima_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimalalu) AS terima_lalu,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS keluar_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarlalu) AS keluar_lalu                    
                    FROM trdrka z WHERE z.kd_skpd='$lcskpd' and left(z.kd_rek5,1)='4'
                    GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5
                    ORDER BY z.kd_rek5"     ;
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $lcprog_lama="";
                    $lckeg_lama="";
                    $ln_jlh1 =0;
                    $ln_jlh2 =0;
                    $ln_jlh3 =0;
                    $ln_jlh4 =0;
                    $ln_jlh5 =0;
                    $ln_jlh6 =0;
                    $ln_jlh7 =0;
                    $ln_jlh8 =0;
                    $ln_jlh9 =0;
                    $ln_jlh10 =0;
                    $ln_jlh11 =0;
                    
                    foreach ($hasil->result() as $row)
                    {
                        $lcprog=substr($row->kd_kegiatan,0,18);
                        $lckeg=$row->kd_kegiatan;
                        $lcrek=$row->kd_rek5;
                        
                        if($lcprog<>$lcprog_lama){//cek program
                            $sql="select z.kd_program, z.nm_program,
                                (SELECT SUM(a.nilai_ubah) FROM trdrka a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and left(a.kd_rek5,1)='4') AS ang_ubah,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_terimaini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_terimalalu) AS terima_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd'
                                    group by z.kd_program, z.nm_program";
                             $hasil_prog = $this->db->query($sql);
                             foreach ($hasil_prog->result() as $row_prog)
                             {
                             $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>$lcprog</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row_prog->nm_program</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)-($row_prog->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_ini)-($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->terima_lalu)+($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)+($row_prog->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu+$row_prog->keluar_ini)-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  </tr>";
                                    
                                
                             }
                                                                                                                                                                 
                        }
                        
                        if($lckeg<>$lckeg_lama){ //cek kegiatan
                            $sql="select z.kd_kegiatan, z.nm_kegiatan,
                                (SELECT SUM(a.nilai_ubah) FROM trdrka a WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd') AS ang_ubah,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_terimaini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_terimalalu) AS terima_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd' 
                                    group by z.kd_kegiatan, z.nm_kegiatan";
                             $hasil_keg = $this->db->query($sql);
                             foreach ($hasil_keg->result() as $row_keg)
                             {
                                $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>$lckeg</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:11px;border-bottom:none;border-top:none\"><b>$row_keg->nm_kegiatan</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)-($row_keg->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_ini)-($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->terima_lalu)+($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)+($row_keg->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu+$row_keg->keluar_ini)-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  </tr>";
                                
                                
                             }
                                                                                                                                                                 
                        }                                                                                                                        
                                                                                                                                
                       $cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\">$lckeg.".$this->tukd_model->dotrek($lcrek)."</td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->terima_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->keluar_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)-($row->terima_lalu))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->terima_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->keluar_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_ini)-($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->terima_lalu)+($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)+($row->keluar_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini))."</td>
                              </tr>";    
                                                              
                        $ln_jlh1=$ln_jlh1+ $row->ang_ubah;
                        $ln_jlh2=$ln_jlh2+ $row->terima_lalu;
                        $ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
                        $ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
                        $ln_jlh5=$ln_jlh5+ $row->terima_ini;
                        $ln_jlh6=$ln_jlh6+ $row->keluar_ini;
                        $ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
                        $ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
                        $ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
                        $ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
                        $ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
                                                                             
                        $lcprog_lama=$lcprog;
                        $lckeg_lama=$lckeg;           
                    }
                    


        $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" colspan=\"2\" style=\"font-size:10px\"><b>Jumlah</b></td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh1)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh2)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh3)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh4)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh5)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh6)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh7)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh8)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh9)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh10)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh11)."</td>
                </tr>
                
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran/<br>Kuasa Pengguna Aggaran</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b></td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                </tr>";
                
                                  
                
        $cRet .='</table>';
         $data['prev']= $cRet;    
         $this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
    }
    
    
// flag    
    function nosp2d_bank($lcskpd='') {                 
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.no_sp2d, a.tgl_sp2d, a.no_spm, 
            (SELECT SUM(c.nilai) FROM trdspp c INNER JOIN trhspm b ON RTRIM(b.no_spp)=RTRIM(c.no_spp) WHERE RTRIM(b.no_spm)=RTRIM(a.no_spm)) AS nilai
            FROM trhsp2d a
            WHERE UPPER(a.no_sp2d) LIKE UPPER('%$lccr%') AND RTRIM(a.kd_skpd)= '$lcskpd' AND no_sp2d NOT IN  
                                (SELECT no_sp2d FROM trbank_terima)";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'tgl_sp2d' => $resulte['tgl_sp2d'],      
                        'nilai' => number_format($resulte['nilai']),
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();
    }
    
    function config_bank_simpanan() {
        $lccr   = $this->input->post('q');
        $sql    = "SELECT kode, nama FROM ms_bank where upper(kode) like '%$lccr%' or upper(nama) like '%$lccr%' order by kode ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kode' => $resulte['kode'],  
                        'nama' => $resulte['nama']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
	}


   		/* function config_skpd(){
        $skpd     = '1.20.05.01';//$this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM  ms_skpd where kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
		
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        } 
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }*/
    
	
	function load_sp2d_transout_ppkd(){
       //$beban='',$giat=''
       $beban   =$this->input->post('jenis');
       $giat    =$this->input->post('giat');
       $kode    ='1.20.05.01';//$this->input->post('kd');
       $bukti   =$this->input->post('bukti');
       $where = '';
       if ($beban=='1'){
        $sisa = "(SELECT IF(SUM(v.nilai) IS NULL,0,SUM(v.nilai)) FROM trhspp z INNER JOIN trhspm s ON z.no_spp=s.no_spp 
                INNER JOIN trhsp2d v ON s.no_spm=v.no_spm WHERE z.jns_spp='1' AND z.kd_skpd=c.kd_skpd )
                -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";
       }else{
        $sisa = "c.nilai -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";   
       }
       if (($beban != '' && $giat == '') || ($beban == '1')){
            $where = " and a.jns_spp='$beban'"; 
       }
       if ($giat !='' && $beban != '1'){
            $where = " and a.jns_spp='$beban' and d.kd_kegiatan='$giat'";
       }
        $kriteria = $this->input->post('q');
            $sql = "SELECT DISTINCT c.no_sp2d,c.tgl_sp2d,c.nilai,
                    $sisa                   
                    FROM trhspp a INNER JOIN trhspm b ON a.no_spp=b.no_spp
                    INNER JOIN trhsp2d c ON b.no_spm=c.no_spm
                    INNER JOIN trdspp d ON a.no_spp=d.no_spp
                    WHERE c.kd_skpd = '$kode' AND c.status = 1 $where ORDER BY c.no_sp2d,c.tgl_sp2d";
       //and UPPER(no_sp2d) LIKE '%$kriteria%'  
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'sisa' => $resulte['sisa']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
	
	function hapus_transout_ppkd(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtransout_ppkd where no_bukti='$nomor'";
        $asg = $this->db->query($sql);
        
        $sql = "delete from trdtransout where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

		$sql = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);
        
        $sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);
        
        $sql = "delete from trdju where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtransout_ppkd where no_bukti='$nomor'";
            $asg = $this->db->query($sql);
            
            $sql = "delete from trhtransout where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_ppkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);
            
            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);
            
            $sql = "delete from trhju where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			
			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }

	function load_transout_ppkd(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where=" and (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT count(*) as total from trhtransout_ppkd where kd_skpd='1.20.05.01' $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtransout_ppkd where kd_skpd='1.20.05.01' $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp'],
                        'pay' => $resulte['pay']                                                                                                        
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }

	function load_dtransout_ppkd(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtransout_ppkd c LEFT JOIN trhtransout_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout_ppkd a INNER JOIN
                trdtransout_ppkd b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
	
	function bku_ppkd()
    {
        $data['page_title']= 'BKU PPKD';
        $this->template->set('title', 'BKU PPKD');   
        $this->template->load('template','tukd/transaksi/bku_ppkd',$data) ; 
    }
     function cetak_bku_ppkd(){
         
         //$cskpd = $_REQUEST['kd_skpd'];
//          $cnm_skpd = $_REQUEST['nm_skpd'];
//          $cskpd = $_REQUEST['kd_skpd'];
         
         //lc = '?kd_skpd='+ckdskpd+'&tgl1='+ctgl1+'&tgl2='+ctgl2+'&tgl_ttd='+ctglttd+'&cpilih=1';
        //lc = '?kd_skpd='+ckdskpd+'&bulan1='+cbulan1+'&bulan2='+cbulan2+'&tgl_ttd='+ctglttd+'&cpilih=2'; 
         $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         
//         
//         $lcskpd = str_replace('123456789','/',$this->uri->segment(3));
//         $lctgl1 = $this->uri->segment(4);
//         $lctgl2 = $this->uri->segment(5);
//         $tgl_ttd = $this->uri->segment(6);
         
         //echo  $lcskpd.$lctgl1.$lctgl2;  
         
         if ($pilih==1){
         $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
            '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
            UNION 
            SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
            b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
            trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
            z.tgl_kas < '$lctgl1' AND z.kd_skpd = '$lcskpd' and year(z.tgl_kas) = $thn_ang
            ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";
         }else{
             $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
            '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
            UNION 
            SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
            b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
            trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
            month(z.tgl_kas) < '$bulan' and year(z.tgl_kas) = $thn_ang AND z.kd_skpd = '$lcskpd'
            ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";
         }
         
         

         
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         
         $saldoawal = $trh4->sel;
         
         
         
                  
         $csql="SELECT a.nm_skpd,(SELECT nama FROM ms_ttd WHERE kode in ('PA','KPA') AND kd_skpd = a.kd_skpd) AS nm_pa,
                (SELECT nip FROM ms_ttd WHERE kode in ('PA','KPA') AND kd_skpd = a.kd_skpd) AS nip_pa,
                (SELECT nama FROM ms_ttd WHERE kode = 'BK' AND kd_skpd = a.kd_skpd) AS nm_bk,
                (SELECT nip FROM ms_ttd WHERE kode = 'BK' AND kd_skpd = a.kd_skpd) AS nip_bk
                 FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
                
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row(); 
            
        
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\"><b>KABUPATEN MAHARDIKA<br>BUKU KAS UMUM PENGELUARAN</b></td>
            </tr>
            <tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\"><b>PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">OPD</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">:&nbsp;$trh2->nm_skpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">:&nbsp;$trh2->nm_pa</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">Bendahara Pengeluaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">:&nbsp;$trh2->nm_bk</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            <tr>
                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">No<br>Urut</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Tanggal</td>
                <td align=\"center\" colspan=\"10\" width=\"30%\" style=\"font-size:12px\">Kode Rekening</td>
                <td align=\"center\" width=\"25%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Pengeluaran</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Saldo</td>
            </tr>
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" colspan=\"10\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
            </tr>";
           
           if ($pilih==1){
           $sql = "SELECT z.* FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
                    '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
                    UNION 
                    SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
                    b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
                    trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
                    z.tgl_kas >= '$lctgl1' AND z.tgl_kas <= '$lctgl2' AND z.kd_skpd = '$lcskpd'
                    ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";
           }else{
           $sql = "SELECT z.* FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
                    '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
                    UNION 
                    SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
                    b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
                    trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
                    month(z.tgl_kas) = '$bulan' AND 
                    year(z.tgl_kas) = $thn_ang and z.kd_skpd = '$lcskpd'
                    ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";     
                    
                    
           }
           
                            
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lcterima = 0;
                    $lckeluar = 0;
                    $lhasil = $saldoawal;
                    $saldolalu=number_format($lhasil);
                    $cRet .= "<tr><td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                    $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">Saldo Lalu</td>";
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">$saldolalu</td></tr>";
                    foreach ($hasil->result() as $row)
                    {
                        $cRet .="<tr>";
                        $lhasil = $lhasil + $row->terima - $row->keluar;
                       if(!empty($row->tanggal)){
                         $lcno = $lcno + 1;
                         $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lcno</td>";
                       }else{
                        $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">&nbsp;</td>";
                       }
                        
                        $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->tanggal</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,0,4)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,5,7)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,13,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,16,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,19,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,0,1)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,1,1)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,2,1)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,3,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,5,2)."</td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->uraian</td>";
                                if(empty($row->terima)){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                }else{
                                    $lcterima = $lcterima + $row->terima; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima)."</td>";
                                }
                                
                                if(empty($row->keluar)){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                }else{
                                    $lckeluar = $lckeluar + $row->keluar; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar)."</td>";
                                }
                                if(empty($row->rekening)){
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                }else{
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($lhasil)."</td>";
                                }
                            $cRet .="</tr>";    
                    }
            
        $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                 </tr>                 
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Periode $lcperiode </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lcterima)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lckeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lhasil)."</td>
                 </tr>";
                 
                 if ($pilih==1){                 
                 $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b LEFT JOIN 
                        trhrekal a ON a.no_kas=b.no_kas WHERE a.tgl_kas < '$lctgl1'";
                 }else{
                    $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b LEFT JOIN 
                        trhrekal a ON a.no_kas=b.no_kas WHERE month(a.tgl_kas) < '$bulan' and year(a.tgl_kas) = $thn_ang";
                 }
                        
                 $hasil = $this->db->query($csql);
                 $trh1 = $hasil->row(); 
                
        $cRet .="<tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Sampai $lcperiode1 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmkeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah s/d $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima+$lcterima)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmkeluar+$lckeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Sisa Kas Pada $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima+$lcterima-$trh1->jmkeluar-$lckeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td align=\"center\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">
                    Mengetahui,<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;$trh2->nm_pa<br>$trh2->nip_pa</td>
                    <td valign=\"top\" align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">
                    ".$this->tukd_model->tanggal_format_indonesia($tgl_ttd)."
                    <br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;$trh2->nm_bk<br>$trh2->nip_bk
                    </td>
                </tr>
              
            
        </table>";
        
         
         $data['prev']= $cRet;    
         $this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
     
     }
	//============
    
    //============04022014bowo
    function lpj_ppkd()
    {
        $data['page_title']= 'INPUT LPJ PPKD';
        $this->template->set('title', 'INPUT LPJ PPKD');   
        $this->template->load('template','tukd/transaksi/lpj_ppkd',$data) ; 
    }
    
    function simpan_lpj(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = trim($this->input->post('beban'));
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s');      
        $msg        = array();

		// Simpan Header //
        if ($tabel == 'hlpj_ppkd') {
            $sql = "delete from hlpj_ppkd where kd_skpd='$skpd' and no_bukti='$nomor' and kd_skpd='1.20.05.01'";
			$asg = $this->db->query($sql);
			if ($beban=='1'){
	           $sql = "delete from trhju_ppkd where kd_skpd='$skpd' and no_voucher='$nomor' and kd_skpd='1.20.05.01'";
			   $asg = $this->db->query($sql);
			}

            if ($asg){
                
				$sql = "insert into hlpj_ppkd(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban')";
                $asg = $this->db->query($sql);

				if ($beban=='1'){
					$asq3 = " insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asg3 = $this->db->query($asq3);
				}



                if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        }elseif($tabel == 'dlpj_ppkd') {
            
            // Simpan Detail //                       
                $sql = "delete from dlpj_ppkd where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
				if ($beban=='1'){
					$sql = "delete from dlpj_ppkd where no_voucher='$nomor'";
					$asg = $this->db->query($sql);
				}
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into dlpj_ppkd(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai)"; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }

				$hasil=$this->db->query(" select * from dlpj_ppkd where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek5'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
	  			    
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
					$rek3=substr($kdrek5,0,3);
	  			    $rekutang=$this->tukd_model->get_nama($rek3,'kd_rek5','ms_rek5','map_lo');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					if ($beban=='1'){
						if ($status=='1'){
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");		
					    }else{
					   
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");							   
					    }
					}

				}   
									 				
				
        }
         
        //$asg->free_result();
    }

     function simpan_penagihan_lpj(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = $this->input->post('beban');
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s');      
        $msg        = array();
        // Simpan Header //
        if ($tabel == 'trhtagih') {
            $sql = "delete from trhtagih where kd_skpd='$skpd' and no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if ($asg){
                $sql = "insert into trhtagih(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban')";
                $asg = $this->db->query($sql);

				$asq3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
				$asg3 = $this->db->query($asq3);

				if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        } else if ($tabel == 'trdtagih') {
            
            // Simpan Detail //                       
                $sql = "delete from trdtagih where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
                $sql = "delete from trdju_pkd where no_voucher='$nomor'";
                $asg = $this->db->query($sql);
                
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdtagih(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,kd_rek,nm_rek5,nilai)"; 
    
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }            
				
				$hasil=$this->db->query(" select * from trdtagih where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
					
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
					
					$rek3=substr($kdrek5,0,3);	  			    
					$rekutang=$this->tukd_model->get_nama($rek3,'kd_rek5','ms_rek5','map_lo');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$jns','1','1') ");                   
					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang','0',$nilai,'K','$jns','2','1') ");  

				} 

        }
         
        //$asg->free_result();	
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);	
	}
    
    function hapus_lpj(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from dlpj_ppkd where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

		$sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from hlpj_ppkd where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			
			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
	
	
    function hapus_penagihan_lpj(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtagih where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

        $sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtagih where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function load_lpj(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where=" and (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from hlpj_ppkd where jns_spp in ('1','3') $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from hlpj_ppkd where jns_spp in ('1','3') $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp']                                                                                              
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
	
	
	
    
    function load_penagihan_lpj(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhtagih  $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtagih   $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp']                                                                                              
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_ambilsimpanan() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = '';
        
        if ($kriteria <> ''){                               
            $where="where ( upper(no_kas) like upper('%$kriteria%') )";            
        }
        
        $sql    = "SELECT * from tr_ambilsimpanan_ppkd $where order by no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'          => $ii,        
                        'no_kas'      => $resulte['no_kas'],
                        //'tgl_kas'     => $this->tukd_model->rev_date($resulte['tgl_kas']),
                        'tgl_kas'     => $resulte['tgl_kas'],
                        'kd_skpd'     => $resulte['kd_skpd'],
                        'nilai'       => number_format($resulte['nilai']),
                        'bank'        => $resulte['bank'],
                        'nm_rekening' => $resulte['nm_rekening'],
                        'keterangan'  => $resulte['keterangan']    
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
    
    function load_dlpj(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout a INNER JOIN
                dlpj_ppkd b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
	
	
	
    function load_dtagih_lpj(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek) AS anggaran FROM trhtagih a INNER JOIN
                trdtagih b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'kd_rek'        => $resulte['kd_rek'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_sp2d_lpj(){
       //$beban='',$giat=''
       $beban   = $this->input->post('jenis');
       $giat    = $this->input->post('giat');
       $kode    = $this->input->post('kd');
       $bukti   = $this->input->post('bukti');
       $where = '';
       if ($beban=='1'){
        $sisa = "c.nilai + (SELECT IF(SUM(v.nilai) IS NULL,0,SUM(v.nilai)) FROM trhspp z INNER JOIN trhspm s ON z.no_spp=s.no_spp 
                INNER JOIN trhsp2d v ON s.no_spm=v.no_spm WHERE z.jns_spp='1' AND z.kd_skpd=c.kd_skpd )
                -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM dlpj_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";
       }else{
        $sisa = "c.nilai -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM dlpj_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";   
       }
       if (($beban != '' && $giat == '') || ($beban == '1')){
            $where = " and a.jns_spp='$beban'"; 
       }
       if ($giat !='' && $beban != '1'){
            $where = " and a.jns_spp='$beban' and d.kd_kegiatan='$giat'";
       }
        $kriteria = $this->input->post('q');
            $sql = "SELECT DISTINCT c.no_sp2d,c.tgl_sp2d,c.nilai,
                    $sisa                   
                    FROM trhspp a INNER JOIN trhspm b ON a.no_spp=b.no_spp
                    INNER JOIN trhsp2d c ON b.no_spm=c.no_spm
                    INNER JOIN trdspp d ON a.no_spp=d.no_spp
                    WHERE c.kd_skpd = '$kode' AND c.status = 1 $where ORDER BY c.no_sp2d,c.tgl_sp2d";
       //and UPPER(no_sp2d) LIKE '%$kriteria%'  
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'sisa' => $resulte['sisa']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
    
	
	    
     function load_trskpd_lpj() {        
        $jenis =$this->input->post('jenis');
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        
        $jns_beban='';
        $cgiat = '';
        if ($jenis !=''){
            $jns_beban = "and a.jns_kegiatan='$jenis'";
        }
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd='$cskpd' $jns_beban $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
     function load_trskpd_penagihan_lpj() {        
        
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        $cgiat = '';
       
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd= '$cskpd'  $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

    function load_rek_lpj() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        $sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
        
        if ($jenis=='1'){
            $sql = "SELECT a.kd_rek5,a.nm_rek5,
                    (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek5=a.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    0 AS sp2d,nilai AS anggaran  FROM trdrka a WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";
                    
        } else {
            $sql = "SELECT b.kd_rek5,b.nm_rek5,
                    (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    a.nilai AS sp2d,(SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran 
                    FROM trhspp a INNER JOIN trdspp b ON a.no_spp=b.no_spp INNER JOIN trhspm c ON b.no_spp=c.no_spp INNER JOIN trhsp2d d ON c.no_spm=d.no_Spm
                    WHERE d.no_sp2d = '$sp2d' and b.kd_kegiatan='$giat' $notIn ";
        }        
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function load_rek_penagihan_lpj() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        //$sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
            $sql = "SELECT a.kd_rek5,a.nm_rek5,e.map_lo,
                    (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek=a.kd_rek5 AND c.no_bukti <> '$nomor' ) AS lalu,
                    0 AS sp2d,a.nilai AS anggaran  FROM trdrka a LEFT JOIN ms_rek5 e ON a.kd_rek5=e.kd_rek5  WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";

        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['map_lo'],
                        'kd_rek' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function out_lalu_lpj(){
         $giat = $this->input->post('giat');
         $sp2d = $this->input->post('sp2d');
         $rek  = $this->input->post('rek');
         $nomor  = $this->input->post('nomor');
         $tgl  = $this->input->post('tgl');
         $skpd  = $this->input->post('skpd');
         $jenis  = $this->input->post('jenis');
         $sql = "SELECT b.no_bukti,b.no_sp2d,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.nm_rek5,
                (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_kegiatan=b.kd_kegiatan AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> b.no_bukti AND d.tgl_bukti<=a.tgl_bukti AND d.jns_spp = a.jns_spp) AS lalu,
                (SELECT SUM(g.nilai) FROM trdspp g INNER JOIN trhspm h ON g.no_spp=h.no_spp INNER JOIN trhsp2d i ON h.no_spm=i.no_spm WHERE i.no_sp2d=b.no_sp2d) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM hlpj_ppkd a INNER JOIN dlpj_ppkd b ON a.no_bukti=b.no_bukti
                WHERE a.kd_skpd = '$skpd' AND b.kd_kegiatan = '$giat' AND b.kd_rek5 = '$rek' AND a.tgl_bukti <> '$tgl' AND 
                b.no_sp2d = '$sp2d' AND a.no_bukti = '$nomor'";                           
         $query1 = $this->db->query($sql);        
         $row = $query1->row();
         $result[] = array('lalu' =>$row->rp);
         //$result = $row->rp;
         echo json_encode($result);
         //echo $result;
         $query1->free_result();
    }
    
	
	//=============
    
      function cetak_register_sp2d_ppkd(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b>REGISTER SPP/SPM/SP2D</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b> BENDAHARA PENGELUARAN PPKD</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"2\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jenis Belanja</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"25%\" rowspan=\"2\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jumlah <br>(Rp)</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"7%\" rowspan=\"2\"><b>Keterangan</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"25%\"><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>11</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,a.no_spp,a.tgl_spp,a.jns_spp,b.tgl_sp2d,b.no_sp2d,b.keperluan,
                b.nilai FROM TRHSPM a LEFT JOIN TRHSP2D b ON a.no_spm=b.no_spm $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                    $beban= $row->jns_spp;
                    $tgl_spp=$row->tgl_spp;
                    $spp= $row->no_spp;
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n= $row->nilai;
                    $lcno = $lcno + 1;
                    switch ($beban) 
                    {
                        case '1': //UP
                            $jns='UP';
                            break;
                        case '2': //GU
                            $jns='GU';
                            break;
                        case '3': //TU
                            $jns='TU';
                            break;
                        case '4': //LS gaji
                           $jns='LS gaji';
                            break;
                        case '5': //LS PPKD
                            $jns='LS PPKD';
                            break;
                        case '6': //LS barang dan jasa
                            $jns='LS barang & jasa';
                            break;
                            
                    }
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"center\" width=\"7%\" style=\"font-size:12px\">$jns</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spp)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spp</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spm</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$sp2d</td>

                                <td align=\"left\" width=\"25%\" style=\"font-size:12px\">$kkeperluan</td>
                                <td align=\"right\" width=\"10%\" style=\"font-size:12px\">".number_format($n)."</td>
                                <td align=\"right\" width=\"7%\" style=\"font-size:12 px\"></td>
                              </tr>  "; 
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');   
    }
    
    function cetak_kas_harian()
    {
        $thn_ang = $this->session->userdata('pcThang');
        
            $bulan =''; 
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
         $tgl= $_REQUEST['tgl1'];
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
       
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '1.20.05.00'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

       
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"7\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>LAPORAN POSISI KAS HARIAN</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">HARI</td>
                <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">:</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">TANGGAL</td>
                <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">: ".$this->tanggal_format_indonesia($tgl)."</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">PERIODE</td>
                <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">: $lcperiode</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"4%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >No.</td>
                <td align=\"center\" colspan=\"3\" width=\"36%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Transaksi</td>
                <td align=\"center\" rowspan=\"2\" width=\"30%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan<br>(Rp)</td> 
                <td align=\"center\" rowspan=\"2\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran<br>(Rp)</td>             
            </tr> 
            <tr>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\" >SP2D</td>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">STS</td>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">Lain - Lain</td>
                       
            </tr>           
            <tr>
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">1</td>
                <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">2</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">3</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">4</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">5</td>               
            </tr>";
           
           


                $csql= "select SUM(nilai) AS nilai FROM trhsp2d  WHERE  tgl_sp2d < '$tgl' ";
                $hasil2 = $this->db->query($csql);
                $trhsp2d2 = $hasil2->row();          
                $lcsp2d_lalu = $trhsp2d2->nilai;
                
                $csqlkasin1= "select SUM(total) AS nilai FROM trhkasin_pkd  WHERE  tgl_sts < '$tgl' ";
                $hasil3 = $this->db->query($csqlkasin1);
                $trhkasinpkd = $hasil3->row();          
                $lckasinpkd = $trhkasinpkd->nilai;
                
                $csqlkasin2= "select SUM(total) AS nilai FROM trhkasin_ppkd  WHERE  tgl_sts < '$tgl' ";
                $hasil4 = $this->db->query($csqlkasin2);
                $trhkasinppkd = $hasil4->row();          
                $lckasinppkd = $trhkasinppkd->nilai;
                
                $kasin_1= $lckasinpkd+$lckasinppkd;
                $posisi_1= $kasin_1-$lcsp2d_lalu;                                            
                
                     $sql = "SELECT * FROM(SELECT no_sp2d AS nomor,tgl_sp2d AS tgl,keperluan AS uraian,nilai AS nilai,'5' AS jns FROM trhsp2d WHERE STATUS='1'
                            UNION
                            SELECT no_sts AS nomor,tgl_sts AS tgl,keterangan AS uraian,total AS nilai,'4' AS jns FROM trhkasin_pkd 
                            UNION
                            SELECT no_sts AS nomor,tgl_sts AS tgl,keterangan AS uraian,total AS nilai,'4' AS jns FROM trhkasin_ppkd) z WHERE z.tgl='$tgl' ORDER BY z.tgl";

           
           
                                       
                    $hasil = $this->db->query($sql);       
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $no=0;
                    foreach ($hasil->result() as $row)
                    {
                       $no      =$no+1;
                       $nomor   =$row->nomor ;
                       $tgl     =$row->tgl;
                       $uraian  =$row->uraian; 
                       $nilai   =$row->nilai;
                       $jns     =$row->jns;                   
                       if ($jns==5){ 
                        $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$no</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nomor</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>
                                  </tr>";                     
                                                                    
                                $lckeluar_ini=$lckeluar_ini+$nilai;
                       }else{
                            $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$no</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nomor</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  </tr>"; 
                                   $lcterima_ini=$lcterima_ini+$nilai;
                       }           
                    }
                    $posisi_ini=$lcterima_ini-$lckeluar_ini;
                    $posisi=$posisi_1+$posisi_ini;
                 


  
                                    
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Jumlah </td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lckeluar_ini)."</td>
                </tr>";
       if ($posisi_ini<0){
                
                $cRet .="<tr>
                            <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Perubahan Posisi Kas</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi_ini)."</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                        </tr>";
        }else {
                 $cRet .="<tr>
                            <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Perubahan Posisi Kas</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi_ini)."</td>
                        </tr>";
        }       
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\"> &nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Posisi Kas (H-1)</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($kasin_1)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcsp2d_lalu)."</td>
                </tr>
        
                
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Posisi Kas (H)</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                </tr>";
        
         $cRet .="
                 <tr>&nbsp;
                    <td align=\"center\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>                                                                                                                                                                                
                </tr>
                 <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Rekapitulasi Posisi kas di BUD (Rp)</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"></td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                </tr>";
                    
         $sqlsaldo = "SELECT nm_bank as nama,saldo as nilai from saldo_bank order by kd_bank";
                $saldo = $this->db->query($sqlsaldo);
                $totsaldo=0;
                foreach ($saldo->result() as $roww)
                {
                    $nmbank = $roww->nama;
                    $rp = $roww->nilai;
                
                    $cRet .="<tr>
                                <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">Saldo di Bank $nmbank </td>
                                <td align=\"right\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"> ".number_format($rp)."</td>
                                <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                            </tr>";
                    $totsaldo=$totsaldo+$rp;
               }
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"><b>Total Saldo Kas</b></td>
                    <td align=\"right\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"><b>".number_format($totsaldo)."</b></td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"><b><u>&nbsp;</u></b></td>
                    <td align=\"center\"style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"> &nbsp;</td>
                    <td align=\"center\"  style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    
    function buku_tunai()
    {
        $data['page_title']= 'Buku Kas Tunai';
        $this->template->set('title', 'Buku Kas Tunai');   
        $this->template->load('template','tukd/transaksi/kas_tunai',$data) ; 
    }
    
    function cetak_kas_tunai()
    {
        $thn_ang = $this->session->userdata('pcThang');
        
            $bulan= $_REQUEST['tgl1'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
       
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
           
         //$tgl= '2014-02-14';//$_REQUEST['tgl1'];
         
         //$tgl_ttd= '2014-02-14';//$_REQUEST['tgl_ttd'];
                  
       
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '1.20.05.00'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

       
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"6\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU KAS TUNAI<br>BENDAHARA PENGELUARAN</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
           
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Tanggal.</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">No. BKU</td>
                <td align=\"center\" width=\"35%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan</td> 
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran</td>  
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Saldo</td>            
            </tr> ";
              $sql = "SELECT * FROM (SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan_ppkd
                        UNION
                        SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhtransout_ppkd WHERE  pay = 'TUNAI' )a where month(a.tgl)<='$bulan' ORDER BY a.tgl";
    
               
               
                                           
                        $hasil = $this->db->query($sql);       
                        $saldo=0;
                        foreach ($hasil->result() as $row)
                        {
                           $bku   =$row->bku ;
                           $tgl     =$row->tgl;
                           $uraian  =$row->ket; 
                           $nilai   =$row->jumlah;
                           $jns     =$row->jns; 
                                             
                           if ($jns==1){ 
                           $saldo=$saldo+$nilai;
                            $cRet .="<tr>
                                      <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                      </tr>";                     
                                                            
                           }else{
                                $saldo=$saldo-$nilai;
                                $cRet .="<tr>
                                      <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                      </tr>"; 
                                       
                           }           
                        }  
              
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Mengetahui:</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Pengguna Anggaran</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>&nbsp;</u></b></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"> NIP.</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    
     function buku_bank()
    {
        $data['page_title']= 'Buku Simpanan Bank';
        $this->template->set('title', 'Buku Simpanan Bank');   
        $this->template->load('template','tukd/transaksi/kas_bank',$data) ; 
    }
    
    function cetak_simpanan_bank()
    {
        $thn_ang = $this->session->userdata('pcThang');
        
            $bulan= $_REQUEST['tgl1'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
       
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
       
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '1.20.05.00'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

       
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"6\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU PEMBANTU SIMPANAN BANK<br>BENDAHARA PENGELUARAN</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">OPD</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">: PPKD</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">PERIODE</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">: $lcperiode</td>
            </tr>
            
           
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Tanggal.</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">No. BKU</td>
                <td align=\"center\" width=\"35%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan</td> 
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran</td>  
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Saldo</td>            
            </tr>  ";
            
             $sql = "SELECT * FROM (SELECT tgl_kas AS tgl,no_kas AS bku,no_sp2d AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhsp2d where jns_spp in('1','2','3')
                    UNION
                    SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhtransout_ppkd WHERE pay <>'TUNAI' )a where month(a.tgl)<='$bulan' ORDER BY a.tgl";

           
           
                                       
                    $hasil = $this->db->query($sql);       
                    $saldo=0;
                    foreach ($hasil->result() as $row)
                    {
                       $bku   =$row->bku ;
                       $tgl     =$row->tgl;
                       $uraian  =$row->ket; 
                       $nilai   =$row->jumlah;
                       $jns     =$row->jns; 
                                         
                       if ($jns==1){ 
                       $saldo=$saldo+$nilai;
                        $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                  </tr>";                     
                                                        
                       }else{
                            $saldo=$saldo-$nilai;
                            $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                  </tr>"; 
                                   
                       }           
                    }
          
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border-top:solid 1px black\">&nbsp;</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Mengetahui:</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Pengguna Anggaran</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>&nbsp;</u></b></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"> NIP.</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    
     function cari_ambilsimpanan() {
    
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = '';
        
        if ($kriteria <> ''){                               
            $where="where ( upper(no_kas) like upper('%$kriteria%') )";            
        }
        
        $sql    = "SELECT * from tr_ambilsimpanan_ppkd $where order by no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'          => $ii,        
                        'no_kas'      => $resulte['no_kas'],
                        'tgl_kas'     => $this->tukd_model->rev_date($resulte['tgl_kas']),
                        'kd_skpd'     => $resulte['kd_skpd'],
                        'nilai'       => number_format($resulte['nilai']),
                        'bank'        => $resulte['bank'],
                        'nm_rekening' => $resulte['nm_rekening'],
                        'keterangan'  => $resulte['keterangan']    
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
    
    function update_ambilsimpanan(){
        $query  = $this->input->post('st_query');
        $query1 = $this->input->post('st_query1');
        $asg    = $this->db->query($query);
        $asg1   = $this->db->query($query1);
    }
    
    function hapus_ambilsimpanan() {    	
		$no    = $this->input->post('no');
        $skpd  = $this->input->post('skpd');        
        $query = $this->db->query("delete from tr_ambilsimpanan_ppkd where no_kas='$no' and kd_skpd='$skpd' ");
        $query->free_result();
    }
    
	function ctk_koreksi_penerimaan($ctk='',$ttd='',$tgl='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$cetk = $this->uri->segment(9);
		
		
		
		if($cetk=='1'){
			$where = "where tanggal = '$tgl'";
			$where2 = "where d.tanggal <'$tgl'";
			
			$tanggala = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
		}else{
			
			
			$tgl1 = $this->uri->segment(7);
			$tgl2 = $this->uri->segment(8);
		
			$where = "where tanggal between '$tgl1' AND '$tgl2'";
			$where2 = "where d.tanggal <'$tgl1'";
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
		}
		
		
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>LAPORAN KOREKSI PENERIMAAN TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold;\">No. Urut</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">Tanggal</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"27%\" style=\"font-weight:bold\">Uraian</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
            </tr>";
			
			if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\" colspan=\"2\">Tanggal : $tanggala</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\" colspan=\"2\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
				
		$nilai3=0; 
		$sql = "SELECT * from trkasout_ppkd $where order by tanggal, [no]";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
		$nomor     = $row->no;	
		$tanggal    = $row->tanggal;	
		$keterangan  = $row->keterangan;	
		$kd_rek  = $row->kd_rek;	
		$nm_skpd  = $row->nm_skpd;	
		$nilai       = $row->nilai;
        $nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
		$nilai3=$nilai3+$nilai;

			$cRet .= '<tr>
			<td>'.$nomor.'</td>
			<td>'.$this->tanggal_format_indonesia($tanggal).'</td>
			<td>'.$nm_skpd.'<br>'.$keterangan.'</td>
			<TD align="center">'.$kd_rek.'</TD>
			<TD align="right">'.$nilaix.'</TD>
			</tr>';
			 
		} 
		
		$sql2 = "select sum(d.nilai) as nilai 
				from trkasout_ppkd d $where2";
				
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		
		if($cetk=='1'){
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="3" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}else{
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="3" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="3">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Koreksi Penerimaan</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,5,5,5,'0',$no_halaman,'');
		}
		
	}
	
	function ctk_penerimaan_non_sp2d2($ctk='',$ttd='',$tgl='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$cetk = $this->uri->segment(9);
		
		
		
		if($cetk=='1'){
			$where = "where tanggal = '$tgl'";
			$where2 = "where d.tanggal <'$tgl'";
			
			$tanggala = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
		}else{
			
			
			$tgl1 = $this->uri->segment(7);
			$tgl2 = $this->uri->segment(8);
		
			$where = "where tanggal between '$tgl1' AND '$tgl2'";
			$where2 = "where d.tanggal <'$tgl1'";
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
		}
		
		
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PEMBANTU PENERIMAAN NON SP2D TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold;\">No. Urut</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"27%\" style=\"font-weight:bold\">Uraian</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>";
			
			if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggala</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
				
		$nilai3=0; 
		$sql = "SELECT * from penerimaan_non_sp2d $where AND jenis='2'";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
		$nomor     = $row->nomor;	
		$tanggal    = $row->tanggal;	
		$keterangan  = $row->keterangan;	
		$nilai       = $row->nilai;
        $nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
		$nilai3=$nilai3+$nilai;

			$cRet .= '<tr>
			<td>'.$nomor.'</td>
			<td>'.$keterangan.'</td>
			<TD></TD>
			<TD align="right">'.$nilaix.'</TD>
			</tr>';
			 
		} 
		
		$sql2 = "select sum(d.nilai) as nilai 
				from penerimaan_non_sp2d d $where2 AND jenis='2'";
				
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		
		if($cetk=='1'){
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}else{
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan Non SP2D</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,5,5,5,'0',$no_halaman,'');
		}
		
	}

	
	function cetak_penerimaan_non_sp2d2()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN NON SP2D';
        $this->template->set('title', 'BUKU KAS PENERIMAAN NON SP2D');   
        $this->template->load('template','tukd/sp2d/ctk_penerimaan_non_sp2d2',$data) ; 
    }
	

	function cetak_koreksi_penerimaan()
    {
        $data['page_title']= 'KOREKSI PENERIMAAN';
        $this->template->set('title', 'KOREKSI PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/ctk_koreksi_penerimaan',$data) ; 
    }
	
	
	function ctk_penerimaan_non_sp2d($ctk='',$ttd='',$tgl='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$cetk = $this->uri->segment(9);
		
		
		
		if($cetk=='1'){
			$where = "where tanggal = '$tgl'";
			$where2 = "where d.tanggal <'$tgl'";
			
			$tanggala = $this->tanggal_format_indonesia($tgl);
			
			$z = strtotime("-1 day", strtotime($tgl));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
		}else{
			
			
			$tgl1 = $this->uri->segment(7);
			$tgl2 = $this->uri->segment(8);
		
			$where = "where tanggal between '$tgl1' AND '$tgl2'";
			$where2 = "where d.tanggal <'$tgl1'";
		
			$tanggal1 = $this->tanggal_format_indonesia($tgl1);
			
			$z = strtotime("-1 day", strtotime($tgl1));
			$n = date("Y-m-d", $z);
			$tanggalsbl = $this->tanggal_format_indonesia($n);
		
			$tanggal2 = $this->tanggal_format_indonesia($tgl2);
			
			$z2 = strtotime("-1 day", strtotime($tgl2));
			$n2 = date("Y-m-d", $z2);
			$tanggalsbl2 = $this->tanggal_format_indonesia($n2);
		}
		
		
		
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT TOP 1 * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PEMBANTU PENERIMAAN NON PENDAPATAN TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold;\">No. Urut</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"27%\" style=\"font-weight:bold\">Uraian</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>";
			
			if($cetk=='1'){
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggala</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}else{
					$cRet .="<tr>
						<td align=\"center\"></td>
						<td align=\"left\">Tanggal : $tanggal1 s.d $tanggal2</td>
						<td align=\"center\"></td>
						<td align=\"center\"></td>
					</tr>
					</thead>";
				}
				
		$nilai3=0; 
		$sql = "SELECT * from penerimaan_non_sp2d $where AND jenis='1'";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
		$nomor     = $row->nomor;	
		$tanggal    = $row->tanggal;	
		$keterangan  = $row->keterangan;	
		$nilai       = $row->nilai;
        $nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
		$nilai3=$nilai3+$nilai;

			$cRet .= '<tr>
			<td>'.$nomor.'</td>
			<td>'.$keterangan.'</td>
			<TD></TD>
			<TD align="right">'.$nilaix.'</TD>
			</tr>';
			 
		} 
		
		$sql2 = "select sum(d.nilai) as nilai 
				from penerimaan_non_sp2d d $where2 AND jenis='1'";
				
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		
		if($cetk=='1'){
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggala.' </TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}else{
			$cRet .= '
			<tr>
				<TD></TD>
				<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' &nbsp; s.d '.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$nilai3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
				<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;"></TD>
				<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'.$tanggal2.' &nbsp;</TD>
				<TD align="right" >'.$totalx.'</TD>
			</tr>';
		}
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Kuasa Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan Non SP2D</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,5,5,5,'0',$no_halaman,'');
		}
		
	}

	
	
    // tambahan  by tox
	function config_bank2(){
		$sql = "SELECT * from ms_bank order by kode";
        $query1 = $this->db->query($sql);
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_bank' => $resulte['kode'],
                        'nama_bank' => $resulte['nama']                                                                                        
                        );
                        $ii++;
        }
		echo json_encode($result);
    	$query1->free_result();   
	}
	
	
	
    function cek_lpj () { 
     	$nlpj = $this->input->post('nlpj');     
      	$sql = "select count(*)as jml from trlpj where no_lpj='$nlpj' ";    
    	$query1 = $this->db->query($sql);
            $config = $query1->row();        
            $result = array('jml' =>$config->jml);
    						
            echo json_encode($result);
            $query1->free_result(); 
	}
	
     function load_lpj_tu() {
		 $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
       $kriteria = '';
        $kriteria = $this->input->post('cari');
		$id  = $this->session->userdata('pcUser');        
        $where =" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') and (upper(no_lpj) like upper('%$kriteria%') or tgl_lpj like '%$kriteria%' or kd_skpd like '%$kriteria%')";            
        }
        
        $sql = "SELECT count(*) as tot from trhlpj WHERE jenis='3' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        $sql = " SELECT TOP $rows *,(SELECT a.nm_skpd FROM ms_skpd a where a.kd_skpd=b.kd_skpd) as nm_skpd FROM trhlpj b WHERE jenis = '3' $where 
		AND no_lpj NOT IN (SELECT TOP $offset no_lpj FROM trhlpj WHERE jenis='3' $where order by tgl_lpj, no_lpj)
		order by tgl_lpj, no_lpj";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte) { 
        $row[] = array(
			'id' => $ii,
						'kd_skpd'    => $resulte['kd_skpd'],      
						'nm_skpd'    => $resulte['nm_skpd'],                          
                        'ket'   => $resulte['keterangan'],
                        'no_lpj'   => $resulte['no_lpj'],
                        'no_sp2d'   => $resulte['no_sp2d'],
                        'tgl_lpj'      => $resulte['tgl_lpj'],
                        'status'      => $resulte['status']												
                        );
			$ii++;
        }
		 $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();
	}
	
	
	function cetaklpjtu_ag(){
		
		$cskpd 		=   $this->uri->segment(5);
		$cetak 		=   $this->uri->segment(6);
        $no_sp2d	= 	str_replace('abcdefghij','/',$this->uri->segment(3));
        $no_lpj		=	str_replace('abcdefghij','/',$this->uri->segment(8));
		$ttd1   	= 	str_replace('a',' ',$this->uri->segment(4));

          $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$cskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
       
		/*		
				
		$sql1="SELECT LEFT(kd_kegiatan,18) as kd_program,nm_program,kd_kegiatan,nm_kegiatan
			   FROM trhspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp AND a.kd_skpd=b.kd_skpd WHERE no_sp2d = '$no_sp2d'";
		*/
		
		
		
				$sql1="SELECT LEFT(c.kd_kegiatan,18) as kd_program,nm_program,c.kd_kegiatan,c.nm_kegiatan
				FROM trhspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp AND a.kd_skpd=b.kd_skpd 
				join trdspp c ON a.no_spp = c.no_spp AND a.kd_skpd=c.kd_skpd 
				WHERE no_sp2d = '$no_sp2d' group by nm_program,c.kd_kegiatan,
				c.nm_kegiatan,LEFT(c.kd_kegiatan,18) ";
				
		$sql2=$this->db->query($sql1);
                 foreach ($sql2->result() as $row)
                {
                    $kd_kegiatan     = $row->kd_kegiatan;
                    $nm_kegiatan     = $row->nm_kegiatan;
					$kd_program      = $row->kd_program;
                    $nm_program      = $row->nm_program;
                }	   
			   
			   
		$cRet  =" <table style=\"border-collapse:collapse;font-size:14px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' ><b>PEMERINTAH PROVINSI KALIMANTAN BARAT</b></td>
					</tr>
					<tr>
						<td align='center'><b>LAPORAN PERTANGGUNG JAWABAN TAMBAHAN UANG (TU)</b></td>
					</tr>
					<tr>
						<td align='center'><b>BENDAHARA PENGELUARAN</b></td>
					</tr>
					<tr>
						<td align='center'>&nbsp;</td>
					</tr>
					</table>				
				";

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='left' width='15%'> OPD&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' > ".$cskpd.", ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
					</tr>
					<tr>
						<td valign='top' align='left' width='15%'>Program&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' >".$kd_program.", ".$nm_program."</td>
					</tr>
					<tr>
						<td valign='top' align='left' width='15%'>Kegiatan&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' >".$kd_kegiatan.", ".$nm_kegiatan."</td>
					</tr>
					
					<tr>
						<td valign='top' align='left' width='15%'>No SP2D &nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' >".$no_sp2d."</td>
					</tr>
					
					</table>
				<br/>					
				";		

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<thead>
					<tr>
						<td align='center' bgcolor='#CCCCCC' width='30%'>KODE REKENING</td>
						<td align='center' bgcolor='#CCCCCC' width='50%'>URAIAN</td>
						<td align='center' bgcolor='#CCCCCC' width='20%'>JUMLAH</td>
					</tr>
					</thead>
				";		


				$sql = "SELECT
						kd_rek5,nm_rek5,SUM(nilai) as nilai
						FROM
							trlpj c
						LEFT JOIN trhlpj d ON c.no_lpj = d.no_lpj AND c.kd_skpd=d.kd_skpd
						WHERE
						c.no_lpj = '$no_lpj' AND d.kd_skpd='$cskpd'
						GROUP BY kd_rek5,nm_rek5 order by kd_rek5,nm_rek5";
				$query1 = $this->db->query($sql);  	
				foreach($query1->result_array() as $resulte){ 
						$kd_rek5=$resulte["kd_rek5"];
						$nm_rek5=$resulte["nm_rek5"];
						$nilai=number_format($resulte["nilai"],"2",",",".");
						$cRet .="
									<tr>
										<td align='left' >$kd_rek5</td>
										<td align='left' >$nm_rek5</td>
										<td align='right' >$nilai</td>
									</tr>					
							";
						}
						
				$sql = "SELECT
						SUM(nilai) nilai
						FROM
							trlpj c
						LEFT JOIN trhlpj d ON c.no_lpj = d.no_lpj
						WHERE
						c.no_lpj = '$no_lpj'";		
				$query1 = $this->db->query($sql);  	
				foreach($query1->result_array() as $resulte){ 
						$total=$resulte["nilai"];
						}

				$sqlp = "SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						 WHERE b.kd_skpd='$cskpd' AND b.jns_spp=3 AND  no_sp2d = '$no_sp2d' ";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}
				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total,"2",",",".")."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Tambahan Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan,"2",",",".")."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Tambahan Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total,"2",",",".")."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				

 		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='center' width='50%'>Mengetahui <br> $jabatan	</td>
						<td valign='top' align='center' width='50%'>$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> Telah diverifikasi<br>Petugas</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'><b><u>$nama</u></b><br>$pangkat</td>
						<td valign='top' align='center' width='50%'>__________________</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>$nip</td>
						<td valign='top' align='center' width='50%'></td>
					</tr>
				  </table>
				";	

        $data['prev']= $cRet;    
      if($cetak==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>LPJ TU</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'0',0,'');
}
     } 
	 
	function load_lpj_up() {
		 $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
       $kriteria = '';
        $kriteria = $this->input->post('cari');
		$id  = $this->session->userdata('pcUser');        
        $where =" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') and (upper(no_lpj) like upper('%$kriteria%') or tgl_lpj like '%$kriteria%' or kd_skpd like '%$kriteria%')";            
        }
        
        $sql = "SELECT count(*) as tot from trhlpj WHERE jenis='1' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = " SELECT TOP $rows *,(SELECT a.nm_skpd FROM ms_skpd a where a.kd_skpd=b.kd_skpd) as nm_skpd FROM trhlpj b WHERE jenis = '1' $where 
		AND no_lpj NOT IN (SELECT TOP $offset no_lpj FROM trhlpj WHERE jenis='1' $where order by tgl_lpj, no_lpj)
		order by tgl_lpj, no_lpj";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte) { 
        $row[] = array(
			'id' => $ii,
			'kd_skpd'    => $resulte['kd_skpd'],      
			'nm_skpd'    => $resulte['nm_skpd'],                          
			'ket'   => $resulte['keterangan'],
			'no_lpj'   => $resulte['no_lpj'],
			'no_sp2d'   => $resulte['no_sp2d'],
			'tgl_lpj'      => $resulte['tgl_lpj'],
			'status'      => $resulte['status']												
			);
			$ii++;
        }
		 $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();
		
	}
	
	function load_lpj_up_ang() {
		 $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
       $kriteria = '';
        $kriteria = $this->input->post('cari');
		$id  = $this->session->userdata('pcUser');        
        $where =" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') and (upper(no_lpj) like upper('%$kriteria%') or tgl_lpj like '%$kriteria%' or kd_skpd like '%$kriteria%')";            
        }
        
        $sql = "SELECT count(*) as tot from trhlpj WHERE jenis2='1' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = " SELECT TOP $rows *,(SELECT a.nm_skpd FROM ms_skpd a where a.kd_skpd=b.kd_skpd) as nm_skpd FROM trhlpj b WHERE jenis2 = '1' $where 
		AND no_lpj NOT IN (SELECT TOP $offset no_lpj FROM trhlpj WHERE jenis2='1' $where order by tgl_lpj, no_lpj)
		order by tgl_lpj, no_lpj";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte) { 
        $row[] = array(
			'id' => $ii,
			'kd_skpd'    => $resulte['kd_skpd'],      
			'nm_skpd'    => $resulte['nm_skpd'],                          
			'ket'   => $resulte['keterangan'],
			'no_lpj'   => $resulte['no_lpj'],
			'no_sp2d'   => $resulte['no_sp2d'],
			'tgl_lpj'      => $resulte['tgl_lpj'],
			'status'      => $resulte['status2']												
			);
			$ii++;
        }
		 $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();
		
	}
	
	
	function cetaklpjup_ag(){
		
		$cskpd  = $this->uri->segment(4);
        $ttd1   = str_replace('a',' ',$this->uri->segment(3));
        $ttd2   = str_replace('a',' ',$this->uri->segment(6));
		$ctk    =   $this->uri->segment(5);
        $nomor1 = str_replace('abcdefghij','/',$this->uri->segment(7));
        $nomor  = str_replace('123456789',' ',$nomor1);
		$jns    =   $this->uri->segment(8);
		$spasi    =   $this->uri->segment(9);
		$lctgl1 = $this->rka_model->get_nama2($nomor,'tgl_awal','trhlpj','no_lpj','kd_skpd',$cskpd);
		$lctgl2 = $this->rka_model->get_nama2($nomor,'tgl_akhir','trhlpj','no_lpj','kd_skpd',$cskpd);
		$lctglspp = $this->rka_model->get_nama2($nomor,'tgl_lpj','trhlpj','no_lpj','kd_skpd',$cskpd);

          
        $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$cskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                 }
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        /* $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where kd_skpd='$cskpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                } */
		$cRet  =" <table style=\"border-collapse:collapse;font-size:15px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='center'> <b>$kab</b></td>
    					</tr>
    					<tr>
    						<td align='center'><b>LAPORAN PERTANGGUNG JAWABAN UANG PERSEDIAAN</b></td>
    					</tr>
						<tr>
    						<td align='center'></td>
    					</tr>
    					<tr>
    						<td align='center'></td>
    					</tr>
						<tr>
    						<td align='center'><b>&nbsp;</b></td>
    					</tr>
		          </table>				
				";

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='left' width='10%'> OPD&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
    					</tr>
    					<tr>
    						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
    					</tr>
		           </table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"$spasi\" cellpadding=\"$spasi\">
					<THEAD>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>NO</b></td>
						<td bgcolor='#CCCCCC' align='center' width='30%'><b>KODE REKENING</b></td>
						<td bgcolor='#CCCCCC' align='center' width='50%'><b>URAIAN</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>JUMLAH</b></td>
					</tr>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>1</b></td>
						<td bgcolor='#CCCCCC' align='center' width='30%'><b>2</b></td>
						<td bgcolor='#CCCCCC' align='center' width='50%'><b>3</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>4</b></td>
					</tr>
					</THEAD>
				";		
			
				if($jns=='0'){
				$sql = "SELECT 1 as urut, LEFT(a.kd_kegiatan,18) as kode, b.nm_program as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN (SELECT DISTINCT kd_program,nm_program,kd_skpd FROM trskpd GROUP BY kd_program,nm_program,kd_skpd)b 
						ON LEFT(a.kd_kegiatan,18) =b.kd_program AND a.kd_skpd=b.kd_skpd
						WHERE a.no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY LEFT(a.kd_kegiatan,18), b.nm_program
						UNION ALL
						SELECT 2 as urut, a.kd_kegiatan as kode, b.nm_kegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY a.kd_kegiatan, b.nm_kegiatan
						UNION ALL
						SELECT 3 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,2) as kode, b.nm_rek2 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,2), b.nm_rek2
						UNION ALL
						SELECT 4 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,3) as kode, b.nm_rek3 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,3), b.nm_rek3
						UNION ALL
						SELECT 5 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,5) as kode, b.nm_rek4 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,5), b.nm_rek4
						UNION ALL
						SELECT 6 as urut, kd_kegiatan+'.'+kd_rek5 as kode, nm_rek5 as uraian, SUM(nilai) as nilai FROM trlpj
						WHERE no_lpj='$nomor' AND kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_kegiatan, kd_rek5, nm_rek5
						ORDER BY kode";		
				$query1 = $this->db->query($sql); 
				$total=0;
				$i=0;
				foreach ($query1->result() as $row) {
                    $kode=$row->kode;                    
                    $urut=$row->urut;                    
                    $uraian= $row->uraian;
                    $nilai  = $row->nilai;
					
					if ($urut==1){
					$i=$i+1;	
						$cRet .="<tr>
									<td valign='top' align='center' ><i><b>$i</b></i></td>
									<td valign='top' align='left' ><i><b>$kode</b></i></td>
									<td valign='top' align='left' ><i><b>$uraian</b></i></td>
									<td valign='top' align='right'><i><b>".number_format($nilai,"2",",",".")."</b></i></td>
								</tr>";
					} else if ($urut==2){
							$cRet .="<tr>
									<td valign='top' align='center' ><b></b></td>
									<td valign='top' align='left' ><b>$kode</b></td>
									<td valign='top' align='left' ><b>$uraian</b></td>
									<td valign='top' align='right'><b>".number_format($nilai,"2",",",".")."</b></td>
								</tr>";
					}else if ($urut==6){
							$total=$total+$nilai;
							$cRet .="<tr>
									<td valign='top' align='center' ></td>
									<td valign='top' align='left' >$kode</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right'>".number_format($nilai,"2",",",".")."</td>
								</tr>";
					}
					else{
						$cRet .="<tr>
									<td valign='top' align='left' ></td>
									<td valign='top' align='left' >$kode</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right' >".number_format($nilai,"2",",",".")."</td>
								</tr>";	
					}

				}
				} else{
				$sql = "SELECT 1 as urut, LEFT(a.kd_kegiatan,18) as kode, b.nm_program as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN (SELECT DISTINCT kd_program,nm_program,kd_skpd FROM trskpd GROUP BY kd_program,nm_program,kd_skpd)b 
						ON LEFT(a.kd_kegiatan,18) =b.kd_program AND a.kd_skpd=b.kd_skpd
						WHERE a.no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY LEFT(a.kd_kegiatan,18), b.nm_program
						UNION ALL
						SELECT 2 as urut, a.kd_kegiatan as kode, b.nm_kegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						AND (panjar NOT IN ('3') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY a.kd_kegiatan, b.nm_kegiatan
						ORDER BY kode";		
				$query1 = $this->db->query($sql); 
				$total=0;
				$i=0;
				foreach ($query1->result() as $row) {
                    $kode=$row->kode;                    
                    $urut=$row->urut;                    
                    $uraian= $row->uraian;
                    $nilai  = $row->nilai;
					
					if ($urut==1){
					$i=$i+1;	
						$cRet .="<tr>
									<td valign='top' align='center' ><b>$i</b></td>
									<td valign='top' align='left' ><b>$kode</b></td>
									<td valign='top' align='left' ><b>$uraian</b></td>
									<td valign='top' align='right'><b>".number_format($nilai,"2",",",".")."</b></td>
								</tr>";
					} else{
						$total=$total+$nilai;
						$cRet .="<tr>
									<td valign='top' align='left' ></td>
									<td valign='top' align='left' >$kode</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right' >".number_format($nilai,"2",",",".")."</td>
								</tr>";	
					}

				}	
				}


				$sqlp = " SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						  WHERE b.kd_skpd='$cskpd' AND (b.jns_spp=1)";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total,"2",",",".")."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan,"2",",",".")."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total,"2",",",".")."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				
//.$this->tukd_model->tanggal_format_indonesia($this->uri->segment(7)).
 		$cRet .=" <table width='100%' style='font-size:12px' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='center' width='50%'>Disetujui 	
						<br>Kuasa Bendahara Umum Daerah</td>
						<td valign='top' align='center' width='50%'>Pontianak, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
						<br>Telah diverifikasi
						<br>Petugas</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'><b><u>$nama</u></b><br>$pangkat</td>
						<td align='center' width='50%'>___________________<br></td>
					</tr>
					<tr>
						<td align='center' width='50%'>$ttd1</td>
						<td align='center' width='50%'></td>
					</tr>
				  </table>
				";		

        $data['prev']= $cRet; 

		switch ($ctk)
        {
            case 0;
			   echo ("<title> LPJ UP</title>");
				echo $cRet;		
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'0',0,'');
               break;
		}
	}
	
	function cetaklpjup_ag_rinci(){
		
		$cskpd  = $this->uri->segment(4);
        $ttd1   = str_replace('a',' ',$this->uri->segment(3));
        $ttd2   = str_replace('a',' ',$this->uri->segment(6));
		$ctk =   $this->uri->segment(5);
        $nomor   = str_replace('abcdefghij','/',$this->uri->segment(7));
        $nomor   = str_replace('123456789',' ',$nomor);
		$kegiatan =   $this->uri->segment(8);
		$spasi =   $this->uri->segment(9);
		$lctgl1 = $this->tukd_model->get_nama($nomor,'tgl_awal','trhlpj','no_lpj');
		$lctgl2 = $this->tukd_model->get_nama($nomor,'tgl_akhir','trhlpj','no_lpj');
		$lctglspp = $this->tukd_model->get_nama($nomor,'tgl_lpj','trhlpj','no_lpj');

          
        $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$cskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                 }
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        /* $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where kd_skpd='$cskpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                } */
		$cRet  =" <table style=\"border-collapse:collapse;font-size:15px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='center'> <b>$kab</b></td>
    					</tr>
    					<tr>
    						<td align='center'><b>LAPORAN PERTANGGUNG JAWABAN UANG PERSEDIAAN</b></td>
    					</tr>
    					<tr>
    						<td align='center'></td>
    					</tr>
						<tr>
    						<td align='center'><b>&nbsp;</b></td>
    					</tr>
		          </table>				
				";

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='left' width='10%'>OPD&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
    					</tr>
    					<tr>
    						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
    					</tr>
						<tr>
    						<td align='left' width='10%'>Kegiatan&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' >$kegiatan - ".$this->tukd_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan')."</td>
    					</tr>
						<tr>
    						<td align='left' width='10%'>&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' ></td>
    					</tr>
		           </table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"$spasi\" cellpadding=\"$spasi\">
					<THEAD>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>NO</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>KODE REKENING</b></td>
						<td bgcolor='#CCCCCC' align='center' width='60%'><b>URAIAN</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>JUMLAH</b></td>
					</tr>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>1</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>2</b></td>
						<td bgcolor='#CCCCCC' align='center' width='60%'><b>3</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>4</b></td>
					</tr>
					</THEAD>
				";		
			
				
				$sql = "SELECT 1 as urut, a.kd_kegiatan as kode, a.kd_kegiatan as rek, b.nm_kegiatan as uraian, SUM(a.nilai) as nilai
						,'' [tgl_bukti],0 [no_bukti]
						FROM trlpj a LEFT JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd
						INNER JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						AND (c.panjar NOT IN('3') or c.panjar IS NULL)
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY a.kd_kegiatan, b.nm_kegiatan
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,2) as kode, LEFT(a.kd_rek5,2) as rek,  nm_rek2 as uraian, SUM(nilai) as nilai,
						'' [tgl_bukti],0 [no_bukti] FROM trlpj a
						INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2
						INNER JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						AND (c.panjar NOT IN('3') or c.panjar IS NULL)
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,2), nm_rek2
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,3) as kode, LEFT(a.kd_rek5,3) as rek,  nm_rek3 as uraian, SUM(nilai) as nilai,
						'' [tgl_bukti],0 [no_bukti] FROM trlpj a
						INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3
						INNER JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						AND (c.panjar NOT IN('3') or c.panjar IS NULL)
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,3), nm_rek3
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,5) as kode, LEFT(a.kd_rek5,5) as rek,  nm_rek4 as uraian, SUM(nilai) as nilai 
						,'' [tgl_bukti],0 [no_bukti] FROM trlpj a
						INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4
						INNER JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						AND (c.panjar NOT IN('3') or c.panjar IS NULL)
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,5), nm_rek4
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+kd_rek5 as kode, kd_rek5 as rek,  nm_rek5 as uraian, SUM(nilai) as nilai
						,'' [tgl_bukti],0 [no_bukti]
						FROM trlpj a
						INNER JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						AND (c.panjar NOT IN('3') or c.panjar IS NULL)
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, kd_rek5, nm_rek5
						UNION ALL
						SELECT 3 as urut, a.kd_kegiatan+'.'+a.kd_rek5+'.1' as kode,'' as rek, c.ket+' \\ No BKU: '+a.no_bukti as uraian, sum(a.nilai) as nilai,
						c.tgl_bukti,a.no_bukti 
						FROM trlpj a 
						INNER JOIN trhlpj b ON a.no_lpj=b.no_lpj AND a.kd_skpd=b.kd_skpd
						INNER JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						AND (c.panjar NOT IN('3') or c.panjar IS NULL)
						WHERE a.no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY a.kd_kegiatan, a.kd_rek5, nm_rek5,a.nilai,a.no_bukti, ket,tgl_bukti
						ORDER BY kode,tgl_bukti,no_bukti	";		
				$query1 = $this->db->query($sql); 
				$total=0;
				$i=0;
				foreach ($query1->result() as $row) {
                    $kode=$row->kode;                    
                    $rek=$row->rek;                    
                    $urut=$row->urut;                    
                    $uraian= $row->uraian;
                    $nilai  = $row->nilai;
					
					if ($urut==1){
					$i=$i+1;	
						$cRet .="<tr>
									<td valign='top' align='center' ><i><b>$i</b></i></td>
									<td valign='top' align='left' ><i><b>$kode</b></i></td>
									<td valign='top' align='left' ><i><b>$uraian</b></i></td>
									<td valign='top' align='right'><i><b>".number_format($nilai,"2",",",".")."</b></i></td>
								</tr>";
					} else if ($urut==2){
							$cRet .="<tr>
									<td valign='top' align='center' ><b></b></td>
									<td valign='top' align='left' ><b>$kode</b></td>
									<td valign='top' align='left' ><b>$uraian</b></td>
									<td valign='top' align='right'><b>".number_format($nilai,"2",",",".")."</b></td>
								</tr>";
					}else{
						$total=$total+$nilai;
						$cRet .="<tr>
									<td valign='top' align='left' ></td>
									<td valign='top' align='left' >$rek</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right' >".$this->rp_minus($nilai)."</td>
								</tr>";	
					}

				}
				

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total,"2",",",".")."</b></td>
						</tr>					
						
					    ";


				$cRet .="</table><p>";				
//.$this->tukd_model->tanggal_format_indonesia($this->uri->segment(7)).
 		$cRet .=" <table width='100%' style='font-size:12px' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='center' width='50%'>Disetujui 	
						<br>Kuasa Bendahara Umum Daerah</td>
						<td valign='top' align='center' width='50%'>Pontianak, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
						<br>Telah diverifikasi
						<br>Petugas</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'><b><u>$nama</u></b><br>$pangkat</td>
						<td align='center' width='50%'>___________________<br></td>
					</tr>
					<tr>
						<td align='center' width='50%'>$ttd1</td>
						<td align='center' width='50%'></td>
					</tr>
				  </table>
				";		

        $data['prev']= $cRet; 

		switch ($ctk)
        {
            case 0;
			   echo ("<title> LPJ UP</title>");
				echo $cRet;		
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'0',0,'');
               break;
		}
	}
	
	function load_giat_lpj(){

		$nomor = $this->input->post('lpj');
        $query1 = $this->db->query("
		select a.kd_kegiatan, c.nm_kegiatan
		from trlpj a 
		INNER JOIN trhlpj b ON a.no_lpj=b.no_lpj AND a.kd_skpd=b.kd_skpd
		LEFT JOIN trskpd c ON a.kd_kegiatan=c.kd_kegiatan AND a.kd_skpd=c.kd_skpd
		WHERE a.no_lpj = '$nomor'
		GROUP BY a.kd_kegiatan,c.nm_kegiatan
		ORDER BY a.kd_kegiatan");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],                       
                        'nm_kegiatan' => $resulte['nm_kegiatan']                      
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
	
	
	function select_data1_lpj_ag($lpj='') {

    $lpj = $this->input->post('lpj');
    $kdskpd = $this->input->post('kdskpd');
   
   
        $sql = "SELECT a.kd_skpd, a.no_bukti, a.no_lpj,a.kd_kegiatan,a.kd_rek5,a.nm_rek5, a.nilai FROM trlpj a WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'
		order by no_bukti";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'idx'        => $ii, 						
                        'no_bukti' => $resulte['no_bukti'],     
                        'kdkegiatan' => $resulte['kd_kegiatan'],     
                        'kdrek5'     => $resulte['kd_rek5'],  
                        'nmrek5'     => $resulte['nm_rek5'], 						 
                        'nilai1'      => number_format($resulte['nilai'])

                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
	
	function setuju_lpj() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status='2' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '2';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	function setuju_lpj_ang() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status2='2' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '2';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	
	function setuju_lpj_tu() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status='1' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '2';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	function batal_lpj() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status='0' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	function batal_lpj_ang() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status2='0' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	
	function ambil_nilai_anggaran() {
	// created by TOX
    $kegi = $this->input->post('kegi');
    $rek = $this->input->post('rek');   
   
        $sql = "SELECT nilai,nilai_ubah FROM trdrka WHERE kd_kegiatan='$kegi' and kd_rek5='$rek'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'idx'       => $ii, 					
                        'nilai_ssn' => number_format($resulte['nilai']), 						 
                        'nilai_ubh' => number_format($resulte['nilai_ubah'])
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
	function ambil_nilai_sp2d_tu() {
	// created by TOX
    $sp2d = $this->input->post('sp2d');
	
    $kegi = $this->input->post('kegi');
    $rek = $this->input->post('rek');   
   
        $sql = "select d.nilai from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm 
					inner join trhspp c on b.no_spp =c.no_spp inner join trdspp d on c.no_spp=d.no_spp 
					where a.no_sp2d='$sp2d' and d.kd_kegiatan='$kegi' and d.kd_rek5='$rek' ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
                       $result[] = array(
                        'idx'        => $ii, 					 						 
                        'nilai_sp2d' => number_format($resulte['nilai'])
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
		 function simpan_hlpj_tu(){
		$kdskpd  =$this->input->post('kode');
		$nlpj = $this->input->post('nlpj');
		
		$nsp2d = $this->input->post('sp2d');
		$ntgllpj = $this->input->post('tgllpj');
		
		$cket = $this->input->post('ket');
		
    	$csql = "INSERT INTO trhlpj (no_lpj,kd_skpd,keterangan,tgl_lpj,status,jenis,no_sp2d) values ('$nlpj','$kdskpd','$cket','$ntgllpj','0','3','$nsp2d')";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }
	
	
	   function update_lpj(){
		$nlpj = $this->input->post('nlpj');
		$ntgllpj = $this->input->post('tgllpj');
		$cket = $this->input->post('ket');
		$kdskpd  = $this->input->post('kode');
		$xnnmrek = $this->input->post('cnnmrek');
		$xnnilai = $this->input->post('cnnilai');

		$xnkdgiat = $this->input->post('cnkdgiat'); 
		$xnkdrek = $this->input->post('cnkdrek');

		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama');  	
		$kdkegiatan = $this->left($xnkdgiat,21);



		

        $csql = "delete from trlpj where no_lpj= '$nlpj' and no_bukti= '$nbukti' ";
    	$query1 = $this->db->query($csql);
    
    
	
    	$csql = "INSERT INTO trlpj (no_lpj,no_bukti,tgl_lpj,keterangan,kd_rek5,username,tgl_update,nm_rek5,nilai,kd_skpd,kd_kegiatan) values ('$nlpj','','$ntgllpj','$cket','$xnkdrek','$user','$cwaktu','$xnnmrek','$xnnilai','$kdskpd','$xnkdgiat')";
    	
    	$query1 = $this->db->query($csql);
	
		
		
        if ( $query1 > 0 ){
           echo '2';
        } else {
           echo '0';
        }
    
    }
		
		function update_hlpj(){
		$kdskpd  = $this->session->userdata('kdskpd');	
		$nlpj = $this->input->post('nlpj');
		$nlpj_hide = $this->input->post('nlpj_hide');
		$nsp2d = $this->input->post('sp2d');
		$ntgllpj = $this->input->post('tgllpj');
		$cket = $this->input->post('ket');
		
         $csql = "delete from trhlpj where no_lpj= '$nlpj' ";
    	$query1 = $this->db->query($csql);
	
    	$csql = "update trhlpj set no_lpj='$nlpj',kd_skpd='$kdskpd',keterangan='$cket',tgl_lpj='$ntgllpj',status='0',no_sp2d='$nsp2d' where no_lpj='$nlpj_hide'";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }	
			
	  function simpan_lpj_tu(){
	  
		$kdskpd  = $this->input->post('kode');
		$nlpj = $this->input->post('nlpj');
		$ntgllpj = $this->input->post('tgllpj');
		$cket = $this->input->post('ket');
		
		$xnkdgiat = $this->input->post('cnkdgiat');
		$xnkdrek = $this->input->post('cnkdrek');
		$xnnmrek = $this->input->post('cnnmrek');
		$xnnilai = $this->input->post('cnnilai');
		
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama');  		
        
    	$csql = "INSERT INTO trlpj (no_lpj,no_bukti,tgl_lpj,keterangan,kd_rek5,username,tgl_update,nm_rek5,nilai,kd_skpd,kd_kegiatan) values ('$nlpj','','$ntgllpj','$cket','$xnkdrek','$user','$cwaktu','$xnnmrek','$xnnilai','$kdskpd','$xnkdgiat')";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }
		
	  function dsimpan_lpj()
	{
	       $no_lpj      = $this->input->post('cnolpj');
           $vno_bukti   = $this->input->post('cnobukti');
                        
           $sql = "delete from trlpj where no_lpj='$no_lpj' and no_bukti='$vno_bukti' ";
           $asg = $this->db->query($sql);

           echo '1';
	}
		
  function hhapuslpj() {    	
		$nomor = $this->input->post('no');        
        $query = $this->db->query("delete from trlpj where no_lpj='$nomor'");
        $query = $this->db->query("delete from trhlpj where no_lpj='$nomor'");
         $query->free_result();
    }
    
	
    function sp2d_tu_list() {

        $skpd  = $this->input->post('kode');
        $v_ats_beban  = $this->input->post('v_ats_beban');
        $sql   = " select no_sp2d, tgl_sp2d from trhsp2d where kd_skpd='$skpd' and jns_spp='$v_ats_beban'";
       // $sql   = " select no_spd, tgl_spd from trhspd ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'tgl_sp2d' => $resulte['tgl_sp2d']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
		
	function load_transaksi_sp2d_tu() {
    
        $kdskpd = $this->input->post('kode');
        $sp2d = $this->input->post('sp2d');

        $sql    = "select d.kd_kegiatan,f.nm_kegiatan,d.kd_rek5,d.nm_rek5,d.nilai from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm 
					inner join trhspp c on b.no_spp =c.no_spp inner join trdspp d on c.no_spp=d.no_spp inner join ms_rek5 e on d.kd_rek5=e.kd_rek5
					inner join m_giat f on d.kd_kegiatan=f.kd_kegiatan where a.no_sp2d='$sp2d' and a.kd_skpd='$kdskpd' 
					ORDER BY d.kd_kegiatan, d.kd_rek5"; 
			
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'idx' => $ii,
                        'kdkegiatan' => $resulte['kd_kegiatan'],
                        'nmkegiatan' => $resulte['nm_kegiatan'],       
                        'kdrek5'     => $resulte['kd_rek5'],  
                        'nmrek5'     => $resulte['nm_rek5'],  
                        'nilai1'     => number_format($resulte['nilai']),
                        );
                        $ii++;
        }
           echo json_encode($result);
           $query1->free_result();
    }
	
	function load_jenis_beban($jenis='') {
     if ($jenis==3){
		$result = array(( 
						array(
						"id"   => 1 ,
						"text" => " TU",
						"selected"=>true
						) 
					) 
				);
		 
	 } else if($jenis==4){
		$result = array(( 
						array(
						"id"   => 1 ,
						"text" => " Gaji & Tunjangan"
						) 
					) ,
						( 
						array( 
					  "id"   => 2 ,
					  "text" => " Kespeg"
						) 
					),
						( 
						array( 
					  "id"   => 3 ,
					  "text" => " Uang Makan"
						) 
					),
						( 
						array( 
					  "id"   => 4 ,
					  "text" => " Upah Pungut"
						) 
					),
						( 
						array( 
					  "id"   => 5 ,
					  "text" => " Upah Pungut PBB"
						) 
					),
						( 
						array( 
					  "id"   => 6 ,
					  "text" => " Upah Pungut PBB-KB PKB & BBN-KB"
						) 
					),
						( 
						array( 
					  "id"   => 7 ,
					  "text" => " Tambahan/Kekurangan Gaji & Tunjangan"
						) 
					),
						( 
						array( 
					  "id"   => 8 ,
					  "text" => " Tunjangan Transport"
						) 
					),
						( 
						array( 
					  "id"   => 9 ,
					  "text" => " Tunjangan Lainnya"
						) 
					)
				);          
	 } else if($jenis==6){
		$result = array(( 
						array(
						"id"   => 1 ,
						"text" => " LS Rutin (PNS)"
						) 
					) ,
						( 
						array( 
					  "id"   => 2 ,
					  "text" => " LS Rutin (Non PNS)"
						) 
					),
						( 
						array( 
					  "id"   => 3 ,
					  "text" => " LS Pihak Ketiga"
						) 
					)
					
				);          
			}
		echo json_encode($result);
			   
			
			 }
			 
	function config_tahun() {
        $result = array();
         $tahun  = $this->session->userdata('pcThang');
		 $result = $tahun;
         echo json_encode($result);
    	   
	}

    function kartu_kendali()
    {
        $data['page_title']= 'CETAK KARTU KENDALI';
        $this->template->set('title', 'CETAK KARTU KENDALI');   
        $this->template->load('template','tukd/sp2d/kartu_kendali',$data) ; 
    }
	
    function pgiat($cskpd='') {
        
        $sql = "SELECT a.kd_sub_kegiatan,b.nm_sub_kegiatan FROM trskpd a INNER JOIN ms_sub_kegiatan b ON a.kd_sub_kegiatan=b.kd_sub_kegiatan
         where a.kd_skpd='$cskpd' order by a.kd_sub_kegiatan";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_sub_kegiatan' => $resulte['kd_sub_kegiatan'],  
                        'nm_sub_kegiatan' => $resulte['nm_sub_kegiatan'],  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	

   function cetak_kartu_kendali_kegi($dcetak='',$ttd='',$skpd='',$kd_kegi='',$dcetak2=''){

	$print = $this->uri->segment(8);

	$prog=substr($kd_kegi,0,7);

			 
			$cRet ="<table style=\"border-collapse:collapse;font-weight:bold;font-family:arial; font-size:12px\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr >
                <td width=\"100%\" align=\"center\" colspan=2 style=\"font-size:18px\">KARTU KENDALI KEGIATAN<br> <br></td></tr>
					 <TR  width=\"100%\">
						<TD align=\"left\" >OPD</TD>
						<TD align=\"left\" >: ".$skpd." - ".$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Nama Program</TD>
						<TD align=\"left\"  >: ".$prog." - ".$this->tukd_model->get_nama($prog,'nm_program','trskpd','kd_program')."</TD>
					 </TR>
					 
					 <TR>
						<TD align=\"left\">Nama Kegiatan</TD>
						<TD align=\"left\"  >: ".$kd_kegi." - ".$this->tukd_model->get_nama($kd_kegi,'nm_sub_kegiatan','trskpd','kd_sub_kegiatan')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" >Periode</TD>
						<TD align=\"left\" >: ".$this->tukd_model->tanggal_format_indonesia($dcetak)." s/d ".$this->tukd_model->tanggal_format_indonesia($dcetak2)."</TD>
					 </TR>
					 </TABLE>";

			$cRet .=" <table style=\"border-collapse:collapse;font-family:arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">               

			   <tr style=\"font-size:12px;font-weight:bold;\">
                    <td style=\"font-size:10px;\" rowspan=2 width=\"2%\" align=\"center\">No.<br>Urut        
                    </td>
                    <td rowspan=2 width=\"5%\" align=\"center\" >Kode<br>Rekening        
                    </td>
                     <td  colspan=2  width=\"20%\" align=\"center\">PAGU ANGGARAN<br>KEGIATAN<br>(Rp)
					 </td>
					 <td rowspan=2 width=\"15%\" align=\"center\" >Uraian        
                    </td>
                    <td  colspan=3  width=\"30%\" align=\"center\">Realisasi Kegiatan (BELANJA)<br>(Rp)
					 </td>
					 
                    <td rowspan=2 width=\"10%\" align=\"center\" >Koreksi / CP
                    </td>
                    <td  rowspan=2 width=\"10%\" align=\"center\">Sisa Pagu Anggaran<br>(Rp.)
                    </td>
                   
                </tr>
				<tr style=\"font-size:12px;font-weight:bold;\">	
					<td width=\"10%\" align=\"center\" >MURNI
                    </td>
					<td width=\"10%\" align=\"center\" >UBAH                 
                    </td>
					<td width=\"10%\" align=\"center\" >UP/GU
                    </td>
					<td width=\"10%\" align=\"center\" >TU
                    </td>
					<td width=\"10%\" align=\"center\" >LS
                    </td>
				</tr>";
			/*	
			$sql ="select c.kd_rek5,nm_rek5,uraian,anggaran_susun,anggaran_ubah,ISNULL(n_upgu,0) n_upgu,ISNULL(n_tu,0) n_tu
					,ISNULL(n_ls,0) n_ls,sisa=anggaran_ubah-(ISNULL(n_upgu,0)+ISNULL(n_tu,0)+ISNULL(n_ls,0)) from(
					select a.kd_rek5,a.nm_rek5,a.nm_rek5 [uraian],
					sum(a.nilai)anggaran_susun,sum(a.nilai_ubah)anggaran_ubah
					from trdrka a 
					where a.kd_kegiatan='$kd_kegi' 
					group by a.kd_rek5,a.nm_rek5,a.nm_rek5) as c left join 
					(select kd_rek5,sum(case when jns_spp in (1,2) then b.nilai else 0 end) n_upgu, 
					sum(case when jns_spp=3 then b.nilai else 0 end) n_tu, 
					sum(case when jns_spp in (4,5,6) then b.nilai else 0 end) n_ls from data_belanja b
					where sp2d_batal=0 and b.kd_kegiatan='$kd_kegi' 
					and sp2d_batal =0 and tgl_sp2d <='$dcetak2'
					group by b.kd_rek5
					) as d on c.kd_rek5=d.kd_rek5 order by c.kd_rek5";
			*/
			$field = $this->get_status($dcetak2,$skpd);
			$sql ="SELECT c.kd_rek6,nm_rek6,uraian,anggaran_susun,anggaran_ubah,ISNULL(n_upgu,0)n_upgu,ISNULL(n_tu,0) 	n_tu,ISNULL(n_ls,0) n_ls,
                    k_cp=ISNULL(k_upgu,0),sisa=anggaran_ubah-(ISNULL(n_upgu,0)+ISNULL(n_tu,0)+ISNULL(n_ls,0)
                    +ISNULL(k_upgu,0)) from(
                    select a.kd_rek6,a.nm_rek6,a.nm_rek6 [uraian],
                    sum(a.nilai)anggaran_susun,sum(a.$field)anggaran_ubah
                    from trdrka a 
                    where a.kd_sub_kegiatan='$kd_kegi'  and a.kd_skpd='$skpd'
                    group by a.kd_rek6,a.nm_rek6,a.nm_rek6) as c 
                    left join 
                    (select kd_rek6,
					sum(case when jns_spp in (1,2) and j.panjar not in ('3','5') then b.nilai else 0 end) [n_upgu], 
                    sum(case when jns_spp=3 then b.nilai else 0 end) n_tu, 
                    sum(case when jns_spp in (4,5,6) then b.nilai else 0 end) n_ls from data_belanja b left join 
                    (select no_bukti,kd_skpd,panjar  from trhtransout where kd_skpd='$skpd') 
                    j on b.no_bukti=j.no_bukti and b.kd_skpd=j.kd_skpd
                    where (sp2d_batal=0 or sp2d_batal is null) and b.kd_sub_kegiatan='$kd_kegi' and b.kd_skpd='$skpd' and sp2d_batal =0 and tgl_sp2d <='$dcetak2'
                    group by b.kd_rek6
                    ) as d on c.kd_rek6=d.kd_rek6 
                    left join 
                    (
                    select kd_rek6,
                    sum(case when jns_spp in (1,2) then b.nilai else 0 end) k_upgu, 
                    sum(case when jns_spp=3 then b.nilai else 0 end) k_tu, 
                    sum(case when jns_spp in (4,5,6) then b.nilai else 0 end) k_ls from trhtransout a join trdtransout b 
                    on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
                    where b.kd_sub_kegiatan='$kd_kegi' and b.kd_skpd='$skpd' and a.tgl_tagih <='$dcetak2' and a.panjar in ('3','5')
                    group by b.kd_rek6
                    ) as e on d.kd_rek6=e.kd_rek6
                    order by c.kd_rek6";


			 $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lntotal = 0;
                     $total_upgu=0;
                     $total_tu=0;
                     $total_ls=0;
                     $total_anggaran_susun=0;
					 $total_anggaran_ubah=0;
                     $total_sisa=0;
					 $tkorek_cp = 0;
					 
					 foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
					   $total_upgu=$row->n_upgu+$total_upgu;
					   $total_tu=$row->n_tu+$total_tu;
					   $total_ls=$row->n_ls+$total_ls;
					   $tkorek_cp = $row->k_cp+$tkorek_cp;
					   $total_anggaran_susun=$row->anggaran_susun+$total_anggaran_susun;
					   $total_anggaran_ubah=$row->anggaran_ubah+$total_anggaran_ubah;
					   $total_sisa=$row->sisa+$total_sisa;
					   
					   $k_cp = $this->rp_minus($row->k_cp);
					   
					   /*
					   if ( $row->tgl_sp2d !=''){
							$tgl_sp2d=$this->tukd_model->tanggal_ind($row->tgl_sp2d);
					
					   }else{
						   $tgl_sp2d = '';
					   }          */         					
       $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px\">$lcno  
                    </td>
                    <td valign=\"top\"  align=\"left\" style=\"font-size:12px\">".$this->dotrek($row->kd_rek6)."
					</td>					
                    <td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->anggaran_susun,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->anggaran_ubah,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"left\" style=\"font-size:12px\">$row->uraian  
                    </td>
                    <td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->n_upgu,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->n_tu,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->n_ls,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">$k_cp &nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->sisa,"2",",",".")."&nbsp; 
					 </td>					 
                </tr>
				";
				};
				
				$tkorek_cp =  $this->rp_minus($tkorek_cp);
				       $cRet .=" <tr style=\"font-size:12px;font-weight:bold;\">
                    <td colspan=\"2\" align=\"center\" >TOTAL
                    </td>
                    <td valign=\"top\"  align=\"right\" >".number_format($total_anggaran_susun,"2",",",".")."&nbsp; 
					 </td>
					  <td valign=\"top\"  align=\"right\" >".number_format($total_anggaran_ubah,"2",",",".")."&nbsp; 
					 </td>
					   <td valign=\"top\"  align=\"center\" >&nbsp;&nbsp; 
					 </td>
					  <td valign=\"top\"  align=\"right\" >".number_format($total_upgu,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"right\">".number_format($total_tu,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\">".number_format($total_ls,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" >$tkorek_cp &nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" >".number_format($total_sisa,"2",",",".")."&nbsp; 
					 </td>					 
                </tr>
				";
			$cRet .='</table>';

			$data['prev']= 'Kartu Kendali';
			if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
	
	}
	
	
   function cetak_kartu_kendali($dcetak='',$ttd='',$skpd='',$kd_kegi='',$rek5='',$dcetak2=''){ //Tox

	$print = $this->uri->segment(9);
//echo $print;
$field = $this->get_status($dcetak2,$skpd);
	$sql = "select sum(nilai)nilai,sum($field)nilai_ubah from trdrka where kd_sub_kegiatan='$kd_kegi' AND kd_rek6='$rek5'";
			 $hasil = $this->db->query($sql);
			 $data1 = $hasil->row();
			 $ang = $data1->nilai_ubah;
			 
			$cRet ="<table style=\"border-collapse:collapse;font-weight:bold;font-family:arial; font-size:12px\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr >
                <td width=\"100%\" align=\"center\" colspan=2 style=\"font-size:18px\">KARTU KENDALI KEGIATAN<br> <br></td></tr>
					 <TR  width=\"100%\">
						<TD align=\"left\" >OPD</TD>
						<TD align=\"left\" >: ".$skpd." - ".$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd')."</TD>
					 </TR>
					 
					 <TR>
						<TD align=\"left\">Nama Kegiatan</TD>
						<TD align=\"left\"  >: ".$kd_kegi." - ".$this->tukd_model->get_nama($kd_kegi,'nm_sub_kegiatan','trskpd','kd_sub_kegiatan')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Nama Rekening</TD>
						<TD align=\"left\"  >: ".$kd_kegi.".".$rek5." - ".$this->tukd_model->get_nama($rek5,'nm_rek6','ms_rek6','kd_rek6')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Anggaran Penyusunan</TD>
						<TD align=\"left\"  >: ".number_format($data1->nilai,"2",".",",")."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Anggaran Perubahan</TD>
						<TD align=\"left\"  >: ".number_format($data1->nilai_ubah,"2",".",",")."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" >Periode</TD>
						<TD align=\"left\" >: ".$this->tukd_model->tanggal_format_indonesia($dcetak)." s/d ".$this->tukd_model->tanggal_format_indonesia($dcetak2)."</TD>
					 </TR>
					 </TABLE>";

			$cRet .=" <table style=\"border-collapse:collapse;font-family:arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">               

			   <tr style=\"font-size:12px;font-weight:bold;\">
                    <td rowspan=2 width=\"2%\" align=\"center\">No.<br>Urut        
                    </td>
                    <td rowspan=2 width=\"5%\" align=\"center\" >Kode<br>Rekening        
                    </td>
                    <td rowspan=2 width=\"8%\" align=\"center\">Tanggal     
                    </td>
                    <td rowspan=2 width=\"25%\" align=\"center\">Uraian       
                    </td>
                    <td  colspan=3  width=\"30%\" align=\"center\">Realisasi Kegiatan (BELANJA)<br>(Rp)
					 </td>
					 
                    <td rowspan=2 width=\"15%\" align=\"center\" >Koreksi / CP
                    </td>
                    <td  rowspan=2 width=\"15%\" align=\"center\">Sisa Pagu Anggaran<br>(Rp.)
                    </td>
                   
                </tr>
				<tr style=\"font-size:12px;font-weight:bold;\">				                   
					<td width=\"10%\" align=\"center\" >UP/GU
                    </td>
					<td width=\"10%\" align=\"center\" >TU
                    </td>
					<td width=\"10%\" align=\"center\" >LS
                    </td>
				</tr>";
			/*
			 $sql = "select a.kd_rek5,a.nm_rek5,tgl_sp2d,rtrim(keperluan) as uraian, 
					sum(case when jns_spp in (1,2) then a.nilai else 0 end)n_upgu,
					sum(case when jns_spp=3 then a.nilai else 0 end)n_tu, 
					sum(case when jns_spp in (4,5,6) then a.nilai else 0 end)n_ls,
					sum(b.nilai)anggaran,(sum(b.nilai)-sum(a.nilai))sisa 
					from data_Belanja a inner join trdrka b on a.kd_kegiatan=b.kd_kegiatan and a.kd_rek5=b.kd_rek5
					where sp2d_batal=0 and a.kd_kegiatan='$kd_kegi' 
					AND a.kd_rek5 = '$rek5' 
					And sp2d_batal =0 and tgl_sp2d <='$dcetak2' group by a.kd_rek5,a.nm_rek5,tgl_sp2d,rtrim(keperluan) ";
			 */
             $sql = "select f.kd_rek6,f.nm_rek6,f.tgl_sp2d,f.no_sp2d,f.uraian,f.n_upgu,f.n_tu,f.n_ls,k_cp=f.k_jurnalgu+f.k_jurnaltu+f.k_jurnalls from (
                        select a.kd_rek6,a.nm_rek6,tgl_sp2d,no_sp2d,rtrim(keperluan) as uraian, 
    					sum(case when jns_spp in (1,2)  then a.nilai else 0 end) [n_upgu],
    					sum(case when jns_spp=3 then a.nilai else 0 end)n_tu, 
    					sum(case when jns_spp in (4,5,6) then a.nilai else 0 end)n_ls,0 [k_jurnalgu],0 [k_jurnaltu],0 [k_jurnalls]
    					from data_Belanja a left join 
						(select no_bukti,kd_skpd,panjar  from trhtransout where kd_skpd='$skpd') 
						j on a.no_bukti=j.no_bukti and a.kd_skpd=j.kd_skpd
    					where sp2d_batal=0 and a.kd_sub_kegiatan='$kd_kegi' 
    					AND a.kd_rek6 = '$rek5' and (j.panjar not in ('3','5') or j.panjar is null)
    					And (sp2d_batal =0 or sp2d_batal is null) and tgl_sp2d <='$dcetak2' group by a.kd_rek6,a.nm_rek6,tgl_sp2d,no_sp2d,rtrim(keperluan)
                        union all
                        select c.kd_rek6,c.nm_rek6,a.tgl_tagih,c.no_sp2d,a.ket, 0 n_upgu,0 n_tu,0 n_ls,
                        sum(case when jns_spp in (1) then c.nilai else 0 end)[k_jurnalgu],
                        0 [k_jurnaltu], 
                        0 [k_jurnalls]
                        from trhtransout a join trdtransout c on a.no_bukti=c.no_bukti and a.kd_skpd=c.kd_skpd 
                        where c.kd_sub_kegiatan='$kd_kegi' and c.kd_rek6 = '$rek5' and jns_spp in (1)  and a.tgl_tagih<='$dcetak2' and a.panjar in ('3','5') 
                        group by c.kd_rek6,c.nm_rek6,a.tgl_tagih,c.no_sp2d,a.ket
                    ) as f order by tgl_sp2d,no_sp2d
                    ";
			 
			 $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lntotal = 0;
                     $total_upgu=0;
                     $total_tu=0;
                     $total_ls=0;
                     $total_anggaran=0;
					 $tkorek_cp = 0;
					 $sisapagu = 0;
                     //$sisa=$data1->nilai_ubah;
					 
					 foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
					   $total_upgu=$row->n_upgu+$total_upgu;
					   $total_tu=$row->n_tu+$total_tu;
					   $total_ls=$row->n_ls+$total_ls;
					   //$total_anggaran=$row->anggaran+$total_anggaran;
					   $tkorek_cp = $tkorek_cp + $row->k_cp;
					   //$sisa=$sisa-$total_upgu-$total_tu-$total_ls;
					   $sisapagu=$ang-$total_upgu-$total_tu-$total_ls-$tkorek_cp;
					   $tgl_sp2d=$this->tukd_model->tanggal_ind($row->tgl_sp2d);
					   $k_cp = $this->rp_minus($row->k_cp);
				               					
       $cRet .=" <tr >
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$lcno  
                    </td>
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$row->kd_rek6     
                    </td>
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$tgl_sp2d
                    </td>
					<td valign=\"top\"  align=\"left\" style=\"font-size:12px\">$row->uraian  
                    </td>
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($row->n_upgu,"2",".",",")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($row->n_tu,"2",".",",")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($row->n_ls,"2",".",",")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$k_cp &nbsp; 
					</td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($sisapagu,"2",".",",")."&nbsp; 
					 </td>					 
                </tr>
				";
				};
				
					$tkorek_cp = $this->rp_minus($tkorek_cp );
				       $cRet .=" <tr style=\"font-size:12px;font-weight:bold;\">
                    <td colspan=\"4\" align=\"center\" >TOTAL
                    </td>
                    <td  align=\"center\" >".number_format($total_upgu,"2",".",",")."&nbsp; 
					 </td>
					<td  align=\"center\">".number_format($total_tu,"2",".",",")."&nbsp; 
					</td>
					<td  align=\"center\">".number_format($total_ls,"2",".",",")."&nbsp; 
					</td>
					<td  align=\"center\" >$tkorek_cp &nbsp; 
					</td>
					<td  align=\"center\" >".number_format($sisapagu,"2",".",",")."&nbsp; 
					 </td>					 
                </tr>
				";
			$cRet .='</table>';

			$data['prev']= 'Kartu Kendali';
			if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
	
	}

	
 
 
	function load_d_uji() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
	
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $skriteria = $this->input->post('vkriteria');
        $where    = " ";
        
        if($skriteria!=''){
            if ($kriteria <> ''){                               
                $where="  and (upper(a.no_uji) like upper('%$kriteria%') or a.tgl_uji like '%$kriteria%' or b.no_sp2d like '%$kriteria%') ";            
            }
    
    
            $sql = "SELECT count(*) as tot from trhuji" ;
            $query1 = $this->db->query($sql);
            $total = $query1->row();
    
    		/*
            $sql = "SELECT top $rows * from trhuji  a where a.no_uji not in (SELECT TOP $offset  no_uji from  
                    trhuji order by tgl_uji,no_uji ) $where order by a.tgl_uji, a.no_uji ";//limit $offset,$rows";
    		*/
    		 $sql = "SELECT top $rows a.no_uji, a.tgl_uji from trhuji a
    				INNER JOIN TRDUJI b ON a.no_uji=b.no_uji 
    				where a.no_uji not in (SELECT TOP $offset  no_uji from  
                    trhuji order by tgl_uji,no_uji ) $where
    				GROUP BY a.no_uji, a.tgl_uji order by a.tgl_uji, a.no_uji ";//limit $offset,$rows";
        }else{
            if ($kriteria <> ''){                               
                $where="  and (upper(a.no_uji) like upper('%$kriteria%') or a.tgl_uji like '%$kriteria%') ";            
            }
    
    
            $sql = "SELECT count(*) as tot from trhuji" ;
            $query1 = $this->db->query($sql);
            $total = $query1->row();
    
    		/*
            $sql = "SELECT top $rows * from trhuji  a where a.no_uji not in (SELECT TOP $offset  no_uji from  
                    trhuji order by tgl_uji,no_uji ) $where order by a.tgl_uji, a.no_uji ";//limit $offset,$rows";
    		*/
    		 $sql = "SELECT top $rows a.no_uji, a.tgl_uji from trhuji a 
    				where a.no_uji not in (SELECT TOP $offset  no_uji from  
                    trhuji order by tgl_uji,no_uji ) $where
    				GROUP BY a.no_uji, a.tgl_uji order by a.tgl_uji, a.no_uji ";//limit $offset,$rows";            
        }
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
		
		  { 
           
            $row[] = array(
                        'id' => $ii,
						'no_uji'    => $resulte['no_uji'],
						'tgl_uji'    => $resulte['tgl_uji']
                        );
                        $ii++;
        }						           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	$query1->free_result();    
		
	}
	
	//copy
	function cek_uji($vno_uji='') {

    $luji = $this->input->post('vno_uji');
   
   
        $sql = "SELECT top 1 isnull(b.no_kas_bud,'') [no_kas_bud] FROM TRDUJI a inner join trhsp2d b on a.no_sp2d=b.no_sp2d WHERE no_uji='$luji' 
                order by b.no_kas_bud desc ";
        
        $query1 = $this->db->query($sql);  
        $result = '';
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result =$resulte['no_kas_bud'];	
        }
   
           echo json_encode($result);
     $query1->free_result();
    }	
	
	function select_detail_uji($vno_uji='') {

    $luji = $this->input->post('vno_uji');
   
   
        $sql = "SELECT no_uji, tgl_uji, a.no_sp2d,b.tgl_sp2d,no_spm,tgl_spm,nilai 
				FROM TRDUJI a inner join trhsp2d b on a.no_sp2d=b.no_sp2d WHERE no_uji='$luji'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'idx'        => $ii, 						
                        'no_sp2d' => $resulte['no_sp2d'],     
                        'tgl_sp2d'     => $resulte['tgl_sp2d'],  
                        'no_spm'     => $resulte['no_spm'], 						 
                        'tgl_spm'     => $resulte['tgl_spm'], 						 
                        'nilai1'      => number_format($resulte['nilai'])
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
	  function sp2d_list_uji() {
	   $lccr = $this->input->post('q');
        $sql   = " select no_sp2d, tgl_sp2d,no_spm,tgl_spm,nilai from trhsp2d where no_sp2d not in 
                    (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and upper(no_sp2d) like upper('%$lccr%') and (sp2d_batal is null or sp2d_batal='') ";
       // $sql   = " select no_spd, tgl_spd from trhspd ";        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],
                        'nilai' => $resulte['nilai']						
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	function no_urut2(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
	select no_kas nomor,'Pencairan SP2D' ket,kd_skpd from trhsp2d where isnumeric(no_kas)=1 and status=1 union ALL
	select no_sts nomor, 'Setor Sisa Kas' ket,kd_skpd from trhkasin_pkd where  isnumeric(no_sts)=1 and jns_trans<>4 union ALL
	select no_sts+1 nomor, 'Setor Sisa Kas' ket,kd_skpd from trhkasin_pkd where  isnumeric(no_sts)=1 and jns_trans<>4 and pot_khusus=1 union ALL
	select NO_BUKTI nomor, 'Keluar lain-lain' ket,KD_SKPD as kd_skpd from TRHOUTLAIN where  isnumeric(NO_BUKTI)=1) z WHERE KD_SKPD = '$kd_skpd'");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	
	function no_urut(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
	select no_kas_bud nomor,'Pencairan SP2D' ket,kd_skpd from trhsp2d where isnumeric(no_kas_bud)=1 and status_bud=1
	) z 
	");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	function no_urut_ppkd(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
	select no_kas nomor,'Terima STS' ket from trhkasin_ppkd where isnumeric(no_kas)=1
	UNION ALL
    select no_kas nomor,'Terima STS' ket from trhrestitusi where isnumeric(no_kas)=1
	UNION ALL
	select nomor,'Terima non SP2D' ket from penerimaan_non_sp2d where isnumeric(nomor)=1
	UNION ALL
	select nomor,'keluar non SP2D' ket from pengeluaran_non_sp2d where isnumeric(nomor)=1
	UNION ALL
	select no,'koreksi' ket from trkasout_ppkd where isnumeric(no)=1
	) z 
	");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }

	
	
	function simpan_update_d_uji(){
		$no_uji = $this->input->post('no_uji');		
		$tgl_uji = $this->input->post('tgl_uji');
		$no_blk = $this->input->post('no_blk');
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama'); 
		$lcst=$this->input->post('lcst');
		$r_nomor='2';
		if ($lcst=='tambah')
		{
			
			$sql = "Select isnull(Max((no_urut)),0) As maks From trhuji";
			$hasil = $this->db->query($sql);
			$nomor7 = $hasil->row();
			$nomor7_urut=$nomor7->maks+1;
			$r_nomor=strval($nomor7_urut).$no_blk;
			
    	$csql = "INSERT INTO trhuji (no_uji,tgl_uji,username,tgl_update,no_urut) values ('$r_nomor','$tgl_uji','$user','$cwaktu','$nomor7_urut')";
    	$query1 = $this->db->query($csql);    					
                if($query1){
                    echo json_encode($r_nomor);
                }else{
                    echo '0';
                }
		} else {
			$csql = "update trhuji set tgl_uji='$tgl_uji',username='$user',tgl_update='$cwaktu' where no_uji='$no_uji' ";
			$query1 = $this->db->query($csql);    					
                if($query1){
                    echo json_encode($r_nomor);
                }else{
                    echo '0';
                }
		}
    }
	
	function simpan_detail_d_uji(){
	  
		$no_uji = $this->input->post('no_uji');		
		$tgl_uji = $this->input->post('tgl_uji');
		$no_sp2d = $this->input->post('no_sp2d');
        
    	$csql = "INSERT INTO trduji (no_uji,tgl_uji,no_sp2d) values ('$no_uji','$tgl_uji','$no_sp2d')";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }
 
    function simpan_detail_d_uji_hapus()
	{
           $no_uji  = trim($this->input->post('no_uji'));

               $sql     = " delete trduji where no_uji='$no_uji' ";
               $asg     = $this->db->query($sql); 	
               if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
    }  

    function cetak_rekap_gaji($dcetak='',$ttd='',$skpd='',$dcetak2='',$cetak='', $pilihan='',$cbulan=''){ //Tox
    $print = $cetak;    
     $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        
        $buln  = $this->getBulan($dcetak);

        if($skpd!='--'){
            $skpd1= "  and a.kd_skpd='$skpd'";
            $a = 'SKPD ';
            $nama = $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        } else{
            $skpd1= "";
        }  
        
        $where2='';
          /*switch ($tstatus){
                        case '1': //SP2D Keluar
                        $where2='';
                            break;
                        case '2': //SP2D lunas
                            $where2=" and status_bud=1 ";
                            break;
                        case '3': //SP2D Advice
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //SP2D belum Bayar
                           $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and status_bud <> 1 ";
                            break;                       
                        case '5': //Belum Advice
                           $where2=" and no_sp2d NOT IN (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;                       
                    }*/
             /*switch ($jenis){
                        case '1': //BL
                        $where4="AND b.jns_spp not in ('4','5')";
                            break;
                        case '2': //BTL
                            $where4=" AND b.jns_spp in ('4','5')";
                            break;
                      }*/
                      
            switch ($pilihan){
                        case '1': //SEMUA
                            $where3="";
                            break;
                        case '2': //BULAN
                                 $where3=" and MONTH(tgl_sp2d)='$dcetak' ";
                            break;
                        case '3': //PERIODE
                                $where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
                            
                            break;
                      }     
                           
           
        
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"13\"><b>$kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"13\"><b>DAFTAR REKAP GAJI BULAN $buln TAHUN $tahun</b></td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"2\"><b>No.<br>Urut</b></td>
             <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>KODE</b></td>
             <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>NAMA</b></td>
             <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>JUMLAH KOTOR</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"8\"><b>POTONGAN</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>BERSIH</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>IWP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>JKK</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>JKM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>BPJS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>PPH21</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TAPERUM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>HKPG</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>Total</b></td>
        
        
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>12</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>13</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where (b.sp2d_batal IS NULL  OR b.sp2d_batal !=1) ";
        if ($kriteria <> '--'){                               
            $where=" where  (b.sp2d_batal IS NULL  OR b.sp2d_batal !=1) and a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT kd_skpd,nm_skpd,sum(nomor) nomor,sum(nilai_sp2d) nilai_sp2d,
sum(IWP) IWP,
sum(JKK) JKK,
sum(JKM) JKM,
sum(BPJS) BPJS,
sum(PPH21) PPH21,
sum(TAPERUM) TAPERUM,
sum(HKPG) HKPG,
sum(IWP) + sum(JKK) + sum(JKM) + sum(BPJS) + sum(PPH21) + sum(TAPERUM) + sum(HKPG) as Total  from( 
select a.kd_skpd,a.nm_skpd,count(a.no_sp2d) nomor,a.nilai nilai_sp2d,
SUM(CASE WHEN b.kd_rek6='210108010001' THEN b.nilai ELSE 0 END) AS IWP,
SUM(CASE WHEN b.kd_rek6='210103010001' THEN b.nilai ELSE 0 END) AS JKK,
SUM(CASE WHEN b.kd_rek6='210104010001' THEN b.nilai ELSE 0 END) AS JKM,
SUM(CASE WHEN b.kd_rek6='210102010001' THEN b.nilai ELSE 0 END) AS BPJS,
SUM(CASE WHEN b.kd_rek6='210105010001' THEN b.nilai ELSE 0 END) AS PPH21,
SUM(CASE WHEN b.kd_rek6='' THEN 0 ELSE 0 END) AS TAPERUM,
SUM(CASE WHEN b.kd_rek6='210601010007' THEN b.nilai ELSE 0 END) AS HKPG from trhsp2d a
inner join trspmpot b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
where a.no_sp2d like '%GJ%' and a.jenis_beban='1' $skpd1 $where3 
group by a.kd_skpd,a.nm_skpd,a.no_sp2d,a.nilai ) z
group by kd_skpd,nm_skpd
order by kd_skpd";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                 $t_up= 0;
                    $t_gu=0;
                    $t_tu=0;
                    $t_gaji=0;
                    $t_ls=0;
                foreach ($hasil->result() as $row)
                {
                    $kd_skpd= $row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $nilai_sp2d= $row->nilai_sp2d;
                    $IWP= $row->IWP;
                    $JKK= $row->JKK;
                    $JKM= $row->JKM;
                    $BPJS= $row->BPJS;
                    $PPH21= $row->PPH21;
                    $TAPERUM= $row->TAPERUM;
                    $HKPG= $row->HKPG;
                    $Total= $row->Total;
                    $Bersih= $nilai_sp2d-$Total;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"left\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"left\" style=\"font-size:12px\">$kd_skpd</td>
                                <td align=\"left\" style=\"font-size:12px\">$nm_skpd</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($nilai_sp2d,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($IWP,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($JKK,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($JKM,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($BPJS,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($PPH21,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($TAPERUM,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($HKPG,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($Total,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($Bersih,"2",",",".")."</td>
                                
                              </tr>  "; 
                   
                }

                    /*$cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                              </tr>  ";*/ 
                    
  
                
        $cRet .="</table>";
        $data['prev']= $cRet;    
        if ($print==1){
                $this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 
        }else if($print==2){
            echo ("<title>REKAP GAJI</title>");
            echo $cRet;
        }else{
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=register.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        }
    } 

    
	function cetak_register_sp2d_baru($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak='',$jenis='',$urut='', $pilihan=''){ //Tox
	$print = $cetak;    
	 $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		
		if($skpd!='--'){
			$a = 'SKPD ';
			$nama = $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
		}	
		
		$where2='';
		  switch ($tstatus){
                        case '1': //SP2D Keluar
						$where2='';
                            break;
                        case '2': //SP2D lunas
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //SP2D Advice
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //SP2D belum Bayar
                           $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and status_bud <> 1 ";
                            break;                       
					    case '5': //Belum Advice
                           $where2=" and no_sp2d NOT IN (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;                       
                    }
			 switch ($jenis){
                        case '1': //BL
						$where4="AND b.jns_spp not in ('4','5')";
                            break;
                        case '2': //BTL
							$where4=" AND b.jns_spp in ('4','5')";
                            break;
                      }
					  
			switch ($pilihan){
                        case '1': //SEMUA
							$where3="";
                            break;
                        case '2': //BULAN
							if($tstatus=='2'){
								 $where3=" and MONTH(tgl_kas_bud)='$dcetak' ";
							}else{
								$where3=" and MONTH(tgl_sp2d)='$dcetak' ";
							}
                          
                            break;
						case '3': //PERIODE
							if($tstatus=='2'){
								$where3= " and ( tgl_kas_bud between '$dcetak' and '$dcetak2') ";
							}else{
								$where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
							}
                            break;
                      }		
						   
			switch ($urut){
							case '1': //BL
							$order="ORDER BY tgl_sp2d,no_sp2d";
								break;
							case '2': //BTL
								$order=" ORDER BY CAST(no_kas_bud as int)";
								break;
						  }
		
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>$kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>DAFTAR SPM DAN SP2D TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"7\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"7\"><b>SP2D</td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>12</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>13</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>14</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>15</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where (b.sp2d_batal IS NULL  OR b.sp2d_batal !=1) ";
        if ($kriteria <> '--'){                               
            $where=" where  (b.sp2d_batal IS NULL  OR b.sp2d_batal !=1) and a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,b.tgl_sp2d,b.no_sp2d,b.keperluan,
				(case when a.jns_spp=1 then c.nilai else 0  end)up,
				(case when a.jns_spp=2 then c.nilai else 0  end)gu,
				(case when a.jns_spp=3 then c.nilai else 0  end)tu,
				(case when a.jns_spp in (4,5) then c.nilai else 0  end)gaji,
				(case when a.jns_spp=6 then c.nilai else 0  end)ls
				 FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				  inner join (select no_spp, sum(nilai) [nilai] from  trdspp group by no_spp) c on a.no_spp=c.no_spp $where $where2 $where4 $where3
				  $order ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
				 $t_up= 0;
                    $t_gu=0;
                    $t_tu=0;
                    $t_gaji=0;
                    $t_ls=0;
                foreach ($hasil->result() as $row)
                {
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n_up= $row->up;
                    $n_gu= $row->gu;
                    $n_tu= $row->tu;
                    $n_gaji= $row->gaji;
                    $n_ls= $row->ls;
                    $t_up= $t_up+$n_up;
                    $t_gu= $t_gu+$n_gu;
                    $t_tu= $t_tu+$n_tu;
                    $t_gaji=$t_gaji+$n_gaji;
                    $t_ls= $t_ls+$n_ls;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"left\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"left\" style=\"font-size:12px\">$spm</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",",",".")."</td>
                                <td align=\"left\" style=\"font-size:12px\">$sp2d</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",",",".")."</td>
                              </tr>  "; 
                   
                }

                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                                <td align=\"center\" style=\"font-size:12px\" colspan=2> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                              </tr>  "; 
                   
                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"right\" style=\"font-size:12px\" colspan=3> Total</td>
                                <td align=\"right\" style=\"font-size:12px\" colspan=5>".number_format($t_up+$t_gu+$t_tu+$t_gaji+$t_ls,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\" colspan=2> Total</td>
                                <td align=\"right\" style=\"font-size:12px\" colspan=5>".number_format($t_up+$t_gu+$t_tu+$t_gaji+$t_ls,"2",",",".")."</td>
								</tr>  "; 
  
				
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 
		}else if($print==2){
			echo ("<title>REGISTER SP2D</title>");
			echo $cRet;
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=register.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
    }
	
	
	function cetak_register_sp2d_baru2($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1,$jenis='',$urut='', $pilihan=''){ //Tox
	$print = $cetak;    
	 $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus){
                        case '1': //SP2D Keluar
						$where2='';
                            break;
                        case '2': //SP2D lunas
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //SP2D Advice
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //SP2D belum Bayar
                           $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and status_bud <> 1 ";
                            break;                       
					    case '5': //Belum Advice
                           $where2=" and no_sp2d NOT IN (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;                       
                    }
			 switch ($jenis){
                        case '1': //BL
						$where4="AND b.jns_spp not in ('4','5')";
                            break;
                        case '2': //BTL
							$where4=" AND b.jns_spp in ('4','5')";
                            break;
                      }
					  
			switch ($pilihan){
                        case '1': //SEMUA
							$where3="";
                            break;
                        case '2': //BULAN
                           $where3=" and MONTH(tgl_sp2d)='$dcetak' ";
                            break;
						case '3': //PERIODE
                           $where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
                            break;
                      }		
						   
			switch ($urut){
							case '1': //BL
							$order="ORDER BY no_sp2d";
								break;
							case '2': //BTL
								$order=" ORDER BY CAST(no_kas_bud as int)";
								break;
						  }
		
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"16\"><b>$kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"16\"><b>DAFTAR SPM DAN SP2D TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"16\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"7\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"8\"><b>SP2D</td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>NO KASDA</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>12</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>13</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>14</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>15</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>16</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where (c.sp2d_batal IS NULL  OR c.sp2d_batal !=1) ";
        if ($kriteria <> '--'){                               
            $where=" where  (c.sp2d_batal IS NULL  OR c.sp2d_batal !=1) and a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,b.tgl_sp2d,b.no_sp2d,b.keperluan,no_kas_bud,
				(case when a.jns_spp=1 then b.nilai else 0  end)up,
				(case when a.jns_spp=2 then b.nilai else 0  end)gu,
				(case when a.jns_spp=3 then b.nilai else 0  end)tu,
				(case when a.jns_spp in (4,5) then b.nilai else 0  end)gaji,
				(case when a.jns_spp=6 then b.nilai else 0  end)ls
				 FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				  inner join TRHSPp c on a.no_spp=c.no_spp $where $where2 $where4 $where3 
				  $order ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
				 $t_up= 0;
                    $t_gu=0;
                    $t_tu=0;
                    $t_gaji=0;
                    $t_ls=0;
                foreach ($hasil->result() as $row)
                {
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $no_kas_bud= $row->no_kas_bud;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n_up= $row->up;
                    $n_gu= $row->gu;
                    $n_tu= $row->tu;
                    $n_gaji= $row->gaji;
                    $n_ls= $row->ls;
                    $t_up= $t_up+$n_up;
                    $t_gu= $t_gu+$n_gu;
                    $t_tu= $t_tu+$n_tu;
                    $t_gaji=$t_gaji+$n_gaji;
                    $t_ls= $t_ls+$n_ls;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"left\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"left\" style=\"font-size:12px\">$spm</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",".",",")."</td>
                                <td align=\"left\" style=\"font-size:12px\">$sp2d</td>
                                <td align=\"left\" style=\"font-size:12px\">$no_kas_bud</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",".",",")."</td>
                              </tr>  "; 
                   
                }

                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",".",",")."</td>
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",".",",")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		echo ("<title>REGISTER SP2D</title>");
  	    echo $cRet;
		}
		//echo("$cRet");   
    }
	


	function cetak_realisasi_sp2d($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak='',$jenis='', $pilihan='',$anggaran){ //Anguz
	$print = $cetak;    
	 $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  
			 switch ($anggaran){
                        case '1': //
						$ang="nilai";
                            break;
                        case '2': //
						$ang="nilai_sempurna";
                            break;
						case '3': //
						$ang="nilai_ubah";
                            break;
                      }
					  
			switch ($pilihan){
                        case '1': //SEMUA
							$where3="";
                            break;
                        case '2': //BULAN
                           $where3=" and MONTH(tgl_sp2d)='$dcetak' ";
                            break;
						case '3': //PERIODE
                           $where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
                            break;
                      }		
						   
		/*        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        } */
		$cRet ="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>REALISASI SURAT PERINTAH PENCAIRAN DANA (SP2D) PERDINAS/ISNTANSI/UNIT KERJA</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>PROVINSI KALIMANTAN BARAT</b></td>
        </tr>
        </table>
		";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="
		<thead>
        <tr>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"7%\" rowspan=\"2\"><b>Kode</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" rowspan=\"2\"><b>Urusan Permerintah Daerah</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" colspan=\"2\"><b>Belanja Tidak Langsung</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"4%\" rowspan=\"2\"><b>Persen<BR>tase</b></td>
			<td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" colspan=\"2\"><b>Belanja Langsung</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"4%\" rowspan=\"2\"><b>Persen<BR>tase</b></td>
			<td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" colspan=\"2\"><b>Jumlah Keseluruhan</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"4%\" rowspan=\"2\"><b>Persen<BR>tase</b></td>
        </tr>  
		<tr>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Plafond</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Realisasi SP2D</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Plafond</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Realisasi SP2D</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Plafond</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Realisasi SP2D</b></td>
          </tr>
        <tr>
            <td style=\"font-size:12px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>11</b></td>
          </tr>
      </thead>
		  ";
        
            
        $sql = "SELECT a.kd_skpd as kode ,a.nm_skpd as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_skpd a 
				LEFT JOIN
				(SELECT a.kd_skpd 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT a.kd_skpd, a.nm_skpd 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY a.kd_skpd, a.nm_skpd)a
				LEFT JOIN 
				(SELECT a.kd_skpd
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL) 
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY a.kd_skpd)b
				ON a.kd_skpd=b.kd_skpd)c
				ON a.kd_skpd=c.kd_skpd
				UNION ALL
				SELECT a.kd_org as kode ,a.nm_org as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_organisasi a 
				LEFT JOIN
				(SELECT a.kode 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT LEFT(a.kd_skpd,7) as kode 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY  LEFT(a.kd_skpd,7))a
				LEFT JOIN 
				(SELECT LEFT(a.kd_skpd,7) as kode
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY LEFT(a.kd_skpd,7))b
				ON a.kode=b.kode)c
				ON a.kd_org=c.kode

				UNION ALL

				SELECT a.kd_urusan as kode ,a.nm_urusan as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_urusan a 
				LEFT JOIN
				(SELECT a.kode 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT LEFT(a.kd_skpd,4) as kode 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY LEFT(a.kd_skpd,4))a
				LEFT JOIN 
				(SELECT LEFT(a.kd_skpd,4) as kode
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY LEFT(a.kd_skpd,4))b
				ON a.kode=b.kode)c
				ON a.kd_urusan=c.kode

				UNION ALL

				SELECT a.kd_urusan1 as kode ,a.nm_urusan1 as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_urusan1 a 
				LEFT JOIN
				(SELECT a.kode 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT LEFT(a.kd_skpd,1) as kode 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY LEFT(a.kd_skpd,1))a
				LEFT JOIN 
				(SELECT LEFT(a.kd_skpd,1) as kode
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY LEFT(a.kd_skpd,1))b
				ON a.kode=b.kode)c
				ON a.kd_urusan1=c.kode
				ORDER BY kode";
				$tot_ang_btl=0;
				$tot_ang_bl=0;
				$tot_bel_btl=0;
				$tot_bel_bl=0;
                $hasil = $this->db->query($sql);
                foreach ($hasil->result() as $row){
                    $kode= $row->kode;
                    $nama=$row->nama;
                    $ang_btl= $row->ang_btl;
                    $ang_bl=$row->ang_bl;
                    $bel_btl= $row->bel_btl;
                    $bel_bl= $row->bel_bl;
					if($ang_btl==0){
						$per_btl=number_format(0,"2",".",",");
					}else{
						$per_btl=$this->tukd_model->persen_real($ang_btl,$bel_btl);//number_format($bel_btl/$ang_btl,"2",".",",");
					}
					if($ang_bl==0){
						$per_bl=number_format(0,"2",".",",");
					}else{
						$per_bl=$this->tukd_model->persen_real($ang_bl,$bel_bl);//number_format($bel_bl/$ang_bl,"2",".",",");
					}
					$angbtlbl=$ang_bl+$ang_btl;
					$belbtlbl=$bel_bl+$bel_btl;
					if($angbtlbl==0){
						$per_blbtl=number_format(0,"2",".",",");
					}else{
						$per_blbtl=$this->tukd_model->persen_real($angbtlbl,$belbtlbl); ;//number_format($belbtlbl/$angbtlbl,"2",".",",");
					}
					$panjang=strlen($kode);
					if($panjang=='10'){
						$tot_ang_bl=$tot_ang_bl+$ang_bl;
						$tot_ang_btl=$tot_ang_btl+$ang_btl;
						$tot_bel_bl=$tot_bel_bl+$bel_bl;
						$tot_bel_btl=$tot_bel_btl+$bel_btl;
						$tot_p_seluruh = $tot_ang_btl+$tot_ang_bl;
						$tot_r_seluruh = $tot_bel_btl+$tot_bel_bl;
					}
                    $cRet .=  "<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kode</td>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px\">".strtoupper($nama)."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ang_btl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($bel_btl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$per_btl."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ang_bl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($bel_bl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$per_bl."</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($angbtlbl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($belbtlbl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$per_blbtl."</td>
                              </tr>  "; 
                }
				$cRet .=  "<tr>
                                <td colspan=\"2\" valign=\"top\" align=\"center\" style=\"font-size:12px\"><b>TOTAL</b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_ang_btl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_bel_btl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".$this->tukd_model->persen_real($tot_ang_btl,$tot_bel_btl)."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_ang_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_bel_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".$this->tukd_model->persen_real($tot_ang_bl,$tot_bel_bl)."<b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_ang_btl+$tot_ang_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_bel_btl+$tot_bel_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$this->tukd_model->persen_real($tot_p_seluruh,$tot_r_seluruh) ."</td>
                              </tr>  ";

                   
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 
		}else if($print==2){
			echo ("<title>REALISASI SP2D</title>");
			echo $cRet;
		}else{
			header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename=realisasi.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
		}
    }
	
	
	
	 function cetak_register_pajak($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1){ //Tox

	$print = $cetak;
    $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus) 
                    {
                        case '1': //UP
						$where2='';
                            break;
                        case '2': //GU
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //TU
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //LS gaji
                           $where2=" and status_bud <> 1 ";
                            break;                            
                    }
					
                           $where3=" and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
						   
		/*        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        } */
		
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>DAFTAR POTONGAN SP2D <br> TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
		</tr>  
		<tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"2%\" ><b>NO.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2width=\"5%\" ><b>Kode <br>OPD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"20%\" ><b>Nama OPD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" colspan=6 width=\"60%\" ><b>Potongan</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"10%\" ><b>TOTAL POTONGAN</b></td>
        </tr>           
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 21</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 22</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 23</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>Pasal 4<br>Ayat 2</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPN</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>LAINNYA</b></td>
        </tr>           
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
          </tr>
		            </thead>";
		  
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where c.sp2d_batal=1 ";
        if ($kriteria <> '--'){                               
            $where=" where  c.sp2d_batal=1 and a.kd_skpd ='$kriteria' ";            
        }       
		
        $sql = "SELECT b.kd_skpd,b.nm_skpd,
				sum(case when d.kd_rek5='2130301' then d.nilai else 0  end)PPN,
				sum(case when d.kd_rek5='2130101' then d.nilai else 0  end)pph21,
				sum(case when d.kd_rek5='2130201' then d.nilai else 0  end)pph22,
				sum(case when d.kd_rek5='2130401' then d.nilai else 0  end)pph23,
				sum(case when d.kd_rek5='2110901' then d.nilai else 0  end)PPnpn,
				sum(case when d.kd_rek5='2130501' then d.nilai else 0  end)PP4,
				sum(case when d.kd_rek5='2110801' then d.nilai else 0  end)hkpg,
				sum(case when d.kd_rek5='2110501' then d.nilai else 0  end)taperum,
				sum(case when d.kd_rek5='2110101' then d.nilai else 0  end)taspen,
				sum(case when d.kd_rek5 in ('2110701','2110702','2110703') then d.nilai else 0  end)iwp,
				sum(case when d.kd_rek5 not in ('2130301','2130101','2130201','2130401','2110901','2130501','2110801','2110501','2110101','2110701','2110702','2110703') then d.nilai else 0  end)lain
				FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				inner join TRHSPp c on a.no_spp=c.no_spp
				left join trspmpot d on a.no_spm=d.no_spm $where $where2 $where3 group by b.kd_skpd,b.nm_skpd";
		
                $hasil = $this->db->query($sql);
                $lcno = 0;
				 $t_PPN= 0;
                    $t_pph21=0;
                    $t_pph22=0;
                    $t_pph23=0;
                    $t_PPnpn=0;
                    $t_PP4=0;
                    $t_hkpg=0;
                    $t_taperum=0;
                    $t_taspen=0;
                    $t_iwp=0;
                    $t_lain=0;
                    $t_lain2=0;
                    $t_total_pjk=0;

					foreach ($hasil->result() as $row)
                {
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd= $row->nm_skpd;
                    $n_PPN= $row->PPN;
                    $n_pph21= $row->pph21;
                    $n_pph22= $row->pph22;
                    $n_pph23= $row->pph23;
                    $n_PPnpn= $row->PPnpn;
					$n_PP4= $row->PP4;
					$n_hkpg= $row->hkpg;
					$n_taperum= $row->taperum;
					$n_taspen= $row->taspen;
					$n_iwp= $row->iwp;
					$n_lain= $row->lain;
					
					$lain2=$n_hkpg+$n_taperum+$n_taspen+$n_iwp+$n_lain+$n_PPnpn;
					$total_pjk=$n_PPN+$n_pph21+$n_pph22+$n_pph23+$n_PP4+$lain2;
					
					  $t_PPN=$t_PPN+$n_PPN;
					    $t_pph21=$t_pph21+$n_pph21;
						  $t_pph22=$t_pph22+$n_pph22;
						    $t_pph23=$t_pph23+$n_pph23;
							  $t_PPnpn=$t_PPnpn+$n_PPnpn;
								
                    $t_PP4= $t_PP4+$n_PP4;
                    $t_hkpg= $t_hkpg+$n_hkpg;
                    $t_taperum= $t_taperum+$n_taperum;
                    $t_taspen=$t_taspen+$n_taspen;
                    $t_iwp= $t_iwp+$n_iwp;
                    $t_lain= $t_lain+$n_lain;

					$t_lain2=$t_lain2+$lain2;
					
					$t_total_pjk=$t_total_pjk+$total_pjk;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"center\" style=\"font-size:12px\">$kd_skpd</td>
                                <td align=\"center\" style=\"font-size:12px\">$nm_skpd</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($lain2,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($total_pjk,"2",".",",")."</td>
                              </tr>  "; 
                   
                }

                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                 <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_lain2,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_total_pjk,"2",".",",")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
		//echo("$cRet");   
    }
	
	
	function cetak_register_pajak_detail($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1){ //Tox

	$print = $cetak;
    $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus) 
                    {
                        case '1': //UP
						$where2='';
                            break;
                        case '2': //GU
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //TU
                            $where2=" and b.no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //LS gaji
                           $where2=" and status_bud <> 1 ";
                            break;                            
                    }
					
                           $where3=" and ( b.tgl_sp2d between '$dcetak' and '$dcetak2') ";
						   
		/*        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        } */
				
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>DAFTAR POTONGAN SP2D <br> TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
		</tr>  
		<tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"2%\" ><b>NO.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"5%\" ><b>Kode <br>Tanggal</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"8%\" ><b>No SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"20%\" ><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"10%\" ><b>Jumlah SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" colspan=6 width=\"60%\" ><b>POTONGAN</b></td>
        </tr>           
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 21</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 22</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 23</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>Pasal 4<br>Ayat 2</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPN</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>LAINNYA</b></td>
        </tr>           
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
			</tr>
		  </thead>";
		  
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where c.sp2d_batal=1 ";
        if ($kriteria <> '--'){                               
            $where=" where  c.sp2d_batal=1 and a.kd_skpd ='$kriteria' ";            
        }       
        		
			$sql = " SELECT b.tgl_sp2d,b.no_sp2d,b.keperluan,sum(b.nilai)nsp2d,
				sum(case when d.kd_rek5='2130301' then d.nilai else 0  end)PPN,
				sum(case when d.kd_rek5='2130101' then d.nilai else 0  end)pph21,
				sum(case when d.kd_rek5='2130201' then d.nilai else 0  end)pph22,
				sum(case when d.kd_rek5='2130401' then d.nilai else 0  end)pph23,
				sum(case when d.kd_rek5='2110901' then d.nilai else 0  end)PPnpn,
				sum(case when d.kd_rek5='2130501' then d.nilai else 0  end)PP4,
				sum(case when d.kd_rek5='2110801' then d.nilai else 0  end)hkpg,
				sum(case when d.kd_rek5='2110501' then d.nilai else 0  end)taperum,
				sum(case when d.kd_rek5='2110101' then d.nilai else 0  end)taspen,
				sum(case when d.kd_rek5 in ('2110701','2110702','2110703') then d.nilai else 0  end)iwp,
				sum(case when d.kd_rek5 not in ('2130301','2130101','2130201','2130401','2110901','2130501','2110801','2110501','2110101','2110701','2110702','2110703') then d.nilai else 0  end)lain
				FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				inner join TRHSPp c on a.no_spp=c.no_spp
				left join trspmpot d on a.no_spm=d.no_spm $where $where2 $where3 group by b.tgl_sp2d,b.no_sp2d,b.keperluan";
				
                $hasil = $this->db->query($sql);
                $lcno = 0;
					$t_PPN= 0;
					$t_sp2d=0;
                    $t_pph21=0;
                    $t_pph22=0;
                    $t_pph23=0;
                    $t_PPnpn=0;
                    $t_PP4=0;
                    $t_hkpg=0;
                    $t_taperum=0;
                    $t_taspen=0;
                    $t_iwp=0;
                    $t_lain=0;
                    $t_lain2=0;
                    $t_total_pjk=0;

				foreach ($hasil->result() as $row)
                {					
                    $no_sp2d=$row->no_sp2d;
                    $keperluan= $row->keperluan;
					$n_sp2d= $row->nsp2d;
					$tgl_sp2d=$row->tgl_sp2d;
                    $n_PPN= $row->PPN;
                    $n_pph21= $row->pph21;
                    $n_pph22= $row->pph22;
                    $n_pph23= $row->pph23;
                    $n_PPnpn= $row->PPnpn;
					$n_PP4= $row->PP4;
					$n_hkpg= $row->hkpg;
					$n_taperum= $row->taperum;
					$n_taspen= $row->taspen;
					$n_iwp= $row->iwp;
					$n_lain= $row->lain;
					
					$lain2=$n_hkpg+$n_taperum+$n_taspen+$n_iwp+$n_lain+$n_PPnpn;
					$total_pjk=$n_PPN+$n_pph21+$n_pph22+$n_pph23+$n_PP4+$lain2;
					
					$t_sp2d=$t_sp2d+$n_sp2d;
					$t_PPN=$t_PPN+$n_PPN;
					$t_pph21=$t_pph21+$n_pph21;
					$t_pph22=$t_pph22+$n_pph22;
					$t_pph23=$t_pph23+$n_pph23;
					$t_PPnpn=$t_PPnpn+$n_PPnpn;
								
                    $t_PP4= $t_PP4+$n_PP4;
                    $t_hkpg= $t_hkpg+$n_hkpg;
                    $t_taperum= $t_taperum+$n_taperum;
                    $t_taspen=$t_taspen+$n_taspen;
                    $t_iwp= $t_iwp+$n_iwp;
                    $t_lain= $t_lain+$n_lain;

					$t_lain2=$t_lain2+$lain2;
					
					$t_total_pjk=$t_total_pjk+$total_pjk;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" style=\"font-size:12px\">$lcno</td>
								<td align=\"center\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"center\" style=\"font-size:12px\">$no_sp2d</td>
                                <td align=\"left\" style=\"font-size:12px\">$keperluan</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_sp2d,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($lain2,"2",".",",")."</td>
                              </tr>  "; 
                   
                }
				
                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=4> Jumlah</td>
								<td align=\"right\" style=\"font-size:12px\">".number_format($t_sp2d,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_lain2,"2",".",",")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
		//echo("$cRet");   
    }
    
	function spd1_ag($jenis='',$tgl_spp='') {
		if ($jenis=='4') {
			$jenis = '51';
		}
		else {
			$jenis='52';
		}
        $skpd  = $this->session->userdata('kdskpd');
		if ($tgl_spp==''){
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd' and jns_beban='$jenis'";
		}else{
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd' and jns_beban='$jenis' and tgl_spd<='$tgl_spp' ";
        }
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'tgl_spd' => $resulte['tgl_spd']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
		function load_ttd($ttd){
        $kd_skpd = $this->session->userdata('kdskpd');
		//$kode_skpd = $this->input->post('kdskpd');
		$sql = "SELECT * FROM ms_ttd WHERE kd_skpd= '$kd_skpd' and kode='$ttd'";
		
        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}


	function load_ttd_dth($ttd='', $opd=''){
        //$kd_skpd = $this->session->userdata('kdskpd');
        //$kode_skpd = $this->input->post('kdskpd');
        $sql = "SELECT * FROM ms_ttd WHERE kd_skpd= '$opd' and kode='$ttd'";
        
        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
           
    }
	
	
	
	function load_ttd_ro($ttd,$kd){
       
		$sql = "SELECT * FROM ms_ttd WHERE kd_skpd='$kd' and kode='$ttd'";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}
	
	
	
	function load_ttd_ksd($ttd){
        $kd_skpd = $this->session->userdata('kdskpd');
		$kode_skpd = $this->input->post('kdskpd');
		$sql = "SELECT * FROM ms_ttd WHERE kd_skpd= '$kode_skpd' and kode='$ttd'";
		
        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}
	
	
	function skpd_unit() {
		$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd = '$kd_skpd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	function total_spd_ppkd() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdskpd  = $this->input->post('kd_skpd');
        $tglspd   = $this->input->post('tglspd');
        $beban   = $this->input->post('beban');
        $kd_rek5   = $this->input->post('kdrek5');
        if($beban==4){
			$query1   = $this->db->query(" SELECT  a.kd_kegiatan, a.kd_rek5, SUM(a.nilai) as nilai FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd 
			where kd_skpd = '$ckdskpd' and  a.kd_kegiatan = '$ckdkegi' AND a.kd_rek5='$kd_rek5' GROUP BY a.kd_kegiatan, a.kd_rek5
			");
			  
		} else{
			$query1   = $this->db->query(" SELECT  a.kd_kegiatan, SUM(a.nilai) as nilai FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd 
			where kd_skpd = '$ckdskpd' and  a.kd_kegiatan = '$ckdkegi' GROUP BY a.kd_kegiatan
			");    
		}
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['nilai'],2,'.',','),
                       // 'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
    }
	//Tambahan Anguz
	function rth(){
        $data['page_title']= 'RTH';
        $this->template->set('title', 'RTH');   
        $this->template->load('template','tukd/transaksi/rth',$data) ; 
    }
	function _mpdf_sp2d($judul='',$isi='',$lMargin='',$rMargin='',$font=0,$orientasi='') {
        
        ini_set("memory_limit","-1");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
        
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 6;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
        $this->mpdf->SetLeftMargin = $lMargin;
        $this->mpdf->SetRightMargin = $rMargin;
        $jam = date("H:i:s");
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
        $this->mpdf->AddPage($orientasi,'','',1,1,$lMargin,$rMargin,15,5);
		//$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO} ");
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);      
        $this->mpdf->Output();
    }
	function _mpdf_daftar_penguji($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='',$atas='', $bawah='', $kiri='', $kanan='') {

        ini_set("memory_limit","-1");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
        
      $header = array (
  'odd' => array (
    'L' => array (
      'content' => '  ',
      'font-size' => 11,
      'font-style' => '',
      'font-family' => 'arial',
      'color'=>'#000000'
    ),
    'C' => array (
      'content' => ' ',
      'font-size' => 15,
      'font-style' => 'B',
      'font-family' => 'arial',
      'color'=>'#000000'
    ),
    'R' => array (
      'content' => '<br>Lembaran ke {PAGENO} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br> Terdiri dari {nb} lembar ',
      'font-size' => 10,
      'font-style' => '',
      'font-family' => 'arial',
      'color'=>'#000000'
    ),
    'line' => 0,
  ),
  'even' => array ()
);

        $this->mpdf->SetLeftMargin = $lMargin;
        $this->mpdf->SetRightMargin = $rMargin;
        $jam = date("H:i:s");

		$this->mpdf = new mPDF('utf-8',array(215,330),$size); //folio
				//$this->mpdf->SetHeader($header,'');

        $this->mpdf->AddPage($orientasi,'',1,1,'',$kiri,$kanan,$atas,$bawah);
		//$this->mpdf->SetHeader(" || Halaman {PAGENO} ");
		//$this->mpdf->SetHeader($header,'');
		//$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO} ");
		//$PageCount =  $this->mpdf->getPageCount();		
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
		
		//$isi = str_replace('$page', $this->mpdf->getPageCount(), $isi);
		
        $this->mpdf->writeHTML($isi);      
		//$this->mpdf->WriteHTML("ewe".$PageCount."2323");		
        $this->mpdf->Output();
    }
	
	function _mpdf_sp2d2($judul='',$isi='',$lMargin='',$rMargin='',$font=0,$orientasi='') {
        
        ini_set("memory_limit","-1");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
        
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 6;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
        $this->mpdf->SetLeftMargin = $lMargin;
        $this->mpdf->SetRightMargin = $rMargin;
        $jam = date("H:i:s");
		$this->mpdf = new mPDF('utf-8', array(215.9,330.2),$size); //folio
        $this->mpdf->AddPage($orientasi,'','',1,1,$lMargin,$rMargin,15,5);
		//$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO} ");
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);      
        $this->mpdf->Output();
    }
	

	function cetak_rth($nbulan='',$ctk='',$ttd='', $tgl='', $cetk=''){
        $nip = str_replace('123456789',' ',$ttd);
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($tgl);
        $atas = $this->uri->segment(9);
        $bawah = $this->uri->segment(10);
        $kiri = $this->uri->segment(11);
        $kanan = $this->uri->segment(12);
		

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE KD_SKPD='$this->ppkd1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
       
	   if($cetk=='2'){
			$periode1 = $this->uri->segment(8);
			$periode2 = $this->uri->segment(9);
			
			$tgl_periode1 = substr($periode1,7,2);
			$bln_periode1 = substr($periode1,5,1);
			$thn_periode1 = substr($periode1,0,4);
			
			$tgl_periode2 = substr($periode2,8,2);
			$bln_periode2 = substr($periode2,5,2);
			
			$tanggl_prd1 = $this->tukd_model->terbilang2($tgl_periode1);
			$buln_prd1  = $this->getBulan($bln_periode1);
		
			$tanggl_prd2 = $this->tukd_model->terbilang2($tgl_periode2);
			$buln_prd2  = $this->getBulan($bln_periode2);
			
			$judul='<TR>
					<TD align="center" ><b>'.$prov.'	 <br>
					PERIODE '.$tgl_periode1.' '.$buln_prd1.' s/d '.$tgl_periode2.' '.$buln_prd2.' '.$thn.'</TD>
					</TR>';
		}else{
			$judul='<TR>
					<TD align="center"><b>'.$prov.'	 <br>
					BULAN '.strtoupper($this->tukd_model->getBulan($nbulan)).' '.$thn.'</TD>
					</TR>';
		}
		
			$cRet ='<TABLE style="border-collapse:collapse; font-size:14px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>REKAPITULASI TRANSAKSI HARIAN BELANJA DAERAH (RTH) </TD>
					</TR>
					<tr></tr>
                    '.$judul.'
					</TABLE><br/>';

			

			$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="1" cellspacing="0" cellpadding="3" align=center>
					 <thead>
					 <TR>
						<TD rowspan="2" bgcolor="#CCCCCC" align="center" >No.</TD>
                        <TD rowspan="2" bgcolor="#CCCCCC" align="center" >NAMA SKPD / KUASA BUD</TD>
						<TD colspan="2" bgcolor="#CCCCCC" align="center" >SPM / SPD </TD>
						<TD colspan="2" bgcolor="#CCCCCC" align="center" >SP2D</TD>
						<TD rowspan="2" bgcolor="#CCCCCC" align="center" >POTONGAN PAJAK</TD>
						<TD rowspan="2" bgcolor="#CCCCCC" align="center" >KET</TD>
					 </TR>
					 <TR>
                        <TD bgcolor="#CCCCCC" align="center" >JUMLAH<BR>TOTAL</TD>
						<TD bgcolor="#CCCCCC" align="center" >NILAI BELANJA<BR>TOTAL</TD>						
						<TD bgcolor="#CCCCCC" align="center" >JUMLAH<BR>TOTAL </TD>
						<TD bgcolor="#CCCCCC" align="center" >NILAI BELANJA<BR>TOTAL</TD>
					 </TR>
					 </thead>
					 ';
			if($cetk=='1'){
				$query = $this->db->query("exec cetak_rth2 $nbulan");
			}else{
				$query = $this->db->query("exec cetak_rth_periode2 '$periode1', '$periode2'");
			}
			$no=0;
			$tot_spm=0;
			$totNilspm=0;
			$tot_sp2d=0;
			$totNilsp2d=0;
			$totNilpot=0;
			   foreach ($query->result() as $row) {
				$no=$no+1;
				$kd_skpd = $row->kd_skpd; 
				$nm_skpd = $row->nm_skpd;                   
				$banyak_spm = $row->banyak_spm;                   
				$nil_spm = $row->nil_spm;                   
				$banyak_sp2d = $row->banyak_sp2d;
				$nil_sp2d =$row->nil_sp2d;
				$nil_pot=$row->nil_pot;
				$tot_spm=$tot_spm + $banyak_spm;
				$totNilspm=$totNilspm + $nil_spm;
				$tot_sp2d=$tot_sp2d + $banyak_sp2d;
				$totNilsp2d=$totNilsp2d + $nil_sp2d;
				$totNilpot=$totNilpot + $nil_pot;
				$banyak_spm1  = empty($banyak_spm) || $banyak_spm == 0 ? 0 :$banyak_spm;	
				$nil_spm1  = empty($nil_spm) || $nil_spm == 0 ? number_format(0,"2",",",".") :number_format($nil_spm,"2",",",".");	
				$banyak_sp2d1 = empty($banyak_sp2d) || $banyak_sp2d == 0 ? 0 :$banyak_sp2d;	
				$nil_sp2d1  = empty($nil_sp2d) || $nil_sp2d == 0 ? number_format(0,"2",",",".") :number_format($nil_sp2d,"2",",",".");	
				$nil_pot1  = empty($nil_pot) || $nil_pot == 0 ? number_format(0,"2",",",".") :number_format($nil_pot,"2",",",".");
			   
				$cRet .="<tr>
						<td valign=\"top\" align=\"center\"> $no </td>
						<td valign=\"top\" align=\"left\"> $nm_skpd </td>
						<td valign=\"top\" align=\"center\"> $banyak_spm1 </td>
						<td valign=\"top\" align=\"right\"> $nil_spm1 &nbsp;</td>
						<td valign=\"top\" align=\"center\"> $banyak_sp2d1 </td>
						<td valign=\"top\" align=\"right\"> $nil_sp2d1 &nbsp;</td>
						<td valign=\"top\" align=\"right\"> $nil_pot1 &nbsp;</td>
						<td valign=\"top\" align=\"right\"> &nbsp;</td>
						</tr>"  ;
				}	
				$cRet .="<tr>
						<td valign=\"top\" align=\"center\"><b> TOTAL </b></td>
						<td valign=\"top\" align=\"center\"><b> $no </b></td>
						<td valign=\"top\" align=\"center\"><b> $tot_spm</b> </td>
						<td valign=\"top\" align=\"right\"><b> ".number_format($totNilspm,"2",",",".")." </b>&nbsp;</td>
						<td valign=\"top\" align=\"center\"><b> $tot_sp2d </b></td>
						<td valign=\"top\" align=\"right\"> <b>".number_format($totNilsp2d,"2",",",".")."</b> &nbsp;</td>
						<td valign=\"top\" align=\"right\"><b> ".number_format($totNilpot,"2",",",".")."</b> &nbsp;</td>
						<td valign=\"top\" align=\"right\"> &nbsp;</td>
						</tr>"  ;
				   
			
				
			$cRet .='</TABLE>';
			
			$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';

			$data['prev']= $cRet;
             switch ($ctk)
        {
            case 0;
			echo ("<title>RTH</title>");
				echo $cRet;
				break;
            case 1;
				//$this->_mpdf('',$cRet,10,10,10,'P',1,'');
                $this->_mpdf_margin('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);
               break;
			case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename=RTH_$nbulan.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
			break;   
		}
	}
	

	
	function _mpdf($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=12;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
							//$this->mpdf->useOddEven = 1;						

        $this->mpdf->AddPage($orientasi,'',$hal,'1','off');
		if ($hal==''){
			$this->mpdf->SetFooter("");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
    }
	
	function update_sp2d(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$keperluan = $this->input->post('keperluan');
			$jns_spp = $this->input->post('jns_spp');
			$jns_beban = $this->input->post('jenis');
			$tgl_spp = $this->input->post('tgl_spp');
			$tgl_spm = $this->input->post('tgl_spm');
			$tgl_sp2d = $this->input->post('tgl_sp2d');                        
			$bulan = $this->input->post('bulan');                        
			$spd = $this->input->post('cspd');
			$bank= $this->input->post('bank');
			$nmrekan= $this->input->post('rekanan');
			$no_rek= $this->input->post('rekening');
			$npwp= $this->input->post('npwp');
			$nm_skpd= $this->input->post('nmskpd');
			$nilai= $this->input->post('nilai');
			$usernm= $this->session->userdata('pcNama');
			$last_update=  date('Y-m-d H:i:s');

			
			$lc_save='2';

			 $query2 = " UPDATE trhsp2d SET username='$usernm',tgl_sp2d='$tgl_sp2d',last_update='$last_update', jenis_beban='$jns_beban', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp' where no_sp2d='$no_sp2d' "; 
			$asg2 = $this->db->query($query2); 
          
          $query3="update trhspm set username='$usernm', last_update='$last_update', jenis_beban='$jns_beban', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp' where no_spm='$no_spm' AND kd_skpd='$kd_skpd'";
          $asg3 = $this->db->query($query3);
			
			$query1="update trhspp set username='$usernm', last_update='$last_update', jns_beban='$jns_beban', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp' where no_spp='$no_spp' AND kd_skpd='$kd_skpd'";
          $asg1 = $this->db->query($query1);
		   if($asg1){
                $lc_save='1';
            }else{
                $lc_save='2';
            }

		if ($lc_save=='1')
		{  
			echo json_encode($no_sp2d);
		}
		else
		{
			echo '2';
			}
         
	}
	
	function pending_sp2d(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$usernm= $this->session->userdata('pcNama');
			$last_update=  date('Y-m-d H:i:s');
			
			$lc_save='2';


          
          $query3="UPDATE trhspm SET username='$usernm', last_update='$last_update', status='0' WHERE no_spm='$no_spm' AND kd_skpd='$kd_skpd'";
          $asg3 = $this->db->query($query3);
			
			$query1="UPDATE trhspp SET username='$usernm', last_update='$last_update', status='0' WHERE no_spp='$no_spp' AND kd_skpd='$kd_skpd'";
          $asg1 = $this->db->query($query1);
		   if($asg1){
                $lc_save='1';
            }else{
                $lc_save='2';
            }

		if ($lc_save=='1')
		{  
			echo json_encode($no_sp2d);
		}
		else
		{
			echo '2';
			}
         
	}
	
	
	function kunci_sp2d(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$last_update=  date('Y-m-d H:i:s');
			$usernm= $this->session->userdata('pcNama');
			$last_update=  date('Y-m-d H:i:s');
			
			$lc_save='2';


          
          $query3="UPDATE trhspm SET username='$usernm', last_update='$last_update', status='1' WHERE no_spm='$no_spm' AND kd_skpd='$kd_skpd'";
          $asg3 = $this->db->query($query3);
			
			$query1="UPDATE trhspp SET username='$usernm', last_update='$last_update', status='1' WHERE no_spp='$no_spp' AND kd_skpd='$kd_skpd'";
          $asg1 = $this->db->query($query1);
		   if($asg1){
                $lc_save='1';
            }else{
                $lc_save='2';
            }

		if ($lc_save=='1')
		{  
			echo json_encode($no_sp2d);
		}
		else
		{
			echo '2';
			}
         
	}
	
	
	
	
	function simpan_sp2d(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			//$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$keperluan = $this->input->post('keperluan');
			$jns_spp = $this->input->post('jns_spp');
			$jns_beban = $this->input->post('jenis');
			$tgl_spp = $this->input->post('tgl_spp');
			$tgl_spm = $this->input->post('tgl_spm');
			$tgl_sp2d = $this->input->post('tgl_sp2d');                        
			$bulan = $this->input->post('bulan');                        
			$spd = $this->input->post('cspd');
			$bank= $this->input->post('bank');
			$nmrekan= $this->input->post('rekanan');
			$no_rek= $this->input->post('rekening');
			$npwp= $this->input->post('npwp');
			$nm_skpd= $this->input->post('nmskpd');
			$nilai= $this->input->post('nilai');
			$dir = $this->input->post('dir');
			$usernm= $this->session->userdata('pcNama');
			$sp2d_blk=$this->input->post('sp2d_blk');
			//date_default_timezone_set('Asia/Bangkok');
			$last_update=  "";
			$no_sementara = $this->input->post('no_sp2d');
			$lcstatus_input= $this->input->post('lcstatus_input');
			$no_sp2d_tag = $this->input->post('no_sp2d_tag');
			$nomor_urut='';
			$real_no_sp2d='7777';
			$lc_save='2';
//						echo $real_no_sp2d;
                    
           /* $sql = "delete from trhsp2d where kd_skpd='$kd_skpd' and no_sp2d='$no_sp2d'";
           $asg = $this->db->query($sql);    */
		   if ($lcstatus_input=='tambah'){ 
		   $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
                    values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";
			} else{
	
			 $query2 = " UPDATE trhsp2d SET no_sp2d='$no_sp2d_tag',tgl_sp2d='$tgl_sp2d', no_spm='$no_spm', tgl_spm='$tgl_spm', bulan='$bulan', kd_skpd='$kd_skpd',
			 nm_skpd='$nm_skpd', no_spp='$no_spp', tgl_spp='$tgl_spp', no_spd='$spd', username='$usernm', status='0', last_update='$last_update',
			 keperluan='$keperluan', jns_spp='$jns_spp', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp',nilai='$nilai' where no_sp2d='$no_sp2d_tag' "; 
		
  //  $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
    //                values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";	
			}           
			$asg2 = $this->db->query($query2); 
          
          $query1="update trhspm set status='1' where no_spm='$no_spm'";
          $asg3 = $this->db->query($query1);
		   if($asg3){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
		  // untuk sementara sp2d manual		
		//get nomor sp2d by tox
		//if ($jns_spp<>'4'){
		if ($lcstatus_input=='tambah'){
			$sql = "insert into nomor_sp2d (no_sp2d) values ('$no_sementara')";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
			
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sementara' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
               // echo $real_no_sp2d;
			   $lc_save='1';
            }else{
				echo '2';                
            }
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
              $lc_save='1';
            }else{
                $lc_save='2';
            }
		}
		 else{
		// sp2d ini sementara manual dulu by tox
				
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sp2d_tag' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }	  
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
               
            $lc_save='1';
            }else{
                $lc_save='2';
            }			

			}
		//}
		
		if ($lc_save=='1')
		{  
			echo json_encode($real_no_sp2d);
		}
		else
		{
			echo '2';
			}
         
	}
	
	function simpan_sp2d_gj(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			//$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$keperluan = $this->input->post('keperluan');
			$jns_spp = $this->input->post('jns_spp');
			$jns_beban = $this->input->post('jenis');
			$tgl_spp = $this->input->post('tgl_spp');
			$tgl_spm = $this->input->post('tgl_spm');
			$tgl_sp2d = $this->input->post('tgl_sp2d');                        
			$bulan = $this->input->post('bulan');                        
			$spd = $this->input->post('cspd');
			$bank= $this->input->post('bank');
			$nmrekan= $this->input->post('rekanan');
			$no_rek= $this->input->post('rekening');
			$npwp= $this->input->post('npwp');
			$nm_skpd= $this->input->post('nmskpd');
			$nilai= $this->input->post('nilai');
			$dir = $this->input->post('dir');
			$usernm= $this->session->userdata('pcNama');
			$sp2d_blk=$this->input->post('sp2d_blk');
			//date_default_timezone_set('Asia/Bangkok');
			$last_update=  "";
			$no_sementara = $this->input->post('no_sp2d');
			$lcstatus_input= $this->input->post('lcstatus_input');
			$no_sp2d_tag = $this->input->post('no_sp2d_tag');
			$nomor_urut='';
			$real_no_sp2d='7777';
			$lc_save='2';
//						echo $real_no_sp2d;
                    
           /* $sql = "delete from trhsp2d where kd_skpd='$kd_skpd' and no_sp2d='$no_sp2d'";
           $asg = $this->db->query($sql);    */
		   if ($lcstatus_input=='tambah'){ 
		   $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
                    values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";
			} else{
	
			 $query2 = " UPDATE trhsp2d SET no_sp2d='$no_sp2d_tag',tgl_sp2d='$tgl_sp2d', no_spm='$no_spm', tgl_spm='$tgl_spm', bulan='$bulan', kd_skpd='$kd_skpd',
			 nm_skpd='$nm_skpd', no_spp='$no_spp', tgl_spp='$tgl_spp', no_spd='$spd', username='$usernm', status='0', last_update='$last_update',
			 keperluan='$keperluan', jns_spp='$jns_spp', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp',nilai='$nilai' where no_sp2d='$no_sp2d_tag' "; 
		
  //  $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
    //                values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";	
			}           
			$asg2 = $this->db->query($query2); 
          
          $query1="update trhspm set status='1' where no_spm='$no_spm'";
          $asg3 = $this->db->query($query1);
		   if($asg3){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
		  // untuk sementara sp2d manual		
		//get nomor sp2d by tox
		if ($jns_spp<>'4'){
		   if ($lcstatus_input=='tambah'){
		$sql = "insert into nomor_sp2d (no_sp2d) values ('$no_sementara')";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
			
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sementara' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
               // echo $real_no_sp2d;
			   $lc_save='1';
            }else{
				echo '2';                
            }
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
              $lc_save='1';
            }else{
                $lc_save='2';
            }
		}
		 else{
		// sp2d ini sementara manual dulu by tox
				
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sp2d_tag' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }	  
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
               
            $lc_save='1';
            }else{
                $lc_save='2';
            }			

			}
		}
		
		if ($lc_save=='1')
		{  
			echo json_encode($real_no_sp2d);
		}
		else
		{
			echo '2';
			}
       //   echo '1';
          //$asg->free_result();
//          $query1->free_result();  
	}
	
	
	function load_data_sp2d_uji($dtgl1='',$dtgl2='') {
    
        $dtgl1  = $this->input->post('tgl1');
        $dtgl2  = $this->input->post('tgl2');

        $sql    = " SELECT no_sp2d, tgl_sp2d,no_spm,tgl_spm,SUM(b.nilai) as nilai from trhsp2d a
					INNER JOIN trdspp b ON a.no_spp=b.no_spp AND a.kd_skpd=b.kd_skpd
					WHERE tgl_sp2d BETWEEN '$dtgl1' AND '$dtgl2' AND 
					no_sp2d not in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) 
					GROUP BY no_sp2d, tgl_sp2d,no_spm,tgl_spm
					ORDER BY tgl_sp2d,no_sp2d"; 
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        //'tgl_sp2d' => $this->tanggal_indonesia($resulte['tgl_sp2d']),
                        'tgl_sp2d' =>$resulte['tgl_sp2d'],
						'no_spm' => $resulte['no_spm'],
						//'tgl_spm' => $this->tanggal_indonesia($resulte['tgl_spm']),
						'tgl_spm' => $resulte['tgl_spm'],
						'nilai' =>number_format($resulte['nilai'],"2",".",",") 				
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	
    }
	
	function simpan_daftar_uji(){
        $tabel    = $this->input->post('tabel');        
		$no_uji = $this->input->post('no_uji');		
		$tgl_uji = $this->input->post('tgl_uji');
		$no_blk = $this->input->post('no_blk');
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama'); 
		$lcst=$this->input->post('lcst');
		$r_nomor='2';
		
		if ($tabel == 'trhuji') {	
		$sql = "Select isnull(Max((no_urut)),0) As maks From trhuji";
		$hasil = $this->db->query($sql);
		$nomor7 = $hasil->row();
		$nomor7_urut=$nomor7->maks+1;
		$r_nomor=strval($nomor7_urut).$no_blk;

        $db_debug = $this->db->db_debug;
        $this->db->db_debug = FALSE;		
    	$csql = "INSERT INTO trhuji (no_uji,tgl_uji,username,tgl_update,no_urut) values ('$r_nomor','$tgl_uji','$user','$cwaktu','$nomor7_urut')";
    	$query1 = $this->db->query($csql);   
		$this->db->db_debug = $db_debug;	
                if($query1){
                    echo json_encode($r_nomor);
                }else{
                    echo '0';
                }
		}
		else if ($tabel == 'trduji') {
			$nomor_baru = $this->input->post('nomor_baru');
			$csql     = $this->input->post('sql');            
            // Simpan Detail //                       
 				$sql = "delete from TRDUJI where no_uji='$nomor_baru'";
                $asg = $this->db->query($sql);
				
				
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $db_debug = $this->db->db_debug;
                    $this->db->db_debug = FALSE;
					$sql = "insert into TRDUJI(no_uji,tgl_uji,no_sp2d)"; 
                    $asg = $this->db->query($sql.$csql);
					$this->db->db_debug = $db_debug;
					
					if (!($asg)){
                       //$msg = array('pesan'=>'0');
                        //echo json_encode($msg);
                     //   exit();
						echo json_encode('0');
					}  else {
                      // $msg = array('pesan'=>'1');
                       // echo json_encode($msg);
						echo json_encode('1');
					}
                }
			
		}
    }
	
	function edit_daftar_uji(){
        $tabel    = $this->input->post('tabel');        
		$no_uji = $this->input->post('no_uji');		
		$no_uji_hide = $this->input->post('no_uji_hide');		
		$tgl_uji = $this->input->post('tgl_uji');
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama'); 
				
		if ($tabel == 'trhuji') {
		$csql = "update trhuji set tgl_uji='$tgl_uji',username='$user',tgl_update='$cwaktu' where no_uji='$no_uji_hide'";
    	$query1 = $this->db->query($csql);	
    	        if($query1){
                    echo json_encode($no_uji);
                }else{
                    echo '0';
                }
		}
		else if ($tabel == 'trduji') {
			$csql     = $this->input->post('sql');            
            // Simpan Detail //                       
				$sql = "delete from TRDUJI where no_uji='$no_uji_hide'";
                $asg = $this->db->query($sql);
				
				
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into TRDUJI(no_uji,tgl_uji,no_sp2d)"; 
                    $asg = $this->db->query($sql.$csql);
					
					
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
			
		}
    }
	
	
	function hhapusuji() {    	
		$nomor = $this->input->post('no');        
        $query = $this->db->query("delete from TRHUJI where no_uji='$nomor'");
        $query = $this->db->query("delete from TRDUJI where no_uji='$nomor'");
         $query->free_result();
    }
	
	function cetak_daftar_penguji($no_uji='',$ttd='',$dcetak='',$cetak='',$atas='',$bawah='',$kiri='',$kanan=''){
	$print = $cetak;
	
			$no_uji = str_replace('123456789','/',$this->uri->segment(3));
			$lcttd = str_replace('abcdefg',' ',$this->uri->segment(4));
		
		    $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
			$sqlcount="SELECT COUNT(a.no_sp2d) as jumlah FROM trduji a INNER JOIN trhuji b ON a.no_uji=b.no_uji WHERE a.no_uji='$no_uji'";
                 $sql123=$this->db->query($sqlcount);
                 foreach ($sql123->result() as $rowcount)
                {
                    $jumlah=$rowcount->jumlah;                    
                   
                }
			$PageCount='$page';	
			$cRet ='';
			$cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-family:Tahoma; font-size:12px\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr >
                <td width=\"100%\" align=\"center\" colspan=4 style=\"font-size:18px\">DAFTAR PENGUJI / PENGANTAR<br>SURAT PERINTAH PENCAIRAN DANA</td></tr>
					 <TR >
						<TD align=\"left\" width=\"10%\">Tanggal </TD>
						<TD align=\"left\" width=\"70%\">: ".$this->tukd_model->tanggal_format_indonesia($dcetak)."</TD>
						<TD align=\"left\" width=\"10%\"></TD>
						<TD align=\"right\"  width=\"20%\">Lembaran ke 1</TD>
					 </TR>					 
					 <TR>
						<TD align=\"left\"> Nomor</TD>
						<TD align=\"left\"  >: ".$no_uji."</TD>
						<TD align=\"left\" > </TD>
						<TD align=\"right\" >Terdiri dari ".$jumlah." lembar </TD>
					 </TR>
					 </TABLE>";

			$cRet .=" <table style=\"border-collapse:collapse;font-family:Tahoma; font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">               
				<thead>
			   <tr style=\"font-size:12px;font-weight:bold;\">
                    <td width=\"5%\" align=\"center\"><b>NO</b></td>
                    <td width=\"10%\" align=\"center\" ><b>TANGGAL DAN<br>NOMOR SP2D</b></td>
                     <td  width=\"28%\" align=\"center\"><b>ATAS NAMA<br>( YANG BERHAK )</b>
					 </td>
					 <td width=\"20%\" align=\"center\" ><b>OPD</b>        
                    </td>
                    <td  width=\"10%\" align=\"center\"><b>JUMLAH KOTOR<br>(Rp)</b>
					 </td>					 
                    <td width=\"10%\" align=\"center\" ><b>JUMLAH<br>POTONGAN</b>
                    </td>
                    <td width=\"10%\" align=\"center\"><b>JUMLAH<br>BERSIH</b>
                    </td>
                    <td  width=\"10%\" align=\"center\"><b>TANGGAL<br>TRANSFER</b>
                    </td>
                   
                </tr>
				<tr style=\"font-size:11px;font-weight:bold;\">	
					<td align=\"center\" >1
                    </td>
					<td align=\"center\" >2
                    </td>
					<td align=\"center\" >3
                    </td>
					<td align=\"center\" >4
                    </td>
					<td align=\"center\" >5
                    </td>
					<td align=\"center\" >6
                    </td>
					<td align=\"center\" >7
                    </td>
					<td align=\"center\" >8
                    </td>
				</tr>
				</thead>
				";
			
			  $sql = "select b.no_sp2d,c.tgl_sp2d,c.nmrekan,c.pimpinan,c.alamat,c.kd_skpd,c.nm_skpd
,c.jns_spp,c.jenis_beban,c.kotor,c.pot FROM TRHUJI a inner join TRDUJI b on a.no_uji=b.no_uji LEFT join (
SELECT a.*,ISNULL(SUM(b.nilai),0)pot FROM (select no_sp2d,no_spm,tgl_sp2d,b.nmrekan,b.alamat,b.pimpinan,
a.kd_skpd,d.nm_skpd,a.jns_spp,a.jenis_beban, isnull(SUM(z.nilai),0)kotor
from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp AND a.kd_skpd=b.kd_skpd
INNER JOIN trdspp z ON b.no_spp=z.no_spp AND b.kd_skpd=z.kd_skpd
INNER JOIN ms_skpd d on a.kd_skpd=d.kd_skpd
GROUP BY no_sp2d,no_spm,tgl_sp2d,b.nmrekan,b.alamat,b.pimpinan,
a.kd_skpd,d.nm_skpd,a.jns_spp,a.jenis_beban)a 
LEFT JOIN 
trspmpot b ON a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd
GROUP BY no_sp2d,a.no_spm,tgl_sp2d,a.nmrekan,a.alamat,a.pimpinan,
a.kd_skpd,a.nm_skpd,a.jns_spp,a.jenis_beban,a.kotor) c on b.no_sp2d=c.no_sp2d WHERE a.no_uji='$no_uji'";
			 $hasil = $this->db->query($sql);
                    $lcno = 0;
                     $total_kotor=0;
                     $total_pot=0;
					 
					 foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
					   $no_sp2d=empty($row->no_sp2d) || $row->no_sp2d == '' ? ' ' :$row->no_sp2d;
					   //$tgl_sp2d=$row->tgl_sp2d;
					   $nmrekan=empty($row->nmrekan) || $row->nmrekan == '' ? ' ' :$row->nmrekan;
					   $pimpinan=empty($row->pimpinan) || $row->pimpinan == '' ? ' ' :$row->pimpinan;
					   $alamat=empty($row->alamat) || $row->alamat == '' ? ' ' :$row->alamat;
					   $kd_skpd=empty($row->kd_skpd) || $row->kd_skpd == '' ? ' ' :$row->kd_skpd;
					   $nm_skpd=empty($row->nm_skpd) || $row->nm_skpd == '' ? ' ' :$row->nm_skpd;
					   $jns=empty($row->jns_spp) || $row->jns_spp == '' ? ' ' :$row->jns_spp;
					   $jns_bbn=empty($row->jenis_beban) || $row->jenis_beban == '' ? ' ' :$row->jenis_beban;
					   $kotor=empty($row->kotor) || $row->kotor == '' ? 0 :$row->kotor;
					   $pot=empty($row->pot) || $row->pot == '' ? 0 :$row->pot;
					   $total_kotor=$kotor+$total_kotor;
					   $total_pot=$pot+$total_pot;
					   //$total_bersih=$total_kotor-$total_pot;
					   $tgl_sp2d=empty($row->tgl_sp2d) || $row->tgl_sp2d == '' ? ' ' :$this->tukd_model->tanggal_ind($row->tgl_sp2d);
			
						$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$kd_skpd' AND kode='BK'";
							 $sqlnam=$this->db->query($sqlnam);
							 foreach ($sqlnam->result() as $rownam)
							{
								$nama_ben=$rownam->nama;                    
								$jabat_ben=$rownam->jabatan;                    
							}
						$nama_ben = empty($nama_ben) || $nama_ben == 'NULL' ? 'Belum Ada data Bendahara' :$nama_ben;
						$jabat_ben = empty($jabat_ben) || $jabat_ben == 0 ? ' ' :$jabat_ben;
						
						
		if(($jns==6) && ($jns_bbn==3) ){
					                       					
       $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\">$lcno  
                    </td>
                    <td valign=\"top\" align=\"center\" >$no_sp2d <br> $tgl_sp2d
					</td>					
                    <td valign=\"top\" align=\"left\">$nmrekan, $pimpinan <br>$alamat
					</td>					
                    <td valign=\"top\" align=\"left\" >$kd_skpd<br>$nm_skpd
					</td>					
                    <td valign=\"top\" align=\"right\" >".number_format($kotor,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"right\" >".number_format($pot,"2",",",".")."&nbsp; 
                    </td>
                    <td valign=\"top\" align=\"right\" >".number_format($kotor-$pot,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"center\" >&nbsp; 
					</td>
									 
                </tr>
				";
		} else if(($jns==5) ){
					                       					
       $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\">$lcno  
                    </td>
                    <td valign=\"top\" align=\"center\" >$no_sp2d <br> $tgl_sp2d
					</td>					
                    <td valign=\"top\" align=\"left\">$nmrekan <br> $alamat
					</td>					
                    <td valign=\"top\" align=\"left\" >$kd_skpd<br>$nm_skpd
					</td>					
                    <td valign=\"top\" align=\"right\" >".number_format($kotor,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"right\" >".number_format($pot,"2",",",".")."&nbsp; 
                    </td>
                    <td valign=\"top\" align=\"right\" >".number_format($kotor-$pot,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"center\" >&nbsp; 
					</td>
									 
                </tr>
				";
		}  else{
		  $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\" >$lcno  
                    </td>
                    <td valign=\"top\" align=\"center\" >$no_sp2d <br> $tgl_sp2d
					</td>					
                    <td valign=\"top\" align=\"left\" >$nama_ben <br>$jabat_ben $nm_skpd
					</td>					
                    <td valign=\"top\" align=\"left\" >$kd_skpd<br>$nm_skpd
					</td>					
                    <td valign=\"top\" align=\"right\" >".number_format($kotor,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"right\" >".number_format($pot,"2",",",".")."&nbsp; 
                    </td>
                    <td valign=\"top\" align=\"right\" >".number_format($kotor-$pot,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"center\" >&nbsp; 
					</td>
									 
                </tr>
				";
			
		}
				};
				
			 $cRet .=" <tr style=\"font-size:11px;font-weight:bold;\">
                    <td colspan=\"4\" align=\"center\" >TOTAL
                    </td>
                    <td  align=\"right\" >".number_format($total_kotor,"2",",",".")."&nbsp; 
					</td>
					<td  align=\"right\" >".number_format($total_pot,"2",",",".")."&nbsp; 
					</td>
					<td  align=\"right\" >".number_format($total_kotor-$total_pot,"2",",",".")."&nbsp;
					</td>
					<td  align=\"center\" >&nbsp; 
					</td>
                </tr>
				";
			$cRet .='</table>';
			
			$cRet .=" <table style=\"border-collapse:collapse;font-weight:bold;font-family:Tahoma; font-size:11px;\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
			
			<tr >
				<td align=\"left\" width=\"70%\" style=\"height: 30px;\" >&nbsp;&nbsp;Diterima oleh : ................................................</td>
				<td align=\"center\" width=\"30%\" >$jabatan</td>
				
				</tr>
			<tr>
				<td>&nbsp;&nbsp;.....................................................</td>
				<td align=\"center\">Kuasa Bendahara Umum Daerah</td>
				</tr>
			<tr>
				<td colspan=\"2\" ><br>&nbsp;&nbsp;Petugas Bank / Pos</td>
				</tr>
			<tr >
				<td width=\"100%\" colspan=\"2\" style=\"height: 50px;\" >&nbsp;</td>
				</tr>
			<tr>
				<td>&nbsp;</td>
				<td align=\"center\"><u>$nama</u></td>
				</tr>
			<tr>
				<td>&nbsp;</td>
				<td align=\"center\">$pangkat</td>
				</tr>
			<tr>
				<td><align=\"left\" style=\"width: 250px;\">__________________________________</td>
				<td align=\"center\">NIP. $nip</td>
				</tr>
				</table>";

			$data['prev']= 'Kartu Kendali';
			if ($print==1){
			//$cRet = str_replace('$page', $this->mpdf->getPageCount(), $cRet);
	    $this->_mpdf_daftar_penguji('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);

				

		} else{
		  $cRet = str_replace('$page', '', $cRet);
		  echo $cRet;
		}
	
	}
	
    function _mpdf2($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=12;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
							//$this->mpdf->useOddEven = 1;						

        $this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
		if ($hal==''){
			$this->mpdf->SetFooter("Printed on Simakda ||  ");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }
function _mpdf_margin($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='',$atas='', $bawah='', $kiri='', $kanan='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=12;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
        $this->mpdf->AddPage($orientasi,'',$hal,'1','off',$kiri,$kanan,$atas,$bawah);
		if ($hal==''){
			$this->mpdf->SetFooter("");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda SKPD || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }

	function _mpdf3($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=15;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(240,280),$size); //folio
							//$this->mpdf->useOddEven = 1;						

        $this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
		if ($hal==''){
			$this->mpdf->SetFooter("Printed on Simakda ||  ");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }

	function lap_trm_str(){
        $data['page_title']= 'BUKU PENERIMAAN DAN PENYETORAN';
        $this->template->set('title', 'BUKU PENERIMAAN DAN PENYETORAN');   
        $this->template->load('template','tukd/pendapatan/trm_str',$data) ; 
    }
    
	
    function ctk_trm_str($dcetak='',$dcetak2='',$skpd='',$jns=''){
   	        $lcskpd2 = $skpd;
            
			$csql11 = " select nm_skpd from ms_skpd where left(kd_skpd,len('$skpd')) = '$skpd'"; 
            $rs1 = $this->db->query($csql11);
            $trh1 = $rs1->row();
            $lcskpd = strtoupper ($trh1->nm_skpd);
            
         


		 $prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd2' ");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;
            
            $cRet='';

			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
             <tr>
                <td align=\"center\" colspan=\"11\" style=\"font-size:14px;border: solid 1px white;\"><b>$lcskpd<br>BUKU PENERIMAAN DAN PENYETORAN <br> BENDAHARA PENERIMAAN</b></td>
            </tr>
           
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"6\" style=\"border: solid 1px white;\">:&nbsp;$lcskpd</td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"border: solid 1px white;border-bottom:solid 1px white;\">PERIODE</td>
                <td align=\"left\" colspan=\"8\" style=\"border: solid 1px white;border-bottom:solid 1px white;\">:&nbsp;".$this->tukd_model->tanggal_format_indonesia($dcetak)." S.D ".$this->tukd_model->tanggal_format_indonesia($dcetak2)."</td>
            </tr>
			</table>";
			
			$cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
            <thead>
			<tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\">NO</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"6\">Penerimaan</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\">Penyetoran</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\">Ket.</td>
            </tr>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Tgl</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">No Bukti</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Cara Pembayaran</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Kode Rekening</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Uraian</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Tgl</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">No STS</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
            </tr>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">1</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\">2</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">3</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">4</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">5</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\">6</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">7</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\">8</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">9</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">10</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">11</td>
            </tr>
			</thead>
           ";
					
              $sql1="SELECT a.tgl_terima tgl, a.no_terima no, 
					case when a.tgl_terima >= '$dcetak' and a.tgl_terima <= '$dcetak2' then cast (a.tgl_terima as varchar(25)) else '' end tgl_terima,
					case when a.tgl_terima >= '$dcetak' and a.tgl_terima <= '$dcetak2' then a.no_terima else '' end no_terima,
					a.kd_rek5,b.nm_rek5,
					case when a.tgl_terima >= '$dcetak' and a.tgl_terima <= '$dcetak2' then a.nilai else 0 end nilai,
					case when c.tgl_sts >= '$dcetak' and c.tgl_sts <= '$dcetak2' then cast (c.tgl_sts as varchar(25)) else '' end tgl_sts,
					case when c.tgl_sts >= '$dcetak' and c.tgl_sts <= '$dcetak2' then c.no_sts else '' end no_sts,
					case when c.tgl_sts >= '$dcetak' and c.tgl_sts <= '$dcetak2' then c.rupiah else 0 end total, 
					a.keterangan, c.status FROM tr_terima a INNER JOIN ms_rek5 b 
                    ON a.kd_rek5=b.kd_rek5 
					LEFT JOIN (SELECT x.tgl_sts,x.no_sts,x.kd_skpd,y.no_terima,SUM(y.rupiah) as rupiah, x.status FROM trhkasin_pkd x INNER JOIN trdkasin_pkd y ON x.no_sts=y.no_sts AND x.kd_skpd=y.kd_skpd AND x.kd_kegiatan=y.kd_kegiatan
					GROUP BY x.tgl_sts,x.no_sts,x.kd_skpd,y.no_terima, x.status) c 
					ON a.no_terima=c.no_terima AND a.kd_skpd=c.kd_skpd
					where ((a.tgl_terima >= '$dcetak' and a.tgl_terima <= '$dcetak2') or (c.tgl_sts >= '$dcetak' and c.tgl_sts <= '$dcetak2')) 
					and left(a.kd_skpd,len('$skpd')) = '$skpd'
					union all
					select x.tgl_kas tgl, x.no_sts no, '' tgl_terima, '' no_terima, kd_rek5, (select nm_rek5 from ms_rek5 where kd_rek5=y.kd_rek5) nm_rek5,	
					0 nilai, cast (x.tgl_sts as varchar(25)) tgl_sts, x.no_sts, y.rupiah total, x.keterangan,	x.status
					FROM trhkasin_pkd x INNER JOIN trdkasin_pkd y ON x.no_sts=y.no_sts AND x.kd_skpd=y.kd_skpd AND x.kd_kegiatan=y.kd_kegiatan
					where x.tgl_sts >= '$dcetak' and x.tgl_sts <= '$dcetak2' and left(x.kd_skpd,len('$skpd')) = '$skpd' and jns_trans='2'
					union all
					select x.tgl_kas tgl, x.no_sts no, x.tgl_kas tgl_terima, x.no_sts no_terima, kd_rek5, (select nm_rek5 from ms_rek5 where kd_rek5=y.kd_rek5) nm_rek5,	
					y.rupiah*-1 nilai, cast (x.tgl_sts as varchar(25)) tgl_sts, x.no_sts, y.rupiah*-1 total, x.keterangan, x.status
					FROM trhkasin_pkd x INNER JOIN trdkasin_pkd y ON x.no_sts=y.no_sts AND x.kd_skpd=y.kd_skpd AND x.kd_kegiatan=y.kd_kegiatan
					where x.tgl_sts >= '$dcetak' and x.tgl_sts <= '$dcetak2' and left(x.kd_skpd,len('$skpd')) = '$skpd' and jns_trans='3'
					order by tgl, no";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lnnilai = 0;                                 
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lnnilai = $lnnilai + $row->nilai;
                    $lntotal = $lntotal + $row->total;
                    $tgl=$row->tgl_terima;
                    $bukti=$row->no_terima;
                    $rek=$row->kd_rek5;                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",",",".");
                    $tgl_sts=$row->tgl_sts;
					$ket=$row->keterangan;
					if($tgl_sts==''){
						$tgl_sts='';
					} else{
						$tgl_sts=$this->tukd_model->tanggal_ind($tgl_sts);
					}
                    $nosts=$row->no_sts;
                    $total=number_format($row->total,"2",",","."); 
					
                     $cRet    .= " <tr><td align=\"center\" width=\"5%\">$lcno</td>
                                        <td align=\"center\" width=\"15%\">".$this->tukd_model->tanggal_ind($tgl)."</td>
                                        <td align=\"center\" width=\"10%\">$bukti</td>
                                        <td align=\"center\" width=\"5%\">Tunai</td>
                                        <td align=\"center\" width=\"5%\">$rek</td>
                                        <td align=\"left\" width=\"20%\">$uraian</td>
                                        <td align=\"right\" width=\"10%\">$nilai</td>
                                        <td align=\"center\" width=\"15%\">$tgl_sts</td>
                                        <td align=\"center\" width=\"10%\">$nosts</td>
                                        <td align=\"right\" width=\"10%\">$total</td>
                                        <td align=\"left\" width=\"10%\">$ket</td>
                                     </tr>
                                     ";
                }
			
			$cRet    .= " <tr><td colspan=\"6\" align=\"center\"><b>Jumlah</b></td>
								<td align=\"right\" width=\"10%\"><b>".number_format($lnnilai,"2",",",".")."</b></td>
								<td align=\"center\" width=\"15%\"></td>
								<td align=\"center\" width=\"10%\"></td>
								<td align=\"right\" width=\"10%\"><b>".number_format($lntotal,"2",",",".")."</b></td>
								<td align=\"left\" width=\"10%\"></td>
							 </tr>
							 </table>";
							 
			

			$data['prev']= '';
			if ($jns==1){
			$this->_mpdf('',$cRet,10,10,10,'1',1,''); 
			} else{
				echo ("<title>Buku Penerimaan Penyetoran</title>");
				echo $cRet;
				}

	}
    
	//pengesahan_spp_tu
	function pengesahan_spp_tu() {
        $data['page_title']= 'PENGESAHAN SPP TU';
        $this->template->set('title', 'PENGESAHAN SPP TU');   
        $this->template->load('template','tukd/spp/pengesahan_spp',$data) ; 
    }
	
	function load_pengesahan_spp() {
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
		$kd_skpd  = $this->session->userdata('kdskpd');
        $id  = $this->session->userdata('pcUser');        
		$kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = " AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')  ";
        if ($kriteria <> ''){                               
            $where="AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') and (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhspp WHERE jns_spp ='3' $where ";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
		//alert('aaa');
		
        $sql = "SELECT TOP $rows * from trhspp WHERE jns_spp ='3' $where 
		and no_spp not in (SELECT TOP $offset no_spp from trhspp WHERE kd_skpd != '' $where) and (sp2d_batal!='1' or sp2d_batal is null) order by no_spp,kd_skpd";
       // $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte){ 
            $row[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'jns_beban' => $resulte['jns_beban'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan'],
                        'no_tagih'=>$resulte['no_tagih'],
                        'tgl_tagih'=>$resulte['tgl_tagih'],
                        'alamat'=>$resulte['alamat'],
                        'lanjut'=>$resulte['lanjut'],
                        'kontrak'=>$resulte['kontrak'],
                        'tgl_mulai'=>$resulte['tgl_mulai'],
                        'tgl_akhir'=>$resulte['tgl_akhir'],
                        'sts_tagih'=>$resulte['sts_tagih'],     
                        'sts_setuju'=>$resulte['sts_setuju']     
                        );
                        $ii++;
        }
		$result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
	}

	function setuju_spp() {
    $spp = $this->input->post('no_spp');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhspp SET sts_setuju='1' WHERE no_spp='$spp' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '2';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	/*function batal_spp() {
    $spp = $this->input->post('no_spp');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhspp SET sts_setuju='0' WHERE no_spp='$spp' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}*/
    function batal_spp(){
        $skpd     = $this->session->userdata('kdskpd');
        $nospp      = $this->input->post('nospp');
        $ket      = $this->input->post('ket');  
        $jns_spp      = $this->input->post('jns_spp');          
        $usernm      = $this->session->userdata('pcNama');
        $last_update=  date('d-m-y H:i:s');
        
        $sql = "update trhspp set sp2d_batal='1',ket_batal='$ket',user_batal='$usernm',tgl_batal='$last_update' where no_spp='$nospp'"; 
        $asg = $this->db->query($sql);  
        
        if($jns_spp=='6'){              
            $query1 = "select ltrim(no_tagih) [no_tagih] from trhspp where no_spp='$nospp'"; 
            $hquery1 = $this->db->query($query1);
            $no_tagih = $hquery1->row('no_tagih');
            if($no_tagih!=''){
                $sql1 = "update trhspp set no_tagih='',kontrak='',sts_tagih='0',nmrekan='',pimpinan='' where no_spp='$nospp'"; 
                $asg1 = $this->db->query($sql1);  
                $sql2 = "update trhtagih set sts_tagih='0' where no_bukti='$no_tagih'"; 
                $asg2 = $this->db->query($sql2);  
            }
        }
        
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
    }
	

    function cetak_pengesahan_spp(){
		$spasi   = $this->uri->segment(10);
		$cetak = $this->uri->segment(3);
        $kd = $this->uri->segment(5);
        $jns = $this->uri->segment(6);
        $tanpa   = $this->uri->segment(11);
		$nm_skpd=$this->rka_model->get_nama($kd,'nm_skpd','ms_skpd','kd_skpd');
        $nomor=str_replace('123456789','/',$this->uri->segment(4));
		$alamat_skpd = $this->rka_model->get_nama($kd,'alamat','ms_skpd','kd_skpd');		
        $kodepos = $this->rka_model->get_nama($kd,'kodepos','ms_skpd','kd_skpd');
			if($kodepos==''){
				$kodepos = "-------";
			} else {
				$kodepos = "$kodepos";
			}
        $BK = str_replace('123456789',' ',$this->uri->segment(7));
        $PPTK = str_replace('123456789',' ',$this->uri->segment(8));
        $PPKD = str_replace('123456789',' ',$this->uri->segment(9));
			$nip='';                     
			$nama= ''; 
			$jabatan  = ''; 
			$pangkat  = ''; 


		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where nip='$BK' and kode = 'BK' AND kd_skpd='$kd'";
		 $sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
		{
			$nip=$rowttd->nip;                    
			$nama= $rowttd->nm;
			$jabatan  = $rowttd->jab;
			$pangkat  = $rowttd->pangkat;
		}
		
		if($PPTK=='-'){
				$nip2='';                    
				$nama2= '';
				$jabatan2  = '';
				$pangkat2  = '';
				$jdl2 = '';
		}else{
			$sqlttd2="SELECT nama as nm2,nip as nip,jabatan as jab , pangkat FROM ms_ttd where nip='$PPTK' and kode = 'PPTK' AND kd_skpd='$kd'";
			$sqlttd2=$this->db->query($sqlttd2);
			foreach ($sqlttd2->result() as $rowttd2){
				$nip2= 'NIP. '.$rowttd2->nip;                    
				$nama2= $rowttd2->nm2;
				$jabatan2  = $rowttd2->jab;
				$pangkat2  = $rowttd2->pangkat;
				$jdl2 = 'MENGETAHUI :';
			}
		}
		

			$nip3	= '';                    
			$nama3	= '';
			$jabatan3  = '';
			$pangkat3  = '';
		
		$sqlttd3="SELECT nama as nm2,nip as nip,jabatan as jab , pangkat FROM ms_ttd where nip='$PPKD' and kode = 'BUD' ";
		 $sqlttd3=$this->db->query($sqlttd3);
		 foreach ($sqlttd3->result() as $rowttd3)
		{
			$nip3	= $rowttd3->nip;                    
			$nama3	= $rowttd3->nm2;
			$jabatan3  = $rowttd3->jab;
			$pangkat3  = $rowttd3->pangkat;
		}
		
		
		
        if ($jns==1){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor' AND kd_skpd='$kd'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$kd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
       
        $thn_ang	   = $this->session->userdata('pcThang');
		if($tanpa==1) {
			$tanggal ="_______________________$thn_ang";
			}          
        $cRet='';
       $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td rowspan=\"5\" align=\"right\">
                        <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
                        </td>
					    <td colspan=\"2\" align=\"center\" style=\"font-size:14px\"><strong>PEMERINTAH PROVINSI KALIMANTAN BARAT </strong></td></tr>";

       $cRet .="    
                    <tr><td align=\"center\" style=\"font-size:13px\"><pre style=\"font-family: Times New Roman;\">$nm_skpd</pre></td></tr>
					<tr><td align=\"center\" style=\"font-size:12px\">$alamat_skpd</td></tr>
                    <tr><td align=\"right\">".strtoupper($daerah)." &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
					&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
					&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp; &nbsp; &nbsp;  Kode Pos: $kodepos &nbsp; &nbsp;</td>	</tr>
					</table>
					<hr  width=\"100%\"> 
					";
					
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor </strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN RENCANA PENGGUNA ANGGARAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$spasi\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $nilai=number_format($row->nilai,"2",",",".");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$kd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$nm_skpd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor' AND kd_skpd='$kd'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",",",".");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 }
				$cRet    .=" <tr><td colspan=\"4\" style=\"border-right:hidden;border-bottom:hidden;border-left:hidden;\" align=\"left\">
						Terbilang : <b><i>".ucwords($this->tukd_model->terbilang($rowp->tot))."</i></b></td>                                     
                                                                       
                                     </tr>";
        $cRet .=       " </table>";
       $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td>                    
                    <td align=\"center\" width=\"25%\">$daerah, $tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td>                    
                    <td align=\"center\" width=\"25%\">$jabatan</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"><b><u></u></b><br>
					 <br>
					 </td>                    
                    <td align=\"center\" width=\"25%\"><b><u>$nama</u></b><br>
					 $pangkat <br>
					 NIP. $nip</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                  </table>";
                $data['prev']= $cRet;
			 if($cetak=='1'){
			$this->_mpdf('',$cRet,10,10,10,'0',1,''); 
				}
				if($cetak=='0'){
				echo $cRet;
				}
       }
        if ($jns==2){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor' AND kd_skpd='$kd'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
				   $nmskpd = $rowtg->nm_skpd;
				   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$kd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        
        $thn_ang	   = $this->session->userdata('pcThang');
		if($tanpa==1) {
			$tanggal ="_______________________$thn_ang";
			}          
        $cRet='';
       $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td rowspan=\"5\" align=\"right\">
                        <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
                        </td>
					    <td colspan=\"2\" align=\"center\" style=\"font-size:14px\"><strong>PEMERINTAH PROVINSI KALIMANTAN BARAT </strong></td></tr>";

 
        
        if(substr($kd,0,7)==$this->org_keu && $kd!=$this->skpd_keu ){
                $nm_org = $this->rka_model->get_nama($this->skpd_keu,'nm_skpd','ms_skpd','kd_skpd');           
                $cRet .="<tr><td align=\"center\" style=\"font-size:13px\">$nm_org</tr>";
        }

       $cRet .="    
                    <tr><td align=\"center\" style=\"font-size:13px\"><pre style=\"font-family: Times New Roman;\">$nm_skpd</pre></td></tr>
					<tr><td align=\"center\" style=\"font-size:12px\">$alamat_skpd</td></tr>
                    <tr><td align=\"right\">".strtoupper($daerah)." &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
					&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
					&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp; &nbsp; &nbsp;  Kode Pos: $kodepos &nbsp; &nbsp;</td>	</tr>
					</table>
					<hr  width=\"100%\"> 
					";
					
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td align=\"center\" style=\"font-size:16px\"><b>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN</b></td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\"><b>(SPP - GU)</b></td></tr>
                    <tr><td align=\"center\"><strong>Nomor :$nomor</strong></td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\"><strong><u>RINCIAN</u></strong></td></tr>
                    <tr><td align=\"center\">&nbsp;</td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"$spasi\" cellpadding=\"0\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 //$sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 $sql1="SELECT SUM(nilai) AS nilai FROM trdspp WHERE no_spp='$nomor' AND kd_skpd='$kd'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                 $lcno = 0;
                 $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                   // $giat=$row->kd_kegiatan;
                   // $rek=$row->kd_rek5;
                    //$reke=$this->dotrek($rek);                    
                    //$uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$kd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$nm_skpd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor' AND kd_skpd='$kd'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\"></td>                                     
                                     </tr>";
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"right\"><b>JUMLAH</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\"><b>$totp</b></td>                                     
                                     </tr>";
                 } 
			$cRet    .=" <tr><td colspan=\"4\" style=\"border-right:hidden;border-bottom:hidden;border-left:hidden;\" align=\"left\">
						Terbilang : <b><i>".ucwords($this->tukd_model->terbilang($rowp->tot))."</i></b></td>                                     
                                                                       
                                     </tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">$jdl2</td>                    
                    <td align=\"center\" width=\"25%\">$daerah, $tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">$jabatan2</td>                    
                    <td align=\"center\" width=\"25%\">$jabatan</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"><b><u>$nama2</u></b><br>
					 $pangkat2 <br>
					 $nip2</td>                    
                    <td align=\"center\" width=\"25%\"><b><u>$nama</u></b><br>
					 $pangkat <br>
					 NIP. $nip</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                  </table>";
		
                $data['prev']= $cRet;
			 if($cetak=='1'){
			$this->_mpdf('',$cRet,10,10,10,'0',1,''); 
				}
				if($cetak=='0'){
				echo $cRet;
				}
       }
       
       if ($jns==3){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor' AND kd_skpd='$kd'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
				   $nmskpd = $rowtg->nm_skpd;
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$kd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
       
        $thn_ang	   = $this->session->userdata('pcThang');
		if($tanpa==1) {
			$tanggal ="_______________________$thn_ang";
			}          
        $cRet='';
       $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td rowspan=\"5\" align=\"right\">
                        <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
                        </td>
					    <td colspan=\"2\" align=\"center\" style=\"font-size:14px\"><strong>PEMERINTAH PROVINSI KALIMANTAN BARAT </strong></td></tr>";

 
       $cRet .="    
                    <tr><td align=\"center\" style=\"font-size:13px\"><pre style=\"font-family: Times New Roman;\">$nm_skpd</pre></td></tr>
					<tr><td align=\"center\" style=\"font-size:12px\">$alamat_skpd</td></tr>
                    <tr><td align=\"right\">".strtoupper($daerah)." &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
					&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
					&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp; &nbsp; &nbsp;  Kode Pos: $kodepos &nbsp; &nbsp;</td>	</tr>
					</table>
					<hr  width=\"100%\"> 
					";
					
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td align=\"center\" style=\"font-size:16px\">SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN</td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\">(SPP - TU)</td></tr>
                    <tr><td align=\"center\"><strong>Nomor :$nomor</strong></td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\"><strong><u>RINCIAN</u></strong></td></tr>
                    <tr><td align=\"center\">&nbsp;</td></tr>
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$spasi\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                // $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 $sql1="SELECT 1 urut, LEFT(c.kd_kegiatan,18) as kode, d.nm_program as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					INNER JOIN trskpd d ON c.kd_kegiatan=d.kd_kegiatan  AND c.kd_skpd=d.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY LEFT(c.kd_kegiatan,18), d.nm_program
					UNION ALL
					SELECT 2 urut, c.kd_kegiatan as kode, c.nm_kegiatan as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					INNER JOIN trskpd d ON c.kd_kegiatan=d.kd_kegiatan  AND c.kd_skpd=d.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,c.nm_kegiatan
					UNION ALL
					SELECT 3 urut, c.kd_kegiatan+'.'+LEFT(c.kd_rek5,3) as kode, d.nm_rek3 as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd 
					LEFT JOIN ms_rek3 d ON LEFT(c.kd_rek5,3)=d.kd_rek3 
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,LEFT(c.kd_rek5,3),d.nm_rek3
					UNION ALL
					SELECT 4 urut, c.kd_kegiatan+'.'+LEFT(c.kd_rek5,5) as kode, d.nm_rek4 as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					LEFT JOIN ms_rek4 d ON LEFT(c.kd_rek5,5)=d.kd_rek4
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,LEFT(c.kd_rek5,5),d.nm_rek4
					UNION ALL
					SELECT 5 urut, c.kd_kegiatan+'.'+c.kd_rek5 as kode, c.nm_rek5 as nama, c.nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					order by kode";
                  $query = $this->db->query($sql1);
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row){   
                    
                    $kode=$row->kode;
                    $uraian=$row->nama;
                    $urut=$row->urut;
                    $nilai=$row->nilai;                    
					if($urut==1){
					$lcno=$lcno+1;
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$lcno</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"><b>$kode</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\"><b>$uraian</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".number_format($nilai,"2",".",",")."</b></td>
                                     </tr>
                                     ";
					} else if($urut==5){
					$lntotal = $lntotal + $row->nilai;
					 $rek=substr($kode,22,7);
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">".$this->left($kode,21).".".$this->dotrek($rek)."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format($nilai,"2",".",",")."</td>
                                     </tr>
                                     ";	
					}else {
					$rek=substr($kode,22,7);
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">".$this->left($kode,22)."".$this->dotrek($rek)."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format($nilai,"2",".",",")."</td>
                                     </tr>
                                     ";
					}
                }
                   
				   $totp=number_format($lntotal,"2",".",",");
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"RIGHT\"><b>JUMLAH</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\"><b>$totp</b></td>                                     
                                     </tr>";
                  

        $cRet .=       " </table>";
		$cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
				<tr><td>Terbilang :".ucwords($this->tukd_model->terbilang($lntotal))." </td></tr>
				</table>";
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td>                    
                    <td align=\"center\" width=\"25%\">$daerah, $tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">$jabatan2</td>                    
                    <td align=\"center\" width=\"25%\">$jabatan</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"><b><u>$nama2</u></b><br>
					 $pangkat2 <br>
					 $nip2</td>                    
                    <td align=\"center\" width=\"25%\"><b><u>$nama</u></b><br>
					 $pangkat <br>
					 $nip</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                  </table>";
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td></tr>
                    <tr><td align=\"center\" width=\"25%\">$jabatan3</td></tr> 
					<tr><td align=\"center\" width=\"25%\">&nbsp;</td></tr> 
					<tr><td align=\"center\" width=\"25%\">&nbsp;</td></tr>	
					<tr><td align=\"center\" width=\"25%\">&nbsp;</td></tr>					
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"><b><u>$nama3</u></b><br>
					 $pangkat3 <br>
					 $nip3</td></tr>
                  </table>";		  
				  
                $data['prev']= $cRet;
                if($cetak=='1'){
			$this->_mpdf('',$cRet,10,10,10,'0',1,''); 
				}
				if($cetak=='0'){
				echo $cRet;
				}
	   }
	   
        
        if ($jns==4){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor' AND kd_skpd='$kd'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $nmskpd = $rowtg->nm_skpd;
				   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$kd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }

        $thn_ang	   = $this->session->userdata('pcThang');
		if($tanpa==1) {
			$tanggal ="_______________________$thn_ang";
			} 

		$jns_bbn=$this->rka_model->get_nama2($nomor,'jns_beban','trhspp','no_spp','kd_skpd',$kd);
		switch ($jns_bbn) 
        {
            case '1': //UP
                $lcbeban = "Gaji dan Tunjangan";
                break;
            case '2': //GU
                $lcbeban = "Uang Kespeg";
                break;
            case '3': //TU
                $lcbeban = "Uang Makan";
                break;
			case '4': //TU
                $lcbeban = "Upah Pungut";
                break;
			case '5': //TU
                $lcbeban = "Upah Pungut PBB";
                break;
			case '6': //TU
                $lcbeban = "Upah Pungut PBB-KB PKB & BBN-KB ";
                break;
			case '7': //TU
                $lcbeban = "Gaji & Tunjangan";
                break;
			case '8': //TU
                $lcbeban = "Tunjangan Transport";
                break;
			case '9': //TU
                $lcbeban = "Tunjangan Lainnya";
                break;
            default:
                $lcbeban = "LS";
        }
			
        $cRet='';
       $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td rowspan=\"5\" align=\"right\">
                        <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
                        </td>
					    <td colspan=\"2\" align=\"center\" style=\"font-size:14px\"><strong>PEMERINTAH PROVINSI KALIMANTAN BARAT </strong></td></tr>";

 
        
        if(substr($kd,0,7)==$this->org_keu && $kd!=$this->skpd_keu ){
                $nm_org = $this->rka_model->get_nama($this->skpd_keu,'nm_skpd','ms_skpd','kd_skpd');           
                $cRet .="<tr><td align=\"center\" style=\"font-size:13px\">$nm_org</tr>";
        }

       $cRet .="    
                    <tr><td align=\"center\" style=\"font-size:13px\"><pre style=\"font-family: Times New Roman;\">$nm_skpd</pre></td></tr>
					<tr><td align=\"center\" style=\"font-size:12px\">$alamat_skpd</td></tr>
                    <tr><td align=\"right\">".strtoupper($daerah)." &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
					&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
					&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp; &nbsp; &nbsp;  Kode Pos: $kodepos &nbsp; &nbsp;</td>	</tr>
					</table>
					<hr  width=\"100%\"> 
					";
					
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td align=\"center\" style=\"font-size:16px\">SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN</td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\">(SPP - LS ".strtoupper($lcbeban).")</td></tr>
                    <tr><td align=\"center\"><strong>Nomor :$nomor</strong></td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\"><strong><u>RINCIAN</u></strong></td></tr>
                    <tr><td align=\"center\">&nbsp;</td></tr>
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>
                    <tr><td align=\"left\">BULAN : ".strtoupper($bln)."</td></tr>

                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$spasi\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="SELECT 1 urut, LEFT(c.kd_kegiatan,18) as kode, d.nm_program as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					INNER JOIN trskpd d ON c.kd_kegiatan=d.kd_kegiatan  AND c.kd_skpd=d.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY LEFT(c.kd_kegiatan,18), d.nm_program
					UNION ALL
					SELECT 2 urut, c.kd_kegiatan as kode, c.nm_kegiatan as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					INNER JOIN trskpd d ON c.kd_kegiatan=d.kd_kegiatan  AND c.kd_skpd=d.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,c.nm_kegiatan
					UNION ALL
					SELECT 3 urut, c.kd_kegiatan+'.'+LEFT(c.kd_rek5,3) as kode, d.nm_rek3 as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd 
					LEFT JOIN ms_rek3 d ON LEFT(c.kd_rek5,3)=d.kd_rek3 
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,LEFT(c.kd_rek5,3),d.nm_rek3
					UNION ALL
					SELECT 4 urut, c.kd_kegiatan+'.'+LEFT(c.kd_rek5,5) as kode, d.nm_rek4 as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					LEFT JOIN ms_rek4 d ON LEFT(c.kd_rek5,5)=d.kd_rek4
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,LEFT(c.kd_rek5,5),d.nm_rek4
					UNION ALL
					SELECT 5 urut, c.kd_kegiatan+'.'+c.kd_rek5 as kode, c.nm_rek5 as nama, c.nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					order by kode";
                  $query = $this->db->query($sql1);
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row){   
                    
                    $kode=$row->kode;
                    $uraian=$row->nama;
                    $urut=$row->urut;
                    $nilai=$row->nilai;                    
					if($urut==1){
					$lcno=$lcno+1;
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$lcno</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"><b>$kode</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\"><b>$uraian</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".number_format($nilai,"2",".",",")."</b></td>
                                     </tr>
                                     ";
					} else if($urut==5){
					$lntotal = $lntotal + $row->nilai;
					 $rek=substr($kode,22,7);
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">".$this->left($kode,21).".".$this->dotrek($rek)."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format($nilai,"2",".",",")."</td>
                                     </tr>
                                     ";	
					}else {
					$rek=substr($kode,22,7);
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">".$this->left($kode,22)."".$this->dotrek($rek)."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format($nilai,"2",".",",")."</td>
                                     </tr>
                                     ";
					}
                }
                   
				   $totp=number_format($lntotal,"2",".",",");
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"RIGHT\"><b>JUMLAH</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\"><b>$totp</b></td>                                     
                                     </tr>";
                  

        $cRet .=       " </table>";
		$cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
				<tr><td>Terbilang :".ucwords($this->tukd_model->terbilang($lntotal))." </td></tr>
				</table>";
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td>                    
                    <td align=\"center\" width=\"25%\">$daerah, $tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td>                    
                    <td align=\"center\" width=\"25%\">$jabatan</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"></td>                    
                    <td align=\"center\" width=\"25%\"><b><u>$nama</u></b><br>
					 $pangkat <br>
					 NIP. $nip</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                  </table>";
                $data['prev']= $cRet;
				if($cetak=='1'){
			$this->_mpdf('',$cRet,10,10,10,'0',1,''); 
				}
				if($cetak=='0'){
				echo $cRet;
				}
       }
       if ($jns==6){
        
        $sqltgl="SELECT nm_skpd,tgl_spp FROM trhspp where no_spp='$nomor' AND kd_skpd='$kd'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $nmskpd=$rowtg->nm_skpd;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$kd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }

        $thn_ang	   = $this->session->userdata('pcThang');
		if($tanpa==1) {
			$tanggal ="_______________________$thn_ang";
			}          
		$jns_bbn=$this->rka_model->get_nama2($nomor,'jns_beban','trhspp','no_spp','kd_skpd',$kd);
		switch ($jns_bbn) 
        {
            case '1': //UP
                $lcbeban = "PNS";
                break;
            case '2': //GU
                $lcbeban = "Non PNS";
                break;
            case '3': //TU
                $lcbeban = "Barang dan Jasa";
                break;
        }
        $cRet='';
       $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td rowspan=\"5\" align=\"right\">
                        <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
                        </td>
					    <td colspan=\"2\" align=\"center\" style=\"font-size:14px\"><strong>PEMERINTAH PROVINSI KALIMANTAN BARAT </strong></td></tr>";

 
        
        if(substr($kd,0,7)==$this->org_keu && $kd!=$this->skpd_keu ){
                $nm_org = $this->rka_model->get_nama($this->skpd_keu,'nm_skpd','ms_skpd','kd_skpd');           
                $cRet .="<tr><td align=\"center\" style=\"font-size:13px\">$nm_org</tr>";
        }

       $cRet .="    
                    <tr><td align=\"center\" style=\"font-size:13px\"><pre style=\"font-family: Times New Roman;\">$nm_skpd</pre></td></tr>
					<tr><td align=\"center\" style=\"font-size:12px\">$alamat_skpd</td></tr>
                    <tr><td align=\"right\">".strtoupper($daerah)." &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
					&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
					&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp; &nbsp; &nbsp;  Kode Pos: $kodepos &nbsp; &nbsp;</td>	</tr>
					</table>
					<hr  width=\"100%\"> 
					";
					
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td align=\"center\" style=\"font-size:16px\">SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA</td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\">(SPP - LS ".strtoupper($lcbeban)." )</td></tr>
                    <tr><td align=\"center\"><strong>Nomor :$nomor</strong></td></tr>
                    <tr><td align=\"center\" style=\"font-size:16px\"><strong><u>RINCIAN</u></strong></td></tr>
                    <tr><td align=\"center\">&nbsp;</td></tr>
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>

                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$spasi\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td> 
                            <td bgcolor=\"#CCCCCC\" width=\"35%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
					 $sql1="SELECT 1 urut, LEFT(c.kd_kegiatan,18) as kode, d.nm_program as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					INNER JOIN trskpd d ON c.kd_kegiatan=d.kd_kegiatan  AND c.kd_skpd=d.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY LEFT(c.kd_kegiatan,18), d.nm_program
					UNION ALL
					SELECT 2 urut, c.kd_kegiatan as kode, c.nm_kegiatan as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					INNER JOIN trskpd d ON c.kd_kegiatan=d.kd_kegiatan  AND c.kd_skpd=d.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,c.nm_kegiatan
					UNION ALL
					SELECT 3 urut, c.kd_kegiatan+'.'+LEFT(c.kd_rek5,3) as kode, d.nm_rek3 as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd 
					LEFT JOIN ms_rek3 d ON LEFT(c.kd_rek5,3)=d.kd_rek3 
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,LEFT(c.kd_rek5,3),d.nm_rek3
					UNION ALL
					SELECT 4 urut, c.kd_kegiatan+'.'+LEFT(c.kd_rek5,5) as kode, d.nm_rek4 as nama,SUM(c.nilai) as nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					LEFT JOIN ms_rek4 d ON LEFT(c.kd_rek5,5)=d.kd_rek4
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					GROUP BY c.kd_kegiatan,LEFT(c.kd_rek5,5),d.nm_rek4
					UNION ALL
					SELECT 5 urut, c.kd_kegiatan+'.'+c.kd_rek5 as kode, c.nm_rek5 as nama, c.nilai
					FROM trhspp b
					INNER JOIN trdspp c ON b.no_spp=c.no_spp AND b.kd_skpd=c.kd_skpd
					WHERE b.no_spp='$nomor' AND b.kd_skpd='$kd'
					order by kode";
                  $query = $this->db->query($sql1);
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row){   
                    
                    $kode=$row->kode;
                    $uraian=$row->nama;
                    $urut=$row->urut;
                    $nilai=$row->nilai;                    
					if($urut==1){
					$lcno=$lcno+1;
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$lcno</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"><b>$kode</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\"><b>$uraian</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".number_format($nilai,"2",".",",")."</b></td>
                                     </tr>
                                     ";
					} else if($urut==5){
					$lntotal = $lntotal + $row->nilai;
					 $rek=substr($kode,22,7);
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">".$this->left($kode,21).".".$this->dotrek($rek)."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format($nilai,"2",".",",")."</td>
                                     </tr>
                                     ";	
					}else {
					$rek=substr($kode,22,7);
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">".$this->left($kode,22)."".$this->dotrek($rek)."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format($nilai,"2",".",",")."</td>
                                     </tr>
                                     ";
					}
                }
                   
				   $totp=number_format($lntotal,"2",".",",");
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"RIGHT\"><b>JUMLAH</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\"><b>$totp</b></td>                                     
                                     </tr>";
                  

        $cRet .=       " </table>";
		$cRet .= "<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
				<tr><td>Terbilang :".ucwords($this->tukd_model->terbilang($lntotal))." </td></tr>
				</table>";
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">MENGETAHUI :</td>                    
                    <td align=\"center\" width=\"25%\">$daerah, $tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">$jabatan2</td>                    
                    <td align=\"center\" width=\"25%\">$jabatan</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\"><b><u>$nama2</u></b><br>
					 $pangkat2 <br>
					 $nip2</td>                    
                    <td align=\"center\" width=\"25%\"><b><u>$nama</u></b><br>
					 $pangkat <br>
					 NIP. $nip</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                  </table>";
                    
                $data['prev']= $cRet;
			if($cetak=='1'){
			$this->_mpdf('',$cRet,10,10,10,'0',1,''); 
				}
				if($cetak=='0'){
				echo $cRet;
				}
       }                  
    }
    
	
	//end pengesahan_spp_tu

   function ambil_sdana(){
        
        $lccr  = '';//$this->input->post('q');
        $tgl = $this->input->post('tgl');
        $skpd = $this->input->post('skpd');
        $giat = $this->input->post('giat');
        $kdrek5 = $this->input->post('kdrek5');
        
        $query1 = $this->tukd_model->qangg_sdana($tgl,$skpd,$giat,$kdrek5);
        //$query1 = $this->db->query("select kd_sdana, nm_sdana from ms_dana") ;
        
        $ii     = 0;
        $result = array();
        foreach ($query1->result_array() as $resulte) {
            
            $result[] = array(
                'id'       => '$ii',
                'sumber' => $resulte['sumber'],
                'anggaran' => number_format($resulte['nilai_sumber'],2,'.',','),
                'anggaran_semp' => number_format($resulte['nilai_sumber_semp'],2,'.',','),
                'anggaran_ubah' => number_format($resulte['nilai_sumber_ubah'],2,'.',',')
                );
                $ii++;    
        }
        
        echo json_encode($result) ;
    }
}	
